import{r as c,M as e,a3 as ke}from"./vendor-D_Wz334c.js";import{D as Me,y as De,z as Ke,A as Pe,e as M,a as Ie,C,b as P,c as I,d as b,B as S,I as Te,h as Q,i as Z,j as ee,k as se,l as u}from"./index-BAtDSpDQ.js";import{S as _e,T as Fe,a as Ae,b as T,c as _}from"./scroll-area-DLqPd2TV.js";import{E as Ee,G as Le,H as $e,L as ze,h as ae,l as Be,C as Ve,I as te,x as Ge,K as le,T as He,n as Oe,u as We,N as Xe,O as Ye,p as qe}from"./icon-vendor-DhUEaqm7.js";import{R as ne,B as re,C as ie,X as ce,Y as de,T as oe,L as me,c as F}from"./chart-vendor-C0q5LQDY.js";import"./utils-vendor-DrCDvq1f.js";import"./ui-vendor-D1gbbhYx.js";const ts=({isOpen:D,onClose:xe,resultIds:v=[],mode:A="single"})=>{const[E,he]=c.useState([]),[je,L]=c.useState(!1),[$,z]=c.useState(null),[ue,ge]=c.useState("overview"),[y,pe]=c.useState(!1),[g,w]=c.useState(0),[R,Ne]=c.useState(10),[K,ve]=c.useState(""),[k,fe]=c.useState("all"),f=A==="compare"&&v.length>1;A==="single"&&v.length;const B=async s=>{L(!0),z(null);try{console.log("📊 분석 결과 상세 정보 요청:",s);const a=s.map(async n=>{try{return{...(await Ie.get(`/api/analysis/results/${n}`)).data,id:n}}catch(r){return console.error(`❌ 결과 ${n} 로딩 실패:`,r),{id:n,error:r.message||"로딩 실패",analysisDate:new Date().toISOString(),neId:"-",cellId:"-",status:"error"}}}),l=await Promise.all(a);he(l),console.log("✅ 분석 결과 상세 정보 로딩 완료:",l)}catch(a){console.error("❌ 분석 결과 상세 정보 로딩 실패:",a),z(a.message||"데이터 로딩에 실패했습니다"),ke.error("분석 결과를 불러오는데 실패했습니다")}finally{L(!1)}};c.useEffect(()=>{D&&v.length>0&&B(v)},[D,v]);const V=s=>{switch(s==null?void 0:s.toLowerCase()){case"success":return"default";case"error":case"failed":return"destructive";case"warning":return"secondary";case"pending":case"processing":return"outline";default:return"secondary"}},G=s=>{try{return new Date(s).toLocaleString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",weekday:"short"})}catch{return s||"-"}},H=s=>{const a=["availability","rrc","erab","sar","mobility_intra","cqi"];return{...s,summary:{totalKpis:a.length,successfulAnalysis:Math.floor(Math.random()*a.length)+1,averageScore:(Math.random()*40+60).toFixed(1),recommendations:Math.floor(Math.random()*5)+1},kpiResults:a.map(l=>({name:l,value:(Math.random()*40+60).toFixed(2),trend:Math.random()>.5?"up":"down",change:(Math.random()*10-5).toFixed(1),status:Math.random()>.8?"warning":"good"})),timeline:Array.from({length:24},(l,n)=>({hour:n,value:Math.random()*100,timestamp:new Date(Date.now()-(23-n)*60*60*1e3).toISOString()})),recommendations:["네트워크 성능 최적화를 위해 특정 셀의 설정 조정을 권장합니다.","RRC 연결 성공률 개선을 위한 안테나 각도 조정이 필요합니다.","ERAB 성공률 향상을 위해 백홀 용량 증설을 고려해보세요."]}},d=c.useMemo(()=>E.map(s=>{var n,r,o,h;if(s.error)return H(s);const a=!!((o=(r=(n=s==null?void 0:s.results)==null?void 0:n[0])==null?void 0:r.kpi_results)!=null&&o.length),l=!!((h=s==null?void 0:s.kpiResults)!=null&&h.length);return a||l?s:H(s)}),[E]),ye=c.useMemo(()=>{var a,l;return f?(((l=(a=d[0])==null?void 0:a.kpiResults)==null?void 0:l.map(n=>n.name))||[]).map(n=>{const r={name:n};return d.forEach((o,h)=>{var j;const x=(j=o.kpiResults)==null?void 0:j.find(p=>p.name===n);r[`결과${h+1}`]=parseFloat((x==null?void 0:x.value)||0)}),r}):null},[d,f]),we=s=>{var a,l,n,r,o,h,x,j,p,t,i,m,N,O,W,X,Y,q,U,J;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(C,{children:[e.jsx(P,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"분석 정보"]})}),e.jsx(b,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"분석 일시"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:G(s.analysisDate)})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"NE ID"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:s.neId||((n=(l=(a=s.results)==null?void 0:a[0])==null?void 0:l.analysis_info)==null?void 0:n.ne)||"-"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cell ID"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:s.cellId||((h=(o=(r=s.results)==null?void 0:r[0])==null?void 0:o.analysis_info)==null?void 0:h.cellid)||"-"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"상태"}),e.jsx(S,{variant:V(s.status),children:s.status||"unknown"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Host"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:((p=(j=(x=s.results)==null?void 0:x[0])==null?void 0:j.analysis_info)==null?void 0:p.host)||"-"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Version"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(S,{variant:"outline",children:((m=(i=(t=s.results)==null?void 0:t[0])==null?void 0:i.analysis_info)==null?void 0:m.version)||"-"})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"평균점수"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"h-4 w-4 text-green-500"}),e.jsxs("span",{className:"font-bold text-lg text-green-600",children:[((O=(N=s.results)==null?void 0:N[0])==null?void 0:O.average_score)||"97.7","%"]})]})]}),e.jsxs("div",{className:"space-y-1 col-span-full",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"평균점수 계산 수식"}),e.jsx("div",{className:"bg-muted/50 p-2 rounded text-sm font-mono",children:((X=(W=s.results)==null?void 0:W[0])==null?void 0:X.score_formula)||"가중 평균 = Σ(PEG값 × 가중치) / Σ(가중치)"})]})]})})]}),e.jsxs(C,{children:[e.jsx(P,{children:e.jsx(I,{children:"분석 요약"})}),e.jsx(b,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((Y=s.summary)==null?void 0:Y.totalKpis)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"총 KPI 수"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:((q=s.summary)==null?void 0:q.successfulAnalysis)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"성공 분석"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[((U=s.summary)==null?void 0:U.averageScore)||0,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"평균 점수"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:((J=s.summary)==null?void 0:J.recommendations)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"권장사항"})]})]})})]})]})},Ce=s=>{var j,p;if(f)return e.jsx(ne,{width:"100%",height:400,children:e.jsxs(re,{data:ye,children:[e.jsx(ie,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"name"}),e.jsx(de,{}),e.jsx(oe,{}),e.jsx(me,{}),d.map((t,i)=>e.jsx(F,{dataKey:`결과${i+1}`,fill:`hsl(${i*60}, 70%, 50%)`},`result${i+1}`))]})});const a=s[0],l=((p=(j=a==null?void 0:a.results)==null?void 0:j[0])==null?void 0:p.kpi_results)||(a==null?void 0:a.kpiResults)||[];if(!l.length)return e.jsx("div",{className:"text-center text-muted-foreground",children:"차트 데이터가 없습니다."});const r=[...l].sort((t,i)=>(i.weight||0)-(t.weight||0)).filter(t=>{const i=!K||t.peg_name.toLowerCase().includes(K.toLowerCase()),m=t.weight||0;let N=!0;return k==="high"?N=m>=8:k==="medium"?N=m>=6&&m<8:k==="low"&&(N=m<6),i&&N}),o=Math.ceil(r.length/R),x=r.slice(g*R,(g+1)*R).map(t=>({name:t.peg_name,"N-1":t.n_minus_1,N:t.n,weight:t.weight,unit:t.unit,peg:t.peg||0}));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"📊 PEG별 N-1/N 성능 비교 (가중치 높은 순)"}),e.jsxs(S,{variant:"outline",children:["전체 ",l.length,"개 중 ",r.length,"개 표시"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(Te,{placeholder:"PEG 이름 검색...",value:K,onChange:t=>{ve(t.target.value),w(0)},className:"pl-8"})]}),e.jsxs(Q,{value:k,onValueChange:t=>{fe(t),w(0)},children:[e.jsxs(Z,{children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),e.jsx(ee,{placeholder:"가중치 필터"})]}),e.jsxs(se,{children:[e.jsx(u,{value:"all",children:"전체"}),e.jsx(u,{value:"high",children:"높음 (≥8)"}),e.jsx(u,{value:"medium",children:"중간 (6-7.9)"}),e.jsx(u,{value:"low",children:"낮음 (<6)"})]})]}),e.jsxs(Q,{value:R.toString(),onValueChange:t=>{Ne(parseInt(t)),w(0)},children:[e.jsx(Z,{children:e.jsx(ee,{placeholder:"표시 개수"})}),e.jsxs(se,{children:[e.jsx(u,{value:"5",children:"5개씩"}),e.jsx(u,{value:"10",children:"10개씩"}),e.jsx(u,{value:"20",children:"20개씩"}),e.jsx(u,{value:"50",children:"50개씩"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(M,{variant:"outline",size:"sm",onClick:()=>w(Math.max(0,g-1)),disabled:g===0,children:e.jsx(Xe,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:[g+1," / ",o||1]}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>w(Math.min(o-1,g+1)),disabled:g>=o-1,children:e.jsx(Ye,{className:"h-4 w-4"})})]})]})]}),e.jsx(ne,{width:"100%",height:500,children:e.jsxs(re,{data:x,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(ie,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"name",angle:-45,textAnchor:"end",height:100,interval:0,fontSize:10}),e.jsx(de,{}),e.jsx(oe,{formatter:(t,i,m)=>[`${t} ${m.payload.unit}`,i],labelFormatter:t=>{const i=x.find(m=>m.name===t);return`${t} (가중치: ${(i==null?void 0:i.weight)||0})`}}),e.jsx(me,{}),e.jsx(F,{dataKey:"N-1",fill:"#ff7300",name:"N-1 기간"}),e.jsx(F,{dataKey:"N",fill:"#8884d8",name:"N 기간"})]})})]})},be=s=>{const a=s.flatMap(l=>l.recommendations||[]);return e.jsx("div",{className:"space-y-4",children:a.map((l,n)=>e.jsx(C,{children:e.jsx(b,{className:"pt-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1",children:e.jsx(qe,{className:"h-5 w-5 text-green-500"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm",children:l})})]})})},n))})},Se=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:[d.length,"개 결과 비교"]}),e.jsx("div",{className:"flex gap-2",children:d.map((s,a)=>e.jsxs(S,{variant:"outline",className:"gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`hsl(${a*60}, 70%, 50%)`}}),"결과 ",a+1]},s.id))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map((s,a)=>e.jsx(C,{className:"border-l-4",style:{borderLeftColor:`hsl(${a*60}, 70%, 50%)`},children:e.jsx(b,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium",children:["결과 ",a+1]}),e.jsx(S,{variant:V(s.status),children:s.status})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:G(s.analysisDate)}),e.jsxs("div",{className:"text-sm",children:["NE: ",s.neId," | Cell: ",s.cellId]})]})})},s.id))})]}),Re=()=>je?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ze,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"분석 결과를 불러오는 중..."})]})}):$?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ae,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"데이터 로딩 오류"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:$}),e.jsxs(M,{onClick:()=>B(v),variant:"outline",children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"다시 시도"]})]})}):d.length===0?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ae,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"분석 결과를 찾을 수 없습니다."})]})}):e.jsxs(Fe,{value:ue,onValueChange:ge,className:"w-full",children:[e.jsxs(Ae,{className:"grid w-full grid-cols-3",children:[e.jsx(T,{value:"overview",children:"개요"}),e.jsx(T,{value:"kpi",children:"KPI 결과"}),e.jsx(T,{value:"recommendations",children:"권장사항"})]}),e.jsx(_,{value:"overview",className:"space-y-4 mt-6",children:f?Se():we(d[0])}),e.jsx(_,{value:"kpi",className:"space-y-4 mt-6",children:e.jsxs(C,{children:[e.jsx(P,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5"}),f?"KPI 비교 차트":"KPI 분석 결과"]})}),e.jsx(b,{children:Ce(d)})]})}),e.jsx(_,{value:"recommendations",className:"space-y-4 mt-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"AI 권장사항"}),be(d)]})})]});return e.jsx(Me,{open:D,onOpenChange:xe,children:e.jsxs(De,{className:`${y?"max-w-7xl h-[92vh] w-[95vw]":"max-w-6xl max-h-[85vh] w-[90vw]"}`,children:[e.jsx(Ke,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Pe,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),f?"분석 결과 비교":"분석 결과 상세"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>pe(!y),title:y?"원래 크기로":"최대화",children:y?e.jsx(Le,{className:"h-4 w-4"}):e.jsx($e,{className:"h-4 w-4"})})})]})}),e.jsx(_e,{className:y?"h-full":"max-h-[70vh]",children:e.jsx("div",{className:"px-1",children:Re()})})]})})};export{ts as default};

import{r as d,M as s,a3 as r}from"./vendor-D_Wz334c.js";import{g as I,C as m,b as x,c as u,d as h,e as w,B as y,L as N,I as b,t as P,v as F,w as B}from"./index-BAtDSpDQ.js";import{B as k,D as R,S as z,L as E,q as $,g as q,F as Q}from"./icon-vendor-DhUEaqm7.js";import"./utils-vendor-DrCDvq1f.js";import"./ui-vendor-D1gbbhYx.js";const V=()=>{var M;const{settings:j}=I(),n=(j==null?void 0:j.databaseSettings)||{host:"",port:5432,user:"postgres",password:"",dbname:"postgres",table:"summary"},[l,Y]=d.useState({n_minus_1:"",n:"",table:"summary",ne:"",cellid:"",preference:"",columns:{time:"datetime",peg_name:"peg_name",value:"value",ne:"ne",cellid:"cellid"}}),[L,D]=d.useState(!1),[i,p]=d.useState(null),[g,o]=d.useState(!1),[a,_]=d.useState(null),[C,H]=d.useState([]),A=async()=>{if(!n.host||!n.password){r.error("Hostì™€ PasswordëŠ” í•„ìˆ˜ ì…ë ¥ê°’ì…ë‹ˆë‹¤.");return}D(!0);try{const e=await P(n);e.success?(p({type:"success",message:"Database ì—°ê²° ì„±ê³µ"}),r.success("Database ì—°ê²°ì´ ì„±ê³µí–ˆìŠµë‹ˆë‹¤.")):(p({type:"error",message:e.error}),r.error(`Database ì—°ê²° ì‹¤íŒ¨: ${e.error}`))}catch(e){console.error("Connection test error:",e),p({type:"error",message:e.message}),r.error("ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}finally{D(!1)}},S=async()=>{if(!l.n_minus_1||!l.n){r.error("ë¶„ì„ ê¸°ê°„(N-1, N)ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}if((i==null?void 0:i.type)!=="success"){r.error("ë¨¼ì € Database ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");return}o(!0);try{console.log("ğŸš€ LLM ë¶„ì„ ì‹œì‘:",{dbConfig:n,analysisParams:l});const e=await F(n,l,"default");console.log("âœ… LLM ë¶„ì„ íŠ¸ë¦¬ê±° ì„±ê³µ:",e),_({id:e.analysis_id,status:"processing",message:e.message,startTime:new Date}),r.success("LLM ë¶„ì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."),T(e.analysis_id)}catch(e){console.error("âŒ LLM ë¶„ì„ ìš”ì²­ ì‹¤íŒ¨:",e),r.error(`ë¶„ì„ ìš”ì²­ ì‹¤íŒ¨: ${e.message}`),o(!1)}},T=e=>{const c=setInterval(async()=>{try{const t=await B(e);console.log("ğŸ“Š í´ë§ ê²°ê³¼:",t),(t.status==="completed"||t.status==="error")&&(clearInterval(c),o(!1),_(v=>({...v,status:t.status,result:t,endTime:new Date})),H(v=>[{id:e,status:t.status,startTime:new Date,params:l,result:t},...v]),t.status==="completed"?r.success("LLM ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"):r.error("LLM ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."))}catch(t){console.error("í´ë§ ì˜¤ë¥˜:",t),clearInterval(c),o(!1)}},5e3);setTimeout(()=>{clearInterval(c),g&&(o(!1),r.error("ë¶„ì„ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”."))},6e5)},f=(e,c)=>{Y(t=>({...t,[e]:c}))};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs(m,{children:[s.jsx(x,{children:s.jsxs(u,{className:"flex items-center gap-2",children:[s.jsx(k,{className:"h-5 w-5"}),"LLM ë¶„ì„ ê´€ë¦¬ì"]})}),s.jsx(h,{children:s.jsx("p",{className:"text-muted-foreground",children:"PostgreSQL Databaseì—ì„œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ì—¬ LLM ê¸°ë°˜ ì„±ëŠ¥ ë¶„ì„ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤."})})]}),s.jsxs(m,{children:[s.jsx(x,{children:s.jsxs(u,{className:"flex items-center gap-2",children:[s.jsx(R,{className:"h-5 w-5"}),"Database ì„¤ì •"]})}),s.jsxs(h,{children:[s.jsxs("p",{className:"text-sm text-muted-foreground",children:["Database ì„¤ì •ì€ ì´ì œ ",s.jsx("strong",{children:"í™˜ê²½ì„¤ì • > Database"})," íƒ­ì—ì„œ í†µí•© ê´€ë¦¬ë©ë‹ˆë‹¤. ì´ í™”ë©´ì—ì„œëŠ” Preferenceì— ì €ì¥ëœ ì„¤ì •ì„ ì‚¬ìš©í•©ë‹ˆë‹¤."]}),s.jsxs("div",{className:"mt-3 text-sm",children:[s.jsxs("div",{children:["Host: ",s.jsx("span",{className:"font-mono",children:n.host||"-"})]}),s.jsxs("div",{children:["Port: ",s.jsx("span",{className:"font-mono",children:n.port||"-"})]}),s.jsxs("div",{children:["User: ",s.jsx("span",{className:"font-mono",children:n.user||"-"})]}),s.jsxs("div",{children:["DB: ",s.jsx("span",{className:"font-mono",children:n.dbname||"-"})]}),s.jsxs("div",{children:["Table: ",s.jsx("span",{className:"font-mono",children:n.table||"-"})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx(w,{onClick:A,disabled:L,children:L?"Testing...":"Test Connection (Preference ì„¤ì • ì‚¬ìš©)"}),i&&s.jsx(y,{className:"ml-2",variant:i.type==="success"?"default":"destructive",children:i.message})]})]})]}),s.jsxs(m,{children:[s.jsx(x,{children:s.jsxs(u,{className:"flex items-center gap-2",children:[s.jsx(z,{className:"h-5 w-5"}),"ë¶„ì„ íŒŒë¼ë¯¸í„°"]})}),s.jsxs(h,{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(N,{htmlFor:"n_minus_1",children:"N-1 ê¸°ê°„"}),s.jsx(b,{id:"n_minus_1",value:l.n_minus_1,onChange:e=>f("n_minus_1",e.target.value),placeholder:"YYYY-MM-DD_HH:mm~YYYY-MM-DD_HH:mm"})]}),s.jsxs("div",{children:[s.jsx(N,{htmlFor:"n",children:"N ê¸°ê°„"}),s.jsx(b,{id:"n",value:l.n,onChange:e=>f("n",e.target.value),placeholder:"YYYY-MM-DD_HH:mm~YYYY-MM-DD_HH:mm"})]}),s.jsxs("div",{children:[s.jsx(N,{htmlFor:"table",children:"í…Œì´ë¸”ëª…"}),s.jsx(b,{id:"table",value:l.table,onChange:e=>f("table",e.target.value),placeholder:"summary"})]})]}),s.jsx("div",{className:"flex items-center gap-3",children:s.jsx(w,{onClick:S,disabled:g,children:g?s.jsxs(s.Fragment,{children:[s.jsx(E,{className:"h-4 w-4 animate-spin mr-2"})," ë¶„ì„ ì¤‘..."]}):s.jsxs(s.Fragment,{children:[s.jsx($,{className:"h-4 w-4 mr-2"})," ë¶„ì„ ì‹œì‘"]})})})]})]}),a&&s.jsxs(m,{children:[s.jsx(x,{children:s.jsxs(u,{className:"flex items-center gap-2",children:[s.jsx(q,{className:"h-5 w-5"}),"í˜„ì¬ ë¶„ì„ ìƒíƒœ"]})}),s.jsxs(h,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"font-medium",children:["ë¶„ì„ ID: ",a.id]}),s.jsx("p",{className:"text-sm text-muted-foreground",children:a.message})]}),s.jsx(y,{variant:a.status==="processing"?"default":a.status==="completed"?"success":"destructive",children:a.status==="processing"?"ì²˜ë¦¬ ì¤‘":a.status==="completed"?"ì™„ë£Œ":"ì˜¤ë¥˜"})]}),a.result&&a.status==="completed"&&s.jsxs("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:[s.jsx("p",{className:"font-medium mb-2",children:"ë¶„ì„ ê²°ê³¼"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[a.result.report_path&&s.jsxs("p",{children:["ğŸ“„ ë¦¬í¬íŠ¸: ",a.result.report_path]}),((M=a.result.results)==null?void 0:M.analysis)&&s.jsx("p",{children:"ğŸ§  LLM ë¶„ì„: ì™„ë£Œ"})]})]})]})]}),C.length>0&&s.jsxs(m,{children:[s.jsx(x,{children:s.jsxs(u,{className:"flex items-center gap-2",children:[s.jsx(Q,{className:"h-5 w-5"}),"ë¶„ì„ íˆìŠ¤í† ë¦¬"]})}),s.jsx(h,{children:s.jsx("div",{className:"space-y-3",children:C.map((e,c)=>s.jsxs("div",{className:"border rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("p",{className:"font-medium text-sm",children:["ë¶„ì„ #",c+1]}),s.jsx(y,{variant:e.status==="completed"?"success":"destructive",children:e.status==="completed"?"ì™„ë£Œ":"ì˜¤ë¥˜"})]}),s.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[s.jsxs("p",{children:["ê¸°ê°„: ",e.params.n_minus_1," vs ",e.params.n]}),s.jsxs("p",{children:["ì‹œê°„: ",e.startTime.toLocaleString()]}),s.jsxs("p",{children:["ID: ",e.id]})]})]},e.id))})})]})]})};export{V as default};

import{r as e,M as t}from"./vendor-CPBPwzYD.js";import{f as M,g as k,B as d,a as v}from"./index-BifUC4c9.js";import{T as _,a as F,b as A,c as I}from"./scroll-area-DQuTYI96.js";import K from"./AdvancedChart-BZzIsTNp.js";import U from"./BasicComparison-udRy6JK-.js";import{h as $,T as q,C as G}from"./icon-vendor-DwJrfwQP.js";import"./ui-vendor-nq4IHmv4.js";import"./utils-vendor-DrCDvq1f.js";import"./chart-vendor-BCXW5yoB.js";import"./ComparisonChart-_b3qqr6-.js";const wt=()=>{const{settings:f,saving:T,error:R}=M(),g=f.defaultDateRange||7,u=f.defaultNe||"",m=f.defaultCellId||"",N=f.decimalPlaces||2,j=f.showComparisonOptions!==!1,w=f.autoCalculateStats!==!1,[Q,B]=e.useState({startDate:new Date(Date.now()-g*24*60*60*1e3).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],ne:u,cellid:m}),[D,V]=e.useState([]),{settings:n}=k(),s=(n==null?void 0:n.databaseSettings)||{host:"",port:5432,user:"",password:"",dbname:"",table:"summary"},[z,J]=e.useState({status:"idle",message:""}),[W,X]=e.useState(null),[Y,Z]=e.useState(""),[tt,st]=e.useState(!1),[et,O]=e.useState([]),[at,L]=e.useState([]),[lt,rt]=e.useState([]),[it,nt]=e.useState([]),[ct,ot]=e.useState([]),[p,P]=e.useState([]),[dt,E]=e.useState([]),[x,y]=e.useState([]),[ut,C]=e.useState([]),[mt,b]=e.useState([]),H=[{value:"availability",label:"Availability"},{value:"rrc",label:"RRC Success Rate"},{value:"erab",label:"ERAB Success Rate"},{value:"sar",label:"SAR"},{value:"mobility_intra",label:"Mobility Intra"},{value:"cqi",label:"CQI"},{value:"se",label:"Spectral Efficiency"},{value:"dl_thp",label:"DL Throughput"},{value:"ul_int",label:"UL Interference"}],[pt,St]=e.useState(H);return e.useEffect(()=>{console.log("[Statistics] 설정 변경 감지:",{defaultDateRange:g,defaultNe:u,defaultCellId:m,decimalPlaces:N}),B(r=>({...r,startDate:new Date(Date.now()-g*24*60*60*1e3).toISOString().split("T")[0],ne:u,cellid:m}))},[g,u,m]),e.useEffect(()=>{(async()=>{var c,i;try{console.info("[Statistics] Fetching DB PEGs & NE/Cells");const a={host:String(s.host||"").trim(),port:Number(s.port)||5432,user:String(s.user||"").trim(),password:String(s.password||"").trim(),dbname:String(s.dbname||"").trim(),table:String(s.table||"summary").trim(),limit:500},[S,h]=await Promise.all([v.post("/api/master/pegs",a),v.post("/api/master/ne-cells",a)]),l=(((c=S.data)==null?void 0:c.pegs)||[]).map(o=>({value:o.id||o.name,label:o.name||o.id}));O(l),L(((i=h.data)==null?void 0:i.sampleCells)||{}),console.info("[Statistics] Master loaded (DB):",l.length)}catch(a){console.error("Error fetching DB master data:",a)}})()},[s.host,s.port,s.user,s.password,s.dbname,s.table]),e.useEffect(()=>{const r=(n==null?void 0:n.statisticsSettings)||{};P(Array.isArray(r.selectedHosts)?r.selectedHosts:[]),y(Array.isArray(r.selectedNEs)?r.selectedNEs:[]),b(Array.isArray(r.selectedCellIds)?r.selectedCellIds:[])},[n==null?void 0:n.statisticsSettings]),e.useEffect(()=>{(async()=>{var c;try{if(p.length===0){E([]),y([]);return}const i={host:String(s.host||"").trim(),port:Number(s.port)||5432,user:String(s.user||"").trim(),password:String(s.password||"").trim(),dbname:String(s.dbname||"").trim(),table:String(s.table||"summary").trim(),hosts:p};console.info("[Statistics] NE 목록 조회(host 필터) 요청:",p);const a=await v.post("/api/master/nes-by-host",i),S=Array.isArray((c=a==null?void 0:a.data)==null?void 0:c.nes)?a.data.nes:[];E(S),y([]),C([]),b([]);const h=String(u||"").split(",").map(l=>l.trim()).filter(Boolean);if(h.length>0){const l=h.filter(o=>S.includes(o));l.length>0&&(console.info("[Statistics] 기본 NE 자동 선택:",l),y(l))}}catch(i){console.error("[Statistics] NE 목록 조회 실패",i)}})()},[p]),e.useEffect(()=>{(async()=>{var c;try{if(p.length===0||x.length===0){C([]),b([]);return}const i={host:String(s.host||"").trim(),port:Number(s.port)||5432,user:String(s.user||"").trim(),password:String(s.password||"").trim(),dbname:String(s.dbname||"").trim(),table:String(s.table||"summary").trim(),hosts:p,nes:x};console.info("[Statistics] CellID 목록 조회(host/ne 필터) 요청:",{hosts:p,nes:x});const a=await v.post("/api/master/cells-by-host-ne",i),S=Array.isArray((c=a==null?void 0:a.data)==null?void 0:c.cellids)?a.data.cellids:[];C(S),b([]);const h=String(m||"").split(",").map(l=>l.trim()).filter(Boolean);if(h.length>0){const l=h.filter(o=>S.includes(o));l.length>0&&(console.info("[Statistics] 기본 CellID 자동 선택:",l),b(l))}}catch(i){console.error("[Statistics] CellID 목록 조회 실패",i)}})()},[x]),D.length>0&&Object.keys(D[0]).filter(r=>r!=="time"),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-3xl font-bold",children:"Statistics"}),t.jsxs("p",{className:"text-muted-foreground",children:["기본 날짜 범위: ",g,"일 • 소수점: ",N,"자리",u&&` • 기본 NE: ${u}`,m&&` • 기본 Cell: ${m}`]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[T&&t.jsxs(d,{variant:"secondary",className:"text-xs",children:[t.jsx($,{className:"h-3 w-3 mr-1"}),"설정 저장 중"]}),R&&t.jsx(d,{variant:"destructive",className:"text-xs",children:"설정 오류"}),w&&t.jsxs(d,{variant:"outline",className:"text-xs",children:[t.jsx(q,{className:"h-3 w-3 mr-1"}),"자동 통계 계산"]}),j&&t.jsxs(d,{variant:"outline",className:"text-xs",children:[t.jsx(G,{className:"h-3 w-3 mr-1"}),"비교 옵션 활성"]})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs(d,{variant:"default",children:["기본 기간: ",g,"일"]}),t.jsxs(d,{variant:"outline",children:["소수점: ",N,"자리"]}),w&&t.jsx(d,{variant:"secondary",children:"자동 통계 계산"}),j&&t.jsx(d,{variant:"secondary",children:"비교 옵션"})]}),t.jsxs(_,{defaultValue:"basic",className:"w-full",children:[t.jsxs(F,{className:"grid w-full grid-cols-2",children:[t.jsx(A,{value:"basic",children:"Basic Analysis"}),t.jsx(A,{value:"advanced",children:"Advanced Analysis"})]}),t.jsx(I,{value:"basic",className:"space-y-6",children:t.jsx(U,{})}),t.jsx(I,{value:"advanced",className:"space-y-6",children:t.jsx(K,{})})]})]})};export{wt as default};

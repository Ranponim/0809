import{r as c,M as e,a3 as g}from"./vendor-CIPdjx1t.js";import{a as V,B as b,i as N,F as K,C as x,b as Q,c as U,d as h,L as y,S as me,e as xe,f as he,g as ue,h as D,T as ge,m as je,n as H,o as J}from"./index-Q594mB1I.js";import{S as W}from"./separator-DidKRWFN.js";import{S as pe}from"./scroll-area-ZOOfn5zd.js";import f from"./ComparisonChart-Dm_WdRJP.js";import{b as be,a as fe}from"./usePreference-BdPvxwX6.js";import{C as ve}from"./checkbox-DNwZZDik.js";import{R as X,P as Ne,S as ye,D as De,k as Y,E as Se,C as Z,r as Ce,M as Pe,N as we,a as _e}from"./icon-vendor-CWV3Q6sV.js";import"./utils-vendor-DrCDvq1f.js";import"./ui-vendor-C5A5DcrM.js";import"./chart-vendor-CWmmjCk1.js";const Le=()=>{var O,B,L,M,F,q;const{settings:i}=be(),{updatePreference:ee,isSaving:_}=fe(),[o,S]=c.useState({startDate:"",endDate:"",preset:"last7days"}),[m,C]=c.useState({startDate:"",endDate:"",preset:"last14days"}),[u,v]=c.useState(["availability","rrc","erab"]),[j,E]=c.useState(!0),[P,T]=c.useState(4),[r,se]=c.useState(null),[I,A]=c.useState(!1),[w,G]=c.useState(null),[R,ae]=c.useState(null),[d,p]=c.useState(new Set),k=c.useMemo(()=>i!=null&&i.table?[{value:"availability",label:"Availability (%)"},{value:"rrc",label:"RRC Success Rate (%)"},{value:"erab",label:"ERAB Success Rate (%)"},{value:"sar",label:"SAR"},{value:"mobility_intra",label:"Mobility Intra (%)"},{value:"cqi",label:"CQI"}]:[],[i==null?void 0:i.table]),$=c.useCallback(async()=>{console.log("ğŸ” Available PEGs ë¡œë“œ ì‹œì‘");try{const s=localStorage.getItem("dbConfig"),a=localStorage.getItem("useDbPegs")==="true";console.log("ğŸ“Š DB ì„¤ì • ìƒíƒœ:",{hasDbConfig:!!s,useDbPegs:a,dbConfigData:s?JSON.parse(s):null});let t=[];if(a&&s){console.log("ğŸ”— Databaseì—ì„œ PEG ëª©ë¡ ì¡°íšŒ ì¤‘...");const l=await V.get("/api/master/pegs");console.log("ğŸ“¥ Database PEG ì‘ë‹µ:",l.data),l.data&&Array.isArray(l.data)&&(t=l.data.map(n=>({value:n.peg_name||n.value||n.id,label:n.display_name||n.label||`${n.peg_name} (${n.unit||"N/A"})`})))}if(t.length===0&&(console.log("ğŸ“ ê¸°ë³¸ PEG ëª©ë¡ ì‚¬ìš©"),t=[{value:"availability",label:"Availability (%)"},{value:"rrc",label:"RRC Success Rate (%)"},{value:"erab",label:"ERAB Success Rate (%)"},{value:"sar",label:"SAR"},{value:"mobility_intra",label:"Mobility Intra (%)"},{value:"cqi",label:"CQI"},{value:"se",label:"Spectral Efficiency"},{value:"dl_thp",label:"DL Throughput"},{value:"ul_int",label:"UL Interference"}]),console.log("âœ… PEG ëª©ë¡ ë¡œë“œ ì™„ë£Œ:",t),u.length===0&&t.length>0){const l=t.slice(0,3).map(n=>n.value);v(l),console.log("ğŸ¯ ê¸°ë³¸ PEG ì„ íƒ:",l)}}catch(s){console.error("âŒ PEG ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:",s)}finally{}},[u.length]);c.useEffect(()=>{const s=new Date,a=new Date(s),t=new Date(s.getTime()-10080*60*1e3),l=new Date(t),n=new Date(t.getTime()-10080*60*1e3);S({startDate:t.toISOString().split("T")[0],endDate:a.toISOString().split("T")[0],preset:"last7days"}),C({startDate:n.toISOString().split("T")[0],endDate:l.toISOString().split("T")[0],preset:"custom"}),$()},[$]),c.useEffect(()=>{i.defaultPegs&&v(i.defaultPegs),i.decimalPlaces!==void 0&&T(i.decimalPlaces),i.includeOutliers!==void 0&&E(i.includeOutliers)},[i]);const te=c.useCallback(({startDate:s,endDate:a})=>{S(t=>({...t,startDate:s,endDate:a,preset:"custom"}))},[]),le=c.useCallback(({startDate:s,endDate:a})=>{C(t=>({...t,startDate:s,endDate:a,preset:"custom"}))},[]),re=async()=>{var s,a,t;if(!o.startDate||!o.endDate||!m.startDate||!m.endDate){g.error("ë‘ ê¸°ê°„ì˜ ë‚ ì§œë¥¼ ëª¨ë‘ ì„¤ì •í•´ì£¼ì„¸ìš”");return}if(u.length===0){g.error("ë¶„ì„í•  PEGë¥¼ ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”");return}A(!0),G(null);try{console.log("ğŸ” Statistics ë¹„êµ ë¶„ì„ ì‹œì‘:",{period1:o,period2:m,selectedPegs:u,includeOutliers:j,decimalPlaces:P});const l={period1:{start_date:`${o.startDate}T00:00:00`,end_date:`${o.endDate}T23:59:59`},period2:{start_date:`${m.startDate}T00:00:00`,end_date:`${m.endDate}T23:59:59`},peg_names:u,include_outliers:j,decimal_places:P,ne_filter:i.defaultNe?[i.defaultNe]:null,cell_id_filter:i.defaultCellId?[i.defaultCellId]:null};console.log("ğŸ“¤ API ìš”ì²­ í˜ì´ë¡œë“œ:",l);const n=await V.post("/api/statistics/compare",l);console.log("ğŸ“¥ API ì‘ë‹µ:",n.data),se(n.data),ae(new Date),g.success(`ë¹„êµ ë¶„ì„ ì™„ë£Œ! ${((s=n.data.analysis_results)==null?void 0:s.length)||0}ê°œ PEG ë¶„ì„ë¨`)}catch(l){console.error("âŒ ë¹„êµ ë¶„ì„ ì‹¤íŒ¨:",l);let n="ë¹„êµ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤";(t=(a=l.response)==null?void 0:a.data)!=null&&t.error_message?n=l.response.data.error_message:l.message&&(n=l.message),G(n),g.error(n)}finally{A(!1)}},ne=s=>{const a=new Set(d);a.has(s)?a.delete(s):a.add(s),p(a)},ie=()=>{var s,a;if(d.size===((s=r==null?void 0:r.analysis_results)==null?void 0:s.length))p(new Set);else{const t=((a=r==null?void 0:r.analysis_results)==null?void 0:a.map(l=>l.peg_name))||[];p(new Set(t))}},ce=async()=>{if(d.size===0){g.error("ì €ì¥í•  PEGë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”");return}try{console.log("ğŸ’¾ Dashboardì— ì €ì¥í•  PEG:",Array.from(d));const s=dashboardSettings||{},a=(s==null?void 0:s.selectedPegs)||[],t=Array.from(d).filter(n=>!a.includes(n)),l=[...a,...t];console.log("ğŸ“Š í˜„ì¬ Dashboard PEG:",a),console.log("ğŸ†• ì¶”ê°€í•  ìƒˆ PEG:",t),console.log("ğŸ“ˆ ì—…ë°ì´íŠ¸ëœ PEG ëª©ë¡:",l),await ee("dashboardSettings",{...s,selectedPegs:l}),g.success(`${d.size}ê°œ PEGê°€ Dashboardì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤`,{description:`ì´ ${l.length}ê°œ PEGê°€ Dashboardì— ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤. Dashboardë¡œ ì´ë™í•´ì„œ í™•ì¸í•´ë³´ì„¸ìš”!`,duration:5e3}),p(new Set)}catch(s){console.error("âŒ Dashboard ì €ì¥ ì‹¤íŒ¨:",s),g.error("Dashboard ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤",{description:s.message||"ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤"})}},z=o.startDate&&o.endDate&&m.startDate&&m.endDate&&u.length>0,de=s=>{switch(s){case"improved":return e.jsx(_e,{className:"h-4 w-4 text-green-500"});case"degraded":return e.jsx(we,{className:"h-4 w-4 text-red-500"});case"stable":return e.jsx(Pe,{className:"h-4 w-4 text-blue-500"});default:return e.jsx(Y,{className:"h-4 w-4 text-yellow-500"})}},oe=(s,a)=>{const t={improved:"bg-green-100 text-green-800 border-green-200",degraded:"bg-red-100 text-red-800 border-red-200",stable:"bg-blue-100 text-blue-800 border-blue-200"},l={significant:"ìƒë‹¹í•œ",moderate:"ë³´í†µ",minor:"ë¯¸ë¯¸í•œ",none:"ë³€í™”ì—†ìŒ"};return e.jsxs(b,{className:`${t[s]||"bg-gray-100 text-gray-800"} text-xs`,children:[de(s),e.jsxs("span",{className:"ml-1",children:[s==="improved"?"ê°œì„ ":s==="degraded"?"ì•…í™”":"ì•ˆì •",a&&` (${l[a]})`]})]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Basic ë¹„êµ ë¶„ì„"}),e.jsx("p",{className:"text-muted-foreground",children:"ë‘ ê¸°ê°„ì˜ KPI ë°ì´í„°ë¥¼ ë¹„êµí•˜ì—¬ ì„±ëŠ¥ ë³€í™”ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[R&&e.jsxs(b,{variant:"outline",className:"text-xs",children:["ë§ˆì§€ë§‰ ë¶„ì„: ",R.toLocaleTimeString("ko-KR")]}),e.jsx(N,{onClick:re,disabled:!z||I,className:"bg-blue-600 hover:bg-blue-700",children:I?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-4 w-4 mr-2 animate-spin"}),"ë¶„ì„ ì¤‘..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"ë¹„êµ ë¶„ì„ ì‹¤í–‰"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(K,{title:"ê¸°ê°„ 1 (ê¸°ì¤€)",description:"ë¹„êµì˜ ê¸°ì¤€ì´ ë˜ëŠ” ì²« ë²ˆì§¸ ê¸°ê°„",startDate:o.startDate,endDate:o.endDate,preset:o.preset,onDateChange:te,onPresetChange:s=>S(a=>({...a,preset:s}))}),e.jsx(K,{title:"ê¸°ê°„ 2 (ë¹„êµ ëŒ€ìƒ)",description:"ê¸°ì¤€ê³¼ ë¹„êµí•  ë‘ ë²ˆì§¸ ê¸°ê°„",startDate:m.startDate,endDate:m.endDate,preset:m.preset,onDateChange:le,onPresetChange:s=>C(a=>({...a,preset:s}))}),e.jsxs(x,{children:[e.jsx(Q,{className:"pb-3",children:e.jsxs(U,{className:"flex items-center gap-2 text-base",children:[e.jsx(ye,{className:"h-4 w-4"}),"ë¶„ì„ ì˜µì…˜"]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{className:"text-sm font-medium flex items-center justify-between",children:e.jsx("span",{children:"ë¶„ì„í•  PEG"})}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:k.length>0?k.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ve,{id:`peg-${s.value}`,checked:u.includes(s.value),onCheckedChange:a=>{v(a?t=>[...t,s.value]:t=>t.filter(l=>l!==s.value))}}),e.jsx(y,{htmlFor:`peg-${s.value}`,className:"text-sm cursor-pointer flex-1",children:s.label})]},s.value)):e.jsxs("div",{className:"text-center text-muted-foreground py-4",children:[e.jsx(De,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"ì‚¬ìš© ê°€ëŠ¥í•œ PEGê°€ ì—†ìŠµë‹ˆë‹¤"}),e.jsx("p",{className:"text-xs",children:"Database ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”"})]})}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(b,{variant:"outline",className:"text-xs",children:[u.length,"ê°œ ì„ íƒë¨"]})})]}),e.jsx(W,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{className:"text-sm",children:"ì´ìƒì¹˜ í¬í•¨"}),e.jsx(N,{variant:j?"default":"outline",size:"sm",onClick:()=>E(!j),children:j?"í¬í•¨":"ì œì™¸"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{className:"text-sm",children:"ì†Œìˆ˜ì  ìë¦¿ìˆ˜"}),e.jsxs(me,{value:P.toString(),onValueChange:s=>T(parseInt(s)),children:[e.jsx(xe,{children:e.jsx(he,{})}),e.jsxs(ue,{children:[e.jsx(D,{value:"2",children:"2ìë¦¬"}),e.jsx(D,{value:"3",children:"3ìë¦¬"}),e.jsx(D,{value:"4",children:"4ìë¦¬"}),e.jsx(D,{value:"5",children:"5ìë¦¬"})]})]})]})]})]})]})]}),w&&e.jsx(x,{className:"border-red-200 bg-red-50",children:e.jsxs(h,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"text-red-700 font-medium",children:"ë¶„ì„ ì˜¤ë¥˜"})]}),e.jsx("p",{className:"text-red-600 mt-2",children:w})]})}),r&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(W,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"ë¹„êµ ë¶„ì„ ê²°ê³¼"}),e.jsx("div",{className:"mb-6",children:e.jsx(f,{comparisonResults:r,title:"PEG ë¹„êµ ë¶„ì„ ì°¨íŠ¸",showControls:!0,defaultChartType:"bar",height:400})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(x,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((O=r.summary)==null?void 0:O.total_pegs_analyzed)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"ë¶„ì„ëœ PEG"})]})})}),e.jsx(x,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:((B=r.summary)==null?void 0:B.improved_count)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"ê°œì„ "})]})})}),e.jsx(x,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:((L=r.summary)==null?void 0:L.degraded_count)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"ì•…í™”"})]})})}),e.jsx(x,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((M=r.summary)==null?void 0:M.stable_count)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"ì•ˆì •"})]})})})]}),e.jsxs(x,{children:[e.jsx(Q,{children:e.jsx(U,{children:"ìƒì„¸ ë¹„êµ ê²°ê³¼"})}),e.jsx(h,{children:e.jsxs(ge,{defaultValue:"table",className:"w-full",children:[e.jsxs(je,{className:"grid w-full grid-cols-2",children:[e.jsxs(H,{value:"table",className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),"í…Œì´ë¸” ë·°"]}),e.jsxs(H,{value:"chart",className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),"ì°¨íŠ¸ ë·°"]})]}),e.jsxs(J,{value:"table",className:"space-y-4",children:[((F=r==null?void 0:r.analysis_results)==null?void 0:F.length)>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 border border-slate-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:d.size===r.analysis_results.length&&d.size>0,onChange:ie,className:"w-4 h-4 text-blue-600 rounded"}),e.jsxs("span",{className:"text-sm font-medium",children:["ì „ì²´ ì„ íƒ (",d.size,"/",r.analysis_results.length,")"]})]}),d.size>0&&e.jsxs(b,{variant:"secondary",className:"bg-blue-100 text-blue-700",children:[d.size,"ê°œ ì„ íƒë¨"]})]}),d.size>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>p(new Set),children:"ì„ íƒ í•´ì œ"}),e.jsx(N,{size:"sm",onClick:ce,disabled:_,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400",children:_?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-3 w-3 mr-1 animate-spin"}),"ì €ì¥ ì¤‘..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"h-3 w-3 mr-1"}),"Dashboardì— ì €ì¥"]})})]})]}),e.jsx(pe,{className:"h-96",children:e.jsx("div",{className:"space-y-4",children:(q=r.analysis_results)==null?void 0:q.map((s,a)=>{var t,l;return e.jsx(x,{className:`border-l-4 border-l-blue-500 ${d.has(s.peg_name)?"ring-2 ring-blue-500 bg-blue-50":""}`,children:e.jsxs(h,{className:"pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:d.has(s.peg_name),onChange:()=>ne(s.peg_name),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("h4",{className:"font-semibold",children:s.peg_name})]}),oe(s.improvement_status,s.improvement_magnitude)]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"ê¸°ê°„ 1 í‰ê· "}),e.jsx("div",{className:"font-medium",children:(t=s.period1_stats)==null?void 0:t.mean})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"ê¸°ê°„ 2 í‰ê· "}),e.jsx("div",{className:"font-medium",children:(l=s.period2_stats)==null?void 0:l.mean})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Delta"}),e.jsxs("div",{className:`font-medium ${s.delta>0?"text-green-600":s.delta<0?"text-red-600":"text-blue-600"}`,children:[s.delta>0?"+":"",s.delta]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Delta %"}),e.jsxs("div",{className:`font-medium ${s.delta_percentage>0?"text-green-600":s.delta_percentage<0?"text-red-600":"text-blue-600"}`,children:[s.delta_percentage>0?"+":"",s.delta_percentage,"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3 pt-3 border-t text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"ê¸°ê°„ 1 RSD"}),e.jsxs("div",{className:"font-medium",children:[s.rsd_period1,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"ê¸°ê°„ 2 RSD"}),e.jsxs("div",{className:"font-medium",children:[s.rsd_period2,"%"]})]})]})]})},a)})})})]}),e.jsx(J,{value:"chart",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(f,{comparisonResults:r,title:"ë§‰ëŒ€ ì°¨íŠ¸",showControls:!1,defaultChartType:"bar",height:300}),e.jsx(f,{comparisonResults:r,title:"ë¼ì¸ ì°¨íŠ¸",showControls:!1,defaultChartType:"line",height:300}),e.jsx(f,{comparisonResults:r,title:"ê°œì„  ìƒíƒœ ë¶„í¬",showControls:!1,defaultChartType:"pie",height:300}),e.jsx(f,{comparisonResults:r,title:"ë ˆì´ë” ì°¨íŠ¸",showControls:!1,defaultChartType:"radar",height:300})]})})})]})})]})]})]}),!r&&!w&&e.jsx(x,{className:"text-center py-12",children:e.jsxs(h,{children:[e.jsx(Z,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"ë¹„êµ ë¶„ì„ ì¤€ë¹„"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"ë‘ ê¸°ê°„ê³¼ ë¶„ì„í•  PEGë¥¼ ì„ íƒí•œ í›„ 'ë¹„êµ ë¶„ì„ ì‹¤í–‰' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”"}),e.jsx(b,{variant:"outline",children:z?"ë¶„ì„ ì¤€ë¹„ ì™„ë£Œ":"ì„¤ì • í•„ìš”"})]})})]})};export{Le as default};

import{M as e,r as c,a3 as se}from"./vendor-CIPdjx1t.js";import{C as R,b as H,c as U,B as A,p as ve,d as M,A as Me,q as Ve,i as D,L as b,S as Ce,e as ke,f as De,g as Ee,h as K,I as he,P as Xe,r as Qe,a as ue,T as Ye,m as Ke,n as me,o as xe}from"./index-Q594mB1I.js";import{a as Fe}from"./usePreference-BdPvxwX6.js";import{S as pe}from"./switch-B92w76t-.js";import{C as qe}from"./checkbox-DNwZZDik.js";import{S as Oe}from"./separator-DidKRWFN.js";import{r as es,s as ss,t as as}from"./ui-vendor-C5A5DcrM.js";import{c as Ne,i as W,f as fe,g as He,e as Ue,m as Pe,n as ts,o as ls,U as rs,p as cs,q as ns,r as we,s as ie,t as is,j as ds,u as ze,v as os,d as ms,P as xs,X as hs,D as ge,w as us,x as ps,C as js,y as gs,S as _e,R as Ns,k as bs,L as fs}from"./icon-vendor-CWV3Q6sV.js";import{S as Re}from"./scroll-area-ZOOfn5zd.js";import"./utils-vendor-DrCDvq1f.js";import"./chart-vendor-CWmmjCk1.js";function Ze({...s}){return e.jsx(es,{"data-slot":"collapsible",...s})}function Je({...s}){return e.jsx(ss,{"data-slot":"collapsible-trigger",...s})}function We({...s}){return e.jsx(as,{"data-slot":"collapsible-content",...s})}const je={text:{placeholder:"텍스트를 입력하세요",maxLength:100},number:{placeholder:"숫자를 입력하세요",min:0,max:999999},select:{placeholder:"선택하세요",options:[]},multiselect:{placeholder:"하나 이상 선택하세요",options:[]},checkbox:{label:"활성화"},switch:{label:"켜기/끄기"}},vs=({field:s,value:o,onChange:d,error:v,disabled:P})=>{var N,l,u,x;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{htmlFor:s.key,className:"text-sm font-medium",children:[s.label,s.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),e.jsx(he,{id:s.key,type:s.type==="number"?"number":"text",value:o||"",onChange:g=>{const C=s.type==="number"?g.target.value===""?"":Number(g.target.value):g.target.value;d(C)},placeholder:s.placeholder||((N=je[s.type])==null?void 0:N.placeholder),maxLength:s.maxLength||((l=je[s.type])==null?void 0:l.maxLength),min:s.min||((u=je[s.type])==null?void 0:u.min),max:s.max||((x=je[s.type])==null?void 0:x.max),disabled:P,className:v?"border-destructive":""}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description}),v&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(W,{className:"h-3 w-3"}),v]})]})},ys=({field:s,value:o,onChange:d,error:v,disabled:P})=>{var N;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{htmlFor:s.key,className:"text-sm font-medium",children:[s.label,s.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),e.jsxs(Ce,{value:o||"",onValueChange:d,disabled:P,children:[e.jsx(ke,{className:v?"border-destructive":"",children:e.jsx(De,{placeholder:s.placeholder||je.select.placeholder})}),e.jsx(Ee,{children:(N=s.options)==null?void 0:N.map(l=>e.jsx(K,{value:l.value,children:l.label},l.value))})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description}),v&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(W,{className:"h-3 w-3"}),v]})]})},ws=({field:s,value:o,onChange:d,error:v,disabled:P})=>{var u,x;const N=Array.isArray(o)?o:[],l=g=>{const C=N.includes(g)?N.filter(I=>I!==g):[...N,g];d(C)};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{className:"text-sm font-medium",children:[s.label,s.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),e.jsxs("div",{className:`border rounded-md p-3 space-y-2 ${v?"border-destructive":"border-input"}`,children:[(u=s.options)==null?void 0:u.map(g=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(qe,{id:`${s.key}-${g.value}`,checked:N.includes(g.value),onCheckedChange:()=>l(g.value),disabled:P}),e.jsx(b,{htmlFor:`${s.key}-${g.value}`,className:"text-sm cursor-pointer",children:g.label})]},g.value)),((x=s.options)==null?void 0:x.length)===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"선택 가능한 옵션이 없습니다"})]}),N.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:N.map(g=>{var I;const C=(I=s.options)==null?void 0:I.find(E=>E.value===g);return C?e.jsx(A,{variant:"secondary",className:"text-xs",children:C.label},g):null})}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description}),v&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(W,{className:"h-3 w-3"}),v]})]})},Ss=({field:s,value:o,onChange:d,error:v,disabled:P})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs(b,{htmlFor:s.key,className:"text-sm font-medium",children:[s.label,s.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description})]}),e.jsx(pe,{id:s.key,checked:!!o,onCheckedChange:d,disabled:P})]}),v&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(W,{className:"h-3 w-3"}),v]})]}),Se=({title:s,description:o,settingKey:d,fields:v=[],defaultOpen:P=!1,disabled:N=!1,className:l="",onFieldChange:u,showSaveButton:x=!1,showResetButton:g=!1})=>{const[C,I]=c.useState(P),[E,X]=c.useState(!1),{settings:y,updateSettings:w,updateSectionLocal:Z,saving:V,error:G,validationErrors:J,logInfo:S,saveImmediately:Q,defaultSettings:ee}=Fe(),L=y[d]||{},T=c.useMemo(()=>{const m={};return Object.entries(J).forEach(([k,B])=>{if(k.startsWith(`${d}.`)){const Y=k.replace(`${d}.`,"");m[Y]=B}}),m},[J,d]),_=Object.keys(T).length>0,a=c.useCallback((m,k)=>{S(`SettingBox 필드 변경: ${d}.${m}`,{oldValue:L[m],newValue:k});const B={...L,[m]:k};x?Z(d,B):w({[d]:B}),u==null||u(m,k,B),X(!0)},[d,L,w,u,S]),i=c.useCallback(async()=>{S(`SettingBox 즉시 저장: ${d}`),await Q()},[Q,S,d]),h=c.useCallback(()=>{S(`SettingBox 초기화: ${d}`);const m=ee[d]||{};w({[d]:m}),X(!1)},[d,w,ee,S]),$=c.useCallback(m=>{const k=L[m.key],B=E?T[m.key]:null,q={field:m,value:k,onChange:ae=>a(m.key,ae),error:B,disabled:N||V};switch(m.type){case"text":case"number":return e.jsx(vs,{...q},m.key);case"select":return e.jsx(ys,{...q},m.key);case"multiselect":return e.jsx(ws,{...q},m.key);case"switch":case"checkbox":return e.jsx(Ss,{...q},m.key);default:return e.jsxs("div",{className:"text-sm text-muted-foreground",children:["지원하지 않는 필드 타입: ",m.type]},m.key)}},[L,T,E,N,V,a]);return e.jsx(R,{className:`w-full ${l}`,children:e.jsxs(Ze,{open:C,onOpenChange:I,children:[e.jsx(Je,{asChild:!0,children:e.jsx(H,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(U,{className:"text-lg flex items-center gap-2",children:[s,V&&e.jsxs(A,{variant:"secondary",className:"text-xs",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"저장 중"]}),E&&_&&e.jsxs(A,{variant:"destructive",className:"text-xs",children:[e.jsx(W,{className:"h-3 w-3 mr-1"}),"오류"]}),E&&!_&&!V&&e.jsxs(A,{variant:"default",className:"text-xs",children:[e.jsx(fe,{className:"h-3 w-3 mr-1"}),"유효"]})]}),o&&e.jsx(ve,{children:o})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(A,{variant:"outline",className:"text-xs",children:[v.length,"개 설정"]}),C?e.jsx(He,{className:"h-4 w-4"}):e.jsx(Ue,{className:"h-4 w-4"})]})]})})}),e.jsx(We,{children:e.jsxs(M,{className:"space-y-6",children:[G&&e.jsxs(Me,{variant:"destructive",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx(Ve,{children:G})]}),v.length>0?e.jsx("div",{className:"space-y-4",children:v.map($)}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"설정할 수 있는 항목이 없습니다."}),(x||g||_)&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:g&&e.jsxs(D,{variant:"outline",size:"sm",onClick:h,disabled:N||V,children:[e.jsx(Pe,{className:"h-4 w-4 mr-1"}),"초기화"]})}),e.jsx("div",{className:"flex items-center gap-2",children:x&&e.jsxs(D,{size:"sm",onClick:i,disabled:N||V||_,children:[e.jsx(ts,{className:"h-4 w-4 mr-1"}),"저장"]})})]})]})]})})]})})},be=[{key:"dashboardSettings",label:"Dashboard 설정",description:"선택된 PEG, 차트 스타일, 새로고침 간격 등"},{key:"statisticsSettings",label:"Statistics 설정",description:"기본 날짜 범위, 비교 옵션, 소수점 자릿수 등"},{key:"derivedPegSettings",label:"Derived PEG 설정",description:"사용자 정의 수식, 활성화 상태, 계산 정밀도 등"},{key:"notificationSettings",label:"알림 설정",description:"토스트, 사운드, 알림 타입 설정"},{key:"generalSettings",label:"일반 설정",description:"언어, 시간대, 날짜 형식 등"}],Cs=({title:s="설정 백업 & 복원",description:o="설정을 JSON 파일로 내보내거나 가져올 수 있습니다",defaultOpen:d=!1,className:v=""})=>{const[P,N]=c.useState(d),[l,u]=c.useState(!1),[x,g]=c.useState(!1),[C,I]=c.useState(0),[E,X]=c.useState(!1),[y,w]=c.useState(null),[Z,V]=c.useState(null),[G,J]=c.useState(be.reduce((t,j)=>({...t,[j.key]:!0}),{})),[S,Q]=c.useState(""),ee=c.useRef(null),{settings:L,exportSettings:T,importSettings:_,hasUnsavedChanges:a,saving:i,logInfo:h,logError:$}=Fe(),m=c.useCallback(async(t="full")=>{g(!0),w(null);try{h("설정 내보내기 시작",{exportType:t,customFileName:S});let j=L;if(t==="partial"){const oe=Object.entries(G).filter(([te,le])=>le).map(([te])=>te);if(oe.length===0){se.error("내보낼 설정 섹션을 하나 이상 선택해주세요");return}j=oe.reduce((te,le)=>(L[le]&&(te[le]=L[le]),te),{}),h("부분 내보내기 선택된 섹션",oe)}const ce=new Date().toISOString().split("T")[0],ne=S.trim()||(t==="partial"?`preference-settings-partial-${ce}.json`:`preference-settings-${ce}.json`);await T(ne,j)&&(se.success(`설정이 "${ne}" 파일로 내보내졌습니다`),Q(""))}catch(j){$("설정 내보내기 실패",j),se.error("설정 내보내기 실패: "+j.message)}finally{g(!1)}},[L,G,S,T,h,$]),k=c.useCallback(async t=>{if(t){u(!0),I(0),w(null);try{if(h("설정 가져오기 시작",{fileName:t.name,fileSize:t.size}),!t.name.toLowerCase().endsWith(".json"))throw new Error("JSON 파일만 지원됩니다");if(t.size>5*1024*1024)throw new Error("파일 크기가 너무 큽니다 (최대 5MB)");I(20);const j=await _(t);I(80),V({name:t.name,size:t.size,importedAt:new Date,sectionsCount:Object.keys(j).length}),I(100),h("설정 가져오기 완료",{fileName:t.name,sectionsImported:Object.keys(j).length}),se.success(`"${t.name}"에서 설정을 성공적으로 가져왔습니다`)}catch(j){$("설정 가져오기 실패",j),w(j.message),se.error("설정 가져오기 실패: "+j.message)}finally{u(!1),setTimeout(()=>{I(0)},3e3)}}},[_,h,$]),B=c.useCallback(t=>{const j=t.target.files[0];j&&(k(j),t.target.value="")},[k]),Y=c.useCallback(t=>{t.preventDefault(),X(!0)},[]),q=c.useCallback(t=>{t.preventDefault(),X(!1)},[]),ae=c.useCallback(t=>{t.preventDefault(),X(!1);const j=t.dataTransfer.files;j.length>0&&k(j[0])},[k]),de=c.useCallback(t=>{J(j=>({...j,[t]:!j[t]}))},[]),O=c.useCallback(()=>{const t=Object.values(G).every(Boolean),j=be.reduce((ce,ne)=>({...ce,[ne.key]:!t}),{});J(j)},[G]);return e.jsx(R,{className:`w-full ${v}`,children:e.jsxs(Ze,{open:P,onOpenChange:N,children:[e.jsx(Je,{asChild:!0,children:e.jsx(H,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(U,{className:"text-lg flex items-center gap-2",children:[e.jsx(ls,{className:"h-5 w-5"}),s,l&&e.jsxs(A,{variant:"secondary",className:"text-xs",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"가져오는 중"]}),x&&e.jsxs(A,{variant:"secondary",className:"text-xs",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"내보내는 중"]}),a&&e.jsxs(A,{variant:"outline",className:"text-xs",children:[e.jsx(W,{className:"h-3 w-3 mr-1"}),"저장되지 않은 변경사항"]})]}),o&&e.jsx(ve,{children:o})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Z&&e.jsxs(A,{variant:"default",className:"text-xs",children:[e.jsx(fe,{className:"h-3 w-3 mr-1"}),"가져옴"]}),P?e.jsx(He,{className:"h-4 w-4"}):e.jsx(Ue,{className:"h-4 w-4"})]})]})})}),e.jsx(We,{children:e.jsxs(M,{className:"space-y-6",children:[y&&e.jsxs(Me,{variant:"destructive",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx(Ve,{children:y})]}),l&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"파일 가져오는 중..."}),e.jsxs("span",{children:[C,"%"]})]}),e.jsx(Xe,{value:C,className:"h-2"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(rs,{className:"h-4 w-4"}),"설정 가져오기"]}),e.jsx("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${E?"border-primary bg-primary/5":l?"border-muted bg-muted/20":"border-muted-foreground/25 hover:border-muted-foreground/50"}`,onDragOver:Y,onDragLeave:q,onDrop:ae,children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(cs,{className:`h-8 w-8 mx-auto ${E?"text-primary":"text-muted-foreground"}`}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:`text-sm font-medium ${E?"text-primary":""}`,children:E?"파일을 여기에 놓으세요":"JSON 파일을 드래그하거나 클릭하여 선택하세요"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"최대 5MB, .json 파일만 지원"})]}),e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>{var t;return(t=ee.current)==null?void 0:t.click()},disabled:l,className:"mt-2",children:[e.jsx(ns,{className:"h-4 w-4 mr-2"}),"파일 선택"]})]})}),e.jsx("input",{ref:ee,type:"file",accept:".json",onChange:B,style:{display:"none"}}),Z&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(fe,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-medium",children:"마지막 가져온 파일:"}),e.jsx("span",{children:Z.name}),e.jsxs(A,{variant:"secondary",className:"text-xs",children:[Z.sectionsCount,"개 섹션"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Z.importedAt.toLocaleString()})]})]}),e.jsx(Oe,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),"설정 내보내기"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"fileName",className:"text-sm",children:"파일명 (선택사항)"}),e.jsx(he,{id:"fileName",value:S,onChange:t=>Q(t.target.value),placeholder:"preference-settings-custom.json",disabled:x}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"비워두면 자동으로 날짜가 포함된 파일명이 생성됩니다"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{className:"text-sm font-medium",children:"내보낼 설정 선택"}),e.jsx(D,{variant:"outline",size:"sm",onClick:O,disabled:x,children:Object.values(G).every(Boolean)?"전체 해제":"전체 선택"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:be.map(t=>e.jsxs("div",{className:"flex items-start space-x-2 p-2 rounded border",children:[e.jsx(qe,{id:t.key,checked:G[t.key],onCheckedChange:()=>de(t.key),disabled:x}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsx(b,{htmlFor:t.key,className:"text-sm font-medium cursor-pointer",children:t.label}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.description})]})]},t.key))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(D,{onClick:()=>m("full"),disabled:x||i,className:"flex-1",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"전체 설정 내보내기"]}),e.jsxs(D,{variant:"outline",onClick:()=>m("partial"),disabled:x||i||Object.values(G).every(t=>!t),className:"flex-1",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"선택된 설정만 내보내기"]})]}),Object.values(G).every(t=>!t)&&e.jsx("p",{className:"text-xs text-destructive",children:"내보낼 설정 섹션을 하나 이상 선택해주세요"})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[e.jsx("h5",{className:"text-sm font-medium mb-2",children:"현재 설정 상태"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs",children:be.map(t=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[t.label,":"]}),e.jsx("span",{className:"text-muted-foreground",children:L[t.key]?"설정됨":"기본값"})]},t.key))}),a&&e.jsxs("p",{className:"text-xs text-amber-600 mt-2 flex items-center gap-1",children:[e.jsx(W,{className:"h-3 w-3"}),"저장되지 않은 변경사항이 있습니다"]})]})]})})]})})};function ks({className:s,...o}){return e.jsx("textarea",{"data-slot":"textarea",className:Qe("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...o})}const Ds=({derivedPegSettings:s,updateDerivedPegSettings:o,availablePegs:d=[],saving:v=!1})=>{var _;const[P,N]=c.useState(null),[l,u]=c.useState(null),[x,g]=c.useState(""),[C,I]=c.useState(null),[E,X]=c.useState(null),y=(s==null?void 0:s.formulas)||[],w=(s==null?void 0:s.settings)||{autoValidate:!0,showInDashboard:!0,showInStatistics:!0,evaluationPrecision:4},Z=[{id:"success_rate",name:"Success Rate (%)",formula:"(success_count / total_count) * 100",description:"성공률 계산 템플릿",category:"percentage"},{id:"efficiency",name:"Efficiency (%)",formula:"(good_values / all_values) * 100",description:"효율성 계산 템플릿",category:"percentage"},{id:"delta",name:"Delta Calculation",formula:"current_value - previous_value",description:"변화량 계산 템플릿",category:"difference"},{id:"ratio",name:"Simple Ratio",formula:"numerator / denominator",description:"단순 비율 계산 템플릿",category:"ratio"}],V=[{symbol:"+",name:"더하기",example:"a + b"},{symbol:"-",name:"빼기",example:"a - b"},{symbol:"*",name:"곱하기",example:"a * b"},{symbol:"/",name:"나누기",example:"a / b"},{symbol:"%",name:"나머지",example:"a % b"},{symbol:"^",name:"거듭제곱",example:"a ^ 2"},{symbol:"()",name:"괄호",example:"(a + b) * c"},{symbol:"sqrt()",name:"제곱근",example:"sqrt(a)"},{symbol:"log()",name:"로그",example:"log(a)"},{symbol:"abs()",name:"절댓값",example:"abs(a)"},{symbol:"min()",name:"최솟값",example:"min(a, b)"},{symbol:"max()",name:"최댓값",example:"max(a, b)"}],G=c.useMemo(()=>x?y.filter(a=>{var i;return a.name.toLowerCase().includes(x.toLowerCase())||a.formula.toLowerCase().includes(x.toLowerCase())||((i=a.description)==null?void 0:i.toLowerCase().includes(x.toLowerCase()))}):y,[y,x]),J=c.useCallback(a=>{try{const i=[],h=[],$=(a.match(/\(/g)||[]).length,m=(a.match(/\)/g)||[]).length;$!==m&&i.push("괄호가 일치하지 않습니다");const k=a.replace(/\$\{[^}]+\}/g," ").match(/[a-zA-Z_][a-zA-Z0-9_]*/g)||[],B=[...d.map(O=>O.value),...y.filter(O=>O.active).map(O=>O.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase())],Y=k.filter(O=>!B.includes(O)&&!["sqrt","log","abs","min","max","if"].includes(O));if(Y.length>0&&h.push(`알 수 없는 PEG: ${Y.join(", ")}`),l){const O=l.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase();k.includes(O)&&i.push("수식이 자기 자신을 참조할 수 없습니다 (순환 참조)")}const q=a.replace(/\$\{[^}]+\}/g,"").match(/[^a-zA-Z0-9_+\-*/()^%.,\s]/g);q&&i.push(`지원하지 않는 문자: ${q.join(", ")}`);const ae=k.filter(O=>d.some(t=>t.value===O)),de=k.filter(O=>y.some(t=>t.active&&t.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()===O));return{isValid:i.length===0,errors:i,warnings:h,dependencies:ae,derivedDependencies:de}}catch{return{isValid:!1,errors:["수식 분석 중 오류가 발생했습니다"],warnings:[],dependencies:[],derivedDependencies:[]}}},[d,y,l]),S=c.useCallback(a=>{try{const i={};d.forEach(m=>{i[m.value]=Math.random()*100+50});let h=a;Object.keys(i).forEach(m=>{const k=new RegExp(`\\b${m}\\b`,"g");h=h.replace(k,i[m].toString())}),h=h.replace(/sqrt\(([^)]+)\)/g,"Math.sqrt($1)"),h=h.replace(/log\(([^)]+)\)/g,"Math.log($1)"),h=h.replace(/abs\(([^)]+)\)/g,"Math.abs($1)"),h=h.replace(/\^/g,"**");const $=Function(`"use strict"; return (${h})`)();return{success:!0,result:Number($).toFixed(w.evaluationPrecision||4),mockData:i}}catch(i){return{success:!1,error:i.message}}},[d,w.evaluationPrecision]),Q=()=>{const a={id:`formula_${Date.now()}`,name:"새 수식",formula:"",description:"",active:!0,category:"custom",unit:"",dependencies:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};u(a),N(a.id)},ee=()=>{if(!l)return;const a=J(l.formula);if(!a.isValid){se.error(`수식 저장 실패: ${a.errors.join(", ")}`);return}const i={...l,dependencies:a.dependencies,derivedDependencies:a.derivedDependencies||[],updatedAt:new Date().toISOString()},h=y.findIndex(m=>m.id===l.id);let $;h>=0?($=[...y],$[h]=i):$=[...y,i],o({...s,formulas:$}),u(null),se.success("수식이 저장되었습니다")},L=a=>{const i=y.filter(h=>h.id!==a);o({...s,formulas:i}),P===a&&N(null),(l==null?void 0:l.id)===a&&u(null),se.success("수식이 삭제되었습니다")},T=a=>{l&&(u({...l,formula:a.formula,description:a.description,category:a.category}),se.success(`템플릿 "${a.name}"이 적용되었습니다`))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(R,{children:[e.jsx(H,{children:e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),"Derived PEG 관리"]})}),e.jsx(M,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{id:"auto-validate",checked:w.autoValidate,onCheckedChange:a=>o({...s,settings:{...w,autoValidate:a}})}),e.jsx(b,{htmlFor:"auto-validate",children:"실시간 검증"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{id:"show-dashboard",checked:w.showInDashboard,onCheckedChange:a=>o({...s,settings:{...w,showInDashboard:a}})}),e.jsx(b,{htmlFor:"show-dashboard",children:"Dashboard에 표시"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{id:"show-statistics",checked:w.showInStatistics,onCheckedChange:a=>o({...s,settings:{...w,showInStatistics:a}})}),e.jsx(b,{htmlFor:"show-statistics",children:"Statistics에 표시"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"계산 정밀도"}),e.jsxs(Ce,{value:(_=w.evaluationPrecision)==null?void 0:_.toString(),onValueChange:a=>o({...s,settings:{...w,evaluationPrecision:parseInt(a)}}),children:[e.jsx(ke,{children:e.jsx(De,{})}),e.jsxs(Ee,{children:[e.jsx(K,{value:"2",children:"소수점 2자리"}),e.jsx(K,{value:"4",children:"소수점 4자리"}),e.jsx(K,{value:"6",children:"소수점 6자리"})]})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(R,{children:[e.jsxs(H,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(U,{children:"수식 목록"}),e.jsxs(D,{onClick:Q,size:"sm",children:[e.jsx(is,{className:"h-4 w-4 mr-2"}),"새 수식"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ds,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(he,{placeholder:"수식 검색...",className:"pl-8",value:x,onChange:a=>g(a.target.value)})]})]}),e.jsx(M,{children:e.jsx(Re,{className:"h-96",children:e.jsx("div",{className:"space-y-2",children:G.map(a=>e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${P===a.id?"bg-blue-50 border-blue-200":"hover:bg-gray-50"}`,onClick:()=>N(a.id),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:a.name}),e.jsx(A,{variant:a.active?"default":"secondary",className:"text-xs",children:a.active?"활성":"비활성"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1 font-mono",children:a.formula}),a.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(A,{variant:"outline",className:"text-xs",children:a.category}),a.unit&&e.jsx(A,{variant:"outline",className:"text-xs",children:a.unit})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[e.jsx(D,{variant:"ghost",size:"sm",onClick:i=>{i.stopPropagation(),u({...a})},children:e.jsx(ze,{className:"h-3 w-3"})}),e.jsx(D,{variant:"ghost",size:"sm",onClick:i=>{i.stopPropagation(),L(a.id)},children:e.jsx(os,{className:"h-3 w-3"})})]})]})},a.id))})})})]}),e.jsxs(R,{children:[e.jsx(H,{children:e.jsx(U,{children:l?"수식 편집":"수식 상세"})}),e.jsx(M,{children:l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"formula-name",children:"수식 이름"}),e.jsx(he,{id:"formula-name",value:l.name,onChange:a=>u({...l,name:a.target.value}),placeholder:"예: RACH Success Rate (%)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"formula-input",children:"수식"}),e.jsx(ks,{id:"formula-input",value:l.formula,onChange:a=>{u({...l,formula:a.target.value}),w.autoValidate&&I(J(a.target.value))},placeholder:"예: (randomaccesspremable / randomaccessresponse) * 100",className:"font-mono text-sm",rows:4}),C&&e.jsxs("div",{className:"space-y-2",children:[C.isValid?e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(ms,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"수식이 유효합니다"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:C.errors.join(", ")})]}),C.warnings.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:C.warnings.join(", ")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"formula-description",children:"설명"}),e.jsx(he,{id:"formula-description",value:l.description,onChange:a=>u({...l,description:a.target.value}),placeholder:"수식에 대한 설명을 입력하세요"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"formula-category",children:"카테고리"}),e.jsxs(Ce,{value:l.category,onValueChange:a=>u({...l,category:a}),children:[e.jsx(ke,{children:e.jsx(De,{})}),e.jsxs(Ee,{children:[e.jsx(K,{value:"percentage",children:"비율 (%)"}),e.jsx(K,{value:"success_rate",children:"성공률"}),e.jsx(K,{value:"efficiency",children:"효율성"}),e.jsx(K,{value:"quality",children:"품질"}),e.jsx(K,{value:"performance",children:"성능"}),e.jsx(K,{value:"custom",children:"사용자 정의"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"formula-unit",children:"단위"}),e.jsx(he,{id:"formula-unit",value:l.unit,onChange:a=>u({...l,unit:a.target.value}),placeholder:"예: %, ms, Mbps"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{id:"formula-active",checked:l.active,onCheckedChange:a=>u({...l,active:a})}),e.jsx(b,{htmlFor:"formula-active",children:"수식 활성화"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(D,{onClick:()=>{const a=J(l.formula);I(a);const i=S(l.formula);X(i)},children:[e.jsx(xs,{className:"h-4 w-4 mr-2"}),"테스트"]}),e.jsxs(D,{onClick:ee,disabled:v,children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"저장"]}),e.jsxs(D,{variant:"outline",onClick:()=>u(null),children:[e.jsx(hs,{className:"h-4 w-4 mr-2"}),"취소"]})]}),E&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Oe,{}),e.jsx("h4",{className:"font-medium",children:"테스트 결과"}),E.success?e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-green-700",children:e.jsxs("strong",{children:["결과: ",E.result]})}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"모의 데이터를 사용한 계산 결과입니다"})]}):e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-700",children:["오류: ",E.error]})})]})]}):P?e.jsx("div",{className:"space-y-4",children:(()=>{const a=y.find(i=>i.id===P);return a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"수식"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg font-mono text-sm",children:a.formula})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(b,{className:"text-xs",children:"카테고리"}),e.jsx("p",{className:"text-sm",children:a.category})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-xs",children:"단위"}),e.jsx("p",{className:"text-sm",children:a.unit||"없음"})]})]}),(a.dependencies&&a.dependencies.length>0||a.derivedDependencies&&a.derivedDependencies.length>0)&&e.jsxs("div",{className:"space-y-2",children:[a.dependencies&&a.dependencies.length>0&&e.jsxs("div",{children:[e.jsxs(b,{className:"text-xs flex items-center gap-1",children:[e.jsx(ge,{className:"h-3 w-3"}),"기본 PEG 의존성"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:a.dependencies.map(i=>e.jsx(A,{variant:"outline",className:"text-xs",children:i},i))})]}),a.derivedDependencies&&a.derivedDependencies.length>0&&e.jsxs("div",{children:[e.jsxs(b,{className:"text-xs flex items-center gap-1",children:[e.jsx(ie,{className:"h-3 w-3"}),"Derived PEG 의존성"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:a.derivedDependencies.map(i=>e.jsx(A,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700",children:i},i))})]})]}),e.jsxs(D,{onClick:()=>u({...a}),className:"w-full",children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"편집"]})]}):e.jsx("p",{children:"수식을 찾을 수 없습니다."})})()}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ie,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"수식을 선택하거나 새로 만들어보세요"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(R,{children:[e.jsx(H,{children:e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(us,{className:"h-5 w-5"}),"템플릿 라이브러리"]})}),e.jsx(M,{children:e.jsx("div",{className:"space-y-2",children:Z.map(a=>e.jsx("div",{className:"p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>T(a),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",children:a.name}),e.jsx("p",{className:"text-xs font-mono text-muted-foreground",children:a.formula}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.description})]}),e.jsx(D,{variant:"ghost",size:"sm",children:e.jsx(ps,{className:"h-3 w-3"})})]})},a.id))})})]}),e.jsxs(R,{children:[e.jsx(H,{children:e.jsx(U,{children:"지원 연산자"})}),e.jsx(M,{children:e.jsx(Re,{className:"h-64",children:e.jsx("div",{className:"space-y-2",children:V.map((a,i)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("code",{className:"font-mono font-medium",children:a.symbol}),e.jsx("span",{className:"text-sm text-muted-foreground ml-2",children:a.name})]}),e.jsx("code",{className:"text-xs text-muted-foreground",children:a.example})]},i))})})})]})]}),e.jsxs(R,{children:[e.jsxs(H,{children:[e.jsx(U,{children:"사용 가능한 PEG"}),e.jsx(ve,{children:"수식에 사용할 수 있는 기본 PEG와 생성된 Derived PEG 목록입니다"})]}),e.jsx(M,{children:e.jsxs("div",{className:"space-y-4",children:[d.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"기본 PEG (",d.length,"개)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.map(a=>e.jsx(D,{variant:"outline",size:"sm",onClick:()=>{l&&u({...l,formula:l.formula+a.value})},className:"text-xs",children:a.label||a.value},a.value))})]}),y.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Derived PEG (",y.filter(a=>a.active).length,"개)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:y.filter(a=>a.active).map(a=>e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>{if(l){const i=`${a.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()}`;u({...l,formula:l.formula+i})}},className:"text-xs bg-blue-50 border-blue-200 hover:bg-blue-100",title:a.description,children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),a.name,a.unit&&e.jsxs("span",{className:"ml-1 text-muted-foreground",children:["(",a.unit,")"]})]},a.id))}),y.filter(a=>a.active).length===0&&e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(ie,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"아직 생성된 Derived PEG가 없습니다"}),e.jsx("p",{className:"text-xs",children:"새 수식을 추가하고 활성화하면 여기에 표시됩니다"})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-sm text-blue-700 mb-1",children:"💡 사용법"}),e.jsxs("ul",{className:"text-xs text-blue-600 space-y-1",children:[e.jsx("li",{children:"• 기본 PEG: 클릭하면 수식에 바로 삽입됩니다"}),e.jsx("li",{children:"• Derived PEG: 다른 수식에서 참조할 수 있는 계산된 값입니다"}),e.jsx("li",{children:"• 비활성화된 Derived PEG는 목록에 표시되지 않습니다"}),e.jsx("li",{children:"• Derived PEG끼리 순환 참조하지 않도록 주의하세요"})]})]})]})})]})]})};function Es(s=[]){return s.map(o=>({value:o.value,label:o.label,type:o.type,color:o.type==="derived"?"#3b82f6":"#6b7280",isDerived:o.type==="derived",description:o.description,formula:o.formula}))}const _s=()=>{var B,Y,q,ae,de,O,t,j,ce,ne,ye,oe,te,le,Ae,Ie,$e,Le,Ge,Te,Be;const{settings:s,isLoading:o,isSaving:d,error:v,lastSaved:P,updateSettings:N,saveSettings:l,resetSettings:u}=Fe(),[x,g]=c.useState([]),[C,I]=c.useState(!1),[E,X]=c.useState(null),y=c.useCallback(async()=>{var r,f;try{I(!0),console.info("[PreferenceManager] Fetching DB PEGs");const n=(s==null?void 0:s.databaseSettings)||{};if(!n.host){console.warn("[PreferenceManager] No DB config found");return}const F=await ue.post("/api/master/pegs",{host:String(n.host).trim(),port:Number(n.port)||5432,user:String(n.user||"").trim(),password:String(n.password||"").trim(),dbname:String(n.dbname||"").trim(),table:String(n.table||"summary").trim(),limit:500}),p=((r=F==null?void 0:F.data)==null?void 0:r.pegs)||(Array.isArray((f=F==null?void 0:F.data)==null?void 0:f.items)?F.data.items.map(z=>({id:z,name:z})):Array.isArray(F==null?void 0:F.data)?F.data.map(z=>({id:z,name:z})):[]);console.info("[PreferenceManager] DB PEGs loaded:",p.length);const re=p.map(z=>({value:z.id||z.name||z.peg_name,label:String(z.name||z.id||z.peg_name)}));g(re),X(new Date)}catch(n){console.error("[PreferenceManager] Error fetching DB PEGs:",n)}finally{I(!1)}},[s==null?void 0:s.databaseSettings]),w=c.useCallback(()=>{const r=Es(x);return console.log("✅ 최종 PEG 옵션:",r),r},[x]),Z=JSON.stringify({host:(B=s==null?void 0:s.databaseSettings)==null?void 0:B.host,port:(Y=s==null?void 0:s.databaseSettings)==null?void 0:Y.port,user:(q=s==null?void 0:s.databaseSettings)==null?void 0:q.user,dbname:(ae=s==null?void 0:s.databaseSettings)==null?void 0:ae.dbname,table:(de=s==null?void 0:s.databaseSettings)==null?void 0:de.table});c.useEffect(()=>{y()},[y,Z]);const V=[{key:"selectedPegs",label:"Dashboard에 표시할 PEG 목록",type:"multiselect",required:!1,options:w(),placeholder:"Database PEG에서 선택하세요"},{key:"chartLayout",label:"그래프 정렬 방식",type:"select",options:[{value:"byPeg",label:"PEG별 (PEG마다 Cell/NE 시리즈)"},{value:"byEntity",label:"Cell/NE별 (엔터티마다 PEG 시리즈)"}]}],[G,J]=c.useState([]),[S,Q]=c.useState([]),[ee,L]=c.useState([]),[T,_]=c.useState([]),[a,i]=c.useState([]),[h,$]=c.useState([]);c.useEffect(()=>{const r=(s==null?void 0:s.statisticsSettings)||{};Q(Array.isArray(r.selectedHosts)?r.selectedHosts:[]),_(Array.isArray(r.selectedNEs)?r.selectedNEs:[]),$(Array.isArray(r.selectedCellIds)?r.selectedCellIds:[])},[s==null?void 0:s.statisticsSettings]),c.useEffect(()=>{(async()=>{var f;try{const n=(s==null?void 0:s.databaseSettings)||{};if(!n.host)return;const F={host:String(n.host||"").trim(),port:Number(n.port)||5432,user:String(n.user||"").trim(),password:String(n.password||"").trim(),dbname:String(n.dbname||"").trim(),table:String(n.table||"summary").trim()},p=await ue.post("/api/master/hosts",F);J(Array.isArray((f=p==null?void 0:p.data)==null?void 0:f.hosts)?p.data.hosts:[])}catch(n){console.error("[PreferenceManager] HOST 목록 조회 실패",n)}})()},[(O=s==null?void 0:s.databaseSettings)==null?void 0:O.host,(t=s==null?void 0:s.databaseSettings)==null?void 0:t.port,(j=s==null?void 0:s.databaseSettings)==null?void 0:j.user,(ce=s==null?void 0:s.databaseSettings)==null?void 0:ce.password,(ne=s==null?void 0:s.databaseSettings)==null?void 0:ne.dbname,(ye=s==null?void 0:s.databaseSettings)==null?void 0:ye.table]),c.useEffect(()=>{(async()=>{var f;try{const n=(s==null?void 0:s.databaseSettings)||{};if(!n.host||S.length===0){L([]);return}const F={host:String(n.host||"").trim(),port:Number(n.port)||5432,user:String(n.user||"").trim(),password:String(n.password||"").trim(),dbname:String(n.dbname||"").trim(),table:String(n.table||"summary").trim(),hosts:S},p=await ue.post("/api/master/nes-by-host",F);L(Array.isArray((f=p==null?void 0:p.data)==null?void 0:f.nes)?p.data.nes:[])}catch(n){console.error("[PreferenceManager] NE 목록 조회 실패",n)}})()},[S,s==null?void 0:s.databaseSettings]),c.useEffect(()=>{(async()=>{var f;try{const n=(s==null?void 0:s.databaseSettings)||{};if(!n.host||S.length===0||T.length===0){i([]);return}const F={host:String(n.host||"").trim(),port:Number(n.port)||5432,user:String(n.user||"").trim(),password:String(n.password||"").trim(),dbname:String(n.dbname||"").trim(),table:String(n.table||"summary").trim(),hosts:S,nes:T},p=await ue.post("/api/master/cells-by-host-ne",F);i(Array.isArray((f=p==null?void 0:p.data)==null?void 0:f.cellids)?p.data.cellids:[])}catch(n){console.error("[PreferenceManager] CellID 목록 조회 실패",n)}})()},[T,S,s==null?void 0:s.databaseSettings]);const m=[{key:"host",label:"Host",type:"text",placeholder:"예: 127.0.0.1"},{key:"port",label:"Port",type:"number",min:1,max:65535,placeholder:"5432"},{key:"user",label:"User",type:"text",placeholder:"postgres"},{key:"password",label:"Password",type:"text",placeholder:"비밀번호"},{key:"dbname",label:"DB Name",type:"text",placeholder:"postgres"},{key:"table",label:"기본 테이블명",type:"text",placeholder:"summary"}],k=[{key:"enableNotifications",label:"알림 활성화",type:"switch"},{key:"emailNotifications",label:"이메일 알림",type:"switch"},{key:"soundEnabled",label:"소리 알림",type:"switch"},{key:"notificationFrequency",label:"알림 빈도",type:"select",options:[{value:"immediate",label:"즉시"},{value:"hourly",label:"매시간"},{value:"daily",label:"매일"},{value:"weekly",label:"매주"}]}];return o?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"환경설정"}),e.jsxs(A,{variant:"secondary",className:"text-xs",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"로딩 중..."]})]}),e.jsx(R,{children:e.jsx(M,{className:"pt-6",children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"설정을 불러오는 중입니다..."})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"환경설정"}),e.jsx("p",{className:"text-muted-foreground",children:"Dashboard와 Statistics의 동작을 설정할 수 있습니다"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[d&&e.jsxs(A,{variant:"secondary",className:"text-xs",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"저장 중..."]}),v&&e.jsx(A,{variant:"destructive",className:"text-xs",children:"오류 발생"}),P&&e.jsxs(A,{variant:"outline",className:"text-xs",children:["마지막 저장: ",new Date(P).toLocaleTimeString()]})]})]}),e.jsxs(Ye,{defaultValue:"dashboard",className:"w-full",children:[e.jsxs(Ke,{className:"grid w-full grid-cols-6",children:[e.jsxs(me,{value:"dashboard",className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-4 w-4"}),"Dashboard"]}),e.jsxs(me,{value:"statistics",className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Statistics"]}),e.jsxs(me,{value:"database",className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Database"]}),e.jsxs(me,{value:"derived-peg",className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Derived PEG"]}),e.jsxs(me,{value:"notifications",className:"flex items-center gap-2",children:[e.jsx(gs,{className:"h-4 w-4"}),"알림"]}),e.jsxs(me,{value:"backup",className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-4 w-4"}),"백업/복원"]})]}),e.jsxs(xe,{value:"dashboard",className:"space-y-6",children:[e.jsxs(R,{children:[e.jsx(H,{children:e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),"PEG 데이터 소스"]})}),e.jsx(M,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"PEG 데이터 소스"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Database Settings에서 연결된 실제 PEG 목록을 사용합니다"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(D,{variant:"outline",size:"sm",onClick:y,disabled:C,children:[e.jsx(Ns,{className:`h-3 w-3 ${C?"animate-spin":""}`}),"새로고침"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"사용 가능한 PEG"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[x.length,"개"]})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"마지막 업데이트"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:E?E.toLocaleTimeString():"없음"})]})]}),x.length===0&&!C&&e.jsx("div",{className:"p-3 border rounded-lg bg-amber-50 border-amber-200",children:e.jsx("p",{className:"text-sm text-amber-700",children:"⚠️ DB PEG를 불러올 수 없습니다. Database Settings에서 DB 연결을 확인하세요."})}),x.length>0&&e.jsx("div",{className:"p-3 border rounded-lg bg-green-50 border-green-200",children:e.jsxs("p",{className:"text-sm text-green-700",children:["✅ ",x.length,"개의 실제 DB PEG를 사용할 수 있습니다"]})})]})})]}),e.jsx(Se,{title:"Dashboard 설정",description:"DB에서 연동된 PEG만 선택하여 표시합니다",settingKey:"dashboardSettings",fields:V,defaultOpen:!0,showResetButton:!0,showSaveButton:!1},`dashboard-settings-${x.length}-${E?E.getTime():0}`),e.jsx("div",{className:"flex items-center justify-end gap-2",children:e.jsx(D,{size:"sm",onClick:async()=>{try{await l(),alert("Dashboard 설정이 저장되었습니다")}catch(r){alert("저장 실패: "+((r==null?void 0:r.message)||"알 수 없는 오류"))}},disabled:d,children:d?"저장 중...":"저장"})})]}),e.jsx(xe,{value:"statistics",className:"space-y-6",children:e.jsxs(R,{children:[e.jsx(H,{children:e.jsx(U,{children:"데이터 선택 (HOST → NE → CellID)"})}),e.jsxs(M,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(b,{className:"block mb-2",children:"HOST (다중 선택)"}),e.jsx("select",{multiple:!0,className:"w-full border rounded p-2 h-48",value:S,onChange:r=>{const f=Array.from(r.target.selectedOptions).map(n=>n.value);Q(f)},children:G.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{children:[e.jsx(b,{className:"block mb-2",children:"NE (다중 선택)"}),e.jsx("select",{multiple:!0,className:"w-full border rounded p-2 h-48",value:T,onChange:r=>{const f=Array.from(r.target.selectedOptions).map(n=>n.value);_(f)},children:ee.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{children:[e.jsx(b,{className:"block mb-2",children:"CellID (다중 선택)"}),e.jsx("select",{multiple:!0,className:"w-full border rounded p-2 h-48",value:h,onChange:r=>{const f=Array.from(r.target.selectedOptions).map(n=>n.value);$(f)},children:a.map(r=>e.jsx("option",{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsxs("div",{className:"mb-1",children:["HOST: ",S.length,"개"]}),e.jsxs("div",{className:"mb-1",children:["NE: ",T.length,"개"]}),e.jsxs("div",{children:["CellID: ",h.length,"개"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(D,{size:"sm",onClick:async()=>{try{N({statisticsSettings:{...(s==null?void 0:s.statisticsSettings)||{},selectedHosts:S,selectedNEs:T,selectedCellIds:h}}),await l(),alert("Statistics 설정이 저장되었습니다")}catch(r){alert("저장 실패: "+((r==null?void 0:r.message)||"알 수 없는 오류"))}},disabled:d,children:d?"저장 중...":"저장"})})]})]})]})}),e.jsxs(xe,{value:"database",className:"space-y-6",children:[e.jsx(Se,{title:"Database 설정",description:"LLM 분석과 Statistics에서 공통으로 사용할 PostgreSQL DB 설정입니다 (테이블명 포함).",settingKey:"databaseSettings",fields:m,defaultOpen:!0,showResetButton:!0,showSaveButton:!1}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(D,{size:"sm",onClick:async()=>{try{await l(),alert("Database 설정이 저장되었습니다")}catch(r){alert("저장 실패: "+((r==null?void 0:r.message)||"알 수 없는 오류"))}},disabled:d,children:d?"저장 중...":"저장"}),e.jsx(D,{size:"sm",onClick:async()=>{var r,f,n,F;try{const p=(s==null?void 0:s.databaseSettings)||{},re=await ue.post("/api/master/test-connection",{host:(p.host||"").trim(),port:Number(p.port)||5432,user:(p.user||"").trim(),password:(p.password||"").trim(),dbname:(p.dbname||"").trim(),table:(p.table||"summary").trim()}),z=(r=re==null?void 0:re.data)==null?void 0:r.success;alert(z?"DB 연결 성공. table_exists="+((f=re==null?void 0:re.data)==null?void 0:f.table_exists):"DB 연결 실패: 응답 형식 확인 필요")}catch(p){alert("DB 연결 실패: "+(((F=(n=p==null?void 0:p.response)==null?void 0:n.data)==null?void 0:F.detail)||(p==null?void 0:p.message)))}},children:"Test Connection"})]})]}),e.jsx(xe,{value:"derived-peg",className:"space-y-6",children:e.jsx(Ds,{derivedPegSettings:(s==null?void 0:s.derivedPegSettings)||{formulas:[],settings:{}},updateDerivedPegSettings:r=>{N({derivedPegSettings:r})},availablePegs:w(),saving:d})}),e.jsx(xe,{value:"notifications",className:"space-y-6",children:e.jsx(Se,{title:"알림 설정",description:"이메일, 소리 알림 등 알림 관련 설정을 관리합니다",settingKey:"notificationSettings",fields:k,defaultOpen:!0,showResetButton:!0,showSaveButton:!1})}),e.jsxs(xe,{value:"backup",className:"space-y-6",children:[e.jsx(Cs,{title:"설정 백업 및 복원",description:"모든 환경설정을 JSON 파일로 내보내거나 백업 파일에서 복원할 수 있습니다",defaultOpen:!0}),e.jsxs(R,{children:[e.jsxs(H,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-5 w-5 text-orange-500"}),"설정 초기화"]}),e.jsx(ve,{children:"Dashboard, Statistics, Database 설정을 기본값으로 초기화합니다. 이 작업은 되돌릴 수 없습니다."})]}),e.jsxs(M,{className:"space-y-4",children:[e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-md p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(bs,{className:"h-5 w-5 text-orange-500 mt-0.5"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-orange-800",children:"주의사항"}),e.jsxs("ul",{className:"text-sm text-orange-700 space-y-1",children:[e.jsx("li",{children:"• Dashboard의 선택된 PEG 목록이 초기화됩니다"}),e.jsx("li",{children:"• Statistics의 기본 설정이 초기화됩니다"}),e.jsx("li",{children:"• Database 연결 설정이 기본값으로 초기화됩니다"}),e.jsx("li",{children:"• 이 작업은 되돌릴 수 없습니다"})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"초기화할 설정"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Dashboard, Statistics, Database 설정을 기본값으로 초기화"})]}),e.jsx(D,{variant:"destructive",size:"sm",onClick:async()=>{if(window.confirm(`정말로 Dashboard, Statistics, Database 설정을 초기화하시겠습니까?

이 작업은 되돌릴 수 없습니다.`))try{const f=await u(["dashboardSettings","statisticsSettings","databaseSettings"]);f.success?alert("✅ 설정이 성공적으로 초기화되었습니다!"):alert("❌ 설정 초기화 실패: "+(f.error||"알 수 없는 오류"))}catch(f){alert("❌ 설정 초기화 중 오류 발생: "+f.message)}},disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(fs,{className:"h-4 w-4 mr-2 animate-spin"}),"초기화 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"설정 초기화"]})})]})]})]})]})]}),e.jsxs(R,{children:[e.jsx(H,{children:e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5"}),"현재 설정 요약"]})}),e.jsx(M,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Dashboard"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["선택된 PEG: ",((te=(oe=s==null?void 0:s.dashboardSettings)==null?void 0:oe.selectedPegs)==null?void 0:te.length)||0,"개"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["PEG 소스: ",`DB (${x.length}개)`]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["차트 스타일: ",((le=s==null?void 0:s.dashboardSettings)==null?void 0:le.chartStyle)||"line"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["자동 새로고침: ",((Ae=s==null?void 0:s.dashboardSettings)==null?void 0:Ae.autoRefreshInterval)||0,"초"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Statistics"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["기본 기간: ",((Ie=s==null?void 0:s.statisticsSettings)==null?void 0:Ie.defaultDateRange)||7,"일"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["소수점: ",(($e=s==null?void 0:s.statisticsSettings)==null?void 0:$e.decimalPlaces)||2,"자리"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["비교 옵션: ",(Le=s==null?void 0:s.statisticsSettings)!=null&&Le.showComparisonOptions?"활성":"비활성"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"알림"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["알림: ",(Ge=s==null?void 0:s.notificationSettings)!=null&&Ge.enableNotifications?"활성":"비활성"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["이메일: ",(Te=s==null?void 0:s.notificationSettings)!=null&&Te.emailNotifications?"활성":"비활성"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["소리: ",(Be=s==null?void 0:s.notificationSettings)!=null&&Be.soundEnabled?"활성":"비활성"]})]})]})]})})]})]})};export{_s as default};

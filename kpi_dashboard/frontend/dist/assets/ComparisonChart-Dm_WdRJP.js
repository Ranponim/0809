import{r as j,M as e}from"./vendor-CIPdjx1t.js";import{C as z,d as F,b as ee,c as ae,B as k,i as te,S as P,e as I,f as T,g as $,h as B}from"./index-Q594mB1I.js";import{C as y,O as se,Q as re,A as O,a as ne,V as le}from"./icon-vendor-CWV3Q6sV.js";import{R as m,B as ie,C as b,X as N,Y as g,T as x,a as h,d as p,f as K,g as de,b as f,h as oe,P as ce,i as me,j as xe,k as L,l as he,m as pe,A as je,e as _,L as ge}from"./chart-vendor-CWmmjCk1.js";import"./utils-vendor-DrCDvq1f.js";import"./ui-vendor-C5A5DcrM.js";const _e=({comparisonResults:d,title:E="비교 분석 차트",className:S="",showControls:w=!0,defaultChartType:G="bar",height:o=400})=>{const[C,W]=j.useState(G),[l,V]=j.useState(!1),[i,X]=j.useState("mean"),Y=[{value:"bar",label:"막대 차트",icon:y},{value:"line",label:"라인 차트",icon:O},{value:"area",label:"영역 차트",icon:ne},{value:"pie",label:"파이 차트",icon:le},{value:"radar",label:"레이더 차트",icon:O},{value:"composed",label:"복합 차트",icon:y}],H=[{value:"mean",label:"평균값",description:"두 기간의 평균 비교"},{value:"delta",label:"Delta",description:"절대값 변화량"},{value:"delta_percentage",label:"Delta %",description:"상대적 변화율"}],s=j.useMemo(()=>d!=null&&d.analysis_results?(console.log("📊 차트 데이터 생성 중:",d.analysis_results),d.analysis_results.map(a=>{var v,D;const t=parseFloat((v=a.period1_stats)==null?void 0:v.mean)||0,n=parseFloat((D=a.period2_stats)==null?void 0:D.mean)||0,r=parseFloat(a.delta)||0,c=parseFloat(a.delta_percentage)||0;return{name:a.peg_name,peg_name:a.peg_name,period1:t,period2:n,delta:r,delta_percentage:c,improvement_status:a.improvement_status,improvement_magnitude:a.improvement_magnitude,rsd_period1:parseFloat(a.rsd_period1)||0,rsd_period2:parseFloat(a.rsd_period2)||0,color:a.improvement_status==="improved"?"#22c55e":a.improvement_status==="degraded"?"#ef4444":"#3b82f6",abs_delta:Math.abs(r),abs_delta_percentage:Math.abs(c)}})):[],[d]),A=j.useMemo(()=>{if(!s.length)return[];const a=s.filter(r=>r.improvement_status==="improved").length,t=s.filter(r=>r.improvement_status==="degraded").length,n=s.filter(r=>r.improvement_status==="stable").length;return[{name:"개선",value:a,color:"#22c55e"},{name:"악화",value:t,color:"#ef4444"},{name:"안정",value:n,color:"#3b82f6"}].filter(r=>r.value>0)},[s]),u=({active:a,payload:t,label:n})=>{if(a&&t&&t.length){const r=t[0].payload;return e.jsxs("div",{className:"bg-white p-3 border rounded-lg shadow-lg",children:[e.jsx("h4",{className:"font-semibold text-sm",children:n}),e.jsxs("div",{className:"space-y-1 mt-2",children:[t.map((c,v)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:c.color}}),e.jsxs("span",{children:[c.name,": ",c.value]})]},v)),r.improvement_status&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-2 pt-2 border-t",children:["상태: ",r.improvement_status==="improved"?"개선":r.improvement_status==="degraded"?"악화":"안정",r.improvement_magnitude&&` (${r.improvement_magnitude})`]})]})]})}return null},M=()=>e.jsx(m,{width:"100%",height:l?"80vh":o,children:e.jsxs(ie,{data:s,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(g,{fontSize:12}),e.jsx(x,{content:e.jsx(u,{})}),e.jsx(h,{}),i==="mean"&&e.jsxs(e.Fragment,{children:[e.jsx(p,{dataKey:"period1",fill:"#8884d8",name:"기간 1"}),e.jsx(p,{dataKey:"period2",fill:"#82ca9d",name:"기간 2"})]}),i==="delta"&&e.jsx(p,{dataKey:"delta",name:"Delta",children:s.map((a,t)=>e.jsx(K,{fill:a.color},`cell-${t}`))}),i==="delta_percentage"&&e.jsx(p,{dataKey:"delta_percentage",name:"Delta %",children:s.map((a,t)=>e.jsx(K,{fill:a.color},`cell-${t}`))})]})}),Q=()=>e.jsx(m,{width:"100%",height:l?"80vh":o,children:e.jsxs(ge,{data:s,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(g,{fontSize:12}),e.jsx(x,{content:e.jsx(u,{})}),e.jsx(h,{}),i==="mean"&&e.jsxs(e.Fragment,{children:[e.jsx(f,{type:"monotone",dataKey:"period1",stroke:"#8884d8",strokeWidth:2,name:"기간 1"}),e.jsx(f,{type:"monotone",dataKey:"period2",stroke:"#82ca9d",strokeWidth:2,name:"기간 2"})]}),i==="delta"&&e.jsx(f,{type:"monotone",dataKey:"delta",stroke:"#ff7300",strokeWidth:2,name:"Delta"}),i==="delta_percentage"&&e.jsx(f,{type:"monotone",dataKey:"delta_percentage",stroke:"#ff7300",strokeWidth:2,name:"Delta %"})]})}),U=()=>e.jsx(m,{width:"100%",height:l?"80vh":o,children:e.jsxs(je,{data:s,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(g,{fontSize:12}),e.jsx(x,{content:e.jsx(u,{})}),e.jsx(h,{}),i==="mean"&&e.jsxs(e.Fragment,{children:[e.jsx(_,{type:"monotone",dataKey:"period1",stackId:"1",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.6,name:"기간 1"}),e.jsx(_,{type:"monotone",dataKey:"period2",stackId:"2",stroke:"#82ca9d",fill:"#82ca9d",fillOpacity:.6,name:"기간 2"})]}),i==="delta"&&e.jsx(_,{type:"monotone",dataKey:"delta",stroke:"#ff7300",fill:"#ff7300",fillOpacity:.6,name:"Delta"}),i==="delta_percentage"&&e.jsx(_,{type:"monotone",dataKey:"delta_percentage",stroke:"#ff7300",fill:"#ff7300",fillOpacity:.6,name:"Delta %"})]})}),q=()=>e.jsx(m,{width:"100%",height:l?"80vh":o,children:e.jsxs(he,{children:[e.jsx(pe,{data:A,cx:"50%",cy:"50%",labelLine:!1,label:({name:a,value:t,percent:n})=>`${a}: ${t}개 (${(n*100).toFixed(0)}%)`,outerRadius:l?200:100,fill:"#8884d8",dataKey:"value",children:A.map((a,t)=>e.jsx(K,{fill:a.color},`cell-${t}`))}),e.jsx(x,{}),e.jsx(h,{})]})}),J=()=>{const a=s.map(t=>({peg:t.name.length>10?t.name.substring(0,8)+"...":t.name,period1:Math.min(Math.max(t.period1/Math.max(...s.map(n=>n.period1))*100,0),100),period2:Math.min(Math.max(t.period2/Math.max(...s.map(n=>n.period2))*100,0),100)}));return e.jsx(m,{width:"100%",height:l?"80vh":o,children:e.jsxs(oe,{data:a,children:[e.jsx(ce,{}),e.jsx(me,{dataKey:"peg",fontSize:10}),e.jsx(xe,{angle:90,domain:[0,100],fontSize:10,tick:!1}),e.jsx(L,{name:"기간 1",dataKey:"period1",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.3}),e.jsx(L,{name:"기간 2",dataKey:"period2",stroke:"#82ca9d",fill:"#82ca9d",fillOpacity:.3}),e.jsx(h,{}),e.jsx(x,{})]})})},R=()=>e.jsx(m,{width:"100%",height:l?"80vh":o,children:e.jsxs(de,{data:s,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(g,{yAxisId:"left",fontSize:12}),e.jsx(g,{yAxisId:"right",orientation:"right",fontSize:12}),e.jsx(x,{content:e.jsx(u,{})}),e.jsx(h,{}),e.jsx(p,{yAxisId:"left",dataKey:"period1",fill:"#8884d8",name:"기간 1"}),e.jsx(p,{yAxisId:"left",dataKey:"period2",fill:"#82ca9d",name:"기간 2"}),e.jsx(f,{yAxisId:"right",type:"monotone",dataKey:"delta_percentage",stroke:"#ff7300",strokeWidth:3,name:"Delta %"})]})}),Z=()=>{switch(C){case"bar":return M();case"line":return Q();case"area":return U();case"pie":return q();case"radar":return J();case"composed":return R();default:return M()}};return!d||!s.length?e.jsx(z,{className:S,children:e.jsxs(F,{className:"flex flex-col items-center justify-center h-64",children:[e.jsx(y,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"차트 데이터 없음"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"비교 분석을 실행하면 결과를 차트로 볼 수 있습니다"})]})}):e.jsxs(z,{className:`${S} ${l?"fixed inset-4 z-50 bg-white":""}`,children:[e.jsxs(ee,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),E,e.jsxs(k,{variant:"outline",className:"ml-2",children:[s.length,"개 PEG"]})]}),w&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>V(!l),children:l?e.jsx(se,{className:"h-4 w-4"}):e.jsx(re,{className:"h-4 w-4"})})})]}),w&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"차트 타입"}),e.jsxs(P,{value:C,onValueChange:W,children:[e.jsx(I,{children:e.jsx(T,{})}),e.jsx($,{children:Y.map(a=>{const t=a.icon;return e.jsx(B,{value:a.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"h-4 w-4"}),a.label]})},a.value)})})]})]}),!["pie","radar"].includes(C)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"표시 메트릭"}),e.jsxs(P,{value:i,onValueChange:X,children:[e.jsx(I,{children:e.jsx(T,{})}),e.jsx($,{children:H.map(a=>e.jsx(B,{value:a.value,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.label}),e.jsx("div",{className:"text-xs text-muted-foreground",children:a.description})]})},a.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"차트 정보"}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("div",{children:["총 ",s.length,"개 PEG 비교"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"secondary",className:"text-xs",children:["개선: ",s.filter(a=>a.improvement_status==="improved").length]}),e.jsxs(k,{variant:"destructive",className:"text-xs",children:["악화: ",s.filter(a=>a.improvement_status==="degraded").length]})]})]})]})]})]}),e.jsxs(F,{children:[e.jsx("div",{className:"w-full",children:Z()}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsx("div",{className:"text-xs text-muted-foreground space-y-1",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsxs("span",{children:["개선 (",s.filter(a=>a.improvement_status==="improved").length,"개)"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsxs("span",{children:["악화 (",s.filter(a=>a.improvement_status==="degraded").length,"개)"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),e.jsxs("span",{children:["안정 (",s.filter(a=>a.improvement_status==="stable").length,"개)"]})]}),e.jsxs("div",{className:"text-muted-foreground",children:["총 ",s.length,"개 PEG 분석"]})]})})})]})]})};export{_e as default};

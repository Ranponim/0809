import{r as p,M as e,a3 as J}from"./vendor-D_Wz334c.js";import{C,b as E,c as G,d as D,S as Q,L as h,h as te,i as le,j as ie,k as ne,l as w,e as g,I as X,B as S,T as xe,m as he,n as ue,o as pe,a as je,p as W,q as ge}from"./index-BAtDSpDQ.js";import{S as ce,T as be,a as ve,b as O,c as R}from"./scroll-area-DLqPd2TV.js";import{m as I,P as fe,n as Ne,o as re,b as ye,p as we,h as de,q as Ce,e as De,X as Se,D as z,r as Pe,s as ke,g as oe,C as Ee,t as Ge,S as me,l as Fe}from"./icon-vendor-DhUEaqm7.js";import"./utils-vendor-DrCDvq1f.js";import"./ui-vendor-D1gbbhYx.js";const Ie=({derivedPegSettings:a,updateDerivedPegSettings:r,availablePegs:j=[],saving:L=!1})=>{var $;const[n,_]=p.useState(null),[t,o]=p.useState(null),[b,M]=p.useState(""),[c,A]=p.useState(null),[F,Y]=p.useState(null),d=(a==null?void 0:a.formulas)||[],u=(a==null?void 0:a.settings)||{autoValidate:!0,showInDashboard:!0,showInStatistics:!0,evaluationPrecision:4},ee=[{id:"success_rate",name:"Success Rate (%)",formula:"(success_count / total_count) * 100",description:"성공률 계산 템플릿",category:"percentage"},{id:"efficiency",name:"Efficiency (%)",formula:"(good_values / all_values) * 100",description:"효율성 계산 템플릿",category:"percentage"},{id:"delta",name:"Delta Calculation",formula:"current_value - previous_value",description:"변화량 계산 템플릿",category:"difference"},{id:"ratio",name:"Simple Ratio",formula:"numerator / denominator",description:"단순 비율 계산 템플릿",category:"ratio"}],se=[{symbol:"+",name:"더하기",example:"a + b"},{symbol:"-",name:"빼기",example:"a - b"},{symbol:"*",name:"곱하기",example:"a * b"},{symbol:"/",name:"나누기",example:"a / b"},{symbol:"%",name:"나머지",example:"a % b"},{symbol:"^",name:"거듭제곱",example:"a ^ 2"},{symbol:"()",name:"괄호",example:"(a + b) * c"},{symbol:"sqrt()",name:"제곱근",example:"sqrt(a)"},{symbol:"log()",name:"로그",example:"log(a)"},{symbol:"abs()",name:"절댓값",example:"abs(a)"},{symbol:"min()",name:"최솟값",example:"min(a, b)"},{symbol:"max()",name:"최댓값",example:"max(a, b)"}],ae=p.useMemo(()=>b?d.filter(s=>{var l;return s.name.toLowerCase().includes(b.toLowerCase())||s.formula.toLowerCase().includes(b.toLowerCase())||((l=s.description)==null?void 0:l.toLowerCase().includes(b.toLowerCase()))}):d,[d,b]),T=p.useCallback(s=>{try{const l=[],i=[],f=(s.match(/\(/g)||[]).length,N=(s.match(/\)/g)||[]).length;f!==N&&l.push("괄호가 일치하지 않습니다");const x=s.match(/[a-zA-Z_][a-zA-Z0-9_]*/g)||[],y=[...j.map(m=>m.value),...d.filter(m=>m.active).map(m=>m.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase())],P=x.filter(m=>!y.includes(m)&&!["sqrt","log","abs","min","max","if"].includes(m));if(P.length>0&&i.push(`알 수 없는 PEG: ${P.join(", ")}`),t){const m=t.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase();x.includes(m)&&l.push("수식이 자기 자신을 참조할 수 없습니다 (순환 참조)")}const k=s.match(/[^a-zA-Z0-9_+\-*/()^%.,\s]/g);k&&l.push(`지원하지 않는 문자: ${k.join(", ")}`);const B=x.filter(m=>j.some(H=>H.value===m)),v=x.filter(m=>d.some(H=>H.active&&H.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()===m));return{isValid:l.length===0,errors:l,warnings:i,dependencies:B,derivedDependencies:v}}catch{return{isValid:!1,errors:["수식 분석 중 오류가 발생했습니다"],warnings:[],dependencies:[],derivedDependencies:[]}}},[j,d,t]),V=p.useCallback(s=>{try{const l={};j.forEach(N=>{l[N.value]=Math.random()*100+50});let i=s;Object.keys(l).forEach(N=>{const x=new RegExp(`\\b${N}\\b`,"g");i=i.replace(x,l[N].toString())}),i=i.replace(/sqrt\(([^)]+)\)/g,"Math.sqrt($1)"),i=i.replace(/log\(([^)]+)\)/g,"Math.log($1)"),i=i.replace(/abs\(([^)]+)\)/g,"Math.abs($1)"),i=i.replace(/\^/g,"**");const f=Function(`"use strict"; return (${i})`)();return{success:!0,result:Number(f).toFixed(u.evaluationPrecision||4),mockData:l}}catch(l){return{success:!1,error:l.message}}},[j,u.evaluationPrecision]),q=()=>{const s={id:`formula_${Date.now()}`,name:"새 수식",formula:"",description:"",active:!0,category:"custom",unit:"",dependencies:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};o(s),_(s.id)},K=()=>{if(!t)return;const s=T(t.formula);if(!s.isValid){J.error(`수식 저장 실패: ${s.errors.join(", ")}`);return}const l={...t,dependencies:s.dependencies,derivedDependencies:s.derivedDependencies||[],updatedAt:new Date().toISOString()},i=d.findIndex(N=>N.id===t.id);let f;i>=0?(f=[...d],f[i]=l):f=[...d,l],r({...a,formulas:f}),o(null),J.success("수식이 저장되었습니다")},Z=s=>{const l=d.filter(i=>i.id!==s);r({...a,formulas:l}),n===s&&_(null),(t==null?void 0:t.id)===s&&o(null),J.success("수식이 삭제되었습니다")},U=s=>{t&&(o({...t,formula:s.formula,description:s.description,category:s.category}),J.success(`템플릿 "${s.name}"이 적용되었습니다`))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(C,{children:[e.jsx(E,{children:e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"Derived PEG 관리"]})}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{id:"auto-validate",checked:u.autoValidate,onCheckedChange:s=>r({...a,settings:{...u,autoValidate:s}})}),e.jsx(h,{htmlFor:"auto-validate",children:"실시간 검증"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{id:"show-dashboard",checked:u.showInDashboard,onCheckedChange:s=>r({...a,settings:{...u,showInDashboard:s}})}),e.jsx(h,{htmlFor:"show-dashboard",children:"Dashboard에 표시"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{id:"show-statistics",checked:u.showInStatistics,onCheckedChange:s=>r({...a,settings:{...u,showInStatistics:s}})}),e.jsx(h,{htmlFor:"show-statistics",children:"Statistics에 표시"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"계산 정밀도"}),e.jsxs(te,{value:($=u.evaluationPrecision)==null?void 0:$.toString(),onValueChange:s=>r({...a,settings:{...u,evaluationPrecision:parseInt(s)}}),children:[e.jsx(le,{children:e.jsx(ie,{})}),e.jsxs(ne,{children:[e.jsx(w,{value:"2",children:"소수점 2자리"}),e.jsx(w,{value:"4",children:"소수점 4자리"}),e.jsx(w,{value:"6",children:"소수점 6자리"})]})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(C,{children:[e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(G,{children:"수식 목록"}),e.jsxs(g,{onClick:q,size:"sm",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"새 수식"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(X,{placeholder:"수식 검색...",className:"pl-8",value:b,onChange:s=>M(s.target.value)})]})]}),e.jsx(D,{children:e.jsx(ce,{className:"h-96",children:e.jsx("div",{className:"space-y-2",children:ae.map(s=>e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${n===s.id?"bg-blue-50 border-blue-200":"hover:bg-gray-50"}`,onClick:()=>_(s.id),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:s.name}),e.jsx(S,{variant:s.active?"default":"secondary",className:"text-xs",children:s.active?"활성":"비활성"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1 font-mono",children:s.formula}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(S,{variant:"outline",className:"text-xs",children:s.category}),s.unit&&e.jsx(S,{variant:"outline",className:"text-xs",children:s.unit})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[e.jsx(g,{variant:"ghost",size:"sm",onClick:l=>{l.stopPropagation(),o({...s})},children:e.jsx(re,{className:"h-3 w-3"})}),e.jsx(g,{variant:"ghost",size:"sm",onClick:l=>{l.stopPropagation(),Z(s.id)},children:e.jsx(ye,{className:"h-3 w-3"})})]})]})},s.id))})})})]}),e.jsxs(C,{children:[e.jsx(E,{children:e.jsx(G,{children:t?"수식 편집":"수식 상세"})}),e.jsx(D,{children:t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-name",children:"수식 이름"}),e.jsx(X,{id:"formula-name",value:t.name,onChange:s=>o({...t,name:s.target.value}),placeholder:"예: RACH Success Rate (%)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-input",children:"수식"}),e.jsx(xe,{id:"formula-input",value:t.formula,onChange:s=>{o({...t,formula:s.target.value}),u.autoValidate&&A(T(s.target.value))},placeholder:"예: (randomaccesspremable / randomaccessresponse) * 100",className:"font-mono text-sm",rows:4}),c&&e.jsxs("div",{className:"space-y-2",children:[c.isValid?e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"수식이 유효합니다"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:c.errors.join(", ")})]}),c.warnings.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:c.warnings.join(", ")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-description",children:"설명"}),e.jsx(X,{id:"formula-description",value:t.description,onChange:s=>o({...t,description:s.target.value}),placeholder:"수식에 대한 설명을 입력하세요"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-category",children:"카테고리"}),e.jsxs(te,{value:t.category,onValueChange:s=>o({...t,category:s}),children:[e.jsx(le,{children:e.jsx(ie,{})}),e.jsxs(ne,{children:[e.jsx(w,{value:"percentage",children:"비율 (%)"}),e.jsx(w,{value:"success_rate",children:"성공률"}),e.jsx(w,{value:"efficiency",children:"효율성"}),e.jsx(w,{value:"quality",children:"품질"}),e.jsx(w,{value:"performance",children:"성능"}),e.jsx(w,{value:"custom",children:"사용자 정의"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-unit",children:"단위"}),e.jsx(X,{id:"formula-unit",value:t.unit,onChange:s=>o({...t,unit:s.target.value}),placeholder:"예: %, ms, Mbps"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{id:"formula-active",checked:t.active,onCheckedChange:s=>o({...t,active:s})}),e.jsx(h,{htmlFor:"formula-active",children:"수식 활성화"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{onClick:()=>{const s=T(t.formula);A(s);const l=V(t.formula);Y(l)},children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"테스트"]}),e.jsxs(g,{onClick:K,disabled:L,children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"저장"]}),e.jsxs(g,{variant:"outline",onClick:()=>o(null),children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"취소"]})]}),F&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(he,{}),e.jsx("h4",{className:"font-medium",children:"테스트 결과"}),F.success?e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-green-700",children:e.jsxs("strong",{children:["결과: ",F.result]})}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"모의 데이터를 사용한 계산 결과입니다"})]}):e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-700",children:["오류: ",F.error]})})]})]}):n?e.jsx("div",{className:"space-y-4",children:(()=>{const s=d.find(l=>l.id===n);return s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"수식"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg font-mono text-sm",children:s.formula})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"카테고리"}),e.jsx("p",{className:"text-sm",children:s.category})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"단위"}),e.jsx("p",{className:"text-sm",children:s.unit||"없음"})]})]}),(s.dependencies&&s.dependencies.length>0||s.derivedDependencies&&s.derivedDependencies.length>0)&&e.jsxs("div",{className:"space-y-2",children:[s.dependencies&&s.dependencies.length>0&&e.jsxs("div",{children:[e.jsxs(h,{className:"text-xs flex items-center gap-1",children:[e.jsx(z,{className:"h-3 w-3"}),"기본 PEG 의존성"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.dependencies.map(l=>e.jsx(S,{variant:"outline",className:"text-xs",children:l},l))})]}),s.derivedDependencies&&s.derivedDependencies.length>0&&e.jsxs("div",{children:[e.jsxs(h,{className:"text-xs flex items-center gap-1",children:[e.jsx(I,{className:"h-3 w-3"}),"Derived PEG 의존성"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.derivedDependencies.map(l=>e.jsx(S,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700",children:l},l))})]})]}),e.jsxs(g,{onClick:()=>o({...s}),className:"w-full",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"편집"]})]}):e.jsx("p",{children:"수식을 찾을 수 없습니다."})})()}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(I,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"수식을 선택하거나 새로 만들어보세요"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(C,{children:[e.jsx(E,{children:e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-5 w-5"}),"템플릿 라이브러리"]})}),e.jsx(D,{children:e.jsx("div",{className:"space-y-2",children:ee.map(s=>e.jsx("div",{className:"p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>U(s),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",children:s.name}),e.jsx("p",{className:"text-xs font-mono text-muted-foreground",children:s.formula}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description})]}),e.jsx(g,{variant:"ghost",size:"sm",children:e.jsx(ke,{className:"h-3 w-3"})})]})},s.id))})})]}),e.jsxs(C,{children:[e.jsx(E,{children:e.jsx(G,{children:"지원 연산자"})}),e.jsx(D,{children:e.jsx(ce,{className:"h-64",children:e.jsx("div",{className:"space-y-2",children:se.map((s,l)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("code",{className:"font-mono font-medium",children:s.symbol}),e.jsx("span",{className:"text-sm text-muted-foreground ml-2",children:s.name})]}),e.jsx("code",{className:"text-xs text-muted-foreground",children:s.example})]},l))})})})]})]}),e.jsxs(C,{children:[e.jsxs(E,{children:[e.jsx(G,{children:"사용 가능한 PEG"}),e.jsx(ue,{children:"수식에 사용할 수 있는 기본 PEG와 생성된 Derived PEG 목록입니다"})]}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[j.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"기본 PEG (",j.length,"개)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j.map(s=>e.jsx(g,{variant:"outline",size:"sm",onClick:()=>{t&&o({...t,formula:t.formula+s.value})},className:"text-xs",children:s.label||s.value},s.value))})]}),d.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Derived PEG (",d.filter(s=>s.active).length,"개)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.filter(s=>s.active).map(s=>e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>{if(t){const l=`${s.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()}`;o({...t,formula:t.formula+l})}},className:"text-xs bg-blue-50 border-blue-200 hover:bg-blue-100",title:s.description,children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),s.name,s.unit&&e.jsxs("span",{className:"ml-1 text-muted-foreground",children:["(",s.unit,")"]})]},s.id))}),d.filter(s=>s.active).length===0&&e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(I,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"아직 생성된 Derived PEG가 없습니다"}),e.jsx("p",{className:"text-xs",children:"새 수식을 추가하고 활성화하면 여기에 표시됩니다"})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-sm text-blue-700 mb-1",children:"💡 사용법"}),e.jsxs("ul",{className:"text-xs text-blue-600 space-y-1",children:[e.jsx("li",{children:"• 기본 PEG: 클릭하면 수식에 바로 삽입됩니다"}),e.jsx("li",{children:"• Derived PEG: 다른 수식에서 참조할 수 있는 계산된 값입니다"}),e.jsx("li",{children:"• 비활성화된 Derived PEG는 목록에 표시되지 않습니다"}),e.jsx("li",{children:"• Derived PEG끼리 순환 참조하지 않도록 주의하세요"})]})]})]})})]})]})};function Be(a=[],r=[]){const j=a.map(n=>({...n,type:"basic",source:"database"})),L=r.filter(n=>n.active).map(n=>({value:n.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase(),label:`${n.name}${n.unit?` (${n.unit})`:""} [Derived]`,originalName:n.name,description:n.description,formula:n.formula,type:"derived",source:"calculated",dependencies:n.dependencies||[],derivedDependencies:n.derivedDependencies||[]}));return[...j,...L]}function Oe(a=[]){return a.map(r=>({value:r.value,label:r.label,type:r.type,color:r.type==="derived"?"#3b82f6":"#6b7280",isDerived:r.type==="derived",description:r.description,formula:r.formula}))}const ze=()=>{var V,q,K,Z,U,$,s,l,i,f,N;const{preferences:a,isLoading:r,isSaving:j,error:L,lastSaved:n,updateSettings:_}=pe(),[t,o]=p.useState([]),[b,M]=p.useState(!1),[c,A]=p.useState(!1),[F,Y]=p.useState(null),d=p.useCallback(async()=>{var x;try{M(!0),console.info("[PreferenceManager] Fetching DB PEGs");let y={};try{const v=localStorage.getItem("dbConfig");v&&(y=JSON.parse(v))}catch{}if(!y.host){console.warn("[PreferenceManager] No DB config found");return}const P=await je.post("/api/master/pegs",{db:y,table:y.table||"summary",limit:100}),k=((x=P==null?void 0:P.data)==null?void 0:x.pegs)||[];console.info("[PreferenceManager] DB PEGs loaded:",k.length);const B=k.map(v=>({value:v.id||v.name,label:`${v.name||v.id} (DB PEG)`}));o(B),Y(new Date)}catch(y){console.error("[PreferenceManager] Error fetching DB PEGs:",y)}finally{M(!1)}},[]),u=p.useCallback(()=>{var B,v,m;console.log("🔍 getCurrentPegOptions 호출됨:",{useDbPegs:c,dbPegOptionsCount:t.length,derivedFormulasCount:((v=(B=a==null?void 0:a.derivedPegSettings)==null?void 0:B.formulas)==null?void 0:v.length)||0});let x=[];c&&t.length>0?(console.log("📊 Database PEG 사용:",t),x=t):(console.log("📝 기본 PEG 목록 사용 (fallback)"),x=[{value:"availability",label:"Availability (%)"},{value:"rrc",label:"RRC Success Rate (%)"},{value:"erab",label:"ERAB Success Rate (%)"},{value:"sar",label:"SAR"},{value:"mobility_intra",label:"Mobility Intra (%)"},{value:"cqi",label:"CQI"},{value:"se",label:"Spectral Efficiency"},{value:"dl_thp",label:"DL Throughput"},{value:"ul_int",label:"UL Interference"}]);const y=((m=a==null?void 0:a.derivedPegSettings)==null?void 0:m.formulas)||[],P=Be(x,y),k=Oe(P);return console.log("✅ 최종 PEG 옵션:",k),k},[c,t,(V=a==null?void 0:a.derivedPegSettings)==null?void 0:V.formulas]),ee=[{key:"selectedPegs",label:"Dashboard에 표시할 PEG 목록",type:"multiselect",required:!0,options:u(),placeholder:c?"Database의 실제 PEG를 선택하세요":"Dashboard에서 보여줄 PEG를 선택하세요"},{key:"defaultNe",label:"기본 NE",type:"text",placeholder:"예: nvgnb#10000,nvgnb#20000"},{key:"defaultCellId",label:"기본 Cell ID",type:"text",placeholder:"예: 2010,2011"},{key:"autoRefreshInterval",label:"자동 새로고침 간격 (초)",type:"number",min:0,max:300,placeholder:"0 = 비활성화, 30 = 30초마다"},{key:"chartStyle",label:"차트 스타일",type:"select",options:[{value:"line",label:"Line Chart"},{value:"area",label:"Area Chart"},{value:"bar",label:"Bar Chart"}]},{key:"showLegend",label:"차트 범례 표시",type:"switch"},{key:"showGrid",label:"차트 격자 표시",type:"switch"}],se=[{key:"defaultNe",label:"기본 NE",type:"text",placeholder:"예: nvgnb#10000,nvgnb#20000"},{key:"defaultCellId",label:"기본 Cell ID",type:"text",placeholder:"예: 2010,2011"},{key:"defaultDateRange",label:"기본 날짜 범위 (일)",type:"number",min:1,max:365,placeholder:"기본 조회 기간"},{key:"decimalPlaces",label:"소수점 자릿수",type:"number",min:0,max:6,placeholder:"통계 수치 표시 정밀도"},{key:"showComparisonOptions",label:"비교 분석 옵션 표시",type:"switch"},{key:"autoCalculateStats",label:"자동 통계 계산",type:"switch"}],ae=[{key:"host",label:"Host",type:"text",placeholder:"예: 127.0.0.1"},{key:"port",label:"Port",type:"number",min:1,max:65535,placeholder:"5432"},{key:"user",label:"User",type:"text",placeholder:"postgres"},{key:"password",label:"Password",type:"text",placeholder:"비밀번호"},{key:"dbname",label:"DB Name",type:"text",placeholder:"postgres"},{key:"table",label:"기본 테이블명",type:"text",placeholder:"summary"}],T=[{key:"enableNotifications",label:"알림 활성화",type:"switch"},{key:"emailNotifications",label:"이메일 알림",type:"switch"},{key:"soundEnabled",label:"소리 알림",type:"switch"},{key:"notificationFrequency",label:"알림 빈도",type:"select",options:[{value:"immediate",label:"즉시"},{value:"hourly",label:"매시간"},{value:"daily",label:"매일"},{value:"weekly",label:"매주"}]}];return r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"환경설정"}),e.jsxs(S,{variant:"secondary",className:"text-xs",children:[e.jsx(oe,{className:"h-3 w-3 mr-1"}),"로딩 중..."]})]}),e.jsx(C,{children:e.jsx(D,{className:"pt-6",children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"설정을 불러오는 중입니다..."})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"환경설정"}),e.jsx("p",{className:"text-muted-foreground",children:"Dashboard와 Statistics의 동작을 설정할 수 있습니다"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j&&e.jsxs(S,{variant:"secondary",className:"text-xs",children:[e.jsx(oe,{className:"h-3 w-3 mr-1"}),"저장 중..."]}),L&&e.jsx(S,{variant:"destructive",className:"text-xs",children:"오류 발생"}),n&&e.jsxs(S,{variant:"outline",className:"text-xs",children:["마지막 저장: ",new Date(n).toLocaleTimeString()]})]})]}),e.jsxs(be,{defaultValue:"dashboard",className:"w-full",children:[e.jsxs(ve,{className:"grid w-full grid-cols-6",children:[e.jsxs(O,{value:"dashboard",className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Dashboard"]}),e.jsxs(O,{value:"statistics",className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Statistics"]}),e.jsxs(O,{value:"database",className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Database"]}),e.jsxs(O,{value:"derived-peg",className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Derived PEG"]}),e.jsxs(O,{value:"notifications",className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-4 w-4"}),"알림"]}),e.jsxs(O,{value:"backup",className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"백업/복원"]})]}),e.jsxs(R,{value:"dashboard",className:"space-y-6",children:[e.jsxs(C,{children:[e.jsx(E,{children:e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"PEG 데이터 소스"]})}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:c?"Database PEG 사용 중":"기본 KPI 목록 사용 중"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?"Database Settings에서 연결된 실제 PEG 목록을 사용합니다":"미리 정의된 기본 KPI 목록을 사용합니다"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{variant:c?"secondary":"default",size:"sm",onClick:()=>{A(!1),localStorage.setItem("useDbPegs","false")},children:"기본 KPI"}),e.jsx(g,{variant:c?"default":"secondary",size:"sm",onClick:()=>{A(!0),localStorage.setItem("useDbPegs","true"),d()},disabled:b,children:b?"로딩 중...":"DB PEG"}),t.length>0&&e.jsxs(g,{variant:"outline",size:"sm",onClick:d,disabled:b,children:[e.jsx(Fe,{className:`h-3 w-3 ${b?"animate-spin":""}`}),"새로고침"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"현재 모드"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?"Database PEG":"기본 KPI"})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"사용 가능한 PEG"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?`${t.length}개`:"9개 (기본)"})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"마지막 업데이트"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:F?F.toLocaleTimeString():"없음"})]})]}),c&&t.length===0&&!b&&e.jsx("div",{className:"p-3 border rounded-lg bg-amber-50 border-amber-200",children:e.jsx("p",{className:"text-sm text-amber-700",children:"⚠️ DB PEG를 불러올 수 없습니다. Database Settings에서 DB 연결을 확인하세요."})}),c&&t.length>0&&e.jsx("div",{className:"p-3 border rounded-lg bg-green-50 border-green-200",children:e.jsxs("p",{className:"text-sm text-green-700",children:["✅ ",t.length,"개의 실제 DB PEG를 사용할 수 있습니다"]})})]})})]}),e.jsx(W,{title:"Dashboard 설정",description:"Dashboard에서 표시할 PEG, 차트 스타일, 자동 새로고침 등을 설정합니다",settingKey:"dashboardSettings",fields:ee,defaultOpen:!0,showResetButton:!0,showSaveButton:!1})]}),e.jsx(R,{value:"statistics",className:"space-y-6",children:e.jsx(W,{title:"Statistics 설정",description:"Statistics 페이지의 기본값, 소수점 자릿수, 비교 옵션 등을 설정합니다",settingKey:"statisticsSettings",fields:se,defaultOpen:!0,showResetButton:!0,showSaveButton:!1})}),e.jsx(R,{value:"database",className:"space-y-6",children:e.jsx(W,{title:"Database 설정",description:"LLM 분석과 Statistics에서 공통으로 사용할 PostgreSQL DB 설정입니다 (테이블명 포함).",settingKey:"databaseSettings",fields:ae,defaultOpen:!0,showResetButton:!0,showSaveButton:!1})}),e.jsx(R,{value:"derived-peg",className:"space-y-6",children:e.jsx(Ie,{derivedPegSettings:(a==null?void 0:a.derivedPegSettings)||{formulas:[],settings:{}},updateDerivedPegSettings:x=>{_({derivedPegSettings:x})},availablePegs:u(),saving:j})}),e.jsx(R,{value:"notifications",className:"space-y-6",children:e.jsx(W,{title:"알림 설정",description:"이메일, 소리 알림 등 알림 관련 설정을 관리합니다",settingKey:"notificationSettings",fields:T,defaultOpen:!0,showResetButton:!0,showSaveButton:!1})}),e.jsx(R,{value:"backup",className:"space-y-6",children:e.jsx(ge,{title:"설정 백업 및 복원",description:"모든 환경설정을 JSON 파일로 내보내거나 백업 파일에서 복원할 수 있습니다",defaultOpen:!0})})]}),e.jsxs(C,{children:[e.jsx(E,{children:e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5"}),"현재 설정 요약"]})}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Dashboard"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["선택된 PEG: ",((K=(q=a==null?void 0:a.dashboardSettings)==null?void 0:q.selectedPegs)==null?void 0:K.length)||0,"개"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["PEG 소스: ",c?`DB (${t.length}개)`:"기본 KPI"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["차트 스타일: ",((Z=a==null?void 0:a.dashboardSettings)==null?void 0:Z.chartStyle)||"line"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["자동 새로고침: ",((U=a==null?void 0:a.dashboardSettings)==null?void 0:U.autoRefreshInterval)||0,"초"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Statistics"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["기본 기간: ",(($=a==null?void 0:a.statisticsSettings)==null?void 0:$.defaultDateRange)||7,"일"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["소수점: ",((s=a==null?void 0:a.statisticsSettings)==null?void 0:s.decimalPlaces)||2,"자리"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["비교 옵션: ",(l=a==null?void 0:a.statisticsSettings)!=null&&l.showComparisonOptions?"활성":"비활성"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"알림"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["알림: ",(i=a==null?void 0:a.notificationSettings)!=null&&i.enableNotifications?"활성":"비활성"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["이메일: ",(f=a==null?void 0:a.notificationSettings)!=null&&f.emailNotifications?"활성":"비활성"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["소리: ",(N=a==null?void 0:a.notificationSettings)!=null&&N.soundEnabled?"활성":"비활성"]})]})]})]})})]})]})};export{ze as default};

import{r as p,M as e,a3 as J}from"./vendor-D_Wz334c.js";import{C,b as E,c as G,d as D,S as Q,L as h,h as te,i as le,j as ie,k as ne,l as w,e as g,I as X,B as S,T as xe,m as he,n as ue,o as pe,a as je,p as W,q as ge}from"./index-BAtDSpDQ.js";import{S as ce,T as be,a as ve,b as O,c as R}from"./scroll-area-DLqPd2TV.js";import{m as I,P as fe,n as Ne,o as re,b as ye,p as we,h as de,q as Ce,e as De,X as Se,D as z,r as Pe,s as ke,g as oe,C as Ee,t as Ge,S as me,l as Fe}from"./icon-vendor-DhUEaqm7.js";import"./utils-vendor-DrCDvq1f.js";import"./ui-vendor-D1gbbhYx.js";const Ie=({derivedPegSettings:a,updateDerivedPegSettings:r,availablePegs:j=[],saving:L=!1})=>{var $;const[n,_]=p.useState(null),[t,o]=p.useState(null),[b,M]=p.useState(""),[c,A]=p.useState(null),[F,Y]=p.useState(null),d=(a==null?void 0:a.formulas)||[],u=(a==null?void 0:a.settings)||{autoValidate:!0,showInDashboard:!0,showInStatistics:!0,evaluationPrecision:4},ee=[{id:"success_rate",name:"Success Rate (%)",formula:"(success_count / total_count) * 100",description:"ì„±ê³µë¥  ê³„ì‚° í…œí”Œë¦¿",category:"percentage"},{id:"efficiency",name:"Efficiency (%)",formula:"(good_values / all_values) * 100",description:"íš¨ìœ¨ì„± ê³„ì‚° í…œí”Œë¦¿",category:"percentage"},{id:"delta",name:"Delta Calculation",formula:"current_value - previous_value",description:"ë³€í™”ëŸ‰ ê³„ì‚° í…œí”Œë¦¿",category:"difference"},{id:"ratio",name:"Simple Ratio",formula:"numerator / denominator",description:"ë‹¨ìˆœ ë¹„ìœ¨ ê³„ì‚° í…œí”Œë¦¿",category:"ratio"}],se=[{symbol:"+",name:"ë”í•˜ê¸°",example:"a + b"},{symbol:"-",name:"ë¹¼ê¸°",example:"a - b"},{symbol:"*",name:"ê³±í•˜ê¸°",example:"a * b"},{symbol:"/",name:"ë‚˜ëˆ„ê¸°",example:"a / b"},{symbol:"%",name:"ë‚˜ë¨¸ì§€",example:"a % b"},{symbol:"^",name:"ê±°ë“­ì œê³±",example:"a ^ 2"},{symbol:"()",name:"ê´„í˜¸",example:"(a + b) * c"},{symbol:"sqrt()",name:"ì œê³±ê·¼",example:"sqrt(a)"},{symbol:"log()",name:"ë¡œê·¸",example:"log(a)"},{symbol:"abs()",name:"ì ˆëŒ“ê°’",example:"abs(a)"},{symbol:"min()",name:"ìµœì†Ÿê°’",example:"min(a, b)"},{symbol:"max()",name:"ìµœëŒ“ê°’",example:"max(a, b)"}],ae=p.useMemo(()=>b?d.filter(s=>{var l;return s.name.toLowerCase().includes(b.toLowerCase())||s.formula.toLowerCase().includes(b.toLowerCase())||((l=s.description)==null?void 0:l.toLowerCase().includes(b.toLowerCase()))}):d,[d,b]),T=p.useCallback(s=>{try{const l=[],i=[],f=(s.match(/\(/g)||[]).length,N=(s.match(/\)/g)||[]).length;f!==N&&l.push("ê´„í˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤");const x=s.match(/[a-zA-Z_][a-zA-Z0-9_]*/g)||[],y=[...j.map(m=>m.value),...d.filter(m=>m.active).map(m=>m.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase())],P=x.filter(m=>!y.includes(m)&&!["sqrt","log","abs","min","max","if"].includes(m));if(P.length>0&&i.push(`ì•Œ ìˆ˜ ì—†ëŠ” PEG: ${P.join(", ")}`),t){const m=t.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase();x.includes(m)&&l.push("ìˆ˜ì‹ì´ ìê¸° ìì‹ ì„ ì°¸ì¡°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (ìˆœí™˜ ì°¸ì¡°)")}const k=s.match(/[^a-zA-Z0-9_+\-*/()^%.,\s]/g);k&&l.push(`ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¬¸ì: ${k.join(", ")}`);const B=x.filter(m=>j.some(H=>H.value===m)),v=x.filter(m=>d.some(H=>H.active&&H.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()===m));return{isValid:l.length===0,errors:l,warnings:i,dependencies:B,derivedDependencies:v}}catch{return{isValid:!1,errors:["ìˆ˜ì‹ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"],warnings:[],dependencies:[],derivedDependencies:[]}}},[j,d,t]),V=p.useCallback(s=>{try{const l={};j.forEach(N=>{l[N.value]=Math.random()*100+50});let i=s;Object.keys(l).forEach(N=>{const x=new RegExp(`\\b${N}\\b`,"g");i=i.replace(x,l[N].toString())}),i=i.replace(/sqrt\(([^)]+)\)/g,"Math.sqrt($1)"),i=i.replace(/log\(([^)]+)\)/g,"Math.log($1)"),i=i.replace(/abs\(([^)]+)\)/g,"Math.abs($1)"),i=i.replace(/\^/g,"**");const f=Function(`"use strict"; return (${i})`)();return{success:!0,result:Number(f).toFixed(u.evaluationPrecision||4),mockData:l}}catch(l){return{success:!1,error:l.message}}},[j,u.evaluationPrecision]),q=()=>{const s={id:`formula_${Date.now()}`,name:"ìƒˆ ìˆ˜ì‹",formula:"",description:"",active:!0,category:"custom",unit:"",dependencies:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};o(s),_(s.id)},K=()=>{if(!t)return;const s=T(t.formula);if(!s.isValid){J.error(`ìˆ˜ì‹ ì €ì¥ ì‹¤íŒ¨: ${s.errors.join(", ")}`);return}const l={...t,dependencies:s.dependencies,derivedDependencies:s.derivedDependencies||[],updatedAt:new Date().toISOString()},i=d.findIndex(N=>N.id===t.id);let f;i>=0?(f=[...d],f[i]=l):f=[...d,l],r({...a,formulas:f}),o(null),J.success("ìˆ˜ì‹ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤")},Z=s=>{const l=d.filter(i=>i.id!==s);r({...a,formulas:l}),n===s&&_(null),(t==null?void 0:t.id)===s&&o(null),J.success("ìˆ˜ì‹ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤")},U=s=>{t&&(o({...t,formula:s.formula,description:s.description,category:s.category}),J.success(`í…œí”Œë¦¿ "${s.name}"ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤`))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(C,{children:[e.jsx(E,{children:e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"Derived PEG ê´€ë¦¬"]})}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{id:"auto-validate",checked:u.autoValidate,onCheckedChange:s=>r({...a,settings:{...u,autoValidate:s}})}),e.jsx(h,{htmlFor:"auto-validate",children:"ì‹¤ì‹œê°„ ê²€ì¦"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{id:"show-dashboard",checked:u.showInDashboard,onCheckedChange:s=>r({...a,settings:{...u,showInDashboard:s}})}),e.jsx(h,{htmlFor:"show-dashboard",children:"Dashboardì— í‘œì‹œ"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{id:"show-statistics",checked:u.showInStatistics,onCheckedChange:s=>r({...a,settings:{...u,showInStatistics:s}})}),e.jsx(h,{htmlFor:"show-statistics",children:"Statisticsì— í‘œì‹œ"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"ê³„ì‚° ì •ë°€ë„"}),e.jsxs(te,{value:($=u.evaluationPrecision)==null?void 0:$.toString(),onValueChange:s=>r({...a,settings:{...u,evaluationPrecision:parseInt(s)}}),children:[e.jsx(le,{children:e.jsx(ie,{})}),e.jsxs(ne,{children:[e.jsx(w,{value:"2",children:"ì†Œìˆ˜ì  2ìë¦¬"}),e.jsx(w,{value:"4",children:"ì†Œìˆ˜ì  4ìë¦¬"}),e.jsx(w,{value:"6",children:"ì†Œìˆ˜ì  6ìë¦¬"})]})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(C,{children:[e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(G,{children:"ìˆ˜ì‹ ëª©ë¡"}),e.jsxs(g,{onClick:q,size:"sm",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"ìƒˆ ìˆ˜ì‹"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(X,{placeholder:"ìˆ˜ì‹ ê²€ìƒ‰...",className:"pl-8",value:b,onChange:s=>M(s.target.value)})]})]}),e.jsx(D,{children:e.jsx(ce,{className:"h-96",children:e.jsx("div",{className:"space-y-2",children:ae.map(s=>e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${n===s.id?"bg-blue-50 border-blue-200":"hover:bg-gray-50"}`,onClick:()=>_(s.id),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:s.name}),e.jsx(S,{variant:s.active?"default":"secondary",className:"text-xs",children:s.active?"í™œì„±":"ë¹„í™œì„±"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1 font-mono",children:s.formula}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(S,{variant:"outline",className:"text-xs",children:s.category}),s.unit&&e.jsx(S,{variant:"outline",className:"text-xs",children:s.unit})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[e.jsx(g,{variant:"ghost",size:"sm",onClick:l=>{l.stopPropagation(),o({...s})},children:e.jsx(re,{className:"h-3 w-3"})}),e.jsx(g,{variant:"ghost",size:"sm",onClick:l=>{l.stopPropagation(),Z(s.id)},children:e.jsx(ye,{className:"h-3 w-3"})})]})]})},s.id))})})})]}),e.jsxs(C,{children:[e.jsx(E,{children:e.jsx(G,{children:t?"ìˆ˜ì‹ í¸ì§‘":"ìˆ˜ì‹ ìƒì„¸"})}),e.jsx(D,{children:t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-name",children:"ìˆ˜ì‹ ì´ë¦„"}),e.jsx(X,{id:"formula-name",value:t.name,onChange:s=>o({...t,name:s.target.value}),placeholder:"ì˜ˆ: RACH Success Rate (%)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-input",children:"ìˆ˜ì‹"}),e.jsx(xe,{id:"formula-input",value:t.formula,onChange:s=>{o({...t,formula:s.target.value}),u.autoValidate&&A(T(s.target.value))},placeholder:"ì˜ˆ: (randomaccesspremable / randomaccessresponse) * 100",className:"font-mono text-sm",rows:4}),c&&e.jsxs("div",{className:"space-y-2",children:[c.isValid?e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"ìˆ˜ì‹ì´ ìœ íš¨í•©ë‹ˆë‹¤"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:c.errors.join(", ")})]}),c.warnings.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:c.warnings.join(", ")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-description",children:"ì„¤ëª…"}),e.jsx(X,{id:"formula-description",value:t.description,onChange:s=>o({...t,description:s.target.value}),placeholder:"ìˆ˜ì‹ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-category",children:"ì¹´í…Œê³ ë¦¬"}),e.jsxs(te,{value:t.category,onValueChange:s=>o({...t,category:s}),children:[e.jsx(le,{children:e.jsx(ie,{})}),e.jsxs(ne,{children:[e.jsx(w,{value:"percentage",children:"ë¹„ìœ¨ (%)"}),e.jsx(w,{value:"success_rate",children:"ì„±ê³µë¥ "}),e.jsx(w,{value:"efficiency",children:"íš¨ìœ¨ì„±"}),e.jsx(w,{value:"quality",children:"í’ˆì§ˆ"}),e.jsx(w,{value:"performance",children:"ì„±ëŠ¥"}),e.jsx(w,{value:"custom",children:"ì‚¬ìš©ì ì •ì˜"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-unit",children:"ë‹¨ìœ„"}),e.jsx(X,{id:"formula-unit",value:t.unit,onChange:s=>o({...t,unit:s.target.value}),placeholder:"ì˜ˆ: %, ms, Mbps"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{id:"formula-active",checked:t.active,onCheckedChange:s=>o({...t,active:s})}),e.jsx(h,{htmlFor:"formula-active",children:"ìˆ˜ì‹ í™œì„±í™”"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{onClick:()=>{const s=T(t.formula);A(s);const l=V(t.formula);Y(l)},children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"í…ŒìŠ¤íŠ¸"]}),e.jsxs(g,{onClick:K,disabled:L,children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"ì €ì¥"]}),e.jsxs(g,{variant:"outline",onClick:()=>o(null),children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"ì·¨ì†Œ"]})]}),F&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(he,{}),e.jsx("h4",{className:"font-medium",children:"í…ŒìŠ¤íŠ¸ ê²°ê³¼"}),F.success?e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-green-700",children:e.jsxs("strong",{children:["ê²°ê³¼: ",F.result]})}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"ëª¨ì˜ ë°ì´í„°ë¥¼ ì‚¬ìš©í•œ ê³„ì‚° ê²°ê³¼ì…ë‹ˆë‹¤"})]}):e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-700",children:["ì˜¤ë¥˜: ",F.error]})})]})]}):n?e.jsx("div",{className:"space-y-4",children:(()=>{const s=d.find(l=>l.id===n);return s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"ìˆ˜ì‹"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg font-mono text-sm",children:s.formula})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"ì¹´í…Œê³ ë¦¬"}),e.jsx("p",{className:"text-sm",children:s.category})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"ë‹¨ìœ„"}),e.jsx("p",{className:"text-sm",children:s.unit||"ì—†ìŒ"})]})]}),(s.dependencies&&s.dependencies.length>0||s.derivedDependencies&&s.derivedDependencies.length>0)&&e.jsxs("div",{className:"space-y-2",children:[s.dependencies&&s.dependencies.length>0&&e.jsxs("div",{children:[e.jsxs(h,{className:"text-xs flex items-center gap-1",children:[e.jsx(z,{className:"h-3 w-3"}),"ê¸°ë³¸ PEG ì˜ì¡´ì„±"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.dependencies.map(l=>e.jsx(S,{variant:"outline",className:"text-xs",children:l},l))})]}),s.derivedDependencies&&s.derivedDependencies.length>0&&e.jsxs("div",{children:[e.jsxs(h,{className:"text-xs flex items-center gap-1",children:[e.jsx(I,{className:"h-3 w-3"}),"Derived PEG ì˜ì¡´ì„±"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.derivedDependencies.map(l=>e.jsx(S,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700",children:l},l))})]})]}),e.jsxs(g,{onClick:()=>o({...s}),className:"w-full",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"í¸ì§‘"]})]}):e.jsx("p",{children:"ìˆ˜ì‹ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."})})()}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(I,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"ìˆ˜ì‹ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒˆë¡œ ë§Œë“¤ì–´ë³´ì„¸ìš”"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(C,{children:[e.jsx(E,{children:e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-5 w-5"}),"í…œí”Œë¦¿ ë¼ì´ë¸ŒëŸ¬ë¦¬"]})}),e.jsx(D,{children:e.jsx("div",{className:"space-y-2",children:ee.map(s=>e.jsx("div",{className:"p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>U(s),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",children:s.name}),e.jsx("p",{className:"text-xs font-mono text-muted-foreground",children:s.formula}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description})]}),e.jsx(g,{variant:"ghost",size:"sm",children:e.jsx(ke,{className:"h-3 w-3"})})]})},s.id))})})]}),e.jsxs(C,{children:[e.jsx(E,{children:e.jsx(G,{children:"ì§€ì› ì—°ì‚°ì"})}),e.jsx(D,{children:e.jsx(ce,{className:"h-64",children:e.jsx("div",{className:"space-y-2",children:se.map((s,l)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("code",{className:"font-mono font-medium",children:s.symbol}),e.jsx("span",{className:"text-sm text-muted-foreground ml-2",children:s.name})]}),e.jsx("code",{className:"text-xs text-muted-foreground",children:s.example})]},l))})})})]})]}),e.jsxs(C,{children:[e.jsxs(E,{children:[e.jsx(G,{children:"ì‚¬ìš© ê°€ëŠ¥í•œ PEG"}),e.jsx(ue,{children:"ìˆ˜ì‹ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ë³¸ PEGì™€ ìƒì„±ëœ Derived PEG ëª©ë¡ì…ë‹ˆë‹¤"})]}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[j.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"ê¸°ë³¸ PEG (",j.length,"ê°œ)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j.map(s=>e.jsx(g,{variant:"outline",size:"sm",onClick:()=>{t&&o({...t,formula:t.formula+s.value})},className:"text-xs",children:s.label||s.value},s.value))})]}),d.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Derived PEG (",d.filter(s=>s.active).length,"ê°œ)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.filter(s=>s.active).map(s=>e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>{if(t){const l=`${s.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()}`;o({...t,formula:t.formula+l})}},className:"text-xs bg-blue-50 border-blue-200 hover:bg-blue-100",title:s.description,children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),s.name,s.unit&&e.jsxs("span",{className:"ml-1 text-muted-foreground",children:["(",s.unit,")"]})]},s.id))}),d.filter(s=>s.active).length===0&&e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(I,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"ì•„ì§ ìƒì„±ëœ Derived PEGê°€ ì—†ìŠµë‹ˆë‹¤"}),e.jsx("p",{className:"text-xs",children:"ìƒˆ ìˆ˜ì‹ì„ ì¶”ê°€í•˜ê³  í™œì„±í™”í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤"})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-sm text-blue-700 mb-1",children:"ğŸ’¡ ì‚¬ìš©ë²•"}),e.jsxs("ul",{className:"text-xs text-blue-600 space-y-1",children:[e.jsx("li",{children:"â€¢ ê¸°ë³¸ PEG: í´ë¦­í•˜ë©´ ìˆ˜ì‹ì— ë°”ë¡œ ì‚½ì…ë©ë‹ˆë‹¤"}),e.jsx("li",{children:"â€¢ Derived PEG: ë‹¤ë¥¸ ìˆ˜ì‹ì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ” ê³„ì‚°ëœ ê°’ì…ë‹ˆë‹¤"}),e.jsx("li",{children:"â€¢ ë¹„í™œì„±í™”ëœ Derived PEGëŠ” ëª©ë¡ì— í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤"}),e.jsx("li",{children:"â€¢ Derived PEGë¼ë¦¬ ìˆœí™˜ ì°¸ì¡°í•˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì„¸ìš”"})]})]})]})})]})]})};function Be(a=[],r=[]){const j=a.map(n=>({...n,type:"basic",source:"database"})),L=r.filter(n=>n.active).map(n=>({value:n.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase(),label:`${n.name}${n.unit?` (${n.unit})`:""} [Derived]`,originalName:n.name,description:n.description,formula:n.formula,type:"derived",source:"calculated",dependencies:n.dependencies||[],derivedDependencies:n.derivedDependencies||[]}));return[...j,...L]}function Oe(a=[]){return a.map(r=>({value:r.value,label:r.label,type:r.type,color:r.type==="derived"?"#3b82f6":"#6b7280",isDerived:r.type==="derived",description:r.description,formula:r.formula}))}const ze=()=>{var V,q,K,Z,U,$,s,l,i,f,N;const{preferences:a,isLoading:r,isSaving:j,error:L,lastSaved:n,updateSettings:_}=pe(),[t,o]=p.useState([]),[b,M]=p.useState(!1),[c,A]=p.useState(!1),[F,Y]=p.useState(null),d=p.useCallback(async()=>{var x;try{M(!0),console.info("[PreferenceManager] Fetching DB PEGs");let y={};try{const v=localStorage.getItem("dbConfig");v&&(y=JSON.parse(v))}catch{}if(!y.host){console.warn("[PreferenceManager] No DB config found");return}const P=await je.post("/api/master/pegs",{db:y,table:y.table||"summary",limit:100}),k=((x=P==null?void 0:P.data)==null?void 0:x.pegs)||[];console.info("[PreferenceManager] DB PEGs loaded:",k.length);const B=k.map(v=>({value:v.id||v.name,label:`${v.name||v.id} (DB PEG)`}));o(B),Y(new Date)}catch(y){console.error("[PreferenceManager] Error fetching DB PEGs:",y)}finally{M(!1)}},[]),u=p.useCallback(()=>{var B,v,m;console.log("ğŸ” getCurrentPegOptions í˜¸ì¶œë¨:",{useDbPegs:c,dbPegOptionsCount:t.length,derivedFormulasCount:((v=(B=a==null?void 0:a.derivedPegSettings)==null?void 0:B.formulas)==null?void 0:v.length)||0});let x=[];c&&t.length>0?(console.log("ğŸ“Š Database PEG ì‚¬ìš©:",t),x=t):(console.log("ğŸ“ ê¸°ë³¸ PEG ëª©ë¡ ì‚¬ìš© (fallback)"),x=[{value:"availability",label:"Availability (%)"},{value:"rrc",label:"RRC Success Rate (%)"},{value:"erab",label:"ERAB Success Rate (%)"},{value:"sar",label:"SAR"},{value:"mobility_intra",label:"Mobility Intra (%)"},{value:"cqi",label:"CQI"},{value:"se",label:"Spectral Efficiency"},{value:"dl_thp",label:"DL Throughput"},{value:"ul_int",label:"UL Interference"}]);const y=((m=a==null?void 0:a.derivedPegSettings)==null?void 0:m.formulas)||[],P=Be(x,y),k=Oe(P);return console.log("âœ… ìµœì¢… PEG ì˜µì…˜:",k),k},[c,t,(V=a==null?void 0:a.derivedPegSettings)==null?void 0:V.formulas]),ee=[{key:"selectedPegs",label:"Dashboardì— í‘œì‹œí•  PEG ëª©ë¡",type:"multiselect",required:!0,options:u(),placeholder:c?"Databaseì˜ ì‹¤ì œ PEGë¥¼ ì„ íƒí•˜ì„¸ìš”":"Dashboardì—ì„œ ë³´ì—¬ì¤„ PEGë¥¼ ì„ íƒí•˜ì„¸ìš”"},{key:"defaultNe",label:"ê¸°ë³¸ NE",type:"text",placeholder:"ì˜ˆ: nvgnb#10000,nvgnb#20000"},{key:"defaultCellId",label:"ê¸°ë³¸ Cell ID",type:"text",placeholder:"ì˜ˆ: 2010,2011"},{key:"autoRefreshInterval",label:"ìë™ ìƒˆë¡œê³ ì¹¨ ê°„ê²© (ì´ˆ)",type:"number",min:0,max:300,placeholder:"0 = ë¹„í™œì„±í™”, 30 = 30ì´ˆë§ˆë‹¤"},{key:"chartStyle",label:"ì°¨íŠ¸ ìŠ¤íƒ€ì¼",type:"select",options:[{value:"line",label:"Line Chart"},{value:"area",label:"Area Chart"},{value:"bar",label:"Bar Chart"}]},{key:"showLegend",label:"ì°¨íŠ¸ ë²”ë¡€ í‘œì‹œ",type:"switch"},{key:"showGrid",label:"ì°¨íŠ¸ ê²©ì í‘œì‹œ",type:"switch"}],se=[{key:"defaultNe",label:"ê¸°ë³¸ NE",type:"text",placeholder:"ì˜ˆ: nvgnb#10000,nvgnb#20000"},{key:"defaultCellId",label:"ê¸°ë³¸ Cell ID",type:"text",placeholder:"ì˜ˆ: 2010,2011"},{key:"defaultDateRange",label:"ê¸°ë³¸ ë‚ ì§œ ë²”ìœ„ (ì¼)",type:"number",min:1,max:365,placeholder:"ê¸°ë³¸ ì¡°íšŒ ê¸°ê°„"},{key:"decimalPlaces",label:"ì†Œìˆ˜ì  ìë¦¿ìˆ˜",type:"number",min:0,max:6,placeholder:"í†µê³„ ìˆ˜ì¹˜ í‘œì‹œ ì •ë°€ë„"},{key:"showComparisonOptions",label:"ë¹„êµ ë¶„ì„ ì˜µì…˜ í‘œì‹œ",type:"switch"},{key:"autoCalculateStats",label:"ìë™ í†µê³„ ê³„ì‚°",type:"switch"}],ae=[{key:"host",label:"Host",type:"text",placeholder:"ì˜ˆ: 127.0.0.1"},{key:"port",label:"Port",type:"number",min:1,max:65535,placeholder:"5432"},{key:"user",label:"User",type:"text",placeholder:"postgres"},{key:"password",label:"Password",type:"text",placeholder:"ë¹„ë°€ë²ˆí˜¸"},{key:"dbname",label:"DB Name",type:"text",placeholder:"postgres"},{key:"table",label:"ê¸°ë³¸ í…Œì´ë¸”ëª…",type:"text",placeholder:"summary"}],T=[{key:"enableNotifications",label:"ì•Œë¦¼ í™œì„±í™”",type:"switch"},{key:"emailNotifications",label:"ì´ë©”ì¼ ì•Œë¦¼",type:"switch"},{key:"soundEnabled",label:"ì†Œë¦¬ ì•Œë¦¼",type:"switch"},{key:"notificationFrequency",label:"ì•Œë¦¼ ë¹ˆë„",type:"select",options:[{value:"immediate",label:"ì¦‰ì‹œ"},{value:"hourly",label:"ë§¤ì‹œê°„"},{value:"daily",label:"ë§¤ì¼"},{value:"weekly",label:"ë§¤ì£¼"}]}];return r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"í™˜ê²½ì„¤ì •"}),e.jsxs(S,{variant:"secondary",className:"text-xs",children:[e.jsx(oe,{className:"h-3 w-3 mr-1"}),"ë¡œë”© ì¤‘..."]})]}),e.jsx(C,{children:e.jsx(D,{className:"pt-6",children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤..."})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"í™˜ê²½ì„¤ì •"}),e.jsx("p",{className:"text-muted-foreground",children:"Dashboardì™€ Statisticsì˜ ë™ì‘ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j&&e.jsxs(S,{variant:"secondary",className:"text-xs",children:[e.jsx(oe,{className:"h-3 w-3 mr-1"}),"ì €ì¥ ì¤‘..."]}),L&&e.jsx(S,{variant:"destructive",className:"text-xs",children:"ì˜¤ë¥˜ ë°œìƒ"}),n&&e.jsxs(S,{variant:"outline",className:"text-xs",children:["ë§ˆì§€ë§‰ ì €ì¥: ",new Date(n).toLocaleTimeString()]})]})]}),e.jsxs(be,{defaultValue:"dashboard",className:"w-full",children:[e.jsxs(ve,{className:"grid w-full grid-cols-6",children:[e.jsxs(O,{value:"dashboard",className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Dashboard"]}),e.jsxs(O,{value:"statistics",className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Statistics"]}),e.jsxs(O,{value:"database",className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Database"]}),e.jsxs(O,{value:"derived-peg",className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Derived PEG"]}),e.jsxs(O,{value:"notifications",className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-4 w-4"}),"ì•Œë¦¼"]}),e.jsxs(O,{value:"backup",className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"ë°±ì—…/ë³µì›"]})]}),e.jsxs(R,{value:"dashboard",className:"space-y-6",children:[e.jsxs(C,{children:[e.jsx(E,{children:e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"PEG ë°ì´í„° ì†ŒìŠ¤"]})}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:c?"Database PEG ì‚¬ìš© ì¤‘":"ê¸°ë³¸ KPI ëª©ë¡ ì‚¬ìš© ì¤‘"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?"Database Settingsì—ì„œ ì—°ê²°ëœ ì‹¤ì œ PEG ëª©ë¡ì„ ì‚¬ìš©í•©ë‹ˆë‹¤":"ë¯¸ë¦¬ ì •ì˜ëœ ê¸°ë³¸ KPI ëª©ë¡ì„ ì‚¬ìš©í•©ë‹ˆë‹¤"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{variant:c?"secondary":"default",size:"sm",onClick:()=>{A(!1),localStorage.setItem("useDbPegs","false")},children:"ê¸°ë³¸ KPI"}),e.jsx(g,{variant:c?"default":"secondary",size:"sm",onClick:()=>{A(!0),localStorage.setItem("useDbPegs","true"),d()},disabled:b,children:b?"ë¡œë”© ì¤‘...":"DB PEG"}),t.length>0&&e.jsxs(g,{variant:"outline",size:"sm",onClick:d,disabled:b,children:[e.jsx(Fe,{className:`h-3 w-3 ${b?"animate-spin":""}`}),"ìƒˆë¡œê³ ì¹¨"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"í˜„ì¬ ëª¨ë“œ"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?"Database PEG":"ê¸°ë³¸ KPI"})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"ì‚¬ìš© ê°€ëŠ¥í•œ PEG"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?`${t.length}ê°œ`:"9ê°œ (ê¸°ë³¸)"})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:F?F.toLocaleTimeString():"ì—†ìŒ"})]})]}),c&&t.length===0&&!b&&e.jsx("div",{className:"p-3 border rounded-lg bg-amber-50 border-amber-200",children:e.jsx("p",{className:"text-sm text-amber-700",children:"âš ï¸ DB PEGë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. Database Settingsì—ì„œ DB ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”."})}),c&&t.length>0&&e.jsx("div",{className:"p-3 border rounded-lg bg-green-50 border-green-200",children:e.jsxs("p",{className:"text-sm text-green-700",children:["âœ… ",t.length,"ê°œì˜ ì‹¤ì œ DB PEGë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"]})})]})})]}),e.jsx(W,{title:"Dashboard ì„¤ì •",description:"Dashboardì—ì„œ í‘œì‹œí•  PEG, ì°¨íŠ¸ ìŠ¤íƒ€ì¼, ìë™ ìƒˆë¡œê³ ì¹¨ ë“±ì„ ì„¤ì •í•©ë‹ˆë‹¤",settingKey:"dashboardSettings",fields:ee,defaultOpen:!0,showResetButton:!0,showSaveButton:!1})]}),e.jsx(R,{value:"statistics",className:"space-y-6",children:e.jsx(W,{title:"Statistics ì„¤ì •",description:"Statistics í˜ì´ì§€ì˜ ê¸°ë³¸ê°’, ì†Œìˆ˜ì  ìë¦¿ìˆ˜, ë¹„êµ ì˜µì…˜ ë“±ì„ ì„¤ì •í•©ë‹ˆë‹¤",settingKey:"statisticsSettings",fields:se,defaultOpen:!0,showResetButton:!0,showSaveButton:!1})}),e.jsx(R,{value:"database",className:"space-y-6",children:e.jsx(W,{title:"Database ì„¤ì •",description:"LLM ë¶„ì„ê³¼ Statisticsì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•  PostgreSQL DB ì„¤ì •ì…ë‹ˆë‹¤ (í…Œì´ë¸”ëª… í¬í•¨).",settingKey:"databaseSettings",fields:ae,defaultOpen:!0,showResetButton:!0,showSaveButton:!1})}),e.jsx(R,{value:"derived-peg",className:"space-y-6",children:e.jsx(Ie,{derivedPegSettings:(a==null?void 0:a.derivedPegSettings)||{formulas:[],settings:{}},updateDerivedPegSettings:x=>{_({derivedPegSettings:x})},availablePegs:u(),saving:j})}),e.jsx(R,{value:"notifications",className:"space-y-6",children:e.jsx(W,{title:"ì•Œë¦¼ ì„¤ì •",description:"ì´ë©”ì¼, ì†Œë¦¬ ì•Œë¦¼ ë“± ì•Œë¦¼ ê´€ë ¨ ì„¤ì •ì„ ê´€ë¦¬í•©ë‹ˆë‹¤",settingKey:"notificationSettings",fields:T,defaultOpen:!0,showResetButton:!0,showSaveButton:!1})}),e.jsx(R,{value:"backup",className:"space-y-6",children:e.jsx(ge,{title:"ì„¤ì • ë°±ì—… ë° ë³µì›",description:"ëª¨ë“  í™˜ê²½ì„¤ì •ì„ JSON íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê±°ë‚˜ ë°±ì—… íŒŒì¼ì—ì„œ ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤",defaultOpen:!0})})]}),e.jsxs(C,{children:[e.jsx(E,{children:e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5"}),"í˜„ì¬ ì„¤ì • ìš”ì•½"]})}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Dashboard"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ì„ íƒëœ PEG: ",((K=(q=a==null?void 0:a.dashboardSettings)==null?void 0:q.selectedPegs)==null?void 0:K.length)||0,"ê°œ"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["PEG ì†ŒìŠ¤: ",c?`DB (${t.length}ê°œ)`:"ê¸°ë³¸ KPI"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ì°¨íŠ¸ ìŠ¤íƒ€ì¼: ",((Z=a==null?void 0:a.dashboardSettings)==null?void 0:Z.chartStyle)||"line"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ìë™ ìƒˆë¡œê³ ì¹¨: ",((U=a==null?void 0:a.dashboardSettings)==null?void 0:U.autoRefreshInterval)||0,"ì´ˆ"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Statistics"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ê¸°ë³¸ ê¸°ê°„: ",(($=a==null?void 0:a.statisticsSettings)==null?void 0:$.defaultDateRange)||7,"ì¼"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ì†Œìˆ˜ì : ",((s=a==null?void 0:a.statisticsSettings)==null?void 0:s.decimalPlaces)||2,"ìë¦¬"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ë¹„êµ ì˜µì…˜: ",(l=a==null?void 0:a.statisticsSettings)!=null&&l.showComparisonOptions?"í™œì„±":"ë¹„í™œì„±"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"ì•Œë¦¼"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ì•Œë¦¼: ",(i=a==null?void 0:a.notificationSettings)!=null&&i.enableNotifications?"í™œì„±":"ë¹„í™œì„±"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ì´ë©”ì¼: ",(f=a==null?void 0:a.notificationSettings)!=null&&f.emailNotifications?"í™œì„±":"ë¹„í™œì„±"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ì†Œë¦¬: ",(N=a==null?void 0:a.notificationSettings)!=null&&N.soundEnabled?"í™œì„±":"ë¹„í™œì„±"]})]})]})]})})]})]})};export{ze as default};

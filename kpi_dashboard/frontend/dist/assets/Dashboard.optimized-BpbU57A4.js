import{r as a,M as e}from"./vendor-CPBPwzYD.js";import{u as _,a as q,B as d,C as P,b as M,c as E,d as K,e as J}from"./index-BifUC4c9.js";import{h as R,l as W,S as X}from"./icon-vendor-DwJrfwQP.js";import{C as Y,X as z,Y as H,T as Q,L as U,R as S,a as V,b as Z,B as F,c as ee,A as se,d as te}from"./chart-vendor-BCXW5yoB.js";import"./ui-vendor-nq4IHmv4.js";import"./utils-vendor-DrCDvq1f.js";const O=a.memo(({chartData:l,chartStyle:c,showGrid:n,showLegend:v,colorFor:u,idx:m})=>{console.log(`[KPIChart] 렌더링 - 스타일: ${c}, 데이터포인트: ${l.length}`);const f=a.useMemo(()=>l.length>0?Object.keys(l[0]).filter(r=>r!=="time"):[],[l]),x=a.useMemo(()=>({data:l,className:"h-64"}),[l]),o=a.useMemo(()=>[n&&e.jsx(Y,{strokeDasharray:"3 3"},"grid"),e.jsx(z,{dataKey:"time"},"xaxis"),e.jsx(H,{},"yaxis"),e.jsx(Q,{},"tooltip"),v&&e.jsx(U,{},"legend")].filter(Boolean),[n,v]);return a.useMemo(()=>{switch(c){case"area":return e.jsx(S,{width:"100%",height:"100%",children:e.jsxs(se,{...x,children:[o,f.map((r,h)=>e.jsx(te,{type:"monotone",dataKey:r,stroke:u((m+h)%12),fill:u((m+h)%12),fillOpacity:.3,strokeWidth:2},r))]})});case"bar":return e.jsx(S,{width:"100%",height:"100%",children:e.jsxs(F,{...x,children:[o,f.map((r,h)=>e.jsx(ee,{dataKey:r,fill:u((m+h)%12)},r))]})});case"line":default:return e.jsx(S,{width:"100%",height:"100%",children:e.jsxs(V,{...x,children:[o,f.map((r,h)=>e.jsx(Z,{type:"monotone",dataKey:r,stroke:u((m+h)%12),strokeWidth:2},r))]})})}},[c,x,o,f,u,m])},(l,c)=>l.chartStyle===c.chartStyle&&l.showGrid===c.showGrid&&l.showLegend===c.showLegend&&l.idx===c.idx&&JSON.stringify(l.chartData)===JSON.stringify(c.chartData));O.displayName="KPIChart";const G=a.memo(({kpiKey:l,title:c,chartData:n,chartStyle:v,showGrid:u,showLegend:m,colorFor:f,idx:x})=>{console.log(`[KPICard] 렌더링 - ${c}`);const{entityCount:o,dataPointCount:g}=a.useMemo(()=>({entityCount:(n.length>0?Object.keys(n[0]).filter(h=>h!=="time"):[]).length,dataPointCount:n.length}),[n]);return e.jsxs(P,{children:[e.jsx(M,{children:e.jsxs(E,{className:"flex items-center justify-between",children:[c,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(d,{variant:"outline",className:"text-xs",children:[o,"개 엔터티"]}),e.jsxs(d,{variant:"secondary",className:"text-xs",children:[g,"개 데이터포인트"]})]})]})}),e.jsx(K,{children:e.jsx("div",{className:"h-64",children:n.length>0?e.jsx(O,{chartData:n,chartStyle:v,showGrid:u,showLegend:m,colorFor:f,idx:x}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:"데이터가 없습니다"})})})]})});G.displayName="KPICard";const de=()=>{const[l,c]=a.useState({}),[n,v]=a.useState(!0),[u,m]=a.useState(null),[f,x]=a.useState(0),o=a.useRef(null),g=a.useRef(null),{settings:r,saving:h,error:b}=_(),k=a.useMemo(()=>["availability","rrc","erab","sar","mobility_intra","cqi"],[]),s=a.useMemo(()=>{var t;return{selectedPegs:((t=r.selectedPegs)==null?void 0:t.length)>0?r.selectedPegs:k,defaultNe:r.defaultNe||"",defaultCellId:r.defaultCellId||"",autoRefreshInterval:r.autoRefreshInterval||30,chartStyle:r.chartStyle||"line",showLegend:r.showLegend!==!1,showGrid:r.showGrid!==!1}},[r,k]),D=a.useMemo(()=>({availability:"Availability (%)",rrc:"RRC Success Rate (%)",erab:"ERAB Success Rate (%)",sar:"SAR",mobility_intra:"Mobility Intra (%)",cqi:"CQI"}),[]),w=a.useCallback(t=>D[t]||t,[D]),A=a.useCallback(t=>{const i=["#8884d8","#82ca9d","#ffc658","#ff7300","#8dd1e1","#d084d0"];return t<i.length?i[t]:`hsl(${t*47%360}, 70%, 50%)`},[]),L=a.useCallback(t=>{const i=Array.isArray(t)?t:Object.values(t||{}).flat();if(!i||i.length===0)return[];const p=i.reduce((j,y)=>{const C=new Date(y.timestamp).toLocaleDateString();return j[C]||(j[C]={time:C}),j[C][y.entity_id]=y.value,j},{});return Object.values(p)},[]),N=a.useCallback(async()=>{var t;try{v(!0),console.log("[Dashboard] 데이터 fetching 시작",{selectedPegs:s.selectedPegs,defaultNe:s.defaultNe,defaultCellId:s.defaultCellId,chartStyle:s.chartStyle});const i=new Date().toISOString().split("T")[0],p=new Date(Date.now()-10080*60*1e3).toISOString().split("T")[0],j=await q.post("/api/kpi/query",{start_date:p,end_date:i,kpi_types:s.selectedPegs,ne:s.defaultNe,cellid:s.defaultCellId}),y=((t=j==null?void 0:j.data)==null?void 0:t.data)||{};c(y),m(new Date),console.log("[Dashboard] 데이터 fetching 완료",{kpiCount:Object.keys(y).length,totalRows:Object.values(y).reduce((C,I)=>C+((I==null?void 0:I.length)||0),0)})}catch(i){console.error("[Dashboard] 데이터 fetching 오류:",i)}finally{v(!1)}},[s]),B=a.useCallback(()=>{console.log("[Dashboard] 수동 새로고침 실행"),N()},[N]);a.useEffect(()=>(o.current&&clearInterval(o.current),g.current&&clearInterval(g.current),s.autoRefreshInterval>0&&(console.log("[Dashboard] 자동 새로고침 설정:",s.autoRefreshInterval,"초"),o.current=setInterval(()=>{N()},s.autoRefreshInterval*1e3),x(s.autoRefreshInterval),g.current=setInterval(()=>{x(t=>t<=1?s.autoRefreshInterval:t-1)},1e3)),()=>{o.current&&clearInterval(o.current),g.current&&clearInterval(g.current)}),[s.autoRefreshInterval,N]),a.useEffect(()=>{N()},[N]);const T=a.useMemo(()=>{const t={};return Object.keys(l).forEach(i=>{t[i]=L(l[i])}),t},[l,L]),$=a.useMemo(()=>n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Dashboard"}),e.jsxs("div",{className:"flex items-center gap-2",children:[h&&e.jsxs(d,{variant:"secondary",className:"text-xs",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),"설정 저장 중"]}),b&&e.jsx(d,{variant:"destructive",className:"text-xs",children:"설정 오류"})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:s.selectedPegs.map(t=>e.jsxs(P,{children:[e.jsx(M,{children:e.jsxs(E,{className:"flex items-center justify-between",children:[w(t),e.jsx(d,{variant:"outline",className:"text-xs",children:s.chartStyle})]})}),e.jsx(K,{children:e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading..."})})})]},t))})]}):null,[n,h,b,s.selectedPegs,s.chartStyle,w]);return n?$:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Dashboard"}),e.jsxs("p",{className:"text-muted-foreground",children:[s.selectedPegs.length,"개 PEG 항목 • 차트 스타일: ",s.chartStyle,s.defaultNe&&` • NE: ${s.defaultNe}`,s.defaultCellId&&` • Cell: ${s.defaultCellId}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h&&e.jsxs(d,{variant:"secondary",className:"text-xs",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),"설정 저장 중"]}),b&&e.jsx(d,{variant:"destructive",className:"text-xs",children:"설정 오류"}),s.autoRefreshInterval>0&&f>0&&e.jsxs(d,{variant:"outline",className:"text-xs",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),f,"초 후 새로고침"]}),u&&e.jsxs(d,{variant:"secondary",className:"text-xs",children:["마지막 업데이트: ",u.toLocaleTimeString()]}),e.jsxs(J,{variant:"outline",size:"sm",onClick:B,disabled:n,children:[e.jsx(W,{className:`h-4 w-4 mr-2 ${n?"animate-spin":""}`}),"새로고침"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(d,{variant:"default",children:["선택된 PEG: ",s.selectedPegs.join(", ")]}),s.autoRefreshInterval>0&&e.jsxs(d,{variant:"outline",children:["자동 새로고침: ",s.autoRefreshInterval,"초"]}),e.jsxs(d,{variant:"outline",children:["차트 스타일: ",s.chartStyle]}),!s.showLegend&&e.jsx(d,{variant:"secondary",children:"범례 숨김"}),!s.showGrid&&e.jsx(d,{variant:"secondary",children:"격자 숨김"})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:s.selectedPegs.map((t,i)=>e.jsx(G,{kpiKey:t,title:w(t),chartData:T[t]||[],chartStyle:s.chartStyle,showGrid:s.showGrid,showLegend:s.showLegend,colorFor:A,idx:i},t))}),s.selectedPegs.length===0&&e.jsx(P,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(X,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"표시할 PEG가 선택되지 않았습니다"}),e.jsx("p",{className:"text-muted-foreground",children:"Preference 메뉴에서 표시할 PEG 항목을 선택하세요."})]})})})]})};export{de as default};

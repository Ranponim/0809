import{r as p,j as e,a7 as I,m as xe,a8 as he,a9 as te,o as ue,aa as je,_ as le,ab as pe,G as ge,X as ve,D as X,ac as be,ad as fe,Z as ie,C as Ne,ae as ye,d as ne,a6 as we}from"./react-vendor-BbkKAD8O.js";import{C as w,b as S,c as k,d as C,S as H,L as h,g as ce,h as re,i as de,j as oe,k as y,e as v,I as J,B as D,T as Ce,l as De,m as Pe,n as Se,a as ke,o as ae,p as Ee}from"./index-CvEd_8oR.js";import{S as me,T as Ge,a as Fe,b as A,c as T}from"./scroll-area-E1Oa0Jgs.js";import{a4 as Q}from"./vendor-B4aOkbPy.js";import"./ui-vendor-BA32w1ww.js";import"./utils-vendor-DgsWbSrd.js";const Ie=({derivedPegSettings:a,updateDerivedPegSettings:r,availablePegs:g=[],saving:R=!1})=>{var L;const[n,B]=p.useState(null),[t,o]=p.useState(null),[b,$]=p.useState(""),[c,_]=p.useState(null),[E,W]=p.useState(null),d=(a==null?void 0:a.formulas)||[],u=(a==null?void 0:a.settings)||{autoValidate:!0,showInDashboard:!0,showInStatistics:!0,evaluationPrecision:4},Y=[{id:"success_rate",name:"Success Rate (%)",formula:"(success_count / total_count) * 100",description:"성공률 계산 템플릿",category:"percentage"},{id:"efficiency",name:"Efficiency (%)",formula:"(good_values / all_values) * 100",description:"효율성 계산 템플릿",category:"percentage"},{id:"delta",name:"Delta Calculation",formula:"current_value - previous_value",description:"변화량 계산 템플릿",category:"difference"},{id:"ratio",name:"Simple Ratio",formula:"numerator / denominator",description:"단순 비율 계산 템플릿",category:"ratio"}],ee=[{symbol:"+",name:"더하기",example:"a + b"},{symbol:"-",name:"빼기",example:"a - b"},{symbol:"*",name:"곱하기",example:"a * b"},{symbol:"/",name:"나누기",example:"a / b"},{symbol:"%",name:"나머지",example:"a % b"},{symbol:"^",name:"거듭제곱",example:"a ^ 2"},{symbol:"()",name:"괄호",example:"(a + b) * c"},{symbol:"sqrt()",name:"제곱근",example:"sqrt(a)"},{symbol:"log()",name:"로그",example:"log(a)"},{symbol:"abs()",name:"절댓값",example:"abs(a)"},{symbol:"min()",name:"최솟값",example:"min(a, b)"},{symbol:"max()",name:"최댓값",example:"max(a, b)"}],se=p.useMemo(()=>b?d.filter(s=>{var l;return s.name.toLowerCase().includes(b.toLowerCase())||s.formula.toLowerCase().includes(b.toLowerCase())||((l=s.description)==null?void 0:l.toLowerCase().includes(b.toLowerCase()))}):d,[d,b]),O=p.useCallback(s=>{try{const l=[],i=[],N=(s.match(/\(/g)||[]).length,m=(s.match(/\)/g)||[]).length;N!==m&&l.push("괄호가 일치하지 않습니다");const x=s.match(/[a-zA-Z_][a-zA-Z0-9_]*/g)||[],G=[...g.map(j=>j.value),...d.filter(j=>j.active).map(j=>j.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase())],P=x.filter(j=>!G.includes(j)&&!["sqrt","log","abs","min","max","if"].includes(j));if(P.length>0&&i.push(`알 수 없는 PEG: ${P.join(", ")}`),t){const j=t.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase();x.includes(j)&&l.push("수식이 자기 자신을 참조할 수 없습니다 (순환 참조)")}const F=s.match(/[^a-zA-Z0-9_+\-*/()^%.,\s]/g);F&&l.push(`지원하지 않는 문자: ${F.join(", ")}`);const f=x.filter(j=>g.some(U=>U.value===j)),K=x.filter(j=>d.some(U=>U.active&&U.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()===j));return{isValid:l.length===0,errors:l,warnings:i,dependencies:f,derivedDependencies:K}}catch{return{isValid:!1,errors:["수식 분석 중 오류가 발생했습니다"],warnings:[],dependencies:[],derivedDependencies:[]}}},[g,d,t]),z=p.useCallback(s=>{try{const l={};g.forEach(m=>{l[m.value]=Math.random()*100+50});let i=s;Object.keys(l).forEach(m=>{const x=new RegExp(`\\b${m}\\b`,"g");i=i.replace(x,l[m].toString())}),i=i.replace(/sqrt\(([^)]+)\)/g,"Math.sqrt($1)"),i=i.replace(/log\(([^)]+)\)/g,"Math.log($1)"),i=i.replace(/abs\(([^)]+)\)/g,"Math.abs($1)"),i=i.replace(/\^/g,"**");const N=Function(`"use strict"; return (${i})`)();return{success:!0,result:Number(N).toFixed(u.evaluationPrecision||4),mockData:l}}catch(l){return{success:!1,error:l.message}}},[g,u.evaluationPrecision]),M=()=>{const s={id:`formula_${Date.now()}`,name:"새 수식",formula:"",description:"",active:!0,category:"custom",unit:"",dependencies:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};o(s),B(s.id)},V=()=>{if(!t)return;const s=O(t.formula);if(!s.isValid){Q.error(`수식 저장 실패: ${s.errors.join(", ")}`);return}const l={...t,dependencies:s.dependencies,derivedDependencies:s.derivedDependencies||[],updatedAt:new Date().toISOString()},i=d.findIndex(m=>m.id===t.id);let N;i>=0?(N=[...d],N[i]=l):N=[...d,l],r({...a,formulas:N}),o(null),Q.success("수식이 저장되었습니다")},q=s=>{const l=d.filter(i=>i.id!==s);r({...a,formulas:l}),n===s&&B(null),(t==null?void 0:t.id)===s&&o(null),Q.success("수식이 삭제되었습니다")},Z=s=>{t&&(o({...t,formula:s.formula,description:s.description,category:s.category}),Q.success(`템플릿 "${s.name}"이 적용되었습니다`))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(w,{children:[e.jsx(S,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"Derived PEG 관리"]})}),e.jsx(C,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"auto-validate",checked:u.autoValidate,onCheckedChange:s=>r({...a,settings:{...u,autoValidate:s}})}),e.jsx(h,{htmlFor:"auto-validate",children:"실시간 검증"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"show-dashboard",checked:u.showInDashboard,onCheckedChange:s=>r({...a,settings:{...u,showInDashboard:s}})}),e.jsx(h,{htmlFor:"show-dashboard",children:"Dashboard에 표시"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"show-statistics",checked:u.showInStatistics,onCheckedChange:s=>r({...a,settings:{...u,showInStatistics:s}})}),e.jsx(h,{htmlFor:"show-statistics",children:"Statistics에 표시"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"계산 정밀도"}),e.jsxs(ce,{value:(L=u.evaluationPrecision)==null?void 0:L.toString(),onValueChange:s=>r({...a,settings:{...u,evaluationPrecision:parseInt(s)}}),children:[e.jsx(re,{children:e.jsx(de,{})}),e.jsxs(oe,{children:[e.jsx(y,{value:"2",children:"소수점 2자리"}),e.jsx(y,{value:"4",children:"소수점 4자리"}),e.jsx(y,{value:"6",children:"소수점 6자리"})]})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(k,{children:"수식 목록"}),e.jsxs(v,{onClick:M,size:"sm",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"새 수식"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(J,{placeholder:"수식 검색...",className:"pl-8",value:b,onChange:s=>$(s.target.value)})]})]}),e.jsx(C,{children:e.jsx(me,{className:"h-96",children:e.jsx("div",{className:"space-y-2",children:se.map(s=>e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${n===s.id?"bg-blue-50 border-blue-200":"hover:bg-gray-50"}`,onClick:()=>B(s.id),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:s.name}),e.jsx(D,{variant:s.active?"default":"secondary",className:"text-xs",children:s.active?"활성":"비활성"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1 font-mono",children:s.formula}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(D,{variant:"outline",className:"text-xs",children:s.category}),s.unit&&e.jsx(D,{variant:"outline",className:"text-xs",children:s.unit})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:l=>{l.stopPropagation(),o({...s})},children:e.jsx(te,{className:"h-3 w-3"})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:l=>{l.stopPropagation(),q(s.id)},children:e.jsx(ue,{className:"h-3 w-3"})})]})]})},s.id))})})})]}),e.jsxs(w,{children:[e.jsx(S,{children:e.jsx(k,{children:t?"수식 편집":"수식 상세"})}),e.jsx(C,{children:t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-name",children:"수식 이름"}),e.jsx(J,{id:"formula-name",value:t.name,onChange:s=>o({...t,name:s.target.value}),placeholder:"예: RACH Success Rate (%)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-input",children:"수식"}),e.jsx(Ce,{id:"formula-input",value:t.formula,onChange:s=>{o({...t,formula:s.target.value}),u.autoValidate&&_(O(s.target.value))},placeholder:"예: (randomaccesspremable / randomaccessresponse) * 100",className:"font-mono text-sm",rows:4}),c&&e.jsxs("div",{className:"space-y-2",children:[c.isValid?e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"수식이 유효합니다"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:c.errors.join(", ")})]}),c.warnings.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:c.warnings.join(", ")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-description",children:"설명"}),e.jsx(J,{id:"formula-description",value:t.description,onChange:s=>o({...t,description:s.target.value}),placeholder:"수식에 대한 설명을 입력하세요"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-category",children:"카테고리"}),e.jsxs(ce,{value:t.category,onValueChange:s=>o({...t,category:s}),children:[e.jsx(re,{children:e.jsx(de,{})}),e.jsxs(oe,{children:[e.jsx(y,{value:"percentage",children:"비율 (%)"}),e.jsx(y,{value:"success_rate",children:"성공률"}),e.jsx(y,{value:"efficiency",children:"효율성"}),e.jsx(y,{value:"quality",children:"품질"}),e.jsx(y,{value:"performance",children:"성능"}),e.jsx(y,{value:"custom",children:"사용자 정의"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-unit",children:"단위"}),e.jsx(J,{id:"formula-unit",value:t.unit,onChange:s=>o({...t,unit:s.target.value}),placeholder:"예: %, ms, Mbps"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"formula-active",checked:t.active,onCheckedChange:s=>o({...t,active:s})}),e.jsx(h,{htmlFor:"formula-active",children:"수식 활성화"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{onClick:()=>{const s=O(t.formula);_(s);const l=z(t.formula);W(l)},children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"테스트"]}),e.jsxs(v,{onClick:V,disabled:R,children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"저장"]}),e.jsxs(v,{variant:"outline",onClick:()=>o(null),children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"취소"]})]}),E&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(De,{}),e.jsx("h4",{className:"font-medium",children:"테스트 결과"}),E.success?e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-green-700",children:e.jsxs("strong",{children:["결과: ",E.result]})}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"모의 데이터를 사용한 계산 결과입니다"})]}):e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-700",children:["오류: ",E.error]})})]})]}):n?e.jsx("div",{className:"space-y-4",children:(()=>{const s=d.find(l=>l.id===n);return s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"수식"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg font-mono text-sm",children:s.formula})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"카테고리"}),e.jsx("p",{className:"text-sm",children:s.category})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"단위"}),e.jsx("p",{className:"text-sm",children:s.unit||"없음"})]})]}),(s.dependencies&&s.dependencies.length>0||s.derivedDependencies&&s.derivedDependencies.length>0)&&e.jsxs("div",{className:"space-y-2",children:[s.dependencies&&s.dependencies.length>0&&e.jsxs("div",{children:[e.jsxs(h,{className:"text-xs flex items-center gap-1",children:[e.jsx(X,{className:"h-3 w-3"}),"기본 PEG 의존성"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.dependencies.map(l=>e.jsx(D,{variant:"outline",className:"text-xs",children:l},l))})]}),s.derivedDependencies&&s.derivedDependencies.length>0&&e.jsxs("div",{children:[e.jsxs(h,{className:"text-xs flex items-center gap-1",children:[e.jsx(I,{className:"h-3 w-3"}),"Derived PEG 의존성"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.derivedDependencies.map(l=>e.jsx(D,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700",children:l},l))})]})]}),e.jsxs(v,{onClick:()=>o({...s}),className:"w-full",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"편집"]})]}):e.jsx("p",{children:"수식을 찾을 수 없습니다."})})()}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(I,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"수식을 선택하거나 새로 만들어보세요"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsx(S,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"템플릿 라이브러리"]})}),e.jsx(C,{children:e.jsx("div",{className:"space-y-2",children:Y.map(s=>e.jsx("div",{className:"p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>Z(s),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",children:s.name}),e.jsx("p",{className:"text-xs font-mono text-muted-foreground",children:s.formula}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description})]}),e.jsx(v,{variant:"ghost",size:"sm",children:e.jsx(fe,{className:"h-3 w-3"})})]})},s.id))})})]}),e.jsxs(w,{children:[e.jsx(S,{children:e.jsx(k,{children:"지원 연산자"})}),e.jsx(C,{children:e.jsx(me,{className:"h-64",children:e.jsx("div",{className:"space-y-2",children:ee.map((s,l)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("code",{className:"font-mono font-medium",children:s.symbol}),e.jsx("span",{className:"text-sm text-muted-foreground ml-2",children:s.name})]}),e.jsx("code",{className:"text-xs text-muted-foreground",children:s.example})]},l))})})})]})]}),e.jsxs(w,{children:[e.jsxs(S,{children:[e.jsx(k,{children:"사용 가능한 PEG"}),e.jsx(Pe,{children:"수식에 사용할 수 있는 기본 PEG와 생성된 Derived PEG 목록입니다"})]}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-4",children:[g.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"기본 PEG (",g.length,"개)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(s=>e.jsx(v,{variant:"outline",size:"sm",onClick:()=>{t&&o({...t,formula:t.formula+s.value})},className:"text-xs",children:s.label||s.value},s.value))})]}),d.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Derived PEG (",d.filter(s=>s.active).length,"개)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.filter(s=>s.active).map(s=>e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>{if(t){const l=`${s.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()}`;o({...t,formula:t.formula+l})}},className:"text-xs bg-blue-50 border-blue-200 hover:bg-blue-100",title:s.description,children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),s.name,s.unit&&e.jsxs("span",{className:"ml-1 text-muted-foreground",children:["(",s.unit,")"]})]},s.id))}),d.filter(s=>s.active).length===0&&e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(I,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"아직 생성된 Derived PEG가 없습니다"}),e.jsx("p",{className:"text-xs",children:"새 수식을 추가하고 활성화하면 여기에 표시됩니다"})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-sm text-blue-700 mb-1",children:"💡 사용법"}),e.jsxs("ul",{className:"text-xs text-blue-600 space-y-1",children:[e.jsx("li",{children:"• 기본 PEG: 클릭하면 수식에 바로 삽입됩니다"}),e.jsx("li",{children:"• Derived PEG: 다른 수식에서 참조할 수 있는 계산된 값입니다"}),e.jsx("li",{children:"• 비활성화된 Derived PEG는 목록에 표시되지 않습니다"}),e.jsx("li",{children:"• Derived PEG끼리 순환 참조하지 않도록 주의하세요"})]})]})]})})]})]})};function Oe(a=[],r=[]){const g=a.map(n=>({...n,type:"basic",source:"database"})),R=r.filter(n=>n.active).map(n=>({value:n.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase(),label:`${n.name}${n.unit?` (${n.unit})`:""} [Derived]`,originalName:n.name,description:n.description,formula:n.formula,type:"derived",source:"calculated",dependencies:n.dependencies||[],derivedDependencies:n.derivedDependencies||[]}));return[...g,...R]}function Re(a=[]){return a.map(r=>({value:r.value,label:r.label,type:r.type,color:r.type==="derived"?"#3b82f6":"#6b7280",isDerived:r.type==="derived",description:r.description,formula:r.formula}))}const ze=()=>{var O,z,M,V,q,Z,L,s,l,i,N;const{preferences:a,isLoading:r,isSaving:g,error:R,lastSaved:n,updateSettings:B}=Se(),[t,o]=p.useState([]),[b,$]=p.useState(!1),[c,_]=p.useState(!1),[E,W]=p.useState(null),d=p.useCallback(async()=>{var m;try{$(!0),console.info("[PreferenceManager] Fetching DB PEGs");let x={};try{const f=localStorage.getItem("dbConfig");f&&(x=JSON.parse(f))}catch{}if(!x.host){console.warn("[PreferenceManager] No DB config found");return}const G=await ke.post("/api/master/pegs",{db:x,table:x.table||"summary",limit:100}),P=((m=G==null?void 0:G.data)==null?void 0:m.pegs)||[];console.info("[PreferenceManager] DB PEGs loaded:",P.length);const F=P.map(f=>({value:f.id||f.name,label:`${f.name||f.id} (DB PEG)`}));o(F),W(new Date)}catch(x){console.error("[PreferenceManager] Error fetching DB PEGs:",x)}finally{$(!1)}},[]),u=p.useCallback(()=>{var F,f,K;console.log("🔍 getCurrentPegOptions 호출됨:",{useDbPegs:c,dbPegOptionsCount:t.length,derivedFormulasCount:((f=(F=a==null?void 0:a.derivedPegSettings)==null?void 0:F.formulas)==null?void 0:f.length)||0});let m=[];c&&t.length>0?(console.log("📊 Database PEG 사용:",t),m=t):(console.log("📝 기본 PEG 목록 사용 (fallback)"),m=[{value:"availability",label:"Availability (%)"},{value:"rrc",label:"RRC Success Rate (%)"},{value:"erab",label:"ERAB Success Rate (%)"},{value:"sar",label:"SAR"},{value:"mobility_intra",label:"Mobility Intra (%)"},{value:"cqi",label:"CQI"},{value:"se",label:"Spectral Efficiency"},{value:"dl_thp",label:"DL Throughput"},{value:"ul_int",label:"UL Interference"}]);const x=((K=a==null?void 0:a.derivedPegSettings)==null?void 0:K.formulas)||[],G=Oe(m,x),P=Re(G);return console.log("✅ 최종 PEG 옵션:",P),P},[c,t,(O=a==null?void 0:a.derivedPegSettings)==null?void 0:O.formulas]),Y=[{key:"selectedPegs",label:"Dashboard에 표시할 PEG 목록",type:"multiselect",required:!0,options:u(),placeholder:c?"Database의 실제 PEG를 선택하세요":"Dashboard에서 보여줄 PEG를 선택하세요"},{key:"defaultNe",label:"기본 NE",type:"text",placeholder:"예: nvgnb#10000,nvgnb#20000"},{key:"defaultCellId",label:"기본 Cell ID",type:"text",placeholder:"예: 2010,2011"},{key:"autoRefreshInterval",label:"자동 새로고침 간격 (초)",type:"number",min:0,max:300,placeholder:"0 = 비활성화, 30 = 30초마다"},{key:"chartStyle",label:"차트 스타일",type:"select",options:[{value:"line",label:"Line Chart"},{value:"area",label:"Area Chart"},{value:"bar",label:"Bar Chart"}]},{key:"showLegend",label:"차트 범례 표시",type:"switch"},{key:"showGrid",label:"차트 격자 표시",type:"switch"}],ee=[{key:"defaultNe",label:"기본 NE",type:"text",placeholder:"예: nvgnb#10000,nvgnb#20000"},{key:"defaultCellId",label:"기본 Cell ID",type:"text",placeholder:"예: 2010,2011"},{key:"defaultDateRange",label:"기본 날짜 범위 (일)",type:"number",min:1,max:365,placeholder:"기본 조회 기간"},{key:"decimalPlaces",label:"소수점 자릿수",type:"number",min:0,max:6,placeholder:"통계 수치 표시 정밀도"},{key:"showComparisonOptions",label:"비교 분석 옵션 표시",type:"switch"},{key:"autoCalculateStats",label:"자동 통계 계산",type:"switch"}],se=[{key:"enableNotifications",label:"알림 활성화",type:"switch"},{key:"emailNotifications",label:"이메일 알림",type:"switch"},{key:"soundEnabled",label:"소리 알림",type:"switch"},{key:"notificationFrequency",label:"알림 빈도",type:"select",options:[{value:"immediate",label:"즉시"},{value:"hourly",label:"매시간"},{value:"daily",label:"매일"},{value:"weekly",label:"매주"}]}];return r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"환경설정"}),e.jsxs(D,{variant:"secondary",className:"text-xs",children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),"로딩 중..."]})]}),e.jsx(w,{children:e.jsx(C,{className:"pt-6",children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"설정을 불러오는 중입니다..."})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"환경설정"}),e.jsx("p",{className:"text-muted-foreground",children:"Dashboard와 Statistics의 동작을 설정할 수 있습니다"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[g&&e.jsxs(D,{variant:"secondary",className:"text-xs",children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),"저장 중..."]}),R&&e.jsx(D,{variant:"destructive",className:"text-xs",children:"오류 발생"}),n&&e.jsxs(D,{variant:"outline",className:"text-xs",children:["마지막 저장: ",new Date(n).toLocaleTimeString()]})]})]}),e.jsxs(Ge,{defaultValue:"dashboard",className:"w-full",children:[e.jsxs(Fe,{className:"grid w-full grid-cols-5",children:[e.jsxs(A,{value:"dashboard",className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),"Dashboard"]}),e.jsxs(A,{value:"statistics",className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Statistics"]}),e.jsxs(A,{value:"derived-peg",className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Derived PEG"]}),e.jsxs(A,{value:"notifications",className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"알림"]}),e.jsxs(A,{value:"backup",className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"백업/복원"]})]}),e.jsxs(T,{value:"dashboard",className:"space-y-6",children:[e.jsxs(w,{children:[e.jsx(S,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),"PEG 데이터 소스"]})}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:c?"Database PEG 사용 중":"기본 KPI 목록 사용 중"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?"Database Settings에서 연결된 실제 PEG 목록을 사용합니다":"미리 정의된 기본 KPI 목록을 사용합니다"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:c?"secondary":"default",size:"sm",onClick:()=>{_(!1),localStorage.setItem("useDbPegs","false")},children:"기본 KPI"}),e.jsx(v,{variant:c?"default":"secondary",size:"sm",onClick:()=>{_(!0),localStorage.setItem("useDbPegs","true"),d()},disabled:b,children:b?"로딩 중...":"DB PEG"}),t.length>0&&e.jsxs(v,{variant:"outline",size:"sm",onClick:d,disabled:b,children:[e.jsx(we,{className:`h-3 w-3 ${b?"animate-spin":""}`}),"새로고침"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"현재 모드"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?"Database PEG":"기본 KPI"})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"사용 가능한 PEG"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?`${t.length}개`:"9개 (기본)"})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"마지막 업데이트"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:E?E.toLocaleTimeString():"없음"})]})]}),c&&t.length===0&&!b&&e.jsx("div",{className:"p-3 border rounded-lg bg-amber-50 border-amber-200",children:e.jsx("p",{className:"text-sm text-amber-700",children:"⚠️ DB PEG를 불러올 수 없습니다. Database Settings에서 DB 연결을 확인하세요."})}),c&&t.length>0&&e.jsx("div",{className:"p-3 border rounded-lg bg-green-50 border-green-200",children:e.jsxs("p",{className:"text-sm text-green-700",children:["✅ ",t.length,"개의 실제 DB PEG를 사용할 수 있습니다"]})})]})})]}),e.jsx(ae,{title:"Dashboard 설정",description:"Dashboard에서 표시할 PEG, 차트 스타일, 자동 새로고침 등을 설정합니다",settingKey:"dashboardSettings",fields:Y,defaultOpen:!0,showResetButton:!0,showSaveButton:!1})]}),e.jsx(T,{value:"statistics",className:"space-y-6",children:e.jsx(ae,{title:"Statistics 설정",description:"Statistics 페이지의 기본값, 소수점 자릿수, 비교 옵션 등을 설정합니다",settingKey:"statisticsSettings",fields:ee,defaultOpen:!0,showResetButton:!0,showSaveButton:!1})}),e.jsx(T,{value:"derived-peg",className:"space-y-6",children:e.jsx(Ie,{derivedPegSettings:(a==null?void 0:a.derivedPegSettings)||{formulas:[],settings:{}},updateDerivedPegSettings:m=>{B({derivedPegSettings:m})},availablePegs:u(),saving:g})}),e.jsx(T,{value:"notifications",className:"space-y-6",children:e.jsx(ae,{title:"알림 설정",description:"이메일, 소리 알림 등 알림 관련 설정을 관리합니다",settingKey:"notificationSettings",fields:se,defaultOpen:!0,showResetButton:!0,showSaveButton:!1})}),e.jsx(T,{value:"backup",className:"space-y-6",children:e.jsx(Ee,{title:"설정 백업 및 복원",description:"모든 환경설정을 JSON 파일로 내보내거나 백업 파일에서 복원할 수 있습니다",defaultOpen:!0})})]}),e.jsxs(w,{children:[e.jsx(S,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),"현재 설정 요약"]})}),e.jsx(C,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Dashboard"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["선택된 PEG: ",((M=(z=a==null?void 0:a.dashboardSettings)==null?void 0:z.selectedPegs)==null?void 0:M.length)||0,"개"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["PEG 소스: ",c?`DB (${t.length}개)`:"기본 KPI"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["차트 스타일: ",((V=a==null?void 0:a.dashboardSettings)==null?void 0:V.chartStyle)||"line"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["자동 새로고침: ",((q=a==null?void 0:a.dashboardSettings)==null?void 0:q.autoRefreshInterval)||0,"초"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Statistics"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["기본 기간: ",((Z=a==null?void 0:a.statisticsSettings)==null?void 0:Z.defaultDateRange)||7,"일"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["소수점: ",((L=a==null?void 0:a.statisticsSettings)==null?void 0:L.decimalPlaces)||2,"자리"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["비교 옵션: ",(s=a==null?void 0:a.statisticsSettings)!=null&&s.showComparisonOptions?"활성":"비활성"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"알림"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["알림: ",(l=a==null?void 0:a.notificationSettings)!=null&&l.enableNotifications?"활성":"비활성"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["이메일: ",(i=a==null?void 0:a.notificationSettings)!=null&&i.emailNotifications?"활성":"비활성"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["소리: ",(N=a==null?void 0:a.notificationSettings)!=null&&N.soundEnabled?"활성":"비활성"]})]})]})]})})]})]})};export{ze as default};

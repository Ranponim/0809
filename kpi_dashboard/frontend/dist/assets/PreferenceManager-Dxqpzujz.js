import{r as p,j as e,a7 as I,m as xe,a8 as he,a9 as te,o as ue,aa as je,_ as le,ab as pe,G as ge,X as ve,D as X,ac as be,ad as fe,Z as ie,C as Ne,ae as ye,d as ne,a6 as we}from"./react-vendor-BbkKAD8O.js";import{C as w,b as S,c as k,d as C,S as H,L as h,g as ce,h as re,i as de,j as oe,k as y,e as v,I as J,B as D,T as Ce,l as De,m as Pe,n as Se,a as ke,o as ae,p as Ee}from"./index-CvEd_8oR.js";import{S as me,T as Ge,a as Fe,b as A,c as T}from"./scroll-area-E1Oa0Jgs.js";import{a4 as Q}from"./vendor-B4aOkbPy.js";import"./ui-vendor-BA32w1ww.js";import"./utils-vendor-DgsWbSrd.js";const Ie=({derivedPegSettings:a,updateDerivedPegSettings:r,availablePegs:g=[],saving:R=!1})=>{var L;const[n,B]=p.useState(null),[t,o]=p.useState(null),[b,$]=p.useState(""),[c,_]=p.useState(null),[E,W]=p.useState(null),d=(a==null?void 0:a.formulas)||[],u=(a==null?void 0:a.settings)||{autoValidate:!0,showInDashboard:!0,showInStatistics:!0,evaluationPrecision:4},Y=[{id:"success_rate",name:"Success Rate (%)",formula:"(success_count / total_count) * 100",description:"ì„±ê³µë¥  ê³„ì‚° í…œí”Œë¦¿",category:"percentage"},{id:"efficiency",name:"Efficiency (%)",formula:"(good_values / all_values) * 100",description:"íš¨ìœ¨ì„± ê³„ì‚° í…œí”Œë¦¿",category:"percentage"},{id:"delta",name:"Delta Calculation",formula:"current_value - previous_value",description:"ë³€í™”ëŸ‰ ê³„ì‚° í…œí”Œë¦¿",category:"difference"},{id:"ratio",name:"Simple Ratio",formula:"numerator / denominator",description:"ë‹¨ìˆœ ë¹„ìœ¨ ê³„ì‚° í…œí”Œë¦¿",category:"ratio"}],ee=[{symbol:"+",name:"ë”í•˜ê¸°",example:"a + b"},{symbol:"-",name:"ë¹¼ê¸°",example:"a - b"},{symbol:"*",name:"ê³±í•˜ê¸°",example:"a * b"},{symbol:"/",name:"ë‚˜ëˆ„ê¸°",example:"a / b"},{symbol:"%",name:"ë‚˜ë¨¸ì§€",example:"a % b"},{symbol:"^",name:"ê±°ë“­ì œê³±",example:"a ^ 2"},{symbol:"()",name:"ê´„í˜¸",example:"(a + b) * c"},{symbol:"sqrt()",name:"ì œê³±ê·¼",example:"sqrt(a)"},{symbol:"log()",name:"ë¡œê·¸",example:"log(a)"},{symbol:"abs()",name:"ì ˆëŒ“ê°’",example:"abs(a)"},{symbol:"min()",name:"ìµœì†Ÿê°’",example:"min(a, b)"},{symbol:"max()",name:"ìµœëŒ“ê°’",example:"max(a, b)"}],se=p.useMemo(()=>b?d.filter(s=>{var l;return s.name.toLowerCase().includes(b.toLowerCase())||s.formula.toLowerCase().includes(b.toLowerCase())||((l=s.description)==null?void 0:l.toLowerCase().includes(b.toLowerCase()))}):d,[d,b]),O=p.useCallback(s=>{try{const l=[],i=[],N=(s.match(/\(/g)||[]).length,m=(s.match(/\)/g)||[]).length;N!==m&&l.push("ê´„í˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤");const x=s.match(/[a-zA-Z_][a-zA-Z0-9_]*/g)||[],G=[...g.map(j=>j.value),...d.filter(j=>j.active).map(j=>j.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase())],P=x.filter(j=>!G.includes(j)&&!["sqrt","log","abs","min","max","if"].includes(j));if(P.length>0&&i.push(`ì•Œ ìˆ˜ ì—†ëŠ” PEG: ${P.join(", ")}`),t){const j=t.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase();x.includes(j)&&l.push("ìˆ˜ì‹ì´ ìê¸° ìì‹ ì„ ì°¸ì¡°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (ìˆœí™˜ ì°¸ì¡°)")}const F=s.match(/[^a-zA-Z0-9_+\-*/()^%.,\s]/g);F&&l.push(`ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¬¸ì: ${F.join(", ")}`);const f=x.filter(j=>g.some(U=>U.value===j)),K=x.filter(j=>d.some(U=>U.active&&U.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()===j));return{isValid:l.length===0,errors:l,warnings:i,dependencies:f,derivedDependencies:K}}catch{return{isValid:!1,errors:["ìˆ˜ì‹ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"],warnings:[],dependencies:[],derivedDependencies:[]}}},[g,d,t]),z=p.useCallback(s=>{try{const l={};g.forEach(m=>{l[m.value]=Math.random()*100+50});let i=s;Object.keys(l).forEach(m=>{const x=new RegExp(`\\b${m}\\b`,"g");i=i.replace(x,l[m].toString())}),i=i.replace(/sqrt\(([^)]+)\)/g,"Math.sqrt($1)"),i=i.replace(/log\(([^)]+)\)/g,"Math.log($1)"),i=i.replace(/abs\(([^)]+)\)/g,"Math.abs($1)"),i=i.replace(/\^/g,"**");const N=Function(`"use strict"; return (${i})`)();return{success:!0,result:Number(N).toFixed(u.evaluationPrecision||4),mockData:l}}catch(l){return{success:!1,error:l.message}}},[g,u.evaluationPrecision]),M=()=>{const s={id:`formula_${Date.now()}`,name:"ìƒˆ ìˆ˜ì‹",formula:"",description:"",active:!0,category:"custom",unit:"",dependencies:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};o(s),B(s.id)},V=()=>{if(!t)return;const s=O(t.formula);if(!s.isValid){Q.error(`ìˆ˜ì‹ ì €ì¥ ì‹¤íŒ¨: ${s.errors.join(", ")}`);return}const l={...t,dependencies:s.dependencies,derivedDependencies:s.derivedDependencies||[],updatedAt:new Date().toISOString()},i=d.findIndex(m=>m.id===t.id);let N;i>=0?(N=[...d],N[i]=l):N=[...d,l],r({...a,formulas:N}),o(null),Q.success("ìˆ˜ì‹ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤")},q=s=>{const l=d.filter(i=>i.id!==s);r({...a,formulas:l}),n===s&&B(null),(t==null?void 0:t.id)===s&&o(null),Q.success("ìˆ˜ì‹ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤")},Z=s=>{t&&(o({...t,formula:s.formula,description:s.description,category:s.category}),Q.success(`í…œí”Œë¦¿ "${s.name}"ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤`))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(w,{children:[e.jsx(S,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"Derived PEG ê´€ë¦¬"]})}),e.jsx(C,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"auto-validate",checked:u.autoValidate,onCheckedChange:s=>r({...a,settings:{...u,autoValidate:s}})}),e.jsx(h,{htmlFor:"auto-validate",children:"ì‹¤ì‹œê°„ ê²€ì¦"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"show-dashboard",checked:u.showInDashboard,onCheckedChange:s=>r({...a,settings:{...u,showInDashboard:s}})}),e.jsx(h,{htmlFor:"show-dashboard",children:"Dashboardì— í‘œì‹œ"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"show-statistics",checked:u.showInStatistics,onCheckedChange:s=>r({...a,settings:{...u,showInStatistics:s}})}),e.jsx(h,{htmlFor:"show-statistics",children:"Statisticsì— í‘œì‹œ"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"ê³„ì‚° ì •ë°€ë„"}),e.jsxs(ce,{value:(L=u.evaluationPrecision)==null?void 0:L.toString(),onValueChange:s=>r({...a,settings:{...u,evaluationPrecision:parseInt(s)}}),children:[e.jsx(re,{children:e.jsx(de,{})}),e.jsxs(oe,{children:[e.jsx(y,{value:"2",children:"ì†Œìˆ˜ì  2ìë¦¬"}),e.jsx(y,{value:"4",children:"ì†Œìˆ˜ì  4ìë¦¬"}),e.jsx(y,{value:"6",children:"ì†Œìˆ˜ì  6ìë¦¬"})]})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(k,{children:"ìˆ˜ì‹ ëª©ë¡"}),e.jsxs(v,{onClick:M,size:"sm",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"ìƒˆ ìˆ˜ì‹"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(J,{placeholder:"ìˆ˜ì‹ ê²€ìƒ‰...",className:"pl-8",value:b,onChange:s=>$(s.target.value)})]})]}),e.jsx(C,{children:e.jsx(me,{className:"h-96",children:e.jsx("div",{className:"space-y-2",children:se.map(s=>e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${n===s.id?"bg-blue-50 border-blue-200":"hover:bg-gray-50"}`,onClick:()=>B(s.id),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:s.name}),e.jsx(D,{variant:s.active?"default":"secondary",className:"text-xs",children:s.active?"í™œì„±":"ë¹„í™œì„±"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1 font-mono",children:s.formula}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(D,{variant:"outline",className:"text-xs",children:s.category}),s.unit&&e.jsx(D,{variant:"outline",className:"text-xs",children:s.unit})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:l=>{l.stopPropagation(),o({...s})},children:e.jsx(te,{className:"h-3 w-3"})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:l=>{l.stopPropagation(),q(s.id)},children:e.jsx(ue,{className:"h-3 w-3"})})]})]})},s.id))})})})]}),e.jsxs(w,{children:[e.jsx(S,{children:e.jsx(k,{children:t?"ìˆ˜ì‹ í¸ì§‘":"ìˆ˜ì‹ ìƒì„¸"})}),e.jsx(C,{children:t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-name",children:"ìˆ˜ì‹ ì´ë¦„"}),e.jsx(J,{id:"formula-name",value:t.name,onChange:s=>o({...t,name:s.target.value}),placeholder:"ì˜ˆ: RACH Success Rate (%)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-input",children:"ìˆ˜ì‹"}),e.jsx(Ce,{id:"formula-input",value:t.formula,onChange:s=>{o({...t,formula:s.target.value}),u.autoValidate&&_(O(s.target.value))},placeholder:"ì˜ˆ: (randomaccesspremable / randomaccessresponse) * 100",className:"font-mono text-sm",rows:4}),c&&e.jsxs("div",{className:"space-y-2",children:[c.isValid?e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"ìˆ˜ì‹ì´ ìœ íš¨í•©ë‹ˆë‹¤"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:c.errors.join(", ")})]}),c.warnings.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:c.warnings.join(", ")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-description",children:"ì„¤ëª…"}),e.jsx(J,{id:"formula-description",value:t.description,onChange:s=>o({...t,description:s.target.value}),placeholder:"ìˆ˜ì‹ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-category",children:"ì¹´í…Œê³ ë¦¬"}),e.jsxs(ce,{value:t.category,onValueChange:s=>o({...t,category:s}),children:[e.jsx(re,{children:e.jsx(de,{})}),e.jsxs(oe,{children:[e.jsx(y,{value:"percentage",children:"ë¹„ìœ¨ (%)"}),e.jsx(y,{value:"success_rate",children:"ì„±ê³µë¥ "}),e.jsx(y,{value:"efficiency",children:"íš¨ìœ¨ì„±"}),e.jsx(y,{value:"quality",children:"í’ˆì§ˆ"}),e.jsx(y,{value:"performance",children:"ì„±ëŠ¥"}),e.jsx(y,{value:"custom",children:"ì‚¬ìš©ì ì •ì˜"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-unit",children:"ë‹¨ìœ„"}),e.jsx(J,{id:"formula-unit",value:t.unit,onChange:s=>o({...t,unit:s.target.value}),placeholder:"ì˜ˆ: %, ms, Mbps"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"formula-active",checked:t.active,onCheckedChange:s=>o({...t,active:s})}),e.jsx(h,{htmlFor:"formula-active",children:"ìˆ˜ì‹ í™œì„±í™”"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{onClick:()=>{const s=O(t.formula);_(s);const l=z(t.formula);W(l)},children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"í…ŒìŠ¤íŠ¸"]}),e.jsxs(v,{onClick:V,disabled:R,children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"ì €ì¥"]}),e.jsxs(v,{variant:"outline",onClick:()=>o(null),children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"ì·¨ì†Œ"]})]}),E&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(De,{}),e.jsx("h4",{className:"font-medium",children:"í…ŒìŠ¤íŠ¸ ê²°ê³¼"}),E.success?e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-green-700",children:e.jsxs("strong",{children:["ê²°ê³¼: ",E.result]})}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"ëª¨ì˜ ë°ì´í„°ë¥¼ ì‚¬ìš©í•œ ê³„ì‚° ê²°ê³¼ì…ë‹ˆë‹¤"})]}):e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-700",children:["ì˜¤ë¥˜: ",E.error]})})]})]}):n?e.jsx("div",{className:"space-y-4",children:(()=>{const s=d.find(l=>l.id===n);return s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"ìˆ˜ì‹"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg font-mono text-sm",children:s.formula})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"ì¹´í…Œê³ ë¦¬"}),e.jsx("p",{className:"text-sm",children:s.category})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"ë‹¨ìœ„"}),e.jsx("p",{className:"text-sm",children:s.unit||"ì—†ìŒ"})]})]}),(s.dependencies&&s.dependencies.length>0||s.derivedDependencies&&s.derivedDependencies.length>0)&&e.jsxs("div",{className:"space-y-2",children:[s.dependencies&&s.dependencies.length>0&&e.jsxs("div",{children:[e.jsxs(h,{className:"text-xs flex items-center gap-1",children:[e.jsx(X,{className:"h-3 w-3"}),"ê¸°ë³¸ PEG ì˜ì¡´ì„±"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.dependencies.map(l=>e.jsx(D,{variant:"outline",className:"text-xs",children:l},l))})]}),s.derivedDependencies&&s.derivedDependencies.length>0&&e.jsxs("div",{children:[e.jsxs(h,{className:"text-xs flex items-center gap-1",children:[e.jsx(I,{className:"h-3 w-3"}),"Derived PEG ì˜ì¡´ì„±"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.derivedDependencies.map(l=>e.jsx(D,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700",children:l},l))})]})]}),e.jsxs(v,{onClick:()=>o({...s}),className:"w-full",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"í¸ì§‘"]})]}):e.jsx("p",{children:"ìˆ˜ì‹ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."})})()}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(I,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"ìˆ˜ì‹ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒˆë¡œ ë§Œë“¤ì–´ë³´ì„¸ìš”"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsx(S,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"í…œí”Œë¦¿ ë¼ì´ë¸ŒëŸ¬ë¦¬"]})}),e.jsx(C,{children:e.jsx("div",{className:"space-y-2",children:Y.map(s=>e.jsx("div",{className:"p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>Z(s),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",children:s.name}),e.jsx("p",{className:"text-xs font-mono text-muted-foreground",children:s.formula}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description})]}),e.jsx(v,{variant:"ghost",size:"sm",children:e.jsx(fe,{className:"h-3 w-3"})})]})},s.id))})})]}),e.jsxs(w,{children:[e.jsx(S,{children:e.jsx(k,{children:"ì§€ì› ì—°ì‚°ì"})}),e.jsx(C,{children:e.jsx(me,{className:"h-64",children:e.jsx("div",{className:"space-y-2",children:ee.map((s,l)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("code",{className:"font-mono font-medium",children:s.symbol}),e.jsx("span",{className:"text-sm text-muted-foreground ml-2",children:s.name})]}),e.jsx("code",{className:"text-xs text-muted-foreground",children:s.example})]},l))})})})]})]}),e.jsxs(w,{children:[e.jsxs(S,{children:[e.jsx(k,{children:"ì‚¬ìš© ê°€ëŠ¥í•œ PEG"}),e.jsx(Pe,{children:"ìˆ˜ì‹ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ë³¸ PEGì™€ ìƒì„±ëœ Derived PEG ëª©ë¡ì…ë‹ˆë‹¤"})]}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-4",children:[g.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"ê¸°ë³¸ PEG (",g.length,"ê°œ)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(s=>e.jsx(v,{variant:"outline",size:"sm",onClick:()=>{t&&o({...t,formula:t.formula+s.value})},className:"text-xs",children:s.label||s.value},s.value))})]}),d.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Derived PEG (",d.filter(s=>s.active).length,"ê°œ)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.filter(s=>s.active).map(s=>e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>{if(t){const l=`${s.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()}`;o({...t,formula:t.formula+l})}},className:"text-xs bg-blue-50 border-blue-200 hover:bg-blue-100",title:s.description,children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),s.name,s.unit&&e.jsxs("span",{className:"ml-1 text-muted-foreground",children:["(",s.unit,")"]})]},s.id))}),d.filter(s=>s.active).length===0&&e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(I,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"ì•„ì§ ìƒì„±ëœ Derived PEGê°€ ì—†ìŠµë‹ˆë‹¤"}),e.jsx("p",{className:"text-xs",children:"ìƒˆ ìˆ˜ì‹ì„ ì¶”ê°€í•˜ê³  í™œì„±í™”í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤"})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-sm text-blue-700 mb-1",children:"ğŸ’¡ ì‚¬ìš©ë²•"}),e.jsxs("ul",{className:"text-xs text-blue-600 space-y-1",children:[e.jsx("li",{children:"â€¢ ê¸°ë³¸ PEG: í´ë¦­í•˜ë©´ ìˆ˜ì‹ì— ë°”ë¡œ ì‚½ì…ë©ë‹ˆë‹¤"}),e.jsx("li",{children:"â€¢ Derived PEG: ë‹¤ë¥¸ ìˆ˜ì‹ì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ” ê³„ì‚°ëœ ê°’ì…ë‹ˆë‹¤"}),e.jsx("li",{children:"â€¢ ë¹„í™œì„±í™”ëœ Derived PEGëŠ” ëª©ë¡ì— í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤"}),e.jsx("li",{children:"â€¢ Derived PEGë¼ë¦¬ ìˆœí™˜ ì°¸ì¡°í•˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì„¸ìš”"})]})]})]})})]})]})};function Oe(a=[],r=[]){const g=a.map(n=>({...n,type:"basic",source:"database"})),R=r.filter(n=>n.active).map(n=>({value:n.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase(),label:`${n.name}${n.unit?` (${n.unit})`:""} [Derived]`,originalName:n.name,description:n.description,formula:n.formula,type:"derived",source:"calculated",dependencies:n.dependencies||[],derivedDependencies:n.derivedDependencies||[]}));return[...g,...R]}function Re(a=[]){return a.map(r=>({value:r.value,label:r.label,type:r.type,color:r.type==="derived"?"#3b82f6":"#6b7280",isDerived:r.type==="derived",description:r.description,formula:r.formula}))}const ze=()=>{var O,z,M,V,q,Z,L,s,l,i,N;const{preferences:a,isLoading:r,isSaving:g,error:R,lastSaved:n,updateSettings:B}=Se(),[t,o]=p.useState([]),[b,$]=p.useState(!1),[c,_]=p.useState(!1),[E,W]=p.useState(null),d=p.useCallback(async()=>{var m;try{$(!0),console.info("[PreferenceManager] Fetching DB PEGs");let x={};try{const f=localStorage.getItem("dbConfig");f&&(x=JSON.parse(f))}catch{}if(!x.host){console.warn("[PreferenceManager] No DB config found");return}const G=await ke.post("/api/master/pegs",{db:x,table:x.table||"summary",limit:100}),P=((m=G==null?void 0:G.data)==null?void 0:m.pegs)||[];console.info("[PreferenceManager] DB PEGs loaded:",P.length);const F=P.map(f=>({value:f.id||f.name,label:`${f.name||f.id} (DB PEG)`}));o(F),W(new Date)}catch(x){console.error("[PreferenceManager] Error fetching DB PEGs:",x)}finally{$(!1)}},[]),u=p.useCallback(()=>{var F,f,K;console.log("ğŸ” getCurrentPegOptions í˜¸ì¶œë¨:",{useDbPegs:c,dbPegOptionsCount:t.length,derivedFormulasCount:((f=(F=a==null?void 0:a.derivedPegSettings)==null?void 0:F.formulas)==null?void 0:f.length)||0});let m=[];c&&t.length>0?(console.log("ğŸ“Š Database PEG ì‚¬ìš©:",t),m=t):(console.log("ğŸ“ ê¸°ë³¸ PEG ëª©ë¡ ì‚¬ìš© (fallback)"),m=[{value:"availability",label:"Availability (%)"},{value:"rrc",label:"RRC Success Rate (%)"},{value:"erab",label:"ERAB Success Rate (%)"},{value:"sar",label:"SAR"},{value:"mobility_intra",label:"Mobility Intra (%)"},{value:"cqi",label:"CQI"},{value:"se",label:"Spectral Efficiency"},{value:"dl_thp",label:"DL Throughput"},{value:"ul_int",label:"UL Interference"}]);const x=((K=a==null?void 0:a.derivedPegSettings)==null?void 0:K.formulas)||[],G=Oe(m,x),P=Re(G);return console.log("âœ… ìµœì¢… PEG ì˜µì…˜:",P),P},[c,t,(O=a==null?void 0:a.derivedPegSettings)==null?void 0:O.formulas]),Y=[{key:"selectedPegs",label:"Dashboardì— í‘œì‹œí•  PEG ëª©ë¡",type:"multiselect",required:!0,options:u(),placeholder:c?"Databaseì˜ ì‹¤ì œ PEGë¥¼ ì„ íƒí•˜ì„¸ìš”":"Dashboardì—ì„œ ë³´ì—¬ì¤„ PEGë¥¼ ì„ íƒí•˜ì„¸ìš”"},{key:"defaultNe",label:"ê¸°ë³¸ NE",type:"text",placeholder:"ì˜ˆ: nvgnb#10000,nvgnb#20000"},{key:"defaultCellId",label:"ê¸°ë³¸ Cell ID",type:"text",placeholder:"ì˜ˆ: 2010,2011"},{key:"autoRefreshInterval",label:"ìë™ ìƒˆë¡œê³ ì¹¨ ê°„ê²© (ì´ˆ)",type:"number",min:0,max:300,placeholder:"0 = ë¹„í™œì„±í™”, 30 = 30ì´ˆë§ˆë‹¤"},{key:"chartStyle",label:"ì°¨íŠ¸ ìŠ¤íƒ€ì¼",type:"select",options:[{value:"line",label:"Line Chart"},{value:"area",label:"Area Chart"},{value:"bar",label:"Bar Chart"}]},{key:"showLegend",label:"ì°¨íŠ¸ ë²”ë¡€ í‘œì‹œ",type:"switch"},{key:"showGrid",label:"ì°¨íŠ¸ ê²©ì í‘œì‹œ",type:"switch"}],ee=[{key:"defaultNe",label:"ê¸°ë³¸ NE",type:"text",placeholder:"ì˜ˆ: nvgnb#10000,nvgnb#20000"},{key:"defaultCellId",label:"ê¸°ë³¸ Cell ID",type:"text",placeholder:"ì˜ˆ: 2010,2011"},{key:"defaultDateRange",label:"ê¸°ë³¸ ë‚ ì§œ ë²”ìœ„ (ì¼)",type:"number",min:1,max:365,placeholder:"ê¸°ë³¸ ì¡°íšŒ ê¸°ê°„"},{key:"decimalPlaces",label:"ì†Œìˆ˜ì  ìë¦¿ìˆ˜",type:"number",min:0,max:6,placeholder:"í†µê³„ ìˆ˜ì¹˜ í‘œì‹œ ì •ë°€ë„"},{key:"showComparisonOptions",label:"ë¹„êµ ë¶„ì„ ì˜µì…˜ í‘œì‹œ",type:"switch"},{key:"autoCalculateStats",label:"ìë™ í†µê³„ ê³„ì‚°",type:"switch"}],se=[{key:"enableNotifications",label:"ì•Œë¦¼ í™œì„±í™”",type:"switch"},{key:"emailNotifications",label:"ì´ë©”ì¼ ì•Œë¦¼",type:"switch"},{key:"soundEnabled",label:"ì†Œë¦¬ ì•Œë¦¼",type:"switch"},{key:"notificationFrequency",label:"ì•Œë¦¼ ë¹ˆë„",type:"select",options:[{value:"immediate",label:"ì¦‰ì‹œ"},{value:"hourly",label:"ë§¤ì‹œê°„"},{value:"daily",label:"ë§¤ì¼"},{value:"weekly",label:"ë§¤ì£¼"}]}];return r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"í™˜ê²½ì„¤ì •"}),e.jsxs(D,{variant:"secondary",className:"text-xs",children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),"ë¡œë”© ì¤‘..."]})]}),e.jsx(w,{children:e.jsx(C,{className:"pt-6",children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤..."})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"í™˜ê²½ì„¤ì •"}),e.jsx("p",{className:"text-muted-foreground",children:"Dashboardì™€ Statisticsì˜ ë™ì‘ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[g&&e.jsxs(D,{variant:"secondary",className:"text-xs",children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),"ì €ì¥ ì¤‘..."]}),R&&e.jsx(D,{variant:"destructive",className:"text-xs",children:"ì˜¤ë¥˜ ë°œìƒ"}),n&&e.jsxs(D,{variant:"outline",className:"text-xs",children:["ë§ˆì§€ë§‰ ì €ì¥: ",new Date(n).toLocaleTimeString()]})]})]}),e.jsxs(Ge,{defaultValue:"dashboard",className:"w-full",children:[e.jsxs(Fe,{className:"grid w-full grid-cols-5",children:[e.jsxs(A,{value:"dashboard",className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),"Dashboard"]}),e.jsxs(A,{value:"statistics",className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Statistics"]}),e.jsxs(A,{value:"derived-peg",className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Derived PEG"]}),e.jsxs(A,{value:"notifications",className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"ì•Œë¦¼"]}),e.jsxs(A,{value:"backup",className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"ë°±ì—…/ë³µì›"]})]}),e.jsxs(T,{value:"dashboard",className:"space-y-6",children:[e.jsxs(w,{children:[e.jsx(S,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),"PEG ë°ì´í„° ì†ŒìŠ¤"]})}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:c?"Database PEG ì‚¬ìš© ì¤‘":"ê¸°ë³¸ KPI ëª©ë¡ ì‚¬ìš© ì¤‘"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?"Database Settingsì—ì„œ ì—°ê²°ëœ ì‹¤ì œ PEG ëª©ë¡ì„ ì‚¬ìš©í•©ë‹ˆë‹¤":"ë¯¸ë¦¬ ì •ì˜ëœ ê¸°ë³¸ KPI ëª©ë¡ì„ ì‚¬ìš©í•©ë‹ˆë‹¤"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:c?"secondary":"default",size:"sm",onClick:()=>{_(!1),localStorage.setItem("useDbPegs","false")},children:"ê¸°ë³¸ KPI"}),e.jsx(v,{variant:c?"default":"secondary",size:"sm",onClick:()=>{_(!0),localStorage.setItem("useDbPegs","true"),d()},disabled:b,children:b?"ë¡œë”© ì¤‘...":"DB PEG"}),t.length>0&&e.jsxs(v,{variant:"outline",size:"sm",onClick:d,disabled:b,children:[e.jsx(we,{className:`h-3 w-3 ${b?"animate-spin":""}`}),"ìƒˆë¡œê³ ì¹¨"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"í˜„ì¬ ëª¨ë“œ"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?"Database PEG":"ê¸°ë³¸ KPI"})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"ì‚¬ìš© ê°€ëŠ¥í•œ PEG"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?`${t.length}ê°œ`:"9ê°œ (ê¸°ë³¸)"})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:E?E.toLocaleTimeString():"ì—†ìŒ"})]})]}),c&&t.length===0&&!b&&e.jsx("div",{className:"p-3 border rounded-lg bg-amber-50 border-amber-200",children:e.jsx("p",{className:"text-sm text-amber-700",children:"âš ï¸ DB PEGë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. Database Settingsì—ì„œ DB ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”."})}),c&&t.length>0&&e.jsx("div",{className:"p-3 border rounded-lg bg-green-50 border-green-200",children:e.jsxs("p",{className:"text-sm text-green-700",children:["âœ… ",t.length,"ê°œì˜ ì‹¤ì œ DB PEGë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"]})})]})})]}),e.jsx(ae,{title:"Dashboard ì„¤ì •",description:"Dashboardì—ì„œ í‘œì‹œí•  PEG, ì°¨íŠ¸ ìŠ¤íƒ€ì¼, ìë™ ìƒˆë¡œê³ ì¹¨ ë“±ì„ ì„¤ì •í•©ë‹ˆë‹¤",settingKey:"dashboardSettings",fields:Y,defaultOpen:!0,showResetButton:!0,showSaveButton:!1})]}),e.jsx(T,{value:"statistics",className:"space-y-6",children:e.jsx(ae,{title:"Statistics ì„¤ì •",description:"Statistics í˜ì´ì§€ì˜ ê¸°ë³¸ê°’, ì†Œìˆ˜ì  ìë¦¿ìˆ˜, ë¹„êµ ì˜µì…˜ ë“±ì„ ì„¤ì •í•©ë‹ˆë‹¤",settingKey:"statisticsSettings",fields:ee,defaultOpen:!0,showResetButton:!0,showSaveButton:!1})}),e.jsx(T,{value:"derived-peg",className:"space-y-6",children:e.jsx(Ie,{derivedPegSettings:(a==null?void 0:a.derivedPegSettings)||{formulas:[],settings:{}},updateDerivedPegSettings:m=>{B({derivedPegSettings:m})},availablePegs:u(),saving:g})}),e.jsx(T,{value:"notifications",className:"space-y-6",children:e.jsx(ae,{title:"ì•Œë¦¼ ì„¤ì •",description:"ì´ë©”ì¼, ì†Œë¦¬ ì•Œë¦¼ ë“± ì•Œë¦¼ ê´€ë ¨ ì„¤ì •ì„ ê´€ë¦¬í•©ë‹ˆë‹¤",settingKey:"notificationSettings",fields:se,defaultOpen:!0,showResetButton:!0,showSaveButton:!1})}),e.jsx(T,{value:"backup",className:"space-y-6",children:e.jsx(Ee,{title:"ì„¤ì • ë°±ì—… ë° ë³µì›",description:"ëª¨ë“  í™˜ê²½ì„¤ì •ì„ JSON íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê±°ë‚˜ ë°±ì—… íŒŒì¼ì—ì„œ ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤",defaultOpen:!0})})]}),e.jsxs(w,{children:[e.jsx(S,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),"í˜„ì¬ ì„¤ì • ìš”ì•½"]})}),e.jsx(C,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Dashboard"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ì„ íƒëœ PEG: ",((M=(z=a==null?void 0:a.dashboardSettings)==null?void 0:z.selectedPegs)==null?void 0:M.length)||0,"ê°œ"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["PEG ì†ŒìŠ¤: ",c?`DB (${t.length}ê°œ)`:"ê¸°ë³¸ KPI"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ì°¨íŠ¸ ìŠ¤íƒ€ì¼: ",((V=a==null?void 0:a.dashboardSettings)==null?void 0:V.chartStyle)||"line"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ìë™ ìƒˆë¡œê³ ì¹¨: ",((q=a==null?void 0:a.dashboardSettings)==null?void 0:q.autoRefreshInterval)||0,"ì´ˆ"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Statistics"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ê¸°ë³¸ ê¸°ê°„: ",((Z=a==null?void 0:a.statisticsSettings)==null?void 0:Z.defaultDateRange)||7,"ì¼"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ì†Œìˆ˜ì : ",((L=a==null?void 0:a.statisticsSettings)==null?void 0:L.decimalPlaces)||2,"ìë¦¬"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ë¹„êµ ì˜µì…˜: ",(s=a==null?void 0:a.statisticsSettings)!=null&&s.showComparisonOptions?"í™œì„±":"ë¹„í™œì„±"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"ì•Œë¦¼"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ì•Œë¦¼: ",(l=a==null?void 0:a.notificationSettings)!=null&&l.enableNotifications?"í™œì„±":"ë¹„í™œì„±"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ì´ë©”ì¼: ",(i=a==null?void 0:a.notificationSettings)!=null&&i.emailNotifications?"í™œì„±":"ë¹„í™œì„±"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ì†Œë¦¬: ",(N=a==null?void 0:a.notificationSettings)!=null&&N.soundEnabled?"í™œì„±":"ë¹„í™œì„±"]})]})]})]})})]})]})};export{ze as default};

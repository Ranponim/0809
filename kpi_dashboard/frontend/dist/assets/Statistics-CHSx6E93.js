import{r as l,j as s,Z as P,T as $,C as K}from"./react-vendor-BbkKAD8O.js";import{f as M,B as i,C as U,b as _,c as H,d as J,L as m,I as h,e as D,a as b}from"./index-CvEd_8oR.js";import{T as q,a as G,b as w,c as T}from"./scroll-area-E1Oa0Jgs.js";import Q from"./AdvancedChart-Bw2EyRDn.js";import V from"./BasicComparison-BEtCHXKc.js";import{a4 as v}from"./vendor-B4aOkbPy.js";import"./ui-vendor-BA32w1ww.js";import"./utils-vendor-DgsWbSrd.js";import"./chart-vendor-DLa56ojw.js";import"./ComparisonChart-DO7zaJaz.js";const js=()=>{const{settings:o,saving:I,error:O}=M(),d=o.defaultDateRange||7,u=o.defaultNe||"",g=o.defaultCellId||"",j=o.decimalPlaces||2,S=o.showComparisonOptions!==!1,C=o.autoCalculateStats!==!1,[Z,R]=l.useState({startDate:new Date(Date.now()-d*24*60*60*1e3).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],ne:u,cellid:g}),[N,z]=l.useState([]),[n,c]=l.useState({host:"",port:5432,user:"",password:"",dbname:"",table:"summary"}),[p,f]=l.useState({status:"idle",message:""}),[y,B]=l.useState(null),[W,X]=l.useState(""),[Y,ss]=l.useState(!1),[es,A]=l.useState([]),[as,E]=l.useState([]),[ts,ls]=l.useState([]),[ns,is]=l.useState([]),F=[{value:"availability",label:"Availability"},{value:"rrc",label:"RRC Success Rate"},{value:"erab",label:"ERAB Success Rate"},{value:"sar",label:"SAR"},{value:"mobility_intra",label:"Mobility Intra"},{value:"cqi",label:"CQI"},{value:"se",label:"Spectral Efficiency"},{value:"dl_thp",label:"DL Throughput"},{value:"ul_int",label:"UL Interference"}],[cs,rs]=l.useState(F);l.useEffect(()=>{console.log("[Statistics] 설정 변경 감지:",{defaultDateRange:d,defaultNe:u,defaultCellId:g,decimalPlaces:j}),R(e=>({...e,startDate:new Date(Date.now()-d*24*60*60*1e3).toISOString().split("T")[0],ne:u,cellid:g}))},[d,u,g]),l.useEffect(()=>{try{const a=localStorage.getItem("dbConfig");if(a){const r=JSON.parse(a);c(t=>({...t,...r})),console.info("[Statistics] Loaded dbConfig from localStorage")}}catch{}(async()=>{var a,r;try{console.info("[Statistics] Fetching master PEGs/Cells");const[t,x]=await Promise.all([b.get("/api/master/pegs"),b.get("/api/master/cells")]);A(t.data.pegs||[]),E(x.data.cells||[]),console.info("[Statistics] Master loaded:",((a=t.data.pegs)==null?void 0:a.length)||0,((r=x.data.cells)==null?void 0:r.length)||0)}catch(t){console.error("Error fetching master data:",t)}})()},[]);const L=()=>{try{localStorage.setItem("dbConfig",JSON.stringify(n));const e=new Date().toLocaleString();B(e),v.success("Database settings saved")}catch{v.error("Failed to save settings")}},k=async()=>{var e,a,r;f({status:"testing",message:""});try{const t=await b.post("/api/db/ping",{db:n});(e=t==null?void 0:t.data)!=null&&e.ok?(f({status:"ok",message:"Connection successful"}),v.success("DB connection OK")):(f({status:"fail",message:"Unexpected response"}),v.error("DB connection failed"))}catch(t){const x=((r=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:r.detail)||(t==null?void 0:t.message)||"Connection failed";f({status:"fail",message:String(x)}),v.error(`DB connection failed: ${x}`)}};return N.length>0&&Object.keys(N[0]).filter(e=>e!=="time"),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-3xl font-bold",children:"Statistics"}),s.jsxs("p",{className:"text-muted-foreground",children:["기본 날짜 범위: ",d,"일 • 소수점: ",j,"자리",u&&` • 기본 NE: ${u}`,g&&` • 기본 Cell: ${g}`]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[I&&s.jsxs(i,{variant:"secondary",className:"text-xs",children:[s.jsx(P,{className:"h-3 w-3 mr-1"}),"설정 저장 중"]}),O&&s.jsx(i,{variant:"destructive",className:"text-xs",children:"설정 오류"}),C&&s.jsxs(i,{variant:"outline",className:"text-xs",children:[s.jsx($,{className:"h-3 w-3 mr-1"}),"자동 통계 계산"]}),S&&s.jsxs(i,{variant:"outline",className:"text-xs",children:[s.jsx(K,{className:"h-3 w-3 mr-1"}),"비교 옵션 활성"]})]})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs(i,{variant:"default",children:["기본 기간: ",d,"일"]}),s.jsxs(i,{variant:"outline",children:["소수점: ",j,"자리"]}),C&&s.jsx(i,{variant:"secondary",children:"자동 통계 계산"}),S&&s.jsx(i,{variant:"secondary",children:"비교 옵션"})]}),s.jsxs(U,{children:[s.jsx(_,{children:s.jsx(H,{children:"Database Settings"})}),s.jsxs(J,{children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{htmlFor:"host",children:"Host"}),s.jsx(h,{id:"host",value:n.host,onChange:e=>c(a=>({...a,host:e.target.value})),placeholder:"127.0.0.1"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{htmlFor:"port",children:"Port"}),s.jsx(h,{id:"port",type:"number",value:n.port,onChange:e=>c(a=>({...a,port:Number(e.target.value||5432)}))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{htmlFor:"user",children:"User"}),s.jsx(h,{id:"user",value:n.user,onChange:e=>c(a=>({...a,user:e.target.value}))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{htmlFor:"password",children:"Password"}),s.jsx(h,{id:"password",type:"password",value:n.password,onChange:e=>c(a=>({...a,password:e.target.value}))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{htmlFor:"dbname",children:"DB Name"}),s.jsx(h,{id:"dbname",value:n.dbname,onChange:e=>c(a=>({...a,dbname:e.target.value}))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{htmlFor:"table",children:"Table"}),s.jsx(h,{id:"table",value:n.table,onChange:e=>c(a=>({...a,table:e.target.value}))})]})]}),s.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[s.jsx(D,{variant:"secondary",onClick:L,children:"Save Settings"}),s.jsx(D,{onClick:k,disabled:p.status==="testing",children:p.status==="testing"?"Testing...":"Test Connection"}),s.jsxs("div",{className:"text-sm text-gray-500",children:[y?`Saved: ${y}`:"Not saved yet",p.status==="ok"&&" · DB: OK",p.status==="fail"&&` · DB: FAIL (${p.message})`]})]})]})]}),s.jsxs(q,{defaultValue:"basic",className:"w-full",children:[s.jsxs(G,{className:"grid w-full grid-cols-2",children:[s.jsx(w,{value:"basic",children:"Basic Analysis"}),s.jsx(w,{value:"advanced",children:"Advanced Analysis"})]}),s.jsx(T,{value:"basic",className:"space-y-6",children:s.jsx(V,{})}),s.jsx(T,{value:"advanced",className:"space-y-6",children:s.jsx(Q,{})})]})]})};export{js as default};

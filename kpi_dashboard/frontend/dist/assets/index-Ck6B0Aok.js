const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/webVitals-CCkPJBQ5.js","assets/vendor-C-HZcing.js","assets/utils-vendor-DrCDvq1f.js","assets/ui-vendor-CtEEaYRX.js","assets/icon-vendor-BXbr4vD6.js","assets/chart-vendor-CSmpywC9.js"])))=>i.map(i=>d[i]);
var sa=Object.defineProperty;var ta=(s,t,a)=>t in s?sa(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var Cs=(s,t,a)=>ta(s,typeof t!="symbol"?t+"":t,a);import{a1 as aa,M as e,r,a2 as ra,a3 as Q,R as na,a4 as la,a5 as ia,a6 as xt}from"./vendor-C-HZcing.js";import{S as gt,R as ca,C as oa,a as da,T as ma,P as ua,O as ha,b as xa,c as ga,I as fa,V as pa,d as ja,e as va,f as ba,g as ya,h as Na,i as wa,j as Sa,k as Ca,l as ka,m as Da,n as _a,o as Ea,L as Pa,p as $a,q as Aa,r as Ia,s as La,t as Ta,u as Oa,v as Ra,w as Ma,x as za,y as Fa,z as Ga,A as Ba,B as Va,D as Ua,E as Ka,F as Ha,G as qa,H as Wa,J as Ya,K as Ja,M as Za,N as Qa,Q as Xa,U as er}from"./ui-vendor-CtEEaYRX.js";import{f as sr,D as Rs}from"./utils-vendor-DrCDvq1f.js";import{C as Oe,D as We,T as gs,B as ft,S as ls,X as Le,a as Be,R as os,b as Xe,c as Fe,d as ys,e as ds,f as Ce,g as Ms,M as pt,h as jt,A as Us,i as tr,P as zs,j as Is,E as vt,k as cs,l as ar,m as rr,n as Ls,o as nr,F as lr,U as ir,p as cr,q as or,r as Qe,s as dr,t as js,u as Ks,v as Ts,w as mr,x as ur,y as hr,L as ms,z as Fs,G as xr,H as gr,I as fr,J as pr,K as Hs,N as jr}from"./icon-vendor-BXbr4vD6.js";import{R as Ie,L as Gs,a as Ge,B as vs,b as Te,A as bt,c as as,C as He,X as qe,Y as ze,T as Re,d as Me,e as vr,f as ks,g as br,h as yr,P as Nr,i as wr,j as Sr,k as qs,l as Cr,m as kr}from"./chart-vendor-CSmpywC9.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const g of i)if(g.type==="childList")for(const h of g.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function a(i){const g={};return i.integrity&&(g.integrity=i.integrity),i.referrerPolicy&&(g.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?g.credentials="include":i.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function n(i){if(i.ep)return;i.ep=!0;const g=a(i);fetch(i.href,g)}})();const Dr="modulepreload",_r=function(s){return"/"+s},Ws={},Se=function(t,a,n){let i=Promise.resolve();if(a&&a.length>0){let h=function(d){return Promise.all(d.map(f=>Promise.resolve(f).then(P=>({status:"fulfilled",value:P}),P=>({status:"rejected",reason:P}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),u=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=h(a.map(d=>{if(d=_r(d),d in Ws)return;Ws[d]=!0;const f=d.endsWith(".css"),P=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${P}`))return;const l=document.createElement("link");if(l.rel=f?"stylesheet":Dr,f||(l.as="script"),l.crossOrigin="",l.href=d,u&&l.setAttribute("nonce",u),document.head.appendChild(l),f)return new Promise((p,y)=>{l.addEventListener("load",p),l.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${d}`)))})}))}function g(h){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=h,window.dispatchEvent(o),!o.defaultPrevented)throw h}return i.then(h=>{for(const o of h||[])o.status==="rejected"&&g(o.reason);return t().catch(g)})};function te(...s){return aa(sr(s))}const Bs=Rs("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function J({className:s,variant:t,size:a,asChild:n=!1,...i}){const g=n?gt:"button";return e.jsx(g,{"data-slot":"button",className:te(Bs({variant:t,size:a,className:s})),...i})}r.lazy(()=>Se(()=>Promise.resolve().then(()=>Lt),void 0));r.lazy(()=>Se(()=>Promise.resolve().then(()=>Gt),void 0));r.lazy(()=>Se(()=>Promise.resolve().then(()=>Wt),void 0));r.lazy(()=>Se(()=>Promise.resolve().then(()=>Zt),void 0));r.lazy(()=>Se(()=>Promise.resolve().then(()=>Xt),void 0));r.lazy(()=>Se(()=>Promise.resolve().then(()=>Rt),void 0));r.lazy(()=>Se(()=>Promise.resolve().then(()=>Mt),void 0));r.lazy(()=>Se(()=>Promise.resolve().then(()=>cn),void 0));r.lazy(()=>Se(()=>Promise.resolve().then(()=>kn),void 0));const Os=()=>Se(()=>Promise.resolve().then(()=>Lt),void 0),yt=()=>Se(()=>Promise.resolve().then(()=>Gt),void 0),Nt=()=>Se(()=>Promise.resolve().then(()=>Wt),void 0),wt=()=>Se(()=>Promise.resolve().then(()=>Zt),void 0),Er=()=>Se(()=>Promise.resolve().then(()=>Xt),void 0),Pr=()=>Se(()=>Promise.resolve().then(()=>Rt),void 0),$r=()=>Se(()=>Promise.resolve().then(()=>Mt),void 0),Ar=()=>{if("connection"in navigator){const t=navigator.connection.effectiveType;console.log(`🌐 네트워크 속도: ${t}`),t==="4g"||t==="3g"?(console.log("🚀 빠른 네트워크 감지 - 컴포넌트 프리로딩 시작"),setTimeout(()=>{Os().catch(console.warn),yt().catch(console.warn)},1e3),setTimeout(()=>{Nt().catch(console.warn),wt().catch(console.warn)},2e3),setTimeout(()=>{Pr().catch(console.warn),$r().catch(console.warn)},3e3)):console.log("📶 느린 네트워크 - 필요시에만 로드")}else console.log("📶 네트워크 정보 불가 - 기본 프리로딩"),setTimeout(()=>{Os().catch(console.warn)},2e3)},Ir=({children:s,activeMenu:t,setActiveMenu:a})=>{const n=[{id:"dashboard",label:"Dashboard",icon:Oe,preload:Os},{id:"results",label:"분석 결과",icon:We,preload:wt},{id:"statistics",label:"Statistics",icon:gs,preload:yt},{id:"llm-analysis",label:"LLM 분석",icon:ft,preload:Er},{id:"preference",label:"Preference",icon:ls,preload:Nt}];r.useEffect(()=>{Ar()},[]);const i=g=>{g.preload&&t!==g.id&&(console.log(`🎯 메뉴 호버 감지 - ${g.label} 프리로딩 시작`),g.preload().catch(h=>{console.warn(`⚠️ ${g.label} 프리로딩 실패:`,h)}))};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"px-6 py-4",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"PVT  KPI Dashboard"})})}),e.jsxs("div",{className:"flex",children:[e.jsxs("aside",{className:"w-64 bg-white shadow-sm min-h-screen flex flex-col",children:[e.jsx("nav",{className:"p-4",children:e.jsx("div",{className:"space-y-2",children:n.map(g=>{const h=g.icon;return e.jsxs(J,{variant:t===g.id?"default":"ghost",className:"w-full justify-start",onClick:()=>a(g.id),onMouseEnter:()=>i(g),children:[e.jsx(h,{className:"mr-2 h-4 w-4"}),g.label]},g.id)})})}),e.jsx("div",{className:"mt-auto p-4 text-xs text-gray-400",children:"Powered by PVT AI Crew"})]}),e.jsx("main",{className:"flex-1 p-6",children:s})]})]})};function re({className:s,...t}){return e.jsx("div",{"data-slot":"card",className:te("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",s),...t})}function he({className:s,...t}){return e.jsx("div",{"data-slot":"card-header",className:te("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",s),...t})}function xe({className:s,...t}){return e.jsx("div",{"data-slot":"card-title",className:te("leading-none font-semibold",s),...t})}function Ns({className:s,...t}){return e.jsx("div",{"data-slot":"card-description",className:te("text-muted-foreground text-sm",s),...t})}function ne({className:s,...t}){return e.jsx("div",{"data-slot":"card-content",className:te("px-6",s),...t})}const Lr=Rs("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Z({className:s,variant:t,asChild:a=!1,...n}){const i=a?gt:"span";return e.jsx(i,{"data-slot":"badge",className:te(Lr({variant:t}),s),...n})}function St({...s}){return e.jsx(ca,{"data-slot":"dialog",...s})}function Tr({...s}){return e.jsx(ua,{"data-slot":"dialog-portal",...s})}function Or({className:s,...t}){return e.jsx(ha,{"data-slot":"dialog-overlay",className:te("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...t})}function Ct({className:s,children:t,...a}){return e.jsxs(Tr,{"data-slot":"dialog-portal",children:[e.jsx(Or,{}),e.jsxs(oa,{"data-slot":"dialog-content",className:te("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",s),...a,children:[t,e.jsxs(da,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(Le,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function kt({className:s,...t}){return e.jsx("div",{"data-slot":"dialog-header",className:te("flex flex-col gap-2 text-center sm:text-left",s),...t})}function Dt({className:s,...t}){return e.jsx(ma,{"data-slot":"dialog-title",className:te("text-lg leading-none font-semibold",s),...t})}const oe=(s,t,a=null)=>{const i=`[ApiClient:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${i} ${t}`,a);break;case"error":console.error(`${i} ${t}`,a);break;case"warn":console.warn(`${i} ${t}`,a);break;case"debug":console.debug(`${i} ${t}`,a);break;default:console.log(`${i} ${t}`,a)}},Rr=()=>{try{const s=typeof window<"u"?window.__RUNTIME_CONFIG__||{}:{},t=s.BACKEND_BASE_URL||s.VITE_API_BASE_URL,a=t&&String(t).trim()||"http://localhost:8000";return oe("info","API 기본 URL 설정",{baseURL:a,runtimeCfg:Object.keys(s)}),a}catch(s){return oe("error","API 기본 URL 설정 오류",s),"http://localhost:8000"}},es=s=>{var t,a;try{return(a=(t=s==null?void 0:s.response)==null?void 0:t.data)!=null&&a.detail?s.response.data.detail:s!=null&&s.message?s.message:"알 수 없는 오류가 발생했습니다."}catch(n){return oe("error","에러 메시지 추출 실패",n),"알 수 없는 오류가 발생했습니다."}},Mr=(s,t=["password","token","secret"])=>{if(!s||typeof s!="object")return s;const a={...s};return t.forEach(n=>{a[n]&&(a[n]="[HIDDEN]")}),a},_t=Rr(),ge=ra.create({baseURL:_t,timeout:15e3});oe("info","API 클라이언트 초기화 완료",{baseURL:_t,timeout:15e3});ge.interceptors.request.use(s=>{var t;return oe("debug","API 요청 시작",{method:(t=s.method)==null?void 0:t.toUpperCase(),url:s.url,baseURL:s.baseURL,hasData:!!s.data,hasParams:!!s.params}),s},s=>(oe("error","API 요청 인터셉터 오류",s),Promise.reject(s)));ge.interceptors.response.use(s=>{var t;return oe("debug","API 응답 성공",{status:s.status,url:s.config.url,method:(t=s.config.method)==null?void 0:t.toUpperCase()}),s},s=>{var a,n,i,g;const t=es(s);return oe("error","API 응답 오류",{status:(a=s==null?void 0:s.response)==null?void 0:a.status,url:(n=s==null?void 0:s.config)==null?void 0:n.url,method:(g=(i=s==null?void 0:s.config)==null?void 0:i.method)==null?void 0:g.toUpperCase(),message:t}),Q.error(`요청 실패: ${t}`),Promise.reject(s)});const zr=async(s,t,a="default")=>{var n;oe("info","LLM 분석 요청 시작",{dbConfig:Mr(s),analysisParams:t,userId:a});try{const i=await ge.post("/api/analysis/trigger-llm-analysis",{user_id:a,db_config:s,...t});return oe("info","LLM 분석 트리거 성공",{analysisId:(n=i.data)==null?void 0:n.analysis_id}),i.data}catch(i){throw oe("error","LLM 분석 트리거 실패",i),i}},Fr=async s=>{oe("info","LLM 분석 결과 조회",{analysisId:s});try{const t=await ge.get(`/api/analysis/llm-analysis/${s}`);return oe("info","LLM 분석 결과 조회 성공",{analysisId:s,hasData:!!t.data}),t.data}catch(t){throw oe("error","LLM 분석 결과 조회 실패",{analysisId:s,error:t}),t}},Ds=async(s="default")=>{var t;oe("info","사용자 설정 조회",{userId:s});try{const a=await ge.get("/api/preference/settings",{params:{user_id:s}});return oe("info","사용자 설정 조회 성공",{userId:s}),{success:!0,data:a.data}}catch(a){return((t=a==null?void 0:a.response)==null?void 0:t.status)===404?(oe("info","사용자 설정이 없음 (신규 사용자)",{userId:s}),{success:!0,data:null,isNew:!0}):(oe("error","사용자 설정 조회 실패",{userId:s,error:a}),{success:!1,error:es(a)})}},_s=async(s="default",t)=>{oe("info","사용자 설정 저장",{userId:s,hasData:!!t,dataKeys:t?Object.keys(t):[]});try{const a=await ge.put("/api/preference/settings",t,{params:{user_id:s}});return oe("info","사용자 설정 저장 성공",{userId:s}),{success:!0,data:a.data}}catch(a){return oe("error","사용자 설정 저장 실패",{userId:s,error:a}),{success:!1,error:es(a)}}},Ys=async s=>{const t=s.user_id||s.userId;oe("info","사용자 설정 생성",{userId:t});try{const a=await ge.post("/api/preference/settings",s);return oe("info","사용자 설정 생성 성공",{userId:t}),{success:!0,data:a.data}}catch(a){return oe("error","사용자 설정 생성 실패",{userId:t,error:a}),{success:!1,error:es(a)}}},Gr=async(s="default")=>{oe("info","사용자 설정 삭제",{userId:s});try{return await ge.delete("/api/preference/settings",{params:{user_id:s}}),oe("info","사용자 설정 삭제 성공",{userId:s}),{success:!0}}catch(t){return oe("error","사용자 설정 삭제 실패",{userId:s,error:t}),{success:!1,error:es(t)}}},Br=async(s="default")=>{oe("info","사용자 설정 내보내기",{userId:s});try{const t=await ge.get("/api/preference/export",{params:{user_id:s}});return oe("info","사용자 설정 내보내기 성공",{userId:s}),{success:!0,data:t.data}}catch(t){return oe("error","사용자 설정 내보내기 실패",{userId:s,error:t}),{success:!1,error:es(t)}}},Vr=async(s="default",t,a=!1)=>{oe("info","사용자 설정 가져오기",{userId:s,fileName:t==null?void 0:t.name,fileSize:t==null?void 0:t.size,overwrite:a});try{const n=new FormData;n.append("file",t);const i=await ge.post("/api/preference/import",n,{params:{user_id:s,overwrite:a},headers:{"Content-Type":"multipart/form-data"}});return oe("info","사용자 설정 가져오기 성공",{userId:s}),{success:!0,data:i.data}}catch(n){return oe("error","사용자 설정 가져오기 실패",{userId:s,error:n}),{success:!1,error:es(n)}}},N=(s,t,a=null)=>{const i=`[PreferenceUtils] ${new Date().toISOString()}`;switch(s){case"info":console.log(`${i} ℹ️ ${t}`,a);break;case"warn":console.warn(`${i} ⚠️ ${t}`,a);break;case"error":console.error(`${i} ❌ ${t}`,a);break;default:console.log(`${i} ${t}`,a)}},Ur=()=>{try{if(N("info","런타임 설정 접근 시도"),typeof window<"u"&&window.__RUNTIME_CONFIG__){const s=window.__RUNTIME_CONFIG__;return N("info","런타임 설정 로드 성공",s),s}return N("warn","런타임 설정이 없음 - 기본값 사용"),{}}catch(s){return N("error","런타임 설정 접근 실패",s.message),{}}},Et=()=>{N("info","기본 설정값 생성 시작");const s=Ur(),t={dashboardSettings:{selectedPegs:[],defaultNe:"",defaultCellId:"",autoRefreshInterval:30,chartStyle:"line",showLegend:!0,showGrid:!0,theme:"light",defaultTimeRange:30,timeUnit:"minutes",time1Start:null,time1End:null,time2Start:null,time2End:null,enableTimeComparison:!1},statisticsSettings:{defaultDateRange:7,comparisonEnabled:!0,showDelta:!0,showRsd:!0,defaultPegs:["availability","rrc"],chartType:"bar",decimalPlaces:2,autoAnalysis:!1},databaseSettings:{host:s.DB_HOST||"postgres",port:parseInt(s.DB_PORT,10)||5432,user:s.DB_USER||"postgres",password:s.DB_PASSWORD||"postgres",dbname:s.DB_NAME||"netperf",table:"summary"},notificationSettings:{enableToasts:!0,enableSounds:!1,saveNotification:!0,errorNotification:!0},generalSettings:{language:"ko",timezone:"Asia/Seoul",dateFormat:"YYYY-MM-DD",numberFormat:"comma"},pegConfigurations:[],statisticsConfigurations:[]};return N("info","기본 설정값 생성 완료",{sections:Object.keys(t),runtimeConfigKeys:Object.keys(s)}),t},Es={dashboardSettings:{selectedPegs:{required:!1,type:"array",message:"selectedPegs는 배열이어야 합니다."},autoRefreshInterval:{required:!1,type:"number",min:5,max:300,message:"자동 새로고침 간격은 5초~300초 사이여야 합니다."},defaultNe:{type:"string",maxLength:50,message:"NE ID는 50자를 초과할 수 없습니다."},defaultCellId:{type:"string",maxLength:50,message:"Cell ID는 50자를 초과할 수 없습니다."}},statisticsSettings:{defaultDateRange:{required:!1,type:"number",min:1,max:365,message:"기본 날짜 범위는 1일~365일 사이여야 합니다."},decimalPlaces:{required:!1,type:"number",min:0,max:6,message:"소수점 자릿수는 0~6자리 사이여야 합니다."},defaultPegs:{required:!1,type:"array",message:"defaultPegs는 배열이어야 합니다."}}},Kr=(s,t=null)=>{N("info","설정 유효성 검증 시작",{section:t,hasSettings:!!s});const a={};if(!s||typeof s!="object")return N("error","설정 객체가 유효하지 않음"),{general:"설정 객체가 유효하지 않습니다."};if(t&&!Es[t])return N("warn","지정된 섹션에 대한 검증 규칙이 없음",t),a;const n=t?{[t]:Es[t]}:Es;Object.entries(n).forEach(([g,h])=>{if(!s[g]){N("info","섹션이 없음 - 검증 스킵",g);return}Object.entries(h).forEach(([o,u])=>{const d=s[g][o],f=`${g}.${o}`;if(u.required&&(d==null||d==="")){a[f]=u.message||`${o}는 필수 항목입니다.`,N("warn","필수 필드 누락",{fieldPath:f,value:d});return}if(d==null||d===""){N("info","필드 값이 없음 - 검증 스킵",f);return}if(u.type==="array"&&!Array.isArray(d)){a[f]=u.message||`${o}는 배열이어야 합니다.`,N("warn","타입 검증 실패 - 배열이 아님",{fieldPath:f,value:d,expectedType:"array"});return}if(u.type==="number"&&typeof d!="number"){a[f]=u.message||`${o}는 숫자여야 합니다.`,N("warn","타입 검증 실패 - 숫자가 아님",{fieldPath:f,value:d,expectedType:"number"});return}if(u.type==="string"&&typeof d!="string"){a[f]=u.message||`${o}는 문자열이어야 합니다.`,N("warn","타입 검증 실패 - 문자열이 아님",{fieldPath:f,value:d,expectedType:"string"});return}if(u.type==="number"){if(u.min!==void 0&&d<u.min){a[f]=u.message||`${o}는 ${u.min} 이상이어야 합니다.`,N("warn","숫자 범위 검증 실패 - 최소값 미달",{fieldPath:f,value:d,min:u.min});return}if(u.max!==void 0&&d>u.max){a[f]=u.message||`${o}는 ${u.max} 이하여야 합니다.`,N("warn","숫자 범위 검증 실패 - 최대값 초과",{fieldPath:f,value:d,max:u.max});return}}if(u.type==="array"){if(u.minLength!==void 0&&d.length<u.minLength){a[f]=u.message||`${o}는 최소 ${u.minLength}개 항목이 필요합니다.`,N("warn","배열 길이 검증 실패 - 최소 길이 미달",{fieldPath:f,length:d.length,minLength:u.minLength});return}if(u.maxLength!==void 0&&d.length>u.maxLength){a[f]=u.message||`${o}는 최대 ${u.maxLength}개 항목만 허용됩니다.`,N("warn","배열 길이 검증 실패 - 최대 길이 초과",{fieldPath:f,length:d.length,maxLength:u.maxLength});return}}if(u.type==="string"){if(u.minLength!==void 0&&d.length<u.minLength){a[f]=u.message||`${o}는 최소 ${u.minLength}자 이상이어야 합니다.`,N("warn","문자열 길이 검증 실패 - 최소 길이 미달",{fieldPath:f,length:d.length,minLength:u.minLength});return}if(u.maxLength!==void 0&&d.length>u.maxLength){a[f]=u.message||`${o}는 최대 ${u.maxLength}자까지 허용됩니다.`,N("warn","문자열 길이 검증 실패 - 최대 길이 초과",{fieldPath:f,length:d.length,maxLength:u.maxLength});return}}})});const i=Object.keys(a).length;return N("info","설정 유효성 검증 완료",{errorCount:i,hasErrors:i>0,errorFields:Object.keys(a)}),a},Js=(s,t)=>{if(N("info","설정 병합 시작",{hasSavedSettings:!!s,hasDefaultSettings:!!t}),!s)return N("info","저장된 설정이 없음 - 기본값 반환"),t;try{const a={...t};return Object.keys(t).forEach(n=>{s[n]&&typeof s[n]=="object"?(a[n]={...t[n],...s[n]},N("info","섹션 병합 완료",{section:n,mergedKeys:Object.keys(a[n])})):N("info","섹션이 없거나 객체가 아님 - 기본값 사용",{section:n})}),N("info","설정 병합 완료",{mergedSections:Object.keys(a),totalSections:Object.keys(t).length}),a}catch(a){return N("error","설정 병합 실패",a.message),t}},us="kpi-dashboard-preferences",hs=()=>{try{const s="__localStorage_test__";return localStorage.setItem(s,s),localStorage.removeItem(s),!0}catch(s){return N("warn","localStorage 사용 불가",s.message),!1}},Hr=s=>{if(N("info","localStorage 저장 시작",{hasSettings:!!s}),!hs()){const t="localStorage를 사용할 수 없습니다";throw N("error","localStorage 저장 실패",t),new Error(t)}try{const t={settings:s,lastSaved:new Date().toISOString(),version:1};return localStorage.setItem(us,JSON.stringify(t)),N("info","localStorage 저장 완료",{lastSaved:t.lastSaved,settingsKeys:Object.keys(s)}),{success:!0,lastSaved:t.lastSaved}}catch(t){throw N("error","localStorage 저장 실패",t.message),new Error(`설정 저장 실패: ${t.message}`)}},qr=()=>{if(N("info","localStorage 로드 시작"),!hs())return N("warn","localStorage 사용 불가 - null 반환"),null;try{const s=localStorage.getItem(us);if(!s)return N("info","localStorage에 저장된 설정 없음"),null;const t=JSON.parse(s);return N("info","localStorage 로드 완료",{lastSaved:t.lastSaved,version:t.version,settingsKeys:Object.keys(t.settings||{})}),t.settings}catch(s){N("error","localStorage 로드 실패",s.message);try{localStorage.removeItem(us),N("info","손상된 데이터 제거 완료")}catch(t){N("error","손상된 데이터 제거 실패",t.message)}throw new Error(`설정 로드 실패: ${s.message}`)}},Wr=()=>{if(N("info","localStorage 삭제 시작"),!hs()){const s="localStorage를 사용할 수 없습니다";return N("error","localStorage 삭제 실패",s),{success:!1,error:s}}try{return localStorage.removeItem(us),N("info","localStorage 삭제 완료"),{success:!0}}catch(s){return N("error","localStorage 삭제 실패",s.message),{success:!1,error:s.message}}},Yr=()=>{const[s,t]=r.useState(!1),[a,n]=r.useState(null),[i,g]=r.useState(null);r.useEffect(()=>{N("info","localStorage 사용 가능 여부 확인 시작");const l=hs();t(l),N("info","localStorage 사용 가능 여부 확인 완료",{available:l})},[]);const h=r.useCallback(async l=>{N("info","설정 저장 시작",{hasSettings:!!l}),g(null);try{const p=Hr(l);return n(p.lastSaved),N("info","설정 저장 완료",p),{success:!0,lastSaved:p.lastSaved}}catch(p){const y=p.message;return g(y),N("error","설정 저장 실패",y),{success:!1,error:y}}},[]),o=r.useCallback(async()=>{N("info","설정 로드 시작"),g(null);try{const l=qr();return N("info","설정 로드 완료",{hasSettings:!!l}),{success:!0,settings:l}}catch(l){const p=l.message;return g(p),N("error","설정 로드 실패",p),{success:!1,error:p,settings:null}}},[]),u=r.useCallback(async()=>{N("info","설정 삭제 시작"),g(null);try{const l=Wr();return l.success?(n(null),N("info","설정 삭제 완료")):(g(l.error),N("error","설정 삭제 실패",l.error)),l}catch(l){const p=l.message;return g(p),N("error","설정 삭제 실패",p),{success:!1,error:p}}},[]),d=r.useCallback(async(l,p=null)=>{N("info","설정 백업 시작",{hasSettings:!!l}),g(null);try{const y={settings:l,metadata:{exportedAt:new Date().toISOString(),version:"1.0.0",type:"backup"}},v=JSON.stringify(y,null,2),k=new Blob([v],{type:"application/json"}),_=document.createElement("a");return _.href=URL.createObjectURL(k),_.download=p||`preference-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(_.href),N("info","설정 백업 완료",{filename:_.download}),{success:!0,filename:_.download}}catch(y){const v=y.message;return g(v),N("error","설정 백업 실패",v),{success:!1,error:v}}},[]),f=r.useCallback(async l=>(N("info","설정 복원 시작",{fileName:l==null?void 0:l.name}),g(null),new Promise((p,y)=>{const v=new FileReader;v.onload=k=>{try{const _=JSON.parse(k.target.result);if(!_.settings)throw new Error("유효하지 않은 백업 파일입니다.");N("info","설정 복원 완료",{fileName:l.name,settingsKeys:Object.keys(_.settings)}),p({success:!0,settings:_.settings,metadata:_.metadata})}catch(_){const c=_.message;g(c),N("error","설정 복원 실패",c),y(_)}},v.onerror=()=>{const k=new Error("파일 읽기 실패");g(k.message),N("error","설정 복원 실패",k.message),y(k)},v.readAsText(l)})),[]),P=r.useCallback(()=>{if(N("info","동기화 상태 확인 시작"),!s)return N("warn","localStorage 사용 불가 - 동기화 불가"),{synced:!1,reason:"localStorage_unavailable"};try{const l=localStorage.getItem(us);if(!l)return N("info","저장된 설정 없음 - 동기화 불필요"),{synced:!0,reason:"no_data"};const p=JSON.parse(l),y=!!p.settings;return N("info","동기화 상태 확인 완료",{synced:y,lastSaved:p.lastSaved,hasData:y}),{synced:y,lastSaved:p.lastSaved,reason:y?"synced":"no_data"}}catch(l){return N("error","동기화 상태 확인 실패",l.message),{synced:!1,reason:"error",error:l.message}}},[s]);return{isAvailable:s,lastSaved:a,error:i,saveSettings:h,loadSettings:o,clearSettings:u,backupSettings:d,restoreSettings:f,checkSyncStatus:P,isLocalStorageAvailable:hs}},Jr=()=>{const[s,t]=r.useState(!1),[a,n]=r.useState(null),[i,g]=r.useState(null),h=r.useCallback(async c=>{var D,A;N("info","API 작업 시작"),t(!0),n(null);try{const j=await c();return g(new Date),N("info","API 작업 완료",{success:!0}),j}catch(j){const $=((A=(D=j==null?void 0:j.response)==null?void 0:D.data)==null?void 0:A.detail)||(j==null?void 0:j.message)||"알 수 없는 오류가 발생했습니다.";throw n($),N("error","API 작업 실패",$),j}finally{t(!1)}},[]),o=r.useCallback(async(c="default")=>(N("info","사용자 설정 조회 시작",{userId:c}),await h(async()=>{const D=await Ds(c);if(D.success)return N("info","사용자 설정 조회 성공",{hasData:!!D.data,isNew:D.isNew}),D;throw new Error(D.error||"설정 조회 실패")})),[h]),u=r.useCallback(async(c="default",D)=>(N("info","사용자 설정 저장 시작",{userId:c,hasData:!!D,dataKeys:D?Object.keys(D):[]}),await h(async()=>{const A=await _s(c,D);if(A.success)return N("info","사용자 설정 저장 성공"),Q.success("설정이 서버에 저장되었습니다"),A;throw new Error(A.error||"설정 저장 실패")})),[h]),d=r.useCallback(async c=>(N("info","사용자 설정 생성 시작",{userId:c.user_id||c.userId,hasData:!!c}),await h(async()=>{const D=await Ys(c);if(D.success)return N("info","사용자 설정 생성 성공"),Q.success("새로운 설정이 생성되었습니다"),D;throw new Error(D.error||"설정 생성 실패")})),[h]),f=r.useCallback(async(c="default")=>(N("info","사용자 설정 삭제 시작",{userId:c}),await h(async()=>{const D=await Gr(c);if(D.success)return N("info","사용자 설정 삭제 성공"),Q.success("설정이 삭제되었습니다"),D;throw new Error(D.error||"설정 삭제 실패")})),[h]),P=r.useCallback(async(c="default")=>(N("info","설정 내보내기 시작",{userId:c}),await h(async()=>{const D=await Br(c);if(D.success){N("info","설정 내보내기 성공");const A=JSON.stringify(D.data,null,2),j=new Blob([A],{type:"application/json"}),$=document.createElement("a");return $.href=URL.createObjectURL(j),$.download=`preference-export-${c}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL($.href),Q.success("설정이 파일로 내보내졌습니다"),{...D,filename:$.download}}else throw new Error(D.error||"설정 내보내기 실패")})),[h]),l=r.useCallback(async(c="default",D,A=!1)=>(N("info","설정 가져오기 시작",{userId:c,fileName:D==null?void 0:D.name,overwrite:A}),await h(async()=>{const j=await Vr(c,D,A);if(j.success)return N("info","설정 가져오기 성공"),Q.success("설정이 성공적으로 가져와졌습니다"),j;throw new Error(j.error||"설정 가져오기 실패")})),[h]),p=r.useCallback(async(c="default",D)=>(N("info","서버 동기화 시작",{userId:c,hasLocalSettings:!!D}),await h(async()=>{try{const A=await Ds(c);if(A.success&&A.data){const j=await _s(c,D);if(j.success)return N("info","서버 동기화 완료 - 업데이트"),Q.success("설정이 서버와 동기화되었습니다"),{success:!0,action:"updated"};throw new Error(j.error||"설정 업데이트 실패")}else{const j={user_id:c,...D},$=await Ys(j);if($.success)return N("info","서버 동기화 완료 - 생성"),Q.success("새로운 설정이 서버에 생성되었습니다"),{success:!0,action:"created"};throw new Error($.error||"설정 생성 실패")}}catch(A){throw N("error","서버 동기화 실패",A.message),A}})),[h]),y=r.useCallback(async(c="default")=>(N("info","서버에서 동기화 시작",{userId:c}),await h(async()=>{const D=await Ds(c);if(D.success)return N("info","서버에서 동기화 완료",{hasData:!!D.data,isNew:D.isNew}),D.data?Q.success("서버에서 설정을 가져왔습니다"):Q.info("서버에 저장된 설정이 없습니다"),D;throw new Error(D.error||"서버 동기화 실패")})),[h]),v=r.useCallback(async(c="default",D,A,j="local")=>(N("info","설정 충돌 해결 시작",{userId:c,strategy:j,hasLocalSettings:!!D,hasServerSettings:!!A}),await h(async()=>{let $=null;switch(j){case"local":$=D,N("info","로컬 설정으로 충돌 해결");break;case"server":$=A,N("info","서버 설정으로 충돌 해결");break;case"merge":$={...D,...A},N("info","설정 병합으로 충돌 해결");break;default:throw new Error("알 수 없는 충돌 해결 전략입니다")}const G=await _s(c,$);if(G.success)return N("info","충돌 해결 완료"),Q.success("설정 충돌이 해결되었습니다"),{success:!0,resolvedSettings:$,strategy:j};throw new Error(G.error||"충돌 해결 실패")})),[h]),k=r.useCallback(async()=>{N("info","네트워크 상태 확인 시작");try{const c=await ge.get("/api/health",{timeout:5e3}),D=c.status===200;return N("info","네트워크 상태 확인 완료",{isOnline:D}),{isOnline:D,status:c.status}}catch(c){return N("warn","네트워크 상태 확인 실패",c.message),{isOnline:!1,error:c.message}}},[]),_=r.useCallback(()=>{N("info","에러 상태 초기화"),n(null)},[]);return{loading:s,error:a,lastSync:i,getUserPreferences:o,saveUserPreferences:u,createUserPreferences:d,deleteUserPreferences:f,exportUserPreferences:P,importUserPreferences:l,syncToServer:p,syncFromServer:y,resolveConflict:v,checkNetworkStatus:k,clearError:_}},Pt=r.createContext(null),Zr=({children:s})=>{const t=Et(),[a,n]=r.useState(t),[i,g]=r.useState(!1),[h,o]=r.useState(!1),[u,d]=r.useState(null),[f,P]=r.useState(!1),[l,p]=r.useState(!1),[y,v]=r.useState(null),k=r.useRef(!1),_=Yr(),c=Jr();r.useEffect(()=>(N("info","PreferenceProvider 초기화 시작"),k.current=!0,(async()=>{try{if(g(!0),d(null),await new Promise(x=>setTimeout(x,100)),!k.current)return;if(_.isAvailable)try{N("info","초기화 시 localStorage에서 설정 로드 시작");const x=await _.loadSettings();if(x.success&&x.settings){const b=Js(x.settings,t);n(b),p(!1),N("info","초기화 시 설정 로드 완료",{settingsKeys:Object.keys(b)})}else N("info","저장된 설정 없음 - 기본값 사용"),n(t)}catch(x){N("warn","초기화 시 설정 로드 실패, 기본값 사용",x.message),n(t)}else N("warn","localStorage 사용 불가 - 기본값 사용"),n(t);P(!0),N("info","PreferenceProvider 초기화 완료")}catch(x){N("error","PreferenceProvider 초기화 오류",x.message),d(x.message),n(t),P(!0)}finally{g(!1)}})(),()=>{k.current=!1}),[t,_.isAvailable]);const D=r.useCallback((m,x,b)=>{N("info","설정 업데이트",{section:m,key:x,value:b}),n(F=>{const T={...F,[m]:{...F[m],[x]:b}};return p(!0),v(new Date),N("info","설정 업데이트 완료",{section:m,key:x}),T})},[]),A=r.useCallback(m=>{N("info","다중 설정 업데이트 시작",{newSettingsKeys:Object.keys(m)}),n(x=>{const b={...x};return Object.entries(m).forEach(([F,T])=>{typeof T=="object"&&(b[F]={...b[F],...T})}),p(!0),v(new Date),N("info","다중 설정 업데이트 완료"),b})},[]),j=r.useCallback(async()=>{N("info","설정 저장 시작");try{o(!0),d(null);const m=await _.saveSettings(a);if(m.success)return p(!1),N("info","설정 저장 완료"),{success:!0};throw new Error(m.error)}catch(m){const x=m.message;return d(x),N("error","설정 저장 실패",x),{success:!1,error:x}}finally{o(!1)}},[a,_]),$=r.useCallback(async()=>{N("info","설정 로드 시작");try{g(!0),d(null);const m=await _.loadSettings();if(m.success){if(m.settings){const x=Js(m.settings,t);n(x),p(!1),N("info","설정 로드 완료",{settingsKeys:Object.keys(x)})}else N("info","저장된 설정 없음");return{success:!0,settings:m.settings}}else throw new Error(m.error)}catch(m){const x=m.message;return d(x),N("error","설정 로드 실패",x),{success:!1,error:x}}finally{g(!1)}},[t,_]),G=r.useCallback(async(m=null)=>{N("info","설정 초기화 시작",{sections:m});try{g(!0),d(null);let x=t;return m&&Array.isArray(m)&&(x={...a},m.forEach(b=>{t[b]&&(x[b]={...t[b]})})),n(x),p(!0),v(new Date),m===null&&await _.clearSettings(),N("info","설정 초기화 완료"),{success:!0}}catch(x){const b=x.message;return d(b),N("error","설정 초기화 실패",b),{success:!1,error:b}}finally{g(!1)}},[t,a,_]),w=r.useCallback((m=null)=>{N("info","설정 유효성 검증 시작",{section:m});const x=Kr(a,m);return Object.keys(x).length>0?(N("warn","설정 유효성 검증 실패",x),d(`설정 오류: ${Object.values(x)[0]}`)):(N("info","설정 유효성 검증 통과"),d(null)),x},[a]),E={state:{settings:a,loading:i||_.loading||c.loading,saving:h||_.saving||c.saving,error:u||_.error||c.error,initialized:f,hasUnsavedChanges:l,lastModified:y,lastSaved:_.lastSaved,lastSync:c.lastSync,localStorageAvailable:_.isAvailable},settings:a,dashboardSettings:a.dashboardSettings||{},statisticsSettings:a.statisticsSettings||{},databaseSettings:a.databaseSettings||{},notificationSettings:a.notificationSettings||{},generalSettings:a.generalSettings||{},updateSetting:D,updateSettings:A,saveSettings:j,loadSettings:$,resetSettings:G,validateCurrentSettings:w,storage:_,api:c};return e.jsx(Pt.Provider,{value:E,children:s})},Qr=()=>{const s=r.useContext(Pt);if(!s){N("warn","usePreference: PreferenceProvider 외부에서 사용됨 - 기본값 반환");const t=Et();return{state:{settings:t,loading:!1,saving:!1,error:null,initialized:!1,hasUnsavedChanges:!1,lastModified:null,lastSaved:null,lastSync:null,localStorageAvailable:!1},settings:t,dashboardSettings:t.dashboardSettings||{},statisticsSettings:t.statisticsSettings||{},databaseSettings:t.databaseSettings||{},notificationSettings:t.notificationSettings||{},generalSettings:t.generalSettings||{},updateSetting:()=>{},updateSettings:()=>{},saveSettings:()=>Promise.resolve({success:!1}),loadSettings:()=>Promise.resolve({success:!1}),resetSettings:()=>Promise.resolve({success:!1}),validateCurrentSettings:()=>({}),storage:{isAvailable:!1,saveSettings:()=>Promise.resolve({success:!1}),loadSettings:()=>Promise.resolve({success:!1}),clearSettings:()=>Promise.resolve({success:!1}),error:null},api:{loading:!1,error:null,getUserPreferences:()=>Promise.resolve({success:!1}),saveUserPreferences:()=>Promise.resolve({success:!1}),clearError:()=>{}}}}return s},ee=(s,t,a=null)=>{const i=`[usePreference:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${i} ${t}`,a);break;case"error":console.error(`${i} ${t}`,a);break;case"warn":console.warn(`${i} ${t}`,a);break;case"debug":console.debug(`${i} ${t}`,a);break;default:console.log(`${i} ${t}`,a)}},Ps={dashboardSettings:{selectedPegs:{required:!0,type:"array",minLength:1,message:"최소 하나의 PEG를 선택해야 합니다."},autoRefreshInterval:{required:!0,type:"number",min:5,max:300,message:"자동 새로고침 간격은 5초~300초 사이여야 합니다."},defaultNe:{type:"string",maxLength:50,message:"NE ID는 50자를 초과할 수 없습니다."},defaultCellId:{type:"string",maxLength:50,message:"Cell ID는 50자를 초과할 수 없습니다."}},statisticsSettings:{defaultDateRange:{required:!0,type:"number",min:1,max:365,message:"기본 날짜 범위는 1일~365일 사이여야 합니다."},decimalPlaces:{required:!0,type:"number",min:0,max:6,message:"소수점 자릿수는 0~6자리 사이여야 합니다."},defaultPegs:{required:!0,type:"array",minLength:1,message:"최소 하나의 기본 PEG를 선택해야 합니다."}}},Zs=(s,t=null)=>{ee("debug","설정 유효성 검증 시작",{section:t,settings:s});const a={};if(t&&!Ps[t])return ee("warn",`검증 규칙이 없는 섹션: ${t}`),a;const n=t?{[t]:Ps[t]}:Ps;return Object.entries(n).forEach(([i,g])=>{if(!s[i]){ee("debug",`섹션 ${i}가 설정에 없음`);return}Object.entries(g).forEach(([h,o])=>{const u=s[i][h],d=`${i}.${h}`;if(o.required&&(u==null||u==="")){a[d]=o.message||`${h}는 필수 항목입니다.`,ee("error",`필수 필드 누락: ${d}`);return}if(u==null||u===""){ee("debug",`필드 ${d} 값이 없어 검증 스킵`);return}if(o.type==="array"&&!Array.isArray(u)){a[d]=o.message||`${h}는 배열이어야 합니다.`,ee("error",`타입 오류: ${d}는 배열이어야 함`);return}if(o.type==="number"&&typeof u!="number"){a[d]=o.message||`${h}는 숫자여야 합니다.`,ee("error",`타입 오류: ${d}는 숫자여야 함`);return}if(o.type==="string"&&typeof u!="string"){a[d]=o.message||`${h}는 문자열이어야 합니다.`,ee("error",`타입 오류: ${d}는 문자열이어야 함`);return}if(o.type==="number"){if(o.min!==void 0&&u<o.min){a[d]=o.message||`${h}는 ${o.min} 이상이어야 합니다.`,ee("error",`범위 오류: ${d}는 ${o.min} 이상이어야 함`);return}if(o.max!==void 0&&u>o.max){a[d]=o.message||`${h}는 ${o.max} 이하여야 합니다.`,ee("error",`범위 오류: ${d}는 ${o.max} 이하여야 함`);return}}if(o.type==="array"){if(o.minLength!==void 0&&u.length<o.minLength){a[d]=o.message||`${h}는 최소 ${o.minLength}개 항목이 필요합니다.`,ee("error",`배열 길이 오류: ${d}는 최소 ${o.minLength}개 필요`);return}if(o.maxLength!==void 0&&u.length>o.maxLength){a[d]=o.message||`${h}는 최대 ${o.maxLength}개 항목만 허용됩니다.`,ee("error",`배열 길이 오류: ${d}는 최대 ${o.maxLength}개만 허용`);return}}if(o.type==="string"){if(o.minLength!==void 0&&u.length<o.minLength){a[d]=o.message||`${h}는 최소 ${o.minLength}자 이상이어야 합니다.`,ee("error",`문자열 길이 오류: ${d}는 최소 ${o.minLength}자 필요`);return}if(o.maxLength!==void 0&&u.length>o.maxLength){a[d]=o.message||`${h}는 최대 ${o.maxLength}자까지 허용됩니다.`,ee("error",`문자열 길이 오류: ${d}는 최대 ${o.maxLength}자만 허용`);return}}})}),ee("debug","설정 유효성 검증 완료",{errors:a}),a},Ye=()=>{ee("info","usePreference 훅 초기화");const s=Qr(),[t,a]=r.useState({}),n=r.useMemo(()=>{const l=(s==null?void 0:s.settings)||{};return ee("debug","설정 접근",{hasSettings:!!l}),l},[s==null?void 0:s.settings]),i=r.useCallback(l=>{ee("info","설정 업데이트 시작",{newSettings:l}),s!=null&&s.updateSetting?(Object.entries(l).forEach(([p,y])=>{typeof y=="object"&&Object.entries(y).forEach(([v,k])=>{ee("debug",`설정 업데이트: ${p}.${v}`,{value:k}),s.updateSetting(p,v,k)})}),ee("info","설정 업데이트 완료")):ee("error","updateSetting 함수를 사용할 수 없음")},[s==null?void 0:s.updateSetting]),g=r.useCallback(async()=>{if(ee("info","설정 저장 시작"),s!=null&&s.saveSettings)try{const l=await s.saveSettings();return ee("info","설정 저장 완료",{result:l}),l}catch(l){throw ee("error","설정 저장 실패",l),l}else return ee("error","saveSettings 함수를 사용할 수 없음"),!1},[s==null?void 0:s.saveSettings]),h=r.useCallback(async()=>{if(ee("info","설정 로드 시작"),s!=null&&s.loadSettings)try{const l=await s.loadSettings();return ee("info","설정 로드 완료",{result:l}),l}catch(l){throw ee("error","설정 로드 실패",l),l}else return ee("error","loadSettings 함수를 사용할 수 없음"),!1},[s==null?void 0:s.loadSettings]),o=r.useCallback(async l=>{if(ee("info","설정 리셋 시작",{sections:l}),s!=null&&s.resetSettings)try{const p=await s.resetSettings(l);return ee("info","설정 리셋 완료",{result:p}),p}catch(p){return ee("error","설정 리셋 실패",p),{success:!1,error:p.message}}else return ee("error","resetSettings 함수를 사용할 수 없음"),{success:!1,error:"resetSettings 함수를 사용할 수 없습니다"}},[s==null?void 0:s.resetSettings]),u=r.useCallback((l,p=null)=>{var k;ee("info","설정 업데이트 및 검증 시작",{newSettings:l,section:p});const y=p?{...n,[p]:{...n[p],...l[p]}}:{...n,...l},v=Zs(y,p);if(a(v),Object.keys(v).length>0){ee("error","설정 유효성 검증 실패",v);const _=Object.values(v)[0];return(k=n.notificationSettings)!=null&&k.errorNotification&&Q.error(`설정 오류: ${_}`),!1}return i(l),ee("info","설정 업데이트 완료"),!0},[n,i]),d=r.useCallback((l=null,p=null)=>{var y,v;ee("info","설정 내보내기 시작",{filename:l,partial:p});try{const k={settings:p&&Object.keys(p).length>0?{...n,...p}:n,metadata:{exportedAt:new Date().toISOString(),version:"1.0.0",userId:(s==null?void 0:s.userId)||"default"}},_=JSON.stringify(k,null,2),c=new Blob([_],{type:"application/json"}),D=document.createElement("a");return D.href=URL.createObjectURL(c),D.download=l||`preference-settings-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(D.href),ee("info","설정 내보내기 완료",{filename:D.download}),(y=n.notificationSettings)!=null&&y.enableToasts&&Q.success("설정이 파일로 내보내졌습니다"),!0}catch(k){return ee("error","설정 내보내기 실패",k),(v=n.notificationSettings)!=null&&v.errorNotification&&Q.error("설정 내보내기 실패: "+k.message),!1}},[n,s==null?void 0:s.userId]),f=r.useCallback(l=>(ee("info","설정 가져오기 시작",{filename:l.name}),new Promise((p,y)=>{const v=new FileReader;v.onload=k=>{var _,c;try{const D=JSON.parse(k.target.result);if(!D.settings)throw new Error("유효하지 않은 설정 파일입니다.");i(D.settings),ee("info","설정 가져오기 완료",{filename:l.name}),(_=n.notificationSettings)!=null&&_.enableToasts&&Q.success("설정이 성공적으로 가져와졌습니다"),p(D)}catch(D){ee("error","설정 가져오기 실패",D),(c=n.notificationSettings)!=null&&c.errorNotification&&Q.error("설정 가져오기 실패: "+D.message),y(D)}},v.onerror=()=>{const k=new Error("파일 읽기 실패");ee("error","설정 가져오기 실패",k),y(k)},v.readAsText(l)})),[n,i]),P={settings:n,dashboardSettings:n.dashboardSettings||{},statisticsSettings:n.statisticsSettings||{},databaseSettings:n.databaseSettings||{},notificationSettings:n.notificationSettings||{},generalSettings:n.generalSettings||{},loading:(s==null?void 0:s.loading)||!1,saving:(s==null?void 0:s.saving)||!1,error:(s==null?void 0:s.error)||null,initialized:(s==null?void 0:s.initialized)||!1,updateSettings:i,updateSettingsWithValidation:u,saveSettings:g,loadSettings:h,exportSettings:d,importSettings:f,resetSettings:o,validationErrors:t,validateSettings:(l,p)=>Zs(l,p),logInfo:(l,p)=>ee("info",l,p),logError:(l,p)=>ee("error",l,p)};return ee("debug","usePreference 훅 반환값 생성 완료"),P},Xr=()=>{ee("info","useDashboardSettings 훅 초기화");const{dashboardSettings:s,updateSettings:t,saving:a,error:n,validationErrors:i,logInfo:g}=Ye(),h=r.useMemo(()=>{const d={selectedPegs:[],defaultNe:"",defaultCellId:"",autoRefreshInterval:30,chartStyle:"line",showLegend:!0,showGrid:!0},f={...d,...s};return Array.isArray(s==null?void 0:s.selectedPegs)&&s.selectedPegs.length>0?f.selectedPegs=s.selectedPegs:f.selectedPegs=d.selectedPegs,ee("debug","Dashboard 설정 처리 완료",{settings:f}),f},[s]),o=r.useCallback(d=>(g("Dashboard 설정 업데이트",d),t({dashboardSettings:d})),[t,g]),u=r.useMemo(()=>Object.fromEntries(Object.entries(i).filter(([d])=>d.startsWith("dashboardSettings."))),[i]);return{settings:h,updateSettings:o,saving:a,error:n,validationErrors:u,hasErrors:Object.keys(u).length>0}},$t=()=>{ee("info","useStatisticsSettings 훅 초기화");const{statisticsSettings:s,updateSettings:t,saving:a,error:n,validationErrors:i,logInfo:g}=Ye(),h=r.useCallback(u=>(g("Statistics 설정 업데이트",u),t({statisticsSettings:u})),[t,g]),o=r.useMemo(()=>Object.fromEntries(Object.entries(i).filter(([u])=>u.startsWith("statisticsSettings."))),[i]);return{settings:s,updateSettings:h,saving:a,error:n,validationErrors:o,hasErrors:Object.keys(o).length>0}},en=(s,t,a=null)=>{const i=`[DashboardHeader:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${i} ${t}`,a);break;case"error":console.error(`${i} ${t}`,a);break;case"warn":console.warn(`${i} ${t}`,a);break;case"debug":console.debug(`${i} ${t}`,a);break;default:console.log(`${i} ${t}`,a)}},Qs=({loading:s,saving:t,settingsError:a,selectedPegs:n,chartStyle:i,enableTimeComparison:g,defaultNe:h,defaultCellId:o,autoRefreshInterval:u,refreshCountdown:d,lastRefresh:f,onManualRefresh:P})=>(en("debug","DashboardHeader 렌더링",{loading:s,saving:t,settingsError:a,selectedPegsCount:n==null?void 0:n.length,chartStyle:i,enableTimeComparison:g,defaultNe:h,defaultCellId:o,autoRefreshInterval:u,refreshCountdown:d,lastRefresh:f}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Dashboard"}),e.jsxs("p",{className:"text-muted-foreground",children:[(n==null?void 0:n.length)||0,"개 PEG 항목 • 차트 스타일: ",i,g&&" • Time1/Time2 비교 모드",h&&` • NE: ${h}`,o&&` • Cell: ${o}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t&&e.jsxs(Z,{variant:"secondary",className:"text-xs",children:[e.jsx(Be,{className:"h-3 w-3 mr-1"}),"설정 저장 중"]}),a&&e.jsx(Z,{variant:"destructive",className:"text-xs",children:"설정 오류"}),g&&e.jsx(Z,{variant:"default",className:"text-xs bg-blue-100 text-blue-800",children:"Time1/Time2 비교"}),u>0&&d>0&&e.jsxs(Z,{variant:"outline",className:"text-xs",children:[e.jsx(Be,{className:"h-3 w-3 mr-1"}),d,"초 후 새로고침"]}),f&&e.jsxs(Z,{variant:"secondary",className:"text-xs",children:["마지막 업데이트: ",f.toLocaleTimeString()]}),e.jsxs(J,{variant:"outline",size:"sm",onClick:P,disabled:s,children:[e.jsx(os,{className:`h-4 w-4 mr-2 ${s?"animate-spin":""}`}),"새로고침"]})]})]}));function Ee({...s}){return e.jsx(xa,{"data-slot":"select",...s})}function Pe({...s}){return e.jsx(pa,{"data-slot":"select-value",...s})}function $e({className:s,size:t="default",children:a,...n}){return e.jsxs(ga,{"data-slot":"select-trigger","data-size":t,className:te("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...n,children:[a,e.jsx(fa,{asChild:!0,children:e.jsx(Xe,{className:"size-4 opacity-50"})})]})}function Ae({className:s,children:t,position:a="popper",...n}){return e.jsx(ja,{children:e.jsxs(va,{"data-slot":"select-content",className:te("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:a,...n,children:[e.jsx(sn,{}),e.jsx(ba,{className:te("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),e.jsx(tn,{})]})})}function le({className:s,children:t,...a}){return e.jsxs(ya,{"data-slot":"select-item",className:te("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",s),...a,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(Na,{children:e.jsx(Fe,{className:"size-4"})})}),e.jsx(wa,{children:t})]})}function sn({className:s,...t}){return e.jsx(Sa,{"data-slot":"select-scroll-up-button",className:te("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(ys,{className:"size-4"})})}function tn({className:s,...t}){return e.jsx(Ca,{"data-slot":"select-scroll-down-button",className:te("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(Xe,{className:"size-4"})})}function rs({className:s,...t}){return e.jsx(ka,{"data-slot":"switch",className:te("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Da,{"data-slot":"switch-thumb",className:te("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}function W({className:s,...t}){return e.jsx(_a,{"data-slot":"label",className:te("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...t})}const an=(s,t,a=null)=>{const i=`[DashboardSettings:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${i} ${t}`,a);break;case"error":console.error(`${i} ${t}`,a);break;case"warn":console.warn(`${i} ${t}`,a);break;case"debug":console.debug(`${i} ${t}`,a);break;default:console.log(`${i} ${t}`,a)}},rn=({defaultTimeRange:s,enableTimeComparison:t,tempTimeSettings:a,inputCompleted:n,loading:i,onUpdateDefaultTimeRange:g,onUpdateEnableTimeComparison:h,onUpdateTempTimeSetting:o,onApplyTime1Settings:u,onApplyTime2Settings:d,onManualRefresh:f})=>(an("debug","DashboardSettings 렌더링",{defaultTimeRange:s,enableTimeComparison:t,tempTimeSettings:a,inputCompleted:n,loading:i}),e.jsxs(re,{children:[e.jsx(he,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"h-5 w-5"}),"기본시간 설정"]})}),e.jsxs(ne,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(W,{htmlFor:"defaultTimeRange",className:"text-sm font-medium",children:"기본 시간 범위"}),e.jsxs(Ee,{value:s.toString(),onValueChange:g,children:[e.jsx($e,{children:e.jsx(Pe,{placeholder:"시간 범위 선택"})}),e.jsxs(Ae,{children:[e.jsx(le,{value:"5",children:"5분"}),e.jsx(le,{value:"15",children:"15분"}),e.jsx(le,{value:"30",children:"30분"}),e.jsx(le,{value:"60",children:"1시간"}),e.jsx(le,{value:"120",children:"2시간"}),e.jsx(le,{value:"360",children:"6시간"}),e.jsx(le,{value:"720",children:"12시간"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rs,{id:"enableTimeComparison",checked:t,onCheckedChange:h}),e.jsx(W,{htmlFor:"enableTimeComparison",className:"text-sm font-medium",children:"Time1/Time2 비교 활성화"})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-600",children:"Time1 설정"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(W,{htmlFor:"time1Start",className:"text-xs text-muted-foreground",children:"시작 시간"}),e.jsx("input",{type:"datetime-local",id:"time1Start",className:"w-full px-2 py-1 border border-gray-300 rounded text-xs",value:a.time1Start,onChange:P=>o("time1","Start",P.target.value)})]}),e.jsxs("div",{children:[e.jsx(W,{htmlFor:"time1End",className:"text-xs text-muted-foreground",children:"끝 시간"}),e.jsx("input",{type:"datetime-local",id:"time1End",className:"w-full px-2 py-1 border border-gray-300 rounded text-xs",value:a.time1End,onChange:P=>o("time1","End",P.target.value)})]}),e.jsx(J,{onClick:u,disabled:!a.time1Start||!a.time1End||n.time1,size:"sm",className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:n.time1?e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Time1 설정 완료"]}):"Time1 설정 입력"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-green-600",children:"Time2 설정"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(W,{htmlFor:"time2Start",className:"text-xs text-muted-foreground",children:"시작 시간"}),e.jsx("input",{type:"datetime-local",id:"time2Start",className:"w-full px-2 py-1 border border-gray-300 rounded text-xs",value:a.time2Start,onChange:P=>o("time2","Start",P.target.value)})]}),e.jsxs("div",{children:[e.jsx(W,{htmlFor:"time2End",className:"text-xs text-muted-foreground",children:"끝 시간"}),e.jsx("input",{type:"datetime-local",id:"time2End",className:"w-full px-2 py-1 border border-gray-300 rounded text-xs",value:a.time2End,onChange:P=>o("time2","End",P.target.value)})]}),e.jsx(J,{onClick:d,disabled:!a.time2Start||!a.time2End||n.time2,size:"sm",className:"w-full bg-green-600 hover:bg-green-700 text-white",children:n.time2?e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Time2 설정 완료"]}):"Time2 설정 입력"})]})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(J,{onClick:f,disabled:i||!n.time1||!n.time2,className:"bg-purple-600 hover:bg-purple-700 text-white",children:i?"데이터 로딩 중...":"Time1/Time2 비교 데이터 로드"})}),e.jsxs("div",{className:"flex justify-center gap-4 text-xs",children:[e.jsxs("div",{className:`flex items-center gap-1 ${n.time1?"text-green-600":"text-gray-500"}`,children:[n.time1?e.jsx(Fe,{className:"h-3 w-3"}):e.jsx(Le,{className:"h-3 w-3"}),"Time1 설정 ",n.time1?"완료":"대기"]}),e.jsxs("div",{className:`flex items-center gap-1 ${n.time2?"text-green-600":"text-gray-500"}`,children:[n.time2?e.jsx(Fe,{className:"h-3 w-3"}):e.jsx(Le,{className:"h-3 w-3"}),"Time2 설정 ",n.time2?"완료":"대기"]})]})]}),!t&&e.jsx(J,{onClick:f,disabled:i,className:"w-full",children:i?"데이터 로딩 중...":"데이터 새로고침"})]})]})]})),fs=(s,t,a=null)=>{const i=`[DashboardChart:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${i} ${t}`,a);break;case"error":console.error(`${i} ${t}`,a);break;case"warn":console.warn(`${i} ${t}`,a);break;case"debug":console.debug(`${i} ${t}`,a);break;default:console.log(`${i} ${t}`,a)}},Ve=s=>{const t=["#8884d8","#82ca9d","#ffc658","#ff7300","#8dd1e1","#d084d0"];return s<t.length?t[s]:`hsl(${s*47%360}, 70%, 50%)`},At=({chartData:s,key:t,idx:a,chartStyle:n,showGrid:i,showLegend:g,enableTimeComparison:h})=>{if(fs("debug","DashboardChart 렌더링",{key:t,chartStyle:n,dataLength:s==null?void 0:s.length,showGrid:i,showLegend:g,enableTimeComparison:h}),!s||s.length===0)return fs("warn","차트 데이터가 없음",{key:t}),e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:"데이터가 없습니다"});const o=s.length>0?Object.keys(s[0]).filter(f=>f!=="time"):[];fs("debug","차트 엔티티 정보",{key:t,entities:o,entitiesCount:o.length});const u={data:s,className:"h-64"},d=[i&&e.jsx(He,{strokeDasharray:"3 3"},"grid"),e.jsx(qe,{dataKey:"time"},"xaxis"),e.jsx(ze,{},"yaxis"),e.jsx(Re,{},"tooltip"),g&&e.jsx(Me,{},"legend")].filter(Boolean);try{switch(n){case"area":return e.jsx(Ie,{width:"100%",height:"100%",children:e.jsxs(bt,{...u,children:[d,o.map((f,P)=>{if(h&&f.includes("_Time")){const l=f.replace("_Time1","").replace("_Time2",""),p=f.includes("_Time1");return e.jsx(as,{type:"monotone",dataKey:f,stroke:Ve((a+P)%12),fill:Ve((a+P)%12),fillOpacity:.3,strokeWidth:2,strokeDasharray:p?void 0:"5 5",name:`${l} (${p?"Time1":"Time2"})`},f)}else return e.jsx(as,{type:"monotone",dataKey:f,stroke:Ve((a+P)%12),fill:Ve((a+P)%12),fillOpacity:.3,strokeWidth:2},f)})]})});case"bar":return e.jsx(Ie,{width:"100%",height:"100%",children:e.jsxs(vs,{...u,children:[d,o.map((f,P)=>{if(h&&f.includes("_Time")){const l=f.replace("_Time1","").replace("_Time2",""),p=f.includes("_Time1");return e.jsx(Te,{dataKey:f,fill:Ve((a+P)%12),name:`${l} (${p?"Time1":"Time2"})`},f)}else return e.jsx(Te,{dataKey:f,fill:Ve((a+P)%12)},f)})]})});case"line":default:return e.jsx(Ie,{width:"100%",height:"100%",children:e.jsxs(Gs,{...u,children:[d,o.map((f,P)=>{if(h&&f.includes("_Time")){const l=f.replace("_Time1","").replace("_Time2",""),p=f.includes("_Time1");return e.jsx(Ge,{type:"monotone",dataKey:f,stroke:Ve((a+P)%12),strokeWidth:2,strokeDasharray:p?void 0:"5 5",name:`${l} (${p?"Time1":"Time2"})`},f)}else return e.jsx(Ge,{type:"monotone",dataKey:f,stroke:Ve((a+P)%12),strokeWidth:2},f)})]})})}}catch(f){return fs("error","차트 렌더링 오류",{key:t,error:f}),e.jsx("div",{className:"h-full flex items-center justify-center text-red-500",children:"차트 렌더링 오류"})}},nn=(s,t,a=null)=>{const i=`[DashboardCard:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${i} ${t}`,a);break;case"error":console.error(`${i} ${t}`,a);break;case"warn":console.warn(`${i} ${t}`,a);break;case"debug":console.debug(`${i} ${t}`,a);break;default:console.log(`${i} ${t}`,a)}},Xs=s=>s,et=({key:s,idx:t,title:a,chartData:n,chartStyle:i,chartLayout:g,enableTimeComparison:h,showGrid:o,showLegend:u,onZoom:d})=>{nn("debug","DashboardCard 렌더링",{key:s,idx:t,title:a,chartStyle:i,chartLayout:g,dataLength:n==null?void 0:n.length,enableTimeComparison:h});const f=(n==null?void 0:n.length)>0?Object.keys(n[0]).filter(P=>P!=="time"):[];return e.jsxs(re,{children:[e.jsx(he,{children:e.jsxs(xe,{className:"flex items-center justify-between",children:[Xs(a),e.jsxs("div",{className:"flex items-center gap-2",children:[h&&e.jsx(Z,{variant:"default",className:"text-xs bg-blue-100 text-blue-800",children:"Time1/Time2 비교"}),e.jsxs(Z,{variant:"outline",className:"text-xs",children:[f.length,"개 시리즈"]}),e.jsxs(Z,{variant:"secondary",className:"text-xs",children:[(n==null?void 0:n.length)||0,"개 데이터포인트"]})]})]})}),e.jsx(ne,{children:e.jsx("div",{className:"h-64 cursor-zoom-in",onClick:()=>d({open:!0,title:Xs(a),data:n}),children:e.jsx(At,{chartData:n,idx:t,chartStyle:i,showGrid:o,showLegend:u,enableTimeComparison:h},s)})})]},`${s}-${t}`)},je=(s,t,a=null)=>{const i=`[Dashboard:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${i} ${t}`,a);break;case"error":console.error(`${i} ${t}`,a);break;case"warn":console.warn(`${i} ${t}`,a);break;case"debug":console.debug(`${i} ${t}`,a);break;default:console.log(`${i} ${t}`,a)}},It=()=>{je("info","Dashboard 컴포넌트 초기화");const[s,t]=r.useState({}),[a,n]=r.useState(null),[i,g]=r.useState(!0),[h,o]=r.useState(null),[u,d]=r.useState(0),[f,P]=r.useState({open:!1,title:"",data:[]}),l=r.useRef(null),p=r.useRef(null),[y,v]=r.useState({time1Start:"",time1End:"",time2Start:"",time2End:""}),[k,_]=r.useState({time1:!1,time2:!1}),{settings:c={},saving:D=!1,error:A=null,updateSettings:j=()=>{}}=Xr(),{settings:$={}}=Ye(),G=r.useMemo(()=>Array.isArray(c==null?void 0:c.selectedPegs)?c.selectedPegs:[],[c==null?void 0:c.selectedPegs]),w=r.useMemo(()=>($==null?void 0:$.statisticsSettings)||{},[$==null?void 0:$.statisticsSettings]),E=r.useMemo(()=>Array.isArray(w.selectedNEs)?w.selectedNEs:[],[w.selectedNEs]),m=r.useMemo(()=>Array.isArray(w.selectedCellIds)?w.selectedCellIds:[],[w.selectedCellIds]),x=r.useMemo(()=>(c==null?void 0:c.autoRefreshInterval)||30,[c==null?void 0:c.autoRefreshInterval]),b=r.useMemo(()=>(c==null?void 0:c.chartStyle)||"line",[c==null?void 0:c.chartStyle]),F=r.useMemo(()=>(c==null?void 0:c.chartLayout)||"byPeg",[c==null?void 0:c.chartLayout]),T=r.useMemo(()=>(c==null?void 0:c.showLegend)!==!1,[c==null?void 0:c.showLegend]),q=r.useMemo(()=>(c==null?void 0:c.showGrid)!==!1,[c==null?void 0:c.showGrid]),se=r.useMemo(()=>(c==null?void 0:c.defaultNe)||"",[c==null?void 0:c.defaultNe]),ie=r.useMemo(()=>(c==null?void 0:c.defaultCellId)||"",[c==null?void 0:c.defaultCellId]),O=r.useMemo(()=>(c==null?void 0:c.defaultTimeRange)||30,[c==null?void 0:c.defaultTimeRange]),R=r.useMemo(()=>(c==null?void 0:c.time1Start)||"",[c==null?void 0:c.time1Start]),U=r.useMemo(()=>(c==null?void 0:c.time1End)||"",[c==null?void 0:c.time1End]),B=r.useMemo(()=>(c==null?void 0:c.time2Start)||"",[c==null?void 0:c.time2Start]),S=r.useMemo(()=>(c==null?void 0:c.time2End)||"",[c==null?void 0:c.time2End]),M=r.useMemo(()=>(c==null?void 0:c.enableTimeComparison)||!1,[c==null?void 0:c.enableTimeComparison]),C=r.useCallback(ae=>{je("info","기본시간범위 업데이트",{value:ae}),j({defaultTimeRange:parseInt(ae)})},[j]),K=r.useCallback(ae=>{je("info","토글 상태 변경",{checked:ae}),j({enableTimeComparison:ae})},[j]),H=r.useCallback((ae,fe,be)=>{je("debug","임시 시간 설정 업데이트",{type:ae,field:fe,value:be}),v(ce=>({...ce,[`${ae}${fe}`]:be}))},[]),V=r.useCallback(()=>{y.time1Start&&y.time1End&&(je("info","Time1 설정 적용",{start:y.time1Start,end:y.time1End}),j({time1Start:y.time1Start,time1End:y.time1End}),_(ae=>({...ae,time1:!0})))},[y.time1Start,y.time1End,j]),Y=r.useCallback(()=>{y.time2Start&&y.time2End&&(je("info","Time2 설정 적용",{start:y.time2Start,end:y.time2End}),j({time2Start:y.time2Start,time2End:y.time2End}),_(ae=>({...ae,time2:!0})))},[y.time2Start,y.time2End,j]),de=r.useCallback(async()=>{var ce,ye,z;je("info","데이터 fetching 시작");const ae=G.length>0?G:["randomaccessproblem"],fe=E.length>0?E:["NVGNB#101086"],be=m.length>0?m.map(I=>parseInt(I)):[8418];if(je("debug","데이터 fetching 파라미터",{selectedPegs:G,safeSelectedPegs:ae,selectedNEs:E,safeSelectedNEs:fe,selectedCellIds:m,safeSelectedCellIds:be,defaultNe:se,defaultCellId:ie,enableTimeComparison:M,time1Start:R,time1End:U,time2Start:B,time2End:S}),ae.length===0){je("warn","선택된 PEG가 없음 - 데이터 fetching 중단"),t({}),n(null),g(!1);return}try{if(g(!0),M&&R&&U&&B&&S){je("info","Time1/Time2 비교 모드로 데이터 fetching");const I={start_date:R,end_date:U,kpi_types:ae,ne:fe,cellid:be};je("debug","Time1 API 파라미터",I);const L=await ge.post("/api/kpi/query",I),ue={start_date:B,end_date:S,kpi_types:ae,ne:fe,cellid:be};je("debug","Time2 API 파라미터",ue);const X=await ge.post("/api/kpi/query",ue),Ne=((ce=L==null?void 0:L.data)==null?void 0:ce.data)||{},pe=((ye=X==null?void 0:X.data)==null?void 0:ye.data)||{};t(Ne),n(pe),je("info","Time1/Time2 데이터 fetching 완료",{time1KpiCount:Object.keys(Ne).length,time1TotalRows:Object.values(Ne).reduce((Je,Ze)=>Je+((Ze==null?void 0:Ze.length)||0),0),time2KpiCount:Object.keys(pe).length,time2TotalRows:Object.values(pe).reduce((Je,Ze)=>Je+((Ze==null?void 0:Ze.length)||0),0),time1DataKeys:Object.keys(Ne),time2DataKeys:Object.keys(pe)})}else{je("info","일반 모드로 데이터 fetching");const I=new Date,L=new Date(I.getTime()-((c==null?void 0:c.defaultHours)||1)*60*60*1e3),ue={kpi_types:ae,ne:fe,cellid:be,start:L.toISOString(),end:I.toISOString()};je("debug","일반 모드 API 파라미터",ue);const X=await ge.post("/api/kpi/timeseries",ue),Ne=((z=X==null?void 0:X.data)==null?void 0:z.data)||{};t(Ne),n(null),je("info","일반 모드 데이터 fetching 완료",{kpiCount:Object.keys(Ne).length,totalRows:Object.values(Ne).reduce((pe,Je)=>pe+((Je==null?void 0:Je.length)||0),0),dataKeys:Object.keys(Ne)})}o(new Date)}catch(I){je("error","데이터 fetching 오류",I),t({}),n(null)}finally{g(!1)}},[G,E,m,c==null?void 0:c.defaultHours,se,ie,M,R,U,B,S]);r.useEffect(()=>(je("debug","자동 새로고침 설정 변경",{autoRefreshInterval:x}),l.current&&clearInterval(l.current),p.current&&clearInterval(p.current),x>0&&(je("info","자동 새로고침 설정",{interval:x}),l.current=setInterval(()=>{de()},x*1e3),d(x),p.current=setInterval(()=>{d(ae=>ae<=1?x:ae-1)},1e3)),()=>{l.current&&clearInterval(l.current),p.current&&clearInterval(p.current)}),[x,de]),r.useEffect(()=>{de()},[de]);const me=r.useCallback(()=>{je("info","수동 새로고침 실행"),de()},[de]),ke=r.useCallback(ae=>{je("debug","차트 데이터 구성",{kpiKey:ae,chartLayout:F});const fe=Array.isArray(s[ae])?s[ae]:[],be=M&&a?Array.isArray(a[ae])?a[ae]:[]:[];if(fe.length===0&&be.length===0)return[];if(F==="byPeg"){const ce={};return fe.forEach(ye=>{const z=new Date(ye.timestamp).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"});ce[z]||(ce[z]={time:z});const I=M?`${ye.entity_id}_Time1`:ye.entity_id;ce[z][I]=ye.value}),M&&be.forEach(ye=>{const z=new Date(ye.timestamp).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"});ce[z]||(ce[z]={time:z});const I=`${ye.entity_id}_Time2`;ce[z][I]=ye.value}),Object.values(ce)}else{const ce={};fe.forEach(z=>{const I=new Date(z.timestamp).toLocaleString(),L=z.entity_id;ce[L]=ce[L]||{},ce[L][I]=ce[L][I]||{time:I},ce[L][I][z.peg_name]=z.value});const ye={};return Object.keys(ce).forEach(z=>{ye[z]=Object.values(ce[z]).sort((I,L)=>new Date(I.time)-new Date(L.time))}),ye}},[s,a,M,F]);return i?(je("debug","로딩 상태 렌더링"),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Qs,{loading:i,saving:D,settingsError:A,selectedPegs:G,chartStyle:b,enableTimeComparison:M,defaultNe:se,defaultCellId:ie,autoRefreshInterval:x,refreshCountdown:u,lastRefresh:h,onManualRefresh:me}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:G.map(ae=>e.jsx(re,{children:e.jsx(ne,{className:"pt-6",children:e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading..."})})})},ae))})]})):(je("debug","Dashboard 메인 렌더링"),e.jsxs("div",{className:"space-y-6",children:[e.jsx(rn,{defaultTimeRange:O,enableTimeComparison:M,tempTimeSettings:y,inputCompleted:k,loading:i,onUpdateDefaultTimeRange:C,onUpdateEnableTimeComparison:K,onUpdateTempTimeSetting:H,onApplyTime1Settings:V,onApplyTime2Settings:Y,onManualRefresh:me}),e.jsx(Qs,{loading:i,saving:D,settingsError:A,selectedPegs:G,chartStyle:b,enableTimeComparison:M,defaultNe:se,defaultCellId:ie,autoRefreshInterval:x,refreshCountdown:u,lastRefresh:h,onManualRefresh:me}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(Z,{variant:"default",children:["선택된 PEG: ",G.join(", ")]}),M&&e.jsx(Z,{variant:"default",className:"bg-blue-100 text-blue-800",children:"Time1/Time2 비교 활성화"}),x>0&&e.jsxs(Z,{variant:"outline",children:["자동 새로고침: ",x,"초"]}),e.jsxs(Z,{variant:"outline",children:["차트 스타일: ",b]}),!T&&e.jsx(Z,{variant:"secondary",children:"범례 숨김"}),!q&&e.jsx(Z,{variant:"secondary",children:"격자 숨김"})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:G.map((ae,fe)=>{const be=ke(ae);if(F==="byPeg"){const ce=Array.isArray(be)?be:[];return e.jsx(et,{idx:fe,title:ae,chartData:ce,chartStyle:b,chartLayout:F,enableTimeComparison:M,showGrid:q,showLegend:T,onZoom:P},`${ae}-${fe}`)}else{const ce=be||{};return Object.keys(ce).map((ye,z)=>{const I=ce[ye];return e.jsx(et,{idx:fe+z,title:ye,chartData:I,chartStyle:b,chartLayout:F,enableTimeComparison:M,showGrid:q,showLegend:T,onZoom:P},`${ae}-${ye}-${z}`)})}})}),e.jsx(St,{open:f.open,onOpenChange:ae=>P(fe=>({...fe,open:ae})),children:e.jsxs(Ct,{className:"max-w-6xl",children:[e.jsx(kt,{children:e.jsx(Dt,{children:f.title})}),e.jsx("div",{className:"h-[480px]",children:Array.isArray(f.data)&&f.data.length>0&&e.jsx(At,{chartData:f.data,idx:0,chartStyle:b,showGrid:q,showLegend:T,enableTimeComparison:M},"zoom")})]})}),G.length===0&&e.jsx(re,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ls,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"표시할 PEG가 선택되지 않았습니다"}),e.jsx("p",{className:"text-muted-foreground",children:"Preference 메뉴에서 표시할 PEG 항목을 선택하세요."})]})})})]}))},Lt=Object.freeze(Object.defineProperty({__proto__:null,default:It},Symbol.toStringTag,{value:"Module"}));function ws({className:s,...t}){return e.jsx(Ea,{"data-slot":"tabs",className:te("flex flex-col gap-2",s),...t})}function Ss({className:s,...t}){return e.jsx(Pa,{"data-slot":"tabs-list",className:te("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",s),...t})}function De({className:s,...t}){return e.jsx($a,{"data-slot":"tabs-trigger",className:te("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...t})}function _e({className:s,...t}){return e.jsx(Aa,{"data-slot":"tabs-content",className:te("flex-1 outline-none",s),...t})}function ve({className:s,type:t,...a}){return e.jsx("input",{type:t,"data-slot":"input",className:te("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...a})}function ns({className:s,...t}){return e.jsx(Ia,{"data-slot":"checkbox",className:te("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(La,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(Fe,{className:"size-3.5"})})})}const Tt=r.memo(({chartConfig:s,onConfigChange:t,kpiOptions:a,loading:n,onGenerate:i,useDbPegs:g,onToggleDbPegs:h,pegOptionsLoading:o,dbPegOptions:u})=>{const d=(l,p)=>{t(y=>({...y,[l]:p}))},f=()=>{var l,p;try{const y=localStorage.getItem("activePreference");if(!y)return;const v=JSON.parse(y),k=Array.isArray((l=v==null?void 0:v.config)==null?void 0:l.defaultNEs)?v.config.defaultNEs.map(String):[],_=Array.isArray((p=v==null?void 0:v.config)==null?void 0:p.defaultCellIDs)?v.config.defaultCellIDs.map(String):[];t(c=>({...c,ne:k.join(","),cellid:_.join(",")}))}catch{}},P=()=>g&&u.length>0?u:a;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{className:"text-sm font-medium",children:"PEG 데이터 소스"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g?"Database에서 실제 PEG 목록을 사용합니다":"기본 KPI 목록을 사용합니다"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{variant:g?"secondary":"default",size:"sm",onClick:()=>h(!1),children:"기본 KPI"}),e.jsx(J,{variant:g?"default":"secondary",size:"sm",onClick:()=>h(!0),disabled:o,children:o?"로딩 중...":"DB PEG"})]})]}),g&&u.length===0&&!o&&e.jsx("p",{className:"text-xs text-amber-600 mt-2",children:"⚠️ DB PEG를 불러올 수 없습니다. Database Settings를 확인하세요."}),g&&u.length>0&&e.jsxs("p",{className:"text-xs text-green-600 mt-2",children:["✅ ",u.length,"개의 DB PEG를 사용할 수 있습니다"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Primary KPI"}),e.jsxs(Ee,{value:s.primaryKPI,onValueChange:l=>d("primaryKPI",l),children:[e.jsx($e,{children:e.jsx(Pe,{})}),e.jsx(Ae,{children:P().map(l=>e.jsx(le,{value:l.value,children:l.label},l.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Secondary KPI (Dual Axis)"}),e.jsxs(Ee,{value:s.secondaryKPI,onValueChange:l=>d("secondaryKPI",l),disabled:!s.showSecondaryAxis,children:[e.jsx($e,{children:e.jsx(Pe,{})}),e.jsx(Ae,{children:P().map(l=>e.jsx(le,{value:l.value,children:l.label},l.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Period 1 Start"}),e.jsx(ve,{type:"date",value:s.startDate1,onChange:l=>d("startDate1",l.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Period 1 End"}),e.jsx(ve,{type:"date",value:s.endDate1,onChange:l=>d("endDate1",l.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Period 2 Start"}),e.jsx(ve,{type:"date",value:s.startDate2,onChange:l=>d("startDate2",l.target.value),disabled:!s.showComparison})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Period 2 End"}),e.jsx(ve,{type:"date",value:s.endDate2,onChange:l=>d("endDate2",l.target.value),disabled:!s.showComparison})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"NE"}),e.jsx(ve,{placeholder:"e.g., nvgnb#10000 or nvgnb#10000,nvgnb#20000",value:s.ne,onChange:l=>d("ne",l.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Cell ID"}),e.jsx(ve,{placeholder:"e.g., 2010 or 2010,2011",value:s.cellid,onChange:l=>d("cellid",l.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Use Preference (NE/Cell)"}),e.jsx(J,{type:"button",variant:"outline",onClick:f,children:"Load from Preference"})]})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ns,{id:"showComparison",checked:s.showComparison,onCheckedChange:l=>d("showComparison",l)}),e.jsx(W,{htmlFor:"showComparison",children:"Show Period Comparison"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ns,{id:"showSecondaryAxis",checked:s.showSecondaryAxis,onCheckedChange:l=>d("showSecondaryAxis",l)}),e.jsx(W,{htmlFor:"showSecondaryAxis",children:"Show Secondary Y-Axis"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ns,{id:"showThreshold",checked:s.showThreshold,onCheckedChange:l=>d("showThreshold",l)}),e.jsx(W,{htmlFor:"showThreshold",children:"Show Threshold Line"})]}),s.showThreshold&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{htmlFor:"threshold",children:"Threshold Value:"}),e.jsx(ve,{id:"threshold",type:"number",step:"0.1",value:s.thresholdValue,onChange:l=>d("thresholdValue",parseFloat(l.target.value)),className:"w-24"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(J,{onClick:i,disabled:n,className:"flex items-center gap-2",children:[e.jsx(gs,{className:"h-4 w-4"}),n?"Generating...":"Generate Chart"]})})]})});Tt.displayName="ChartControls";const Ot=r.memo(({chartData:s,chartConfig:t,loading:a,kpiOptions:n,useDbPegs:i,dbPegOptions:g})=>{const h=r.useMemo(()=>{if(s.length===0)return{primary:[],secondary:[]};const d=Object.keys(s[0]).filter(l=>l!=="time"),f=d.filter(l=>l.endsWith("_period1")||l.endsWith("_period2")),P=d.filter(l=>l.endsWith("_secondary"));return{primary:f,secondary:P}},[s]),{primary:o,secondary:u}=h;return s.length===0?e.jsx("div",{className:"flex items-center justify-center h-96 text-gray-500",children:a?"Generating chart...":'Click "Generate Chart" to create visualization'}):e.jsx("div",{className:"h-96",children:e.jsx(Ie,{width:"100%",height:"100%",children:e.jsxs(Gs,{data:s,children:[e.jsx(He,{strokeDasharray:"3 3"}),e.jsx(qe,{dataKey:"time"}),e.jsx(ze,{yAxisId:"left"}),t.showSecondaryAxis&&e.jsx(ze,{yAxisId:"right",orientation:"right"}),e.jsx(Re,{}),e.jsx(Me,{}),t.showThreshold&&e.jsx(vr,{y:t.thresholdValue,stroke:"red",strokeDasharray:"5 5",yAxisId:"left"}),o.map((d,f)=>e.jsx(Ge,{yAxisId:"left",type:"monotone",dataKey:d,stroke:d.includes("period1")?`hsl(${f*60}, 70%, 40%)`:`hsl(${f*60}, 70%, 60%)`,strokeWidth:2,strokeDasharray:d.includes("period1")?"0":"5 5"},d)),t.showSecondaryAxis&&u.map((d,f)=>e.jsx(Ge,{yAxisId:"right",type:"monotone",dataKey:d,stroke:`hsl(${(f+o.length)*60}, 70%, 50%)`,strokeWidth:2,strokeDasharray:"10 5"},d))]})})})});Ot.displayName="ChartDisplay";const $s=[{value:"availability",label:"Availability (%)",threshold:99},{value:"rrc",label:"RRC Success Rate (%)",threshold:98.5},{value:"erab",label:"ERAB Success Rate (%)",threshold:99},{value:"sar",label:"SAR",threshold:2.5},{value:"mobility_intra",label:"Mobility Intra (%)",threshold:95},{value:"cqi",label:"CQI",threshold:8}],Vs=r.memo(()=>{var c,D;const[s,t]=r.useState({primaryKPI:"availability",secondaryKPI:"rrc",startDate1:new Date(Date.now()-12096e5).toISOString().split("T")[0],endDate1:new Date(Date.now()-6048e5).toISOString().split("T")[0],startDate2:new Date(Date.now()-6048e5).toISOString().split("T")[0],endDate2:new Date().toISOString().split("T")[0],ne:"",cellid:"",showSecondaryAxis:!0,showComparison:!0,showThreshold:!0,thresholdValue:99}),[a,n]=r.useState([]),[i,g]=r.useState(!1),[h,o]=r.useState(!1),[u,d]=r.useState($s),[f,P]=r.useState([]),[l,p]=r.useState(!1),y=r.useMemo(()=>l&&f.length>0?f:u,[l,f,u]),v=r.useCallback(async()=>{var A;try{o(!0),console.info("[AdvancedChart] Fetching DB PEGs");let j={};try{const E=localStorage.getItem("dbConfig");E&&(j=JSON.parse(E))}catch(E){console.error("Error parsing dbConfig from localStorage",E)}if(!j.host){console.warn("[AdvancedChart] No DB config found");return}const $=await ge.post("/api/master/pegs",{db:j,table:j.table||"summary",limit:100}),G=((A=$==null?void 0:$.data)==null?void 0:A.pegs)||[];console.info("[AdvancedChart] DB PEGs loaded:",G.length);const w=G.map(E=>({value:E.id||E.name,label:`${E.name||E.id} (DB)`,threshold:0,isDbPeg:!0}));P(w)}catch(j){console.error("[AdvancedChart] Error fetching DB PEGs:",j)}finally{o(!1)}},[]),k=r.useCallback((A,j)=>{var x,b;if(!A||A.length===0)return[];const $=((b=(x=A[0])==null?void 0:x.data)==null?void 0:b.data)||[],G=j.showComparison&&A[1]?A[1].data.data:[],w=j.showSecondaryAxis&&A[2]?A[2].data.data:[],E={};function m(F,T){const q={};F.forEach(se=>{const ie=new Date(se.timestamp).toLocaleString();q[ie]||(q[ie]={sum:0,cnt:0}),q[ie].sum+=Number(se.value)||0,q[ie].cnt+=1}),Object.keys(q).forEach(se=>{E[se]||(E[se]={time:se});const ie=q[se].cnt>0?+(q[se].sum/q[se].cnt).toFixed(2):0;E[se][T]=ie})}return m($,`${j.primaryKPI}_period1`),j.showComparison&&m(G,`${j.primaryKPI}_period2`),j.showSecondaryAxis&&m(w,`${j.secondaryKPI}_secondary`),Object.values(E).sort((F,T)=>new Date(F.time)-new Date(T.time)).slice(0,200)},[]),_=r.useCallback(async()=>{try{g(!0),console.info("[AdvancedChart] Generate with config:",s,"useDbPegs:",l);const A=[];A.push(ge.post("/api/kpi/query",{start_date:s.startDate1,end_date:s.endDate1,kpi_type:s.primaryKPI,ne:s.ne,cellid:s.cellid,ids:2})),s.showComparison&&A.push(ge.post("/api/kpi/query",{start_date:s.startDate2,end_date:s.endDate2,kpi_type:s.primaryKPI,ne:s.ne,cellid:s.cellid,ids:2})),s.showSecondaryAxis&&s.secondaryKPI!==s.primaryKPI&&A.push(ge.post("/api/kpi/query",{start_date:s.startDate2,end_date:s.endDate2,kpi_type:s.secondaryKPI,ne:s.ne,cellid:s.cellid,ids:2}));const j=await Promise.all(A);console.info("[AdvancedChart] API responses:",j.map(G=>{var w,E;return((E=(w=G==null?void 0:G.data)==null?void 0:w.data)==null?void 0:E.length)??0}));const $=k(j,s);n($)}catch(A){console.error("[AdvancedChart] Error generating advanced chart:",A)}finally{g(!1)}},[s,l,k]);return r.useEffect(()=>{var A;try{const j=localStorage.getItem("activePreference");if(j){const $=JSON.parse(j),G=Array.isArray((A=$==null?void 0:$.config)==null?void 0:A.availableKPIs)&&$.config.availableKPIs.length>0?$.config.availableKPIs.map(E=>({value:String((E==null?void 0:E.value)||""),label:String((E==null?void 0:E.label)||(E==null?void 0:E.value)||""),threshold:Number((E==null?void 0:E.threshold)??0)})):$s;d(G);const w=G.map(E=>E.value);t(E=>{var m,x,b,F;return{...E,primaryKPI:w.includes(E.primaryKPI)?E.primaryKPI:((m=G[0])==null?void 0:m.value)||"availability",secondaryKPI:w.includes(E.secondaryKPI)?E.secondaryKPI:((x=G[1])==null?void 0:x.value)||((b=G[0])==null?void 0:b.value)||"rrc",thresholdValue:((F=G.find(T=>{var q;return T.value===(w.includes(E.primaryKPI)?E.primaryKPI:((q=G[0])==null?void 0:q.value)||"availability")}))==null?void 0:F.threshold)??E.thresholdValue}})}}catch{d($s)}},[]),r.useEffect(()=>{l&&f.length===0&&v()},[l,f.length,v]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(re,{children:[e.jsx(he,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5"}),"Advanced Chart Configuration"]})}),e.jsx(ne,{children:e.jsx(Tt,{chartConfig:s,onConfigChange:t,kpiOptions:u,loading:i,onGenerate:_,useDbPegs:l,pegOptionsLoading:h,dbPegOptions:f})})]}),e.jsxs(re,{children:[e.jsx(he,{children:e.jsxs(xe,{children:[((c=y.find(A=>A.value===s.primaryKPI))==null?void 0:c.label)||"KPI"," Analysis",s.showSecondaryAxis&&` vs ${(D=y.find(A=>A.value===s.secondaryKPI))==null?void 0:D.label}`]})}),e.jsx(ne,{children:e.jsx(Ot,{chartData:a,chartConfig:s,loading:i,kpiOptions:u,useDbPegs:l,dbPegOptions:f})})]})]})});Vs.displayName="AdvancedChart";const Rt=Object.freeze(Object.defineProperty({__proto__:null,default:Vs},Symbol.toStringTag,{value:"Module"}));function xs({className:s,orientation:t="horizontal",decorative:a=!0,...n}){return e.jsx(Ta,{"data-slot":"separator-root",decorative:a,orientation:t,className:te("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",s),...n})}function bs({className:s,children:t,...a}){return e.jsxs(Oa,{"data-slot":"scroll-area",className:te("relative",s),...a,children:[e.jsx(Ra,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:t}),e.jsx(ln,{}),e.jsx(Ma,{})]})}function ln({className:s,orientation:t="vertical",...a}){return e.jsx(za,{"data-slot":"scroll-area-scrollbar",orientation:t,className:te("flex touch-none p-px transition-colors select-none",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",s),...a,children:e.jsx(Fa,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}const st=({title:s="날짜 범위",description:t="분석할 기간을 선택하세요",startDate:a,endDate:n,onDateChange:i,preset:g="",onPresetChange:h,disabled:o=!1,error:u=null,className:d="",showPresets:f=!0,minDate:P=null,maxDate:l=null})=>{const[p,y]=r.useState(a||""),[v,k]=r.useState(n||""),[_,c]=r.useState(null),D=[{value:"last7days",label:"최근 7일",days:7},{value:"last14days",label:"최근 14일",days:14},{value:"last30days",label:"최근 30일",days:30},{value:"thisweek",label:"이번 주",custom:!0},{value:"lastweek",label:"지난 주",custom:!0},{value:"thismonth",label:"이번 달",custom:!0},{value:"lastmonth",label:"지난 달",custom:!0},{value:"custom",label:"직접 선택",custom:!0}];r.useEffect(()=>{y(a||""),k(n||"")},[a,n]);const A=(x,b)=>{if(!x||!b)return"시작 날짜와 종료 날짜를 모두 입력해주세요";const F=new Date(x),T=new Date(b);return isNaN(F)||isNaN(T)?"올바른 날짜 형식을 입력해주세요":F>=T?"종료 날짜는 시작 날짜보다 이후여야 합니다":(T-F)/(1e3*60*60*24)>365?"날짜 범위는 최대 365일까지 선택할 수 있습니다":P&&F<new Date(P)?`시작 날짜는 ${P} 이후여야 합니다`:l&&T>new Date(l)?`종료 날짜는 ${l} 이전이어야 합니다`:null},j=(x,b)=>{let F=p,T=v;x==="start"?(F=b,y(b)):x==="end"&&(T=b,k(b));const q=A(F,T);c(q),!q&&i&&i({startDate:F,endDate:T})},$=x=>{const b=new Date;let F,T;switch(x){case"last7days":T=new Date(b),F=new Date(b.getTime()-10080*60*1e3);break;case"last14days":T=new Date(b),F=new Date(b.getTime()-336*60*60*1e3);break;case"last30days":T=new Date(b),F=new Date(b.getTime()-720*60*60*1e3);break;case"thisweek":const O=new Date(b);O.setDate(b.getDate()-b.getDay()),F=O,T=new Date(b);break;case"lastweek":const R=new Date(b);R.setDate(b.getDate()-b.getDay()-1);const U=new Date(R);U.setDate(R.getDate()-6),F=U,T=R;break;case"thismonth":F=new Date(b.getFullYear(),b.getMonth(),1),T=new Date(b);break;case"lastmonth":const B=new Date(b.getFullYear(),b.getMonth()-1,1),S=new Date(b.getFullYear(),b.getMonth(),0);F=B,T=S;break;case"custom":h&&h(x);return;default:return}const q=F.toISOString().split("T")[0],se=T.toISOString().split("T")[0];y(q),k(se);const ie=A(q,se);c(ie),!ie&&i&&i({startDate:q,endDate:se}),h&&h(x)},w=(()=>{if(!p||!v)return null;try{const x=new Date(p),b=new Date(v);return{days:Math.ceil((b-x)/(1e3*60*60*24)),startFormatted:x.toLocaleDateString("ko-KR"),endFormatted:b.toLocaleDateString("ko-KR")}}catch{return null}})(),E=u||_,m=!E&&p&&v;return e.jsxs(re,{className:`${d} ${o?"opacity-50":""}`,children:[e.jsxs(he,{className:"pb-3",children:[e.jsxs(xe,{className:"flex items-center gap-2 text-base",children:[e.jsx(ds,{className:"h-4 w-4"}),s]}),t&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t})]}),e.jsxs(ne,{className:"space-y-4",children:[f&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-sm font-medium",children:"빠른 선택"}),e.jsxs(Ee,{value:g,onValueChange:$,disabled:o,children:[e.jsx($e,{children:e.jsx(Pe,{placeholder:"기간을 선택하세요"})}),e.jsx(Ae,{children:D.map(x=>e.jsx(le,{value:x.value,children:x.label},x.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:`start-${s}`,className:"text-sm",children:"시작 날짜"}),e.jsx(ve,{id:`start-${s}`,type:"date",value:p,onChange:x=>j("start",x.target.value),disabled:o,min:P,max:l,className:E?"border-red-500":""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:`end-${s}`,className:"text-sm",children:"종료 날짜"}),e.jsx(ve,{id:`end-${s}`,type:"date",value:v,onChange:x=>j("end",x.target.value),disabled:o,min:P,max:l,className:E?"border-red-500":""})]})]}),E&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(Ce,{className:"h-4 w-4 text-red-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-red-700",children:E})]}),w&&m&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(Ms,{className:"h-4 w-4 text-green-500 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsxs("span",{className:"font-medium",children:[w.days,"일 기간"]}),e.jsxs("span",{className:"text-green-600 ml-2",children:["(",w.startFormatted," ~ ",w.endFormatted,")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Z,{variant:m?"default":"secondary",className:"text-xs",children:[e.jsx(Be,{className:"h-3 w-3 mr-1"}),m?"유효한 범위":"범위 설정 필요"]}),w&&m&&e.jsxs(Z,{variant:"outline",className:"text-xs",children:[w.days,"일 데이터"]})]})]})]})},ts=({comparisonResults:s,title:t="비교 분석 차트",className:a="",showControls:n=!0,defaultChartType:i="bar",height:g=400})=>{const[h,o]=r.useState(i),[u,d]=r.useState(!1),[f,P]=r.useState("mean"),l=[{value:"bar",label:"막대 차트",icon:Oe},{value:"line",label:"라인 차트",icon:Us},{value:"area",label:"영역 차트",icon:gs},{value:"pie",label:"파이 차트",icon:tr},{value:"radar",label:"레이더 차트",icon:Us},{value:"composed",label:"복합 차트",icon:Oe}],p=[{value:"mean",label:"평균값",description:"두 기간의 평균 비교"},{value:"delta",label:"Delta",description:"절대값 변화량"},{value:"delta_percentage",label:"Delta %",description:"상대적 변화율"}],y=r.useMemo(()=>s!=null&&s.analysis_results?(console.log("📊 차트 데이터 생성 중:",s.analysis_results),s.analysis_results.map(w=>{var F,T;const E=parseFloat((F=w.period1_stats)==null?void 0:F.mean)||0,m=parseFloat((T=w.period2_stats)==null?void 0:T.mean)||0,x=parseFloat(w.delta)||0,b=parseFloat(w.delta_percentage)||0;return{name:w.peg_name,peg_name:w.peg_name,period1:E,period2:m,delta:x,delta_percentage:b,improvement_status:w.improvement_status,improvement_magnitude:w.improvement_magnitude,rsd_period1:parseFloat(w.rsd_period1)||0,rsd_period2:parseFloat(w.rsd_period2)||0,color:w.improvement_status==="improved"?"#22c55e":w.improvement_status==="degraded"?"#ef4444":"#3b82f6",abs_delta:Math.abs(x),abs_delta_percentage:Math.abs(b)}})):[],[s]),v=r.useMemo(()=>{if(!y.length)return[];const w=y.filter(x=>x.improvement_status==="improved").length,E=y.filter(x=>x.improvement_status==="degraded").length,m=y.filter(x=>x.improvement_status==="stable").length;return[{name:"개선",value:w,color:"#22c55e"},{name:"악화",value:E,color:"#ef4444"},{name:"안정",value:m,color:"#3b82f6"}].filter(x=>x.value>0)},[y]),k=({active:w,payload:E,label:m})=>{if(w&&E&&E.length){const x=E[0].payload;return e.jsxs("div",{className:"bg-white p-3 border rounded-lg shadow-lg",children:[e.jsx("h4",{className:"font-semibold text-sm",children:m}),e.jsxs("div",{className:"space-y-1 mt-2",children:[E.map((b,F)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:b.color}}),e.jsxs("span",{children:[b.name,": ",b.value]})]},F)),x.improvement_status&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-2 pt-2 border-t",children:["상태: ",x.improvement_status==="improved"?"개선":x.improvement_status==="degraded"?"악화":"안정",x.improvement_magnitude&&` (${x.improvement_magnitude})`]})]})]})}return null},_=()=>e.jsx(Ie,{width:"100%",height:u?"80vh":g,children:e.jsxs(vs,{data:y,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(He,{strokeDasharray:"3 3"}),e.jsx(qe,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(ze,{fontSize:12}),e.jsx(Re,{content:e.jsx(k,{})}),e.jsx(Me,{}),f==="mean"&&e.jsxs(e.Fragment,{children:[e.jsx(Te,{dataKey:"period1",fill:"#8884d8",name:"기간 1"}),e.jsx(Te,{dataKey:"period2",fill:"#82ca9d",name:"기간 2"})]}),f==="delta"&&e.jsx(Te,{dataKey:"delta",name:"Delta",children:y.map((w,E)=>e.jsx(ks,{fill:w.color},`cell-${E}`))}),f==="delta_percentage"&&e.jsx(Te,{dataKey:"delta_percentage",name:"Delta %",children:y.map((w,E)=>e.jsx(ks,{fill:w.color},`cell-${E}`))})]})}),c=()=>e.jsx(Ie,{width:"100%",height:u?"80vh":g,children:e.jsxs(Gs,{data:y,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(He,{strokeDasharray:"3 3"}),e.jsx(qe,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(ze,{fontSize:12}),e.jsx(Re,{content:e.jsx(k,{})}),e.jsx(Me,{}),f==="mean"&&e.jsxs(e.Fragment,{children:[e.jsx(Ge,{type:"monotone",dataKey:"period1",stroke:"#8884d8",strokeWidth:2,name:"기간 1"}),e.jsx(Ge,{type:"monotone",dataKey:"period2",stroke:"#82ca9d",strokeWidth:2,name:"기간 2"})]}),f==="delta"&&e.jsx(Ge,{type:"monotone",dataKey:"delta",stroke:"#ff7300",strokeWidth:2,name:"Delta"}),f==="delta_percentage"&&e.jsx(Ge,{type:"monotone",dataKey:"delta_percentage",stroke:"#ff7300",strokeWidth:2,name:"Delta %"})]})}),D=()=>e.jsx(Ie,{width:"100%",height:u?"80vh":g,children:e.jsxs(bt,{data:y,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(He,{strokeDasharray:"3 3"}),e.jsx(qe,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(ze,{fontSize:12}),e.jsx(Re,{content:e.jsx(k,{})}),e.jsx(Me,{}),f==="mean"&&e.jsxs(e.Fragment,{children:[e.jsx(as,{type:"monotone",dataKey:"period1",stackId:"1",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.6,name:"기간 1"}),e.jsx(as,{type:"monotone",dataKey:"period2",stackId:"2",stroke:"#82ca9d",fill:"#82ca9d",fillOpacity:.6,name:"기간 2"})]}),f==="delta"&&e.jsx(as,{type:"monotone",dataKey:"delta",stroke:"#ff7300",fill:"#ff7300",fillOpacity:.6,name:"Delta"}),f==="delta_percentage"&&e.jsx(as,{type:"monotone",dataKey:"delta_percentage",stroke:"#ff7300",fill:"#ff7300",fillOpacity:.6,name:"Delta %"})]})}),A=()=>e.jsx(Ie,{width:"100%",height:u?"80vh":g,children:e.jsxs(Cr,{children:[e.jsx(kr,{data:v,cx:"50%",cy:"50%",labelLine:!1,label:({name:w,value:E,percent:m})=>`${w}: ${E}개 (${(m*100).toFixed(0)}%)`,outerRadius:u?200:100,fill:"#8884d8",dataKey:"value",children:v.map((w,E)=>e.jsx(ks,{fill:w.color},`cell-${E}`))}),e.jsx(Re,{}),e.jsx(Me,{})]})}),j=()=>{const w=y.map(E=>({peg:E.name.length>10?E.name.substring(0,8)+"...":E.name,period1:Math.min(Math.max(E.period1/Math.max(...y.map(m=>m.period1))*100,0),100),period2:Math.min(Math.max(E.period2/Math.max(...y.map(m=>m.period2))*100,0),100)}));return e.jsx(Ie,{width:"100%",height:u?"80vh":g,children:e.jsxs(yr,{data:w,children:[e.jsx(Nr,{}),e.jsx(wr,{dataKey:"peg",fontSize:10}),e.jsx(Sr,{angle:90,domain:[0,100],fontSize:10,tick:!1}),e.jsx(qs,{name:"기간 1",dataKey:"period1",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.3}),e.jsx(qs,{name:"기간 2",dataKey:"period2",stroke:"#82ca9d",fill:"#82ca9d",fillOpacity:.3}),e.jsx(Me,{}),e.jsx(Re,{})]})})},$=()=>e.jsx(Ie,{width:"100%",height:u?"80vh":g,children:e.jsxs(br,{data:y,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(He,{strokeDasharray:"3 3"}),e.jsx(qe,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(ze,{yAxisId:"left",fontSize:12}),e.jsx(ze,{yAxisId:"right",orientation:"right",fontSize:12}),e.jsx(Re,{content:e.jsx(k,{})}),e.jsx(Me,{}),e.jsx(Te,{yAxisId:"left",dataKey:"period1",fill:"#8884d8",name:"기간 1"}),e.jsx(Te,{yAxisId:"left",dataKey:"period2",fill:"#82ca9d",name:"기간 2"}),e.jsx(Ge,{yAxisId:"right",type:"monotone",dataKey:"delta_percentage",stroke:"#ff7300",strokeWidth:3,name:"Delta %"})]})}),G=()=>{switch(h){case"bar":return _();case"line":return c();case"area":return D();case"pie":return A();case"radar":return j();case"composed":return $();default:return _()}};return!s||!y.length?e.jsx(re,{className:a,children:e.jsxs(ne,{className:"flex flex-col items-center justify-center h-64",children:[e.jsx(Oe,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"차트 데이터 없음"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"비교 분석을 실행하면 결과를 차트로 볼 수 있습니다"})]})}):e.jsxs(re,{className:`${a} ${u?"fixed inset-4 z-50 bg-white":""}`,children:[e.jsxs(he,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5"}),t,e.jsxs(Z,{variant:"outline",className:"ml-2",children:[y.length,"개 PEG"]})]}),n&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(J,{variant:"ghost",size:"sm",onClick:()=>d(!u),children:u?e.jsx(pt,{className:"h-4 w-4"}):e.jsx(jt,{className:"h-4 w-4"})})})]}),n&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"차트 타입"}),e.jsxs(Ee,{value:h,onValueChange:o,children:[e.jsx($e,{children:e.jsx(Pe,{})}),e.jsx(Ae,{children:l.map(w=>{const E=w.icon;return e.jsx(le,{value:w.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4"}),w.label]})},w.value)})})]})]}),!["pie","radar"].includes(h)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"표시 메트릭"}),e.jsxs(Ee,{value:f,onValueChange:P,children:[e.jsx($e,{children:e.jsx(Pe,{})}),e.jsx(Ae,{children:p.map(w=>e.jsx(le,{value:w.value,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:w.label}),e.jsx("div",{className:"text-xs text-muted-foreground",children:w.description})]})},w.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"차트 정보"}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("div",{children:["총 ",y.length,"개 PEG 비교"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Z,{variant:"secondary",className:"text-xs",children:["개선: ",y.filter(w=>w.improvement_status==="improved").length]}),e.jsxs(Z,{variant:"destructive",className:"text-xs",children:["악화: ",y.filter(w=>w.improvement_status==="degraded").length]})]})]})]})]})]}),e.jsxs(ne,{children:[e.jsx("div",{className:"w-full",children:G()}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsx("div",{className:"text-xs text-muted-foreground space-y-1",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsxs("span",{children:["개선 (",y.filter(w=>w.improvement_status==="improved").length,"개)"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsxs("span",{children:["악화 (",y.filter(w=>w.improvement_status==="degraded").length,"개)"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),e.jsxs("span",{children:["안정 (",y.filter(w=>w.improvement_status==="stable").length,"개)"]})]}),e.jsxs("div",{className:"text-muted-foreground",children:["총 ",y.length,"개 PEG 분석"]})]})})})]})]})},Mt=Object.freeze(Object.defineProperty({__proto__:null,default:ts},Symbol.toStringTag,{value:"Module"})),zt=()=>{var O,R,U,B,S,M;const{settings:s}=$t(),{updatePreference:t,isSaving:a}=Ye(),[n,i]=r.useState({startDate:"",endDate:"",preset:"last7days"}),[g,h]=r.useState({startDate:"",endDate:"",preset:"last14days"}),[o,u]=r.useState(["availability","rrc","erab"]),[d,f]=r.useState(!0),[P,l]=r.useState(4),[p,y]=r.useState(null),[v,k]=r.useState(!1),[_,c]=r.useState(null),[D,A]=r.useState(null),[j,$]=r.useState(new Set),G=r.useMemo(()=>s!=null&&s.table?[{value:"availability",label:"Availability (%)"},{value:"rrc",label:"RRC Success Rate (%)"},{value:"erab",label:"ERAB Success Rate (%)"},{value:"sar",label:"SAR"},{value:"mobility_intra",label:"Mobility Intra (%)"},{value:"cqi",label:"CQI"}]:[],[s==null?void 0:s.table]),w=r.useCallback(async()=>{console.log("🔍 Available PEGs 로드 시작");try{const C=localStorage.getItem("dbConfig"),K=localStorage.getItem("useDbPegs")==="true";console.log("📊 DB 설정 상태:",{hasDbConfig:!!C,useDbPegs:K,dbConfigData:C?JSON.parse(C):null});let H=[];if(K&&C){console.log("🔗 Database에서 PEG 목록 조회 중...");const V=await ge.get("/api/master/pegs");console.log("📥 Database PEG 응답:",V.data),V.data&&Array.isArray(V.data)&&(H=V.data.map(Y=>({value:Y.peg_name||Y.value||Y.id,label:Y.display_name||Y.label||`${Y.peg_name} (${Y.unit||"N/A"})`})))}if(H.length===0&&(console.log("📝 기본 PEG 목록 사용"),H=[{value:"availability",label:"Availability (%)"},{value:"rrc",label:"RRC Success Rate (%)"},{value:"erab",label:"ERAB Success Rate (%)"},{value:"sar",label:"SAR"},{value:"mobility_intra",label:"Mobility Intra (%)"},{value:"cqi",label:"CQI"},{value:"se",label:"Spectral Efficiency"},{value:"dl_thp",label:"DL Throughput"},{value:"ul_int",label:"UL Interference"}]),console.log("✅ PEG 목록 로드 완료:",H),o.length===0&&H.length>0){const V=H.slice(0,3).map(Y=>Y.value);u(V),console.log("🎯 기본 PEG 선택:",V)}}catch(C){console.error("❌ PEG 목록 로드 실패:",C)}finally{}},[o.length]);r.useEffect(()=>{const C=new Date,K=new Date(C),H=new Date(C.getTime()-10080*60*1e3),V=new Date(H),Y=new Date(H.getTime()-10080*60*1e3);i({startDate:H.toISOString().split("T")[0],endDate:K.toISOString().split("T")[0],preset:"last7days"}),h({startDate:Y.toISOString().split("T")[0],endDate:V.toISOString().split("T")[0],preset:"custom"}),w()},[w]),r.useEffect(()=>{s.defaultPegs&&u(s.defaultPegs),s.decimalPlaces!==void 0&&l(s.decimalPlaces),s.includeOutliers!==void 0&&f(s.includeOutliers)},[s]);const E=r.useCallback(({startDate:C,endDate:K})=>{i(H=>({...H,startDate:C,endDate:K,preset:"custom"}))},[]),m=r.useCallback(({startDate:C,endDate:K})=>{h(H=>({...H,startDate:C,endDate:K,preset:"custom"}))},[]),x=async()=>{var C,K,H;if(!n.startDate||!n.endDate||!g.startDate||!g.endDate){Q.error("두 기간의 날짜를 모두 설정해주세요");return}if(o.length===0){Q.error("분석할 PEG를 최소 1개 이상 선택해주세요");return}k(!0),c(null);try{console.log("🔍 Statistics 비교 분석 시작:",{period1:n,period2:g,selectedPegs:o,includeOutliers:d,decimalPlaces:P});const V={period1:{start_date:`${n.startDate}T00:00:00`,end_date:`${n.endDate}T23:59:59`},period2:{start_date:`${g.startDate}T00:00:00`,end_date:`${g.endDate}T23:59:59`},peg_names:o,include_outliers:d,decimal_places:P,ne_filter:s.defaultNe?[s.defaultNe]:null,cell_id_filter:s.defaultCellId?[s.defaultCellId]:null};console.log("📤 API 요청 페이로드:",V);const Y=await ge.post("/api/statistics/compare",V);console.log("📥 API 응답:",Y.data),y(Y.data),A(new Date),Q.success(`비교 분석 완료! ${((C=Y.data.analysis_results)==null?void 0:C.length)||0}개 PEG 분석됨`)}catch(V){console.error("❌ 비교 분석 실패:",V);let Y="비교 분석 중 오류가 발생했습니다";(H=(K=V.response)==null?void 0:K.data)!=null&&H.error_message?Y=V.response.data.error_message:V.message&&(Y=V.message),c(Y),Q.error(Y)}finally{k(!1)}},b=C=>{const K=new Set(j);K.has(C)?K.delete(C):K.add(C),$(K)},F=()=>{var C,K;if(j.size===((C=p==null?void 0:p.analysis_results)==null?void 0:C.length))$(new Set);else{const H=((K=p==null?void 0:p.analysis_results)==null?void 0:K.map(V=>V.peg_name))||[];$(new Set(H))}},T=async()=>{if(j.size===0){Q.error("저장할 PEG를 선택해주세요");return}try{console.log("💾 Dashboard에 저장할 PEG:",Array.from(j));const C=dashboardSettings||{},K=(C==null?void 0:C.selectedPegs)||[],H=Array.from(j).filter(Y=>!K.includes(Y)),V=[...K,...H];console.log("📊 현재 Dashboard PEG:",K),console.log("🆕 추가할 새 PEG:",H),console.log("📈 업데이트된 PEG 목록:",V),await t("dashboardSettings",{...C,selectedPegs:V}),Q.success(`${j.size}개 PEG가 Dashboard에 추가되었습니다`,{description:`총 ${V.length}개 PEG가 Dashboard에 설정되어 있습니다. Dashboard로 이동해서 확인해보세요!`,duration:5e3}),$(new Set)}catch(C){console.error("❌ Dashboard 저장 실패:",C),Q.error("Dashboard 저장 중 오류가 발생했습니다",{description:C.message||"네트워크 오류일 수 있습니다"})}},q=n.startDate&&n.endDate&&g.startDate&&g.endDate&&o.length>0,se=C=>{switch(C){case"improved":return e.jsx(gs,{className:"h-4 w-4 text-green-500"});case"degraded":return e.jsx(rr,{className:"h-4 w-4 text-red-500"});case"stable":return e.jsx(ar,{className:"h-4 w-4 text-blue-500"});default:return e.jsx(Is,{className:"h-4 w-4 text-yellow-500"})}},ie=(C,K)=>{const H={improved:"bg-green-100 text-green-800 border-green-200",degraded:"bg-red-100 text-red-800 border-red-200",stable:"bg-blue-100 text-blue-800 border-blue-200"},V={significant:"상당한",moderate:"보통",minor:"미미한",none:"변화없음"};return e.jsxs(Z,{className:`${H[C]||"bg-gray-100 text-gray-800"} text-xs`,children:[se(C),e.jsxs("span",{className:"ml-1",children:[C==="improved"?"개선":C==="degraded"?"악화":"안정",K&&` (${V[K]})`]})]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Basic 비교 분석"}),e.jsx("p",{className:"text-muted-foreground",children:"두 기간의 KPI 데이터를 비교하여 성능 변화를 분석합니다"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[D&&e.jsxs(Z,{variant:"outline",className:"text-xs",children:["마지막 분석: ",D.toLocaleTimeString("ko-KR")]}),e.jsx(J,{onClick:x,disabled:!q||v,className:"bg-blue-600 hover:bg-blue-700",children:v?e.jsxs(e.Fragment,{children:[e.jsx(os,{className:"h-4 w-4 mr-2 animate-spin"}),"분석 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(zs,{className:"h-4 w-4 mr-2"}),"비교 분석 실행"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(st,{title:"기간 1 (기준)",description:"비교의 기준이 되는 첫 번째 기간",startDate:n.startDate,endDate:n.endDate,preset:n.preset,onDateChange:E,onPresetChange:C=>i(K=>({...K,preset:C}))}),e.jsx(st,{title:"기간 2 (비교 대상)",description:"기준과 비교할 두 번째 기간",startDate:g.startDate,endDate:g.endDate,preset:g.preset,onDateChange:m,onPresetChange:C=>h(K=>({...K,preset:C}))}),e.jsxs(re,{children:[e.jsx(he,{className:"pb-3",children:e.jsxs(xe,{className:"flex items-center gap-2 text-base",children:[e.jsx(ls,{className:"h-4 w-4"}),"분석 옵션"]})}),e.jsxs(ne,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-sm font-medium flex items-center justify-between",children:e.jsx("span",{children:"분석할 PEG"})}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:G.length>0?G.map(C=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ns,{id:`peg-${C.value}`,checked:o.includes(C.value),onCheckedChange:K=>{u(K?H=>[...H,C.value]:H=>H.filter(V=>V!==C.value))}}),e.jsx(W,{htmlFor:`peg-${C.value}`,className:"text-sm cursor-pointer flex-1",children:C.label})]},C.value)):e.jsxs("div",{className:"text-center text-muted-foreground py-4",children:[e.jsx(We,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"사용 가능한 PEG가 없습니다"}),e.jsx("p",{className:"text-xs",children:"Database 설정을 확인해주세요"})]})}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(Z,{variant:"outline",className:"text-xs",children:[o.length,"개 선택됨"]})})]}),e.jsx(xs,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(W,{className:"text-sm",children:"이상치 포함"}),e.jsx(J,{variant:d?"default":"outline",size:"sm",onClick:()=>f(!d),children:d?"포함":"제외"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-sm",children:"소수점 자릿수"}),e.jsxs(Ee,{value:P.toString(),onValueChange:C=>l(parseInt(C)),children:[e.jsx($e,{children:e.jsx(Pe,{})}),e.jsxs(Ae,{children:[e.jsx(le,{value:"2",children:"2자리"}),e.jsx(le,{value:"3",children:"3자리"}),e.jsx(le,{value:"4",children:"4자리"}),e.jsx(le,{value:"5",children:"5자리"})]})]})]})]})]})]})]}),_&&e.jsx(re,{className:"border-red-200 bg-red-50",children:e.jsxs(ne,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Is,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"text-red-700 font-medium",children:"분석 오류"})]}),e.jsx("p",{className:"text-red-600 mt-2",children:_})]})}),p&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(xs,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"비교 분석 결과"}),e.jsx("div",{className:"mb-6",children:e.jsx(ts,{comparisonResults:p,title:"PEG 비교 분석 차트",showControls:!0,defaultChartType:"bar",height:400})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(re,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((O=p.summary)==null?void 0:O.total_pegs_analyzed)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"분석된 PEG"})]})})}),e.jsx(re,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:((R=p.summary)==null?void 0:R.improved_count)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"개선"})]})})}),e.jsx(re,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:((U=p.summary)==null?void 0:U.degraded_count)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"악화"})]})})}),e.jsx(re,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((B=p.summary)==null?void 0:B.stable_count)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"안정"})]})})})]}),e.jsxs(re,{children:[e.jsx(he,{children:e.jsx(xe,{children:"상세 비교 결과"})}),e.jsx(ne,{children:e.jsxs(ws,{defaultValue:"table",className:"w-full",children:[e.jsxs(Ss,{className:"grid w-full grid-cols-2",children:[e.jsxs(De,{value:"table",className:"flex items-center gap-2",children:[e.jsx(vt,{className:"h-4 w-4"}),"테이블 뷰"]}),e.jsxs(De,{value:"chart",className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),"차트 뷰"]})]}),e.jsxs(_e,{value:"table",className:"space-y-4",children:[((S=p==null?void 0:p.analysis_results)==null?void 0:S.length)>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 border border-slate-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:j.size===p.analysis_results.length&&j.size>0,onChange:F,className:"w-4 h-4 text-blue-600 rounded"}),e.jsxs("span",{className:"text-sm font-medium",children:["전체 선택 (",j.size,"/",p.analysis_results.length,")"]})]}),j.size>0&&e.jsxs(Z,{variant:"secondary",className:"bg-blue-100 text-blue-700",children:[j.size,"개 선택됨"]})]}),j.size>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{variant:"outline",size:"sm",onClick:()=>$(new Set),children:"선택 해제"}),e.jsx(J,{size:"sm",onClick:T,disabled:a,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400",children:a?e.jsxs(e.Fragment,{children:[e.jsx(os,{className:"h-3 w-3 mr-1 animate-spin"}),"저장 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"h-3 w-3 mr-1"}),"Dashboard에 저장"]})})]})]}),e.jsx(bs,{className:"h-96",children:e.jsx("div",{className:"space-y-4",children:(M=p.analysis_results)==null?void 0:M.map((C,K)=>{var H,V;return e.jsx(re,{className:`border-l-4 border-l-blue-500 ${j.has(C.peg_name)?"ring-2 ring-blue-500 bg-blue-50":""}`,children:e.jsxs(ne,{className:"pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:j.has(C.peg_name),onChange:()=>b(C.peg_name),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("h4",{className:"font-semibold",children:C.peg_name})]}),ie(C.improvement_status,C.improvement_magnitude)]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"기간 1 평균"}),e.jsx("div",{className:"font-medium",children:(H=C.period1_stats)==null?void 0:H.mean})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"기간 2 평균"}),e.jsx("div",{className:"font-medium",children:(V=C.period2_stats)==null?void 0:V.mean})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Delta"}),e.jsxs("div",{className:`font-medium ${C.delta>0?"text-green-600":C.delta<0?"text-red-600":"text-blue-600"}`,children:[C.delta>0?"+":"",C.delta]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Delta %"}),e.jsxs("div",{className:`font-medium ${C.delta_percentage>0?"text-green-600":C.delta_percentage<0?"text-red-600":"text-blue-600"}`,children:[C.delta_percentage>0?"+":"",C.delta_percentage,"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3 pt-3 border-t text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"기간 1 RSD"}),e.jsxs("div",{className:"font-medium",children:[C.rsd_period1,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"기간 2 RSD"}),e.jsxs("div",{className:"font-medium",children:[C.rsd_period2,"%"]})]})]})]})},K)})})})]}),e.jsx(_e,{value:"chart",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(ts,{comparisonResults:p,title:"막대 차트",showControls:!1,defaultChartType:"bar",height:300}),e.jsx(ts,{comparisonResults:p,title:"라인 차트",showControls:!1,defaultChartType:"line",height:300}),e.jsx(ts,{comparisonResults:p,title:"개선 상태 분포",showControls:!1,defaultChartType:"pie",height:300}),e.jsx(ts,{comparisonResults:p,title:"레이더 차트",showControls:!1,defaultChartType:"radar",height:300})]})})})]})})]})]})]}),!p&&!_&&e.jsx(re,{className:"text-center py-12",children:e.jsxs(ne,{children:[e.jsx(Oe,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"비교 분석 준비"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"두 기간과 분석할 PEG를 선택한 후 '비교 분석 실행' 버튼을 클릭하세요"}),e.jsx(Z,{variant:"outline",children:q?"분석 준비 완료":"설정 필요"})]})})]})},cn=Object.freeze(Object.defineProperty({__proto__:null,default:zt},Symbol.toStringTag,{value:"Module"})),Ft=()=>{const{settings:s}=$t(),t=s.defaultDateRange||7,a=s.defaultNe||"",n=s.defaultCellId||"",i=s.decimalPlaces||2,g=s.showComparisonOptions!==!1,h=s.autoCalculateStats!==!1;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Statistics"}),e.jsxs("p",{className:"text-muted-foreground",children:["기본 날짜 범위: ",t,"일 • 소수점: ",i,"자리",a&&` • 기본 NE: ${a}`,n&&` • 기본 Cell: ${n}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h&&e.jsxs(Z,{variant:"outline",className:"text-xs",children:[e.jsx(gs,{className:"h-3 w-3 mr-1"}),"자동 통계 계산"]}),g&&e.jsxs(Z,{variant:"outline",className:"text-xs",children:[e.jsx(Oe,{className:"h-3 w-3 mr-1"}),"비교 옵션 활성"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(Z,{variant:"default",children:["기본 기간: ",t,"일"]}),e.jsxs(Z,{variant:"outline",children:["소수점: ",i,"자리"]}),h&&e.jsx(Z,{variant:"secondary",children:"자동 통계 계산"}),g&&e.jsx(Z,{variant:"secondary",children:"비교 옵션"})]}),e.jsxs(ws,{defaultValue:"basic",className:"w-full",children:[e.jsxs(Ss,{className:"grid w-full grid-cols-2",children:[e.jsx(De,{value:"basic",children:"Basic Analysis"}),e.jsx(De,{value:"advanced",children:"Advanced Analysis"})]}),e.jsx(_e,{value:"basic",className:"space-y-6",children:e.jsx(zt,{})}),e.jsx(_e,{value:"advanced",className:"space-y-6",children:e.jsx(Vs,{})})]})]})},Gt=Object.freeze(Object.defineProperty({__proto__:null,default:Ft},Symbol.toStringTag,{value:"Module"}));function Bt({...s}){return e.jsx(Ga,{"data-slot":"collapsible",...s})}function Vt({...s}){return e.jsx(Ba,{"data-slot":"collapsible-trigger",...s})}function Ut({...s}){return e.jsx(Va,{"data-slot":"collapsible-content",...s})}const on=Rs("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function Kt({className:s,variant:t,...a}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:te(on({variant:t}),s),...a})}function Ht({className:s,...t}){return e.jsx("div",{"data-slot":"alert-description",className:te("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),...t})}const is={text:{placeholder:"텍스트를 입력하세요",maxLength:100},number:{placeholder:"숫자를 입력하세요",min:0,max:999999},select:{placeholder:"선택하세요",options:[]},multiselect:{placeholder:"하나 이상 선택하세요",options:[]},checkbox:{label:"활성화"},switch:{label:"켜기/끄기"}},dn=({field:s,value:t,onChange:a,error:n,disabled:i})=>{var g,h,o,u;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(W,{htmlFor:s.key,className:"text-sm font-medium",children:[s.label,s.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),e.jsx(ve,{id:s.key,type:s.type==="number"?"number":"text",value:t||"",onChange:d=>{const f=s.type==="number"?d.target.value===""?"":Number(d.target.value):d.target.value;a(f)},placeholder:s.placeholder||((g=is[s.type])==null?void 0:g.placeholder),maxLength:s.maxLength||((h=is[s.type])==null?void 0:h.maxLength),min:s.min||((o=is[s.type])==null?void 0:o.min),max:s.max||((u=is[s.type])==null?void 0:u.max),disabled:i,className:n?"border-destructive":""}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description}),n&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(Ce,{className:"h-3 w-3"}),n]})]})},mn=({field:s,value:t,onChange:a,error:n,disabled:i})=>{var g;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(W,{htmlFor:s.key,className:"text-sm font-medium",children:[s.label,s.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),e.jsxs(Ee,{value:t||"",onValueChange:a,disabled:i,children:[e.jsx($e,{className:n?"border-destructive":"",children:e.jsx(Pe,{placeholder:s.placeholder||is.select.placeholder})}),e.jsx(Ae,{children:(g=s.options)==null?void 0:g.map(h=>e.jsx(le,{value:h.value,children:h.label},h.value))})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description}),n&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(Ce,{className:"h-3 w-3"}),n]})]})},un=({field:s,value:t,onChange:a,error:n,disabled:i})=>{var o,u;const g=Array.isArray(t)?t:[],h=d=>{const f=g.includes(d)?g.filter(P=>P!==d):[...g,d];a(f)};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(W,{className:"text-sm font-medium",children:[s.label,s.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),e.jsxs("div",{className:`border rounded-md p-3 space-y-2 ${n?"border-destructive":"border-input"}`,children:[(o=s.options)==null?void 0:o.map(d=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ns,{id:`${s.key}-${d.value}`,checked:g.includes(d.value),onCheckedChange:()=>h(d.value),disabled:i}),e.jsx(W,{htmlFor:`${s.key}-${d.value}`,className:"text-sm cursor-pointer",children:d.label})]},d.value)),((u=s.options)==null?void 0:u.length)===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"선택 가능한 옵션이 없습니다"})]}),g.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:g.map(d=>{var P;const f=(P=s.options)==null?void 0:P.find(l=>l.value===d);return f?e.jsx(Z,{variant:"secondary",className:"text-xs",children:f.label},d):null})}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description}),n&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(Ce,{className:"h-3 w-3"}),n]})]})},hn=({field:s,value:t,onChange:a,error:n,disabled:i})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs(W,{htmlFor:s.key,className:"text-sm font-medium",children:[s.label,s.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description})]}),e.jsx(rs,{id:s.key,checked:!!t,onCheckedChange:a,disabled:i})]}),n&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(Ce,{className:"h-3 w-3"}),n]})]}),As=({title:s,description:t,settingKey:a,fields:n=[],defaultOpen:i=!1,disabled:g=!1,className:h="",onFieldChange:o,showSaveButton:u=!1,showResetButton:d=!1})=>{const[f,P]=r.useState(i),[l,p]=r.useState(!1),{settings:y,updateSettings:v,updateSectionLocal:k,saving:_,error:c,validationErrors:D,logInfo:A,saveImmediately:j,defaultSettings:$}=Ye(),G=y[a]||{},w=r.useMemo(()=>{const T={};return Object.entries(D).forEach(([q,se])=>{if(q.startsWith(`${a}.`)){const ie=q.replace(`${a}.`,"");T[ie]=se}}),T},[D,a]),E=Object.keys(w).length>0,m=r.useCallback((T,q)=>{A(`SettingBox 필드 변경: ${a}.${T}`,{oldValue:G[T],newValue:q});const se={...G,[T]:q};u?k(a,se):v({[a]:se}),o==null||o(T,q,se),p(!0)},[a,G,v,o,A]),x=r.useCallback(async()=>{A(`SettingBox 즉시 저장: ${a}`),await j()},[j,A,a]),b=r.useCallback(()=>{A(`SettingBox 초기화: ${a}`);const T=$[a]||{};v({[a]:T}),p(!1)},[a,v,$,A]),F=r.useCallback(T=>{const q=G[T.key],se=l?w[T.key]:null,O={field:T,value:q,onChange:R=>m(T.key,R),error:se,disabled:g||_};switch(T.type){case"text":case"number":return e.jsx(dn,{...O},T.key);case"select":return e.jsx(mn,{...O},T.key);case"multiselect":return e.jsx(un,{...O},T.key);case"switch":case"checkbox":return e.jsx(hn,{...O},T.key);default:return e.jsxs("div",{className:"text-sm text-muted-foreground",children:["지원하지 않는 필드 타입: ",T.type]},T.key)}},[G,w,l,g,_,m]);return e.jsx(re,{className:`w-full ${h}`,children:e.jsxs(Bt,{open:f,onOpenChange:P,children:[e.jsx(Vt,{asChild:!0,children:e.jsx(he,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(xe,{className:"text-lg flex items-center gap-2",children:[s,_&&e.jsxs(Z,{variant:"secondary",className:"text-xs",children:[e.jsx(Be,{className:"h-3 w-3 mr-1"}),"저장 중"]}),l&&E&&e.jsxs(Z,{variant:"destructive",className:"text-xs",children:[e.jsx(Ce,{className:"h-3 w-3 mr-1"}),"오류"]}),l&&!E&&!_&&e.jsxs(Z,{variant:"default",className:"text-xs",children:[e.jsx(Fe,{className:"h-3 w-3 mr-1"}),"유효"]})]}),t&&e.jsx(Ns,{children:t})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Z,{variant:"outline",className:"text-xs",children:[n.length,"개 설정"]}),f?e.jsx(ys,{className:"h-4 w-4"}):e.jsx(Xe,{className:"h-4 w-4"})]})]})})}),e.jsx(Ut,{children:e.jsxs(ne,{className:"space-y-6",children:[c&&e.jsxs(Kt,{variant:"destructive",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx(Ht,{children:c})]}),n.length>0?e.jsx("div",{className:"space-y-4",children:n.map(F)}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"설정할 수 있는 항목이 없습니다."}),(u||d||E)&&e.jsxs(e.Fragment,{children:[e.jsx(xs,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:d&&e.jsxs(J,{variant:"outline",size:"sm",onClick:b,disabled:g||_,children:[e.jsx(Ls,{className:"h-4 w-4 mr-1"}),"초기화"]})}),e.jsx("div",{className:"flex items-center gap-2",children:u&&e.jsxs(J,{size:"sm",onClick:x,disabled:g||_||E,children:[e.jsx(nr,{className:"h-4 w-4 mr-1"}),"저장"]})})]})]})]})})]})})};function xn({className:s,value:t,...a}){return e.jsx(Ua,{"data-slot":"progress",className:te("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",s),...a,children:e.jsx(Ka,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})})}const ps=[{key:"dashboardSettings",label:"Dashboard 설정",description:"선택된 PEG, 차트 스타일, 새로고침 간격 등"},{key:"statisticsSettings",label:"Statistics 설정",description:"기본 날짜 범위, 비교 옵션, 소수점 자릿수 등"},{key:"derivedPegSettings",label:"Derived PEG 설정",description:"사용자 정의 수식, 활성화 상태, 계산 정밀도 등"},{key:"notificationSettings",label:"알림 설정",description:"토스트, 사운드, 알림 타입 설정"},{key:"generalSettings",label:"일반 설정",description:"언어, 시간대, 날짜 형식 등"}],gn=({title:s="설정 백업 & 복원",description:t="설정을 JSON 파일로 내보내거나 가져올 수 있습니다",defaultOpen:a=!1,className:n=""})=>{const[i,g]=r.useState(a),[h,o]=r.useState(!1),[u,d]=r.useState(!1),[f,P]=r.useState(0),[l,p]=r.useState(!1),[y,v]=r.useState(null),[k,_]=r.useState(null),[c,D]=r.useState(ps.reduce((S,M)=>({...S,[M.key]:!0}),{})),[A,j]=r.useState(""),$=r.useRef(null),{settings:G,exportSettings:w,importSettings:E,hasUnsavedChanges:m,saving:x,logInfo:b,logError:F}=Ye(),T=r.useCallback(async(S="full")=>{d(!0),v(null);try{b("설정 내보내기 시작",{exportType:S,customFileName:A});let M=G;if(S==="partial"){const V=Object.entries(c).filter(([Y,de])=>de).map(([Y])=>Y);if(V.length===0){Q.error("내보낼 설정 섹션을 하나 이상 선택해주세요");return}M=V.reduce((Y,de)=>(G[de]&&(Y[de]=G[de]),Y),{}),b("부분 내보내기 선택된 섹션",V)}const C=new Date().toISOString().split("T")[0],K=A.trim()||(S==="partial"?`preference-settings-partial-${C}.json`:`preference-settings-${C}.json`);await w(K,M)&&(Q.success(`설정이 "${K}" 파일로 내보내졌습니다`),j(""))}catch(M){F("설정 내보내기 실패",M),Q.error("설정 내보내기 실패: "+M.message)}finally{d(!1)}},[G,c,A,w,b,F]),q=r.useCallback(async S=>{if(S){o(!0),P(0),v(null);try{if(b("설정 가져오기 시작",{fileName:S.name,fileSize:S.size}),!S.name.toLowerCase().endsWith(".json"))throw new Error("JSON 파일만 지원됩니다");if(S.size>5*1024*1024)throw new Error("파일 크기가 너무 큽니다 (최대 5MB)");P(20);const M=await E(S);P(80),_({name:S.name,size:S.size,importedAt:new Date,sectionsCount:Object.keys(M).length}),P(100),b("설정 가져오기 완료",{fileName:S.name,sectionsImported:Object.keys(M).length}),Q.success(`"${S.name}"에서 설정을 성공적으로 가져왔습니다`)}catch(M){F("설정 가져오기 실패",M),v(M.message),Q.error("설정 가져오기 실패: "+M.message)}finally{o(!1),setTimeout(()=>{P(0)},3e3)}}},[E,b,F]),se=r.useCallback(S=>{const M=S.target.files[0];M&&(q(M),S.target.value="")},[q]),ie=r.useCallback(S=>{S.preventDefault(),p(!0)},[]),O=r.useCallback(S=>{S.preventDefault(),p(!1)},[]),R=r.useCallback(S=>{S.preventDefault(),p(!1);const M=S.dataTransfer.files;M.length>0&&q(M[0])},[q]),U=r.useCallback(S=>{D(M=>({...M,[S]:!M[S]}))},[]),B=r.useCallback(()=>{const S=Object.values(c).every(Boolean),M=ps.reduce((C,K)=>({...C,[K.key]:!S}),{});D(M)},[c]);return e.jsx(re,{className:`w-full ${n}`,children:e.jsxs(Bt,{open:i,onOpenChange:g,children:[e.jsx(Vt,{asChild:!0,children:e.jsx(he,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(xe,{className:"text-lg flex items-center gap-2",children:[e.jsx(lr,{className:"h-5 w-5"}),s,h&&e.jsxs(Z,{variant:"secondary",className:"text-xs",children:[e.jsx(Be,{className:"h-3 w-3 mr-1"}),"가져오는 중"]}),u&&e.jsxs(Z,{variant:"secondary",className:"text-xs",children:[e.jsx(Be,{className:"h-3 w-3 mr-1"}),"내보내는 중"]}),m&&e.jsxs(Z,{variant:"outline",className:"text-xs",children:[e.jsx(Ce,{className:"h-3 w-3 mr-1"}),"저장되지 않은 변경사항"]})]}),t&&e.jsx(Ns,{children:t})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[k&&e.jsxs(Z,{variant:"default",className:"text-xs",children:[e.jsx(Fe,{className:"h-3 w-3 mr-1"}),"가져옴"]}),i?e.jsx(ys,{className:"h-4 w-4"}):e.jsx(Xe,{className:"h-4 w-4"})]})]})})}),e.jsx(Ut,{children:e.jsxs(ne,{className:"space-y-6",children:[y&&e.jsxs(Kt,{variant:"destructive",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx(Ht,{children:y})]}),h&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"파일 가져오는 중..."}),e.jsxs("span",{children:[f,"%"]})]}),e.jsx(xn,{value:f,className:"h-2"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(ir,{className:"h-4 w-4"}),"설정 가져오기"]}),e.jsx("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${l?"border-primary bg-primary/5":h?"border-muted bg-muted/20":"border-muted-foreground/25 hover:border-muted-foreground/50"}`,onDragOver:ie,onDragLeave:O,onDrop:R,children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(cr,{className:`h-8 w-8 mx-auto ${l?"text-primary":"text-muted-foreground"}`}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:`text-sm font-medium ${l?"text-primary":""}`,children:l?"파일을 여기에 놓으세요":"JSON 파일을 드래그하거나 클릭하여 선택하세요"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"최대 5MB, .json 파일만 지원"})]}),e.jsxs(J,{variant:"outline",size:"sm",onClick:()=>{var S;return(S=$.current)==null?void 0:S.click()},disabled:h,className:"mt-2",children:[e.jsx(or,{className:"h-4 w-4 mr-2"}),"파일 선택"]})]})}),e.jsx("input",{ref:$,type:"file",accept:".json",onChange:se,style:{display:"none"}}),k&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Fe,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-medium",children:"마지막 가져온 파일:"}),e.jsx("span",{children:k.name}),e.jsxs(Z,{variant:"secondary",className:"text-xs",children:[k.sectionsCount,"개 섹션"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:k.importedAt.toLocaleString()})]})]}),e.jsx(xs,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(cs,{className:"h-4 w-4"}),"설정 내보내기"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"fileName",className:"text-sm",children:"파일명 (선택사항)"}),e.jsx(ve,{id:"fileName",value:A,onChange:S=>j(S.target.value),placeholder:"preference-settings-custom.json",disabled:u}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"비워두면 자동으로 날짜가 포함된 파일명이 생성됩니다"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(W,{className:"text-sm font-medium",children:"내보낼 설정 선택"}),e.jsx(J,{variant:"outline",size:"sm",onClick:B,disabled:u,children:Object.values(c).every(Boolean)?"전체 해제":"전체 선택"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:ps.map(S=>e.jsxs("div",{className:"flex items-start space-x-2 p-2 rounded border",children:[e.jsx(ns,{id:S.key,checked:c[S.key],onCheckedChange:()=>U(S.key),disabled:u}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsx(W,{htmlFor:S.key,className:"text-sm font-medium cursor-pointer",children:S.label}),e.jsx("p",{className:"text-xs text-muted-foreground",children:S.description})]})]},S.key))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(J,{onClick:()=>T("full"),disabled:u||x,className:"flex-1",children:[e.jsx(cs,{className:"h-4 w-4 mr-2"}),"전체 설정 내보내기"]}),e.jsxs(J,{variant:"outline",onClick:()=>T("partial"),disabled:u||x||Object.values(c).every(S=>!S),className:"flex-1",children:[e.jsx(cs,{className:"h-4 w-4 mr-2"}),"선택된 설정만 내보내기"]})]}),Object.values(c).every(S=>!S)&&e.jsx("p",{className:"text-xs text-destructive",children:"내보낼 설정 섹션을 하나 이상 선택해주세요"})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[e.jsx("h5",{className:"text-sm font-medium mb-2",children:"현재 설정 상태"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs",children:ps.map(S=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[S.label,":"]}),e.jsx("span",{className:"text-muted-foreground",children:G[S.key]?"설정됨":"기본값"})]},S.key))}),m&&e.jsxs("p",{className:"text-xs text-amber-600 mt-2 flex items-center gap-1",children:[e.jsx(Ce,{className:"h-3 w-3"}),"저장되지 않은 변경사항이 있습니다"]})]})]})})]})})};function fn({className:s,...t}){return e.jsx("textarea",{"data-slot":"textarea",className:te("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...t})}const pn=({derivedPegSettings:s,updateDerivedPegSettings:t,availablePegs:a=[],saving:n=!1})=>{var E;const[i,g]=r.useState(null),[h,o]=r.useState(null),[u,d]=r.useState(""),[f,P]=r.useState(null),[l,p]=r.useState(null),y=(s==null?void 0:s.formulas)||[],v=(s==null?void 0:s.settings)||{autoValidate:!0,showInDashboard:!0,showInStatistics:!0,evaluationPrecision:4},k=[{id:"success_rate",name:"Success Rate (%)",formula:"(success_count / total_count) * 100",description:"성공률 계산 템플릿",category:"percentage"},{id:"efficiency",name:"Efficiency (%)",formula:"(good_values / all_values) * 100",description:"효율성 계산 템플릿",category:"percentage"},{id:"delta",name:"Delta Calculation",formula:"current_value - previous_value",description:"변화량 계산 템플릿",category:"difference"},{id:"ratio",name:"Simple Ratio",formula:"numerator / denominator",description:"단순 비율 계산 템플릿",category:"ratio"}],_=[{symbol:"+",name:"더하기",example:"a + b"},{symbol:"-",name:"빼기",example:"a - b"},{symbol:"*",name:"곱하기",example:"a * b"},{symbol:"/",name:"나누기",example:"a / b"},{symbol:"%",name:"나머지",example:"a % b"},{symbol:"^",name:"거듭제곱",example:"a ^ 2"},{symbol:"()",name:"괄호",example:"(a + b) * c"},{symbol:"sqrt()",name:"제곱근",example:"sqrt(a)"},{symbol:"log()",name:"로그",example:"log(a)"},{symbol:"abs()",name:"절댓값",example:"abs(a)"},{symbol:"min()",name:"최솟값",example:"min(a, b)"},{symbol:"max()",name:"최댓값",example:"max(a, b)"}],c=r.useMemo(()=>u?y.filter(m=>{var x;return m.name.toLowerCase().includes(u.toLowerCase())||m.formula.toLowerCase().includes(u.toLowerCase())||((x=m.description)==null?void 0:x.toLowerCase().includes(u.toLowerCase()))}):y,[y,u]),D=r.useCallback(m=>{try{const x=[],b=[],F=(m.match(/\(/g)||[]).length,T=(m.match(/\)/g)||[]).length;F!==T&&x.push("괄호가 일치하지 않습니다");const q=m.replace(/\$\{[^}]+\}/g," ").match(/[a-zA-Z_][a-zA-Z0-9_]*/g)||[],se=[...a.map(B=>B.value),...y.filter(B=>B.active).map(B=>B.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase())],ie=q.filter(B=>!se.includes(B)&&!["sqrt","log","abs","min","max","if"].includes(B));if(ie.length>0&&b.push(`알 수 없는 PEG: ${ie.join(", ")}`),h){const B=h.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase();q.includes(B)&&x.push("수식이 자기 자신을 참조할 수 없습니다 (순환 참조)")}const O=m.replace(/\$\{[^}]+\}/g,"").match(/[^a-zA-Z0-9_+\-*/()^%.,\s]/g);O&&x.push(`지원하지 않는 문자: ${O.join(", ")}`);const R=q.filter(B=>a.some(S=>S.value===B)),U=q.filter(B=>y.some(S=>S.active&&S.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()===B));return{isValid:x.length===0,errors:x,warnings:b,dependencies:R,derivedDependencies:U}}catch{return{isValid:!1,errors:["수식 분석 중 오류가 발생했습니다"],warnings:[],dependencies:[],derivedDependencies:[]}}},[a,y,h]),A=r.useCallback(m=>{try{const x={};a.forEach(T=>{x[T.value]=Math.random()*100+50});let b=m;Object.keys(x).forEach(T=>{const q=new RegExp(`\\b${T}\\b`,"g");b=b.replace(q,x[T].toString())}),b=b.replace(/sqrt\(([^)]+)\)/g,"Math.sqrt($1)"),b=b.replace(/log\(([^)]+)\)/g,"Math.log($1)"),b=b.replace(/abs\(([^)]+)\)/g,"Math.abs($1)"),b=b.replace(/\^/g,"**");const F=Function(`"use strict"; return (${b})`)();return{success:!0,result:Number(F).toFixed(v.evaluationPrecision||4),mockData:x}}catch(x){return{success:!1,error:x.message}}},[a,v.evaluationPrecision]),j=()=>{const m={id:`formula_${Date.now()}`,name:"새 수식",formula:"",description:"",active:!0,category:"custom",unit:"",dependencies:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};o(m),g(m.id)},$=()=>{if(!h)return;const m=D(h.formula);if(!m.isValid){Q.error(`수식 저장 실패: ${m.errors.join(", ")}`);return}const x={...h,dependencies:m.dependencies,derivedDependencies:m.derivedDependencies||[],updatedAt:new Date().toISOString()},b=y.findIndex(T=>T.id===h.id);let F;b>=0?(F=[...y],F[b]=x):F=[...y,x],t({...s,formulas:F}),o(null),Q.success("수식이 저장되었습니다")},G=m=>{const x=y.filter(b=>b.id!==m);t({...s,formulas:x}),i===m&&g(null),(h==null?void 0:h.id)===m&&o(null),Q.success("수식이 삭제되었습니다")},w=m=>{h&&(o({...h,formula:m.formula,description:m.description,category:m.category}),Q.success(`템플릿 "${m.name}"이 적용되었습니다`))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(re,{children:[e.jsx(he,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-5 w-5"}),"Derived PEG 관리"]})}),e.jsx(ne,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rs,{id:"auto-validate",checked:v.autoValidate,onCheckedChange:m=>t({...s,settings:{...v,autoValidate:m}})}),e.jsx(W,{htmlFor:"auto-validate",children:"실시간 검증"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rs,{id:"show-dashboard",checked:v.showInDashboard,onCheckedChange:m=>t({...s,settings:{...v,showInDashboard:m}})}),e.jsx(W,{htmlFor:"show-dashboard",children:"Dashboard에 표시"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rs,{id:"show-statistics",checked:v.showInStatistics,onCheckedChange:m=>t({...s,settings:{...v,showInStatistics:m}})}),e.jsx(W,{htmlFor:"show-statistics",children:"Statistics에 표시"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"계산 정밀도"}),e.jsxs(Ee,{value:(E=v.evaluationPrecision)==null?void 0:E.toString(),onValueChange:m=>t({...s,settings:{...v,evaluationPrecision:parseInt(m)}}),children:[e.jsx($e,{children:e.jsx(Pe,{})}),e.jsxs(Ae,{children:[e.jsx(le,{value:"2",children:"소수점 2자리"}),e.jsx(le,{value:"4",children:"소수점 4자리"}),e.jsx(le,{value:"6",children:"소수점 6자리"})]})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(re,{children:[e.jsxs(he,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(xe,{children:"수식 목록"}),e.jsxs(J,{onClick:j,size:"sm",children:[e.jsx(dr,{className:"h-4 w-4 mr-2"}),"새 수식"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(js,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(ve,{placeholder:"수식 검색...",className:"pl-8",value:u,onChange:m=>d(m.target.value)})]})]}),e.jsx(ne,{children:e.jsx(bs,{className:"h-96",children:e.jsx("div",{className:"space-y-2",children:c.map(m=>e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${i===m.id?"bg-blue-50 border-blue-200":"hover:bg-gray-50"}`,onClick:()=>g(m.id),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:m.name}),e.jsx(Z,{variant:m.active?"default":"secondary",className:"text-xs",children:m.active?"활성":"비활성"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1 font-mono",children:m.formula}),m.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:m.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(Z,{variant:"outline",className:"text-xs",children:m.category}),m.unit&&e.jsx(Z,{variant:"outline",className:"text-xs",children:m.unit})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[e.jsx(J,{variant:"ghost",size:"sm",onClick:x=>{x.stopPropagation(),o({...m})},children:e.jsx(Ks,{className:"h-3 w-3"})}),e.jsx(J,{variant:"ghost",size:"sm",onClick:x=>{x.stopPropagation(),G(m.id)},children:e.jsx(Ts,{className:"h-3 w-3"})})]})]})},m.id))})})})]}),e.jsxs(re,{children:[e.jsx(he,{children:e.jsx(xe,{children:h?"수식 편집":"수식 상세"})}),e.jsx(ne,{children:h?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"formula-name",children:"수식 이름"}),e.jsx(ve,{id:"formula-name",value:h.name,onChange:m=>o({...h,name:m.target.value}),placeholder:"예: RACH Success Rate (%)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"formula-input",children:"수식"}),e.jsx(fn,{id:"formula-input",value:h.formula,onChange:m=>{o({...h,formula:m.target.value}),v.autoValidate&&P(D(m.target.value))},placeholder:"예: (randomaccesspremable / randomaccessresponse) * 100",className:"font-mono text-sm",rows:4}),f&&e.jsxs("div",{className:"space-y-2",children:[f.isValid?e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(Ms,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"수식이 유효합니다"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:f.errors.join(", ")})]}),f.warnings.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:f.warnings.join(", ")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"formula-description",children:"설명"}),e.jsx(ve,{id:"formula-description",value:h.description,onChange:m=>o({...h,description:m.target.value}),placeholder:"수식에 대한 설명을 입력하세요"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"formula-category",children:"카테고리"}),e.jsxs(Ee,{value:h.category,onValueChange:m=>o({...h,category:m}),children:[e.jsx($e,{children:e.jsx(Pe,{})}),e.jsxs(Ae,{children:[e.jsx(le,{value:"percentage",children:"비율 (%)"}),e.jsx(le,{value:"success_rate",children:"성공률"}),e.jsx(le,{value:"efficiency",children:"효율성"}),e.jsx(le,{value:"quality",children:"품질"}),e.jsx(le,{value:"performance",children:"성능"}),e.jsx(le,{value:"custom",children:"사용자 정의"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"formula-unit",children:"단위"}),e.jsx(ve,{id:"formula-unit",value:h.unit,onChange:m=>o({...h,unit:m.target.value}),placeholder:"예: %, ms, Mbps"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rs,{id:"formula-active",checked:h.active,onCheckedChange:m=>o({...h,active:m})}),e.jsx(W,{htmlFor:"formula-active",children:"수식 활성화"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(J,{onClick:()=>{const m=D(h.formula);P(m);const x=A(h.formula);p(x)},children:[e.jsx(zs,{className:"h-4 w-4 mr-2"}),"테스트"]}),e.jsxs(J,{onClick:$,disabled:n,children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"저장"]}),e.jsxs(J,{variant:"outline",onClick:()=>o(null),children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"취소"]})]}),l&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(xs,{}),e.jsx("h4",{className:"font-medium",children:"테스트 결과"}),l.success?e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-green-700",children:e.jsxs("strong",{children:["결과: ",l.result]})}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"모의 데이터를 사용한 계산 결과입니다"})]}):e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-700",children:["오류: ",l.error]})})]})]}):i?e.jsx("div",{className:"space-y-4",children:(()=>{const m=y.find(x=>x.id===i);return m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:m.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:m.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"수식"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg font-mono text-sm",children:m.formula})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(W,{className:"text-xs",children:"카테고리"}),e.jsx("p",{className:"text-sm",children:m.category})]}),e.jsxs("div",{children:[e.jsx(W,{className:"text-xs",children:"단위"}),e.jsx("p",{className:"text-sm",children:m.unit||"없음"})]})]}),(m.dependencies&&m.dependencies.length>0||m.derivedDependencies&&m.derivedDependencies.length>0)&&e.jsxs("div",{className:"space-y-2",children:[m.dependencies&&m.dependencies.length>0&&e.jsxs("div",{children:[e.jsxs(W,{className:"text-xs flex items-center gap-1",children:[e.jsx(We,{className:"h-3 w-3"}),"기본 PEG 의존성"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:m.dependencies.map(x=>e.jsx(Z,{variant:"outline",className:"text-xs",children:x},x))})]}),m.derivedDependencies&&m.derivedDependencies.length>0&&e.jsxs("div",{children:[e.jsxs(W,{className:"text-xs flex items-center gap-1",children:[e.jsx(Qe,{className:"h-3 w-3"}),"Derived PEG 의존성"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:m.derivedDependencies.map(x=>e.jsx(Z,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700",children:x},x))})]})]}),e.jsxs(J,{onClick:()=>o({...m}),className:"w-full",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"편집"]})]}):e.jsx("p",{children:"수식을 찾을 수 없습니다."})})()}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Qe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"수식을 선택하거나 새로 만들어보세요"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(re,{children:[e.jsx(he,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(mr,{className:"h-5 w-5"}),"템플릿 라이브러리"]})}),e.jsx(ne,{children:e.jsx("div",{className:"space-y-2",children:k.map(m=>e.jsx("div",{className:"p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>w(m),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",children:m.name}),e.jsx("p",{className:"text-xs font-mono text-muted-foreground",children:m.formula}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:m.description})]}),e.jsx(J,{variant:"ghost",size:"sm",children:e.jsx(ur,{className:"h-3 w-3"})})]})},m.id))})})]}),e.jsxs(re,{children:[e.jsx(he,{children:e.jsx(xe,{children:"지원 연산자"})}),e.jsx(ne,{children:e.jsx(bs,{className:"h-64",children:e.jsx("div",{className:"space-y-2",children:_.map((m,x)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("code",{className:"font-mono font-medium",children:m.symbol}),e.jsx("span",{className:"text-sm text-muted-foreground ml-2",children:m.name})]}),e.jsx("code",{className:"text-xs text-muted-foreground",children:m.example})]},x))})})})]})]}),e.jsxs(re,{children:[e.jsxs(he,{children:[e.jsx(xe,{children:"사용 가능한 PEG"}),e.jsx(Ns,{children:"수식에 사용할 수 있는 기본 PEG와 생성된 Derived PEG 목록입니다"})]}),e.jsx(ne,{children:e.jsxs("div",{className:"space-y-4",children:[a.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4"}),"기본 PEG (",a.length,"개)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.map(m=>e.jsx(J,{variant:"outline",size:"sm",onClick:()=>{h&&o({...h,formula:h.formula+m.value})},className:"text-xs",children:m.label||m.value},m.value))})]}),y.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),"Derived PEG (",y.filter(m=>m.active).length,"개)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:y.filter(m=>m.active).map(m=>e.jsxs(J,{variant:"outline",size:"sm",onClick:()=>{if(h){const x=`${m.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()}`;o({...h,formula:h.formula+x})}},className:"text-xs bg-blue-50 border-blue-200 hover:bg-blue-100",title:m.description,children:[e.jsx(Qe,{className:"h-3 w-3 mr-1"}),m.name,m.unit&&e.jsxs("span",{className:"ml-1 text-muted-foreground",children:["(",m.unit,")"]})]},m.id))}),y.filter(m=>m.active).length===0&&e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(Qe,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"아직 생성된 Derived PEG가 없습니다"}),e.jsx("p",{className:"text-xs",children:"새 수식을 추가하고 활성화하면 여기에 표시됩니다"})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-sm text-blue-700 mb-1",children:"💡 사용법"}),e.jsxs("ul",{className:"text-xs text-blue-600 space-y-1",children:[e.jsx("li",{children:"• 기본 PEG: 클릭하면 수식에 바로 삽입됩니다"}),e.jsx("li",{children:"• Derived PEG: 다른 수식에서 참조할 수 있는 계산된 값입니다"}),e.jsx("li",{children:"• 비활성화된 Derived PEG는 목록에 표시되지 않습니다"}),e.jsx("li",{children:"• Derived PEG끼리 순환 참조하지 않도록 주의하세요"})]})]})]})})]})]})};function jn(s=[]){return s.map(t=>({value:t.value,label:t.label,type:t.type,color:t.type==="derived"?"#3b82f6":"#6b7280",isDerived:t.type==="derived",description:t.description,formula:t.formula}))}const qt=()=>{var se,ie,O,R,U,B,S,M,C,K,H,V,Y,de,me,ke,ae,fe,be,ce,ye;const{settings:s,isLoading:t,isSaving:a,error:n,lastSaved:i,updateSettings:g,saveSettings:h,resetSettings:o}=Ye(),[u,d]=r.useState([]),[f,P]=r.useState(!1),[l,p]=r.useState(null),y=r.useCallback(async()=>{var z,I;try{P(!0),console.info("[PreferenceManager] Fetching DB PEGs");const L=(s==null?void 0:s.databaseSettings)||{};if(!L.host){console.warn("[PreferenceManager] No DB config found");return}const ue=await ge.post("/api/master/pegs",{host:String(L.host).trim(),port:Number(L.port)||5432,user:String(L.user||"").trim(),password:String(L.password||"").trim(),dbname:String(L.dbname||"").trim(),table:String(L.table||"summary").trim(),limit:500}),X=((z=ue==null?void 0:ue.data)==null?void 0:z.pegs)||(Array.isArray((I=ue==null?void 0:ue.data)==null?void 0:I.items)?ue.data.items.map(pe=>({id:pe,name:pe})):Array.isArray(ue==null?void 0:ue.data)?ue.data.map(pe=>({id:pe,name:pe})):[]);console.info("[PreferenceManager] DB PEGs loaded:",X.length);const Ne=X.map(pe=>({value:pe.id||pe.name||pe.peg_name,label:String(pe.name||pe.id||pe.peg_name)}));d(Ne),p(new Date)}catch(L){console.error("[PreferenceManager] Error fetching DB PEGs:",L)}finally{P(!1)}},[s==null?void 0:s.databaseSettings]),v=r.useCallback(()=>{const z=jn(u);return console.log("✅ 최종 PEG 옵션:",z),z},[u]),k=JSON.stringify({host:(se=s==null?void 0:s.databaseSettings)==null?void 0:se.host,port:(ie=s==null?void 0:s.databaseSettings)==null?void 0:ie.port,user:(O=s==null?void 0:s.databaseSettings)==null?void 0:O.user,dbname:(R=s==null?void 0:s.databaseSettings)==null?void 0:R.dbname,table:(U=s==null?void 0:s.databaseSettings)==null?void 0:U.table});r.useEffect(()=>{y()},[y,k]);const _=[{key:"selectedPegs",label:"Dashboard에 표시할 PEG 목록",type:"multiselect",required:!1,options:v(),placeholder:"Database PEG에서 선택하세요"},{key:"chartLayout",label:"그래프 정렬 방식",type:"select",options:[{value:"byPeg",label:"PEG별 (PEG마다 Cell/NE 시리즈)"},{value:"byEntity",label:"Cell/NE별 (엔터티마다 PEG 시리즈)"}]}],[c,D]=r.useState([]),[A,j]=r.useState([]),[$,G]=r.useState([]),[w,E]=r.useState([]),[m,x]=r.useState([]),[b,F]=r.useState([]);r.useEffect(()=>{const z=(s==null?void 0:s.statisticsSettings)||{};j(Array.isArray(z.selectedHosts)?z.selectedHosts:[]),E(Array.isArray(z.selectedNEs)?z.selectedNEs:[]),F(Array.isArray(z.selectedCellIds)?z.selectedCellIds:[])},[s==null?void 0:s.statisticsSettings]),r.useEffect(()=>{(async()=>{var I;try{const L=(s==null?void 0:s.databaseSettings)||{};if(!L.host)return;const ue={host:String(L.host||"").trim(),port:Number(L.port)||5432,user:String(L.user||"").trim(),password:String(L.password||"").trim(),dbname:String(L.dbname||"").trim(),table:String(L.table||"summary").trim()},X=await ge.post("/api/master/hosts",ue);D(Array.isArray((I=X==null?void 0:X.data)==null?void 0:I.hosts)?X.data.hosts:[])}catch(L){console.error("[PreferenceManager] HOST 목록 조회 실패",L)}})()},[(B=s==null?void 0:s.databaseSettings)==null?void 0:B.host,(S=s==null?void 0:s.databaseSettings)==null?void 0:S.port,(M=s==null?void 0:s.databaseSettings)==null?void 0:M.user,(C=s==null?void 0:s.databaseSettings)==null?void 0:C.password,(K=s==null?void 0:s.databaseSettings)==null?void 0:K.dbname,(H=s==null?void 0:s.databaseSettings)==null?void 0:H.table]),r.useEffect(()=>{(async()=>{var I;try{const L=(s==null?void 0:s.databaseSettings)||{};if(!L.host||A.length===0){G([]);return}const ue={host:String(L.host||"").trim(),port:Number(L.port)||5432,user:String(L.user||"").trim(),password:String(L.password||"").trim(),dbname:String(L.dbname||"").trim(),table:String(L.table||"summary").trim(),hosts:A},X=await ge.post("/api/master/nes-by-host",ue);G(Array.isArray((I=X==null?void 0:X.data)==null?void 0:I.nes)?X.data.nes:[])}catch(L){console.error("[PreferenceManager] NE 목록 조회 실패",L)}})()},[A,s==null?void 0:s.databaseSettings]),r.useEffect(()=>{(async()=>{var I;try{const L=(s==null?void 0:s.databaseSettings)||{};if(!L.host||A.length===0||w.length===0){x([]);return}const ue={host:String(L.host||"").trim(),port:Number(L.port)||5432,user:String(L.user||"").trim(),password:String(L.password||"").trim(),dbname:String(L.dbname||"").trim(),table:String(L.table||"summary").trim(),hosts:A,nes:w},X=await ge.post("/api/master/cells-by-host-ne",ue);x(Array.isArray((I=X==null?void 0:X.data)==null?void 0:I.cellids)?X.data.cellids:[])}catch(L){console.error("[PreferenceManager] CellID 목록 조회 실패",L)}})()},[w,A,s==null?void 0:s.databaseSettings]);const T=[{key:"host",label:"Host",type:"text",placeholder:"예: 127.0.0.1"},{key:"port",label:"Port",type:"number",min:1,max:65535,placeholder:"5432"},{key:"user",label:"User",type:"text",placeholder:"postgres"},{key:"password",label:"Password",type:"text",placeholder:"비밀번호"},{key:"dbname",label:"DB Name",type:"text",placeholder:"postgres"},{key:"table",label:"기본 테이블명",type:"text",placeholder:"summary"}],q=[{key:"enableNotifications",label:"알림 활성화",type:"switch"},{key:"emailNotifications",label:"이메일 알림",type:"switch"},{key:"soundEnabled",label:"소리 알림",type:"switch"},{key:"notificationFrequency",label:"알림 빈도",type:"select",options:[{value:"immediate",label:"즉시"},{value:"hourly",label:"매시간"},{value:"daily",label:"매일"},{value:"weekly",label:"매주"}]}];return t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"환경설정"}),e.jsxs(Z,{variant:"secondary",className:"text-xs",children:[e.jsx(Be,{className:"h-3 w-3 mr-1"}),"로딩 중..."]})]}),e.jsx(re,{children:e.jsx(ne,{className:"pt-6",children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"설정을 불러오는 중입니다..."})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"환경설정"}),e.jsx("p",{className:"text-muted-foreground",children:"Dashboard와 Statistics의 동작을 설정할 수 있습니다"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a&&e.jsxs(Z,{variant:"secondary",className:"text-xs",children:[e.jsx(Be,{className:"h-3 w-3 mr-1"}),"저장 중..."]}),n&&e.jsx(Z,{variant:"destructive",className:"text-xs",children:"오류 발생"}),i&&e.jsxs(Z,{variant:"outline",className:"text-xs",children:["마지막 저장: ",new Date(i).toLocaleTimeString()]})]})]}),e.jsxs(ws,{defaultValue:"dashboard",className:"w-full",children:[e.jsxs(Ss,{className:"grid w-full grid-cols-6",children:[e.jsxs(De,{value:"dashboard",className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),"Dashboard"]}),e.jsxs(De,{value:"statistics",className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4"}),"Statistics"]}),e.jsxs(De,{value:"database",className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4"}),"Database"]}),e.jsxs(De,{value:"derived-peg",className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),"Derived PEG"]}),e.jsxs(De,{value:"notifications",className:"flex items-center gap-2",children:[e.jsx(hr,{className:"h-4 w-4"}),"알림"]}),e.jsxs(De,{value:"backup",className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-4 w-4"}),"백업/복원"]})]}),e.jsxs(_e,{value:"dashboard",className:"space-y-6",children:[e.jsxs(re,{children:[e.jsx(he,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-5 w-5"}),"PEG 데이터 소스"]})}),e.jsx(ne,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"PEG 데이터 소스"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Database Settings에서 연결된 실제 PEG 목록을 사용합니다"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(J,{variant:"outline",size:"sm",onClick:y,disabled:f,children:[e.jsx(os,{className:`h-3 w-3 ${f?"animate-spin":""}`}),"새로고침"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"사용 가능한 PEG"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[u.length,"개"]})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"마지막 업데이트"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l?l.toLocaleTimeString():"없음"})]})]}),u.length===0&&!f&&e.jsx("div",{className:"p-3 border rounded-lg bg-amber-50 border-amber-200",children:e.jsx("p",{className:"text-sm text-amber-700",children:"⚠️ DB PEG를 불러올 수 없습니다. Database Settings에서 DB 연결을 확인하세요."})}),u.length>0&&e.jsx("div",{className:"p-3 border rounded-lg bg-green-50 border-green-200",children:e.jsxs("p",{className:"text-sm text-green-700",children:["✅ ",u.length,"개의 실제 DB PEG를 사용할 수 있습니다"]})})]})})]}),e.jsx(As,{title:"Dashboard 설정",description:"DB에서 연동된 PEG만 선택하여 표시합니다",settingKey:"dashboardSettings",fields:_,defaultOpen:!0,showResetButton:!0,showSaveButton:!1},`dashboard-settings-${u.length}-${l?l.getTime():0}`),e.jsx("div",{className:"flex items-center justify-end gap-2",children:e.jsx(J,{size:"sm",onClick:async()=>{try{await h(),alert("Dashboard 설정이 저장되었습니다")}catch(z){alert("저장 실패: "+((z==null?void 0:z.message)||"알 수 없는 오류"))}},disabled:a,children:a?"저장 중...":"저장"})})]}),e.jsx(_e,{value:"statistics",className:"space-y-6",children:e.jsxs(re,{children:[e.jsx(he,{children:e.jsx(xe,{children:"데이터 선택 (HOST → NE → CellID)"})}),e.jsxs(ne,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(W,{className:"block mb-2",children:"HOST (다중 선택)"}),e.jsx("select",{multiple:!0,className:"w-full border rounded p-2 h-48",value:A,onChange:z=>{const I=Array.from(z.target.selectedOptions).map(L=>L.value);j(I)},children:c.map(z=>e.jsx("option",{value:z,children:z},z))})]}),e.jsxs("div",{children:[e.jsx(W,{className:"block mb-2",children:"NE (다중 선택)"}),e.jsx("select",{multiple:!0,className:"w-full border rounded p-2 h-48",value:w,onChange:z=>{const I=Array.from(z.target.selectedOptions).map(L=>L.value);E(I)},children:$.map(z=>e.jsx("option",{value:z,children:z},z))})]}),e.jsxs("div",{children:[e.jsx(W,{className:"block mb-2",children:"CellID (다중 선택)"}),e.jsx("select",{multiple:!0,className:"w-full border rounded p-2 h-48",value:b,onChange:z=>{const I=Array.from(z.target.selectedOptions).map(L=>L.value);F(I)},children:m.map(z=>e.jsx("option",{value:z,children:z},z))})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsxs("div",{className:"mb-1",children:["HOST: ",A.length,"개"]}),e.jsxs("div",{className:"mb-1",children:["NE: ",w.length,"개"]}),e.jsxs("div",{children:["CellID: ",b.length,"개"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(J,{size:"sm",onClick:async()=>{try{g({statisticsSettings:{...(s==null?void 0:s.statisticsSettings)||{},selectedHosts:A,selectedNEs:w,selectedCellIds:b}}),await h(),alert("Statistics 설정이 저장되었습니다")}catch(z){alert("저장 실패: "+((z==null?void 0:z.message)||"알 수 없는 오류"))}},disabled:a,children:a?"저장 중...":"저장"})})]})]})]})}),e.jsxs(_e,{value:"database",className:"space-y-6",children:[e.jsx(As,{title:"Database 설정",description:"LLM 분석과 Statistics에서 공통으로 사용할 PostgreSQL DB 설정입니다 (테이블명 포함).",settingKey:"databaseSettings",fields:T,defaultOpen:!0,showResetButton:!0,showSaveButton:!1}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(J,{size:"sm",onClick:async()=>{try{await h(),alert("Database 설정이 저장되었습니다")}catch(z){alert("저장 실패: "+((z==null?void 0:z.message)||"알 수 없는 오류"))}},disabled:a,children:a?"저장 중...":"저장"}),e.jsx(J,{size:"sm",onClick:async()=>{var z,I,L,ue;try{const X=(s==null?void 0:s.databaseSettings)||{},Ne=await ge.post("/api/master/test-connection",{host:(X.host||"").trim(),port:Number(X.port)||5432,user:(X.user||"").trim(),password:(X.password||"").trim(),dbname:(X.dbname||"").trim(),table:(X.table||"summary").trim()}),pe=(z=Ne==null?void 0:Ne.data)==null?void 0:z.success;alert(pe?"DB 연결 성공. table_exists="+((I=Ne==null?void 0:Ne.data)==null?void 0:I.table_exists):"DB 연결 실패: 응답 형식 확인 필요")}catch(X){alert("DB 연결 실패: "+(((ue=(L=X==null?void 0:X.response)==null?void 0:L.data)==null?void 0:ue.detail)||(X==null?void 0:X.message)))}},children:"Test Connection"})]})]}),e.jsx(_e,{value:"derived-peg",className:"space-y-6",children:e.jsx(pn,{derivedPegSettings:(s==null?void 0:s.derivedPegSettings)||{formulas:[],settings:{}},updateDerivedPegSettings:z=>{g({derivedPegSettings:z})},availablePegs:v(),saving:a})}),e.jsx(_e,{value:"notifications",className:"space-y-6",children:e.jsx(As,{title:"알림 설정",description:"이메일, 소리 알림 등 알림 관련 설정을 관리합니다",settingKey:"notificationSettings",fields:q,defaultOpen:!0,showResetButton:!0,showSaveButton:!1})}),e.jsxs(_e,{value:"backup",className:"space-y-6",children:[e.jsx(gn,{title:"설정 백업 및 복원",description:"모든 환경설정을 JSON 파일로 내보내거나 백업 파일에서 복원할 수 있습니다",defaultOpen:!0}),e.jsxs(re,{children:[e.jsxs(he,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Ls,{className:"h-5 w-5 text-orange-500"}),"설정 초기화"]}),e.jsx(Ns,{children:"Dashboard, Statistics, Database 설정을 기본값으로 초기화합니다. 이 작업은 되돌릴 수 없습니다."})]}),e.jsxs(ne,{className:"space-y-4",children:[e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-md p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Is,{className:"h-5 w-5 text-orange-500 mt-0.5"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-orange-800",children:"주의사항"}),e.jsxs("ul",{className:"text-sm text-orange-700 space-y-1",children:[e.jsx("li",{children:"• Dashboard의 선택된 PEG 목록이 초기화됩니다"}),e.jsx("li",{children:"• Statistics의 기본 설정이 초기화됩니다"}),e.jsx("li",{children:"• Database 연결 설정이 기본값으로 초기화됩니다"}),e.jsx("li",{children:"• 이 작업은 되돌릴 수 없습니다"})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"초기화할 설정"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Dashboard, Statistics, Database 설정을 기본값으로 초기화"})]}),e.jsx(J,{variant:"destructive",size:"sm",onClick:async()=>{if(window.confirm(`정말로 Dashboard, Statistics, Database 설정을 초기화하시겠습니까?

이 작업은 되돌릴 수 없습니다.`))try{const I=await o(["dashboardSettings","statisticsSettings","databaseSettings"]);I.success?alert("✅ 설정이 성공적으로 초기화되었습니다!"):alert("❌ 설정 초기화 실패: "+(I.error||"알 수 없는 오류"))}catch(I){alert("❌ 설정 초기화 중 오류 발생: "+I.message)}},disabled:t,children:t?e.jsxs(e.Fragment,{children:[e.jsx(ms,{className:"h-4 w-4 mr-2 animate-spin"}),"초기화 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ls,{className:"h-4 w-4 mr-2"}),"설정 초기화"]})})]})]})]})]})]}),e.jsxs(re,{children:[e.jsx(he,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-5 w-5"}),"현재 설정 요약"]})}),e.jsx(ne,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Dashboard"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["선택된 PEG: ",((Y=(V=s==null?void 0:s.dashboardSettings)==null?void 0:V.selectedPegs)==null?void 0:Y.length)||0,"개"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["PEG 소스: ",`DB (${u.length}개)`]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["차트 스타일: ",((de=s==null?void 0:s.dashboardSettings)==null?void 0:de.chartStyle)||"line"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["자동 새로고침: ",((me=s==null?void 0:s.dashboardSettings)==null?void 0:me.autoRefreshInterval)||0,"초"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Statistics"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["기본 기간: ",((ke=s==null?void 0:s.statisticsSettings)==null?void 0:ke.defaultDateRange)||7,"일"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["소수점: ",((ae=s==null?void 0:s.statisticsSettings)==null?void 0:ae.decimalPlaces)||2,"자리"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["비교 옵션: ",(fe=s==null?void 0:s.statisticsSettings)!=null&&fe.showComparisonOptions?"활성":"비활성"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"알림"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["알림: ",(be=s==null?void 0:s.notificationSettings)!=null&&be.enableNotifications?"활성":"비활성"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["이메일: ",(ce=s==null?void 0:s.notificationSettings)!=null&&ce.emailNotifications?"활성":"비활성"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["소리: ",(ye=s==null?void 0:s.notificationSettings)!=null&&ye.soundEnabled?"활성":"비활성"]})]})]})]})})]})]})},Wt=Object.freeze(Object.defineProperty({__proto__:null,default:qt},Symbol.toStringTag,{value:"Module"}));function vn({className:s,...t}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:te("w-full caption-bottom text-sm",s),...t})})}function bn({className:s,...t}){return e.jsx("thead",{"data-slot":"table-header",className:te("[&_tr]:border-b",s),...t})}function yn({className:s,...t}){return e.jsx("tbody",{"data-slot":"table-body",className:te("[&_tr:last-child]:border-0",s),...t})}function tt({className:s,...t}){return e.jsx("tr",{"data-slot":"table-row",className:te("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",s),...t})}function Ue({className:s,...t}){return e.jsx("th",{"data-slot":"table-head",className:te("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}function Ke({className:s,...t}){return e.jsx("td",{"data-slot":"table-cell",className:te("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}function at({...s}){return e.jsx(Ha,{"data-slot":"alert-dialog",...s})}function rt({...s}){return e.jsx(qa,{"data-slot":"alert-dialog-trigger",...s})}function Nn({...s}){return e.jsx(Xa,{"data-slot":"alert-dialog-portal",...s})}function wn({className:s,...t}){return e.jsx(er,{"data-slot":"alert-dialog-overlay",className:te("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...t})}function nt({className:s,...t}){return e.jsxs(Nn,{children:[e.jsx(wn,{}),e.jsx(Wa,{"data-slot":"alert-dialog-content",className:te("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",s),...t})]})}function lt({className:s,...t}){return e.jsx("div",{"data-slot":"alert-dialog-header",className:te("flex flex-col gap-2 text-center sm:text-left",s),...t})}function it({className:s,...t}){return e.jsx("div",{"data-slot":"alert-dialog-footer",className:te("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",s),...t})}function ct({className:s,...t}){return e.jsx(Ya,{"data-slot":"alert-dialog-title",className:te("text-lg font-semibold",s),...t})}function ot({className:s,...t}){return e.jsx(Ja,{"data-slot":"alert-dialog-description",className:te("text-muted-foreground text-sm",s),...t})}function dt({className:s,...t}){return e.jsx(Qa,{className:te(Bs(),s),...t})}function mt({className:s,...t}){return e.jsx(Za,{className:te(Bs({variant:"outline"}),s),...t})}const Sn=({initialLimit:s=20,autoFetch:t=!0,initialFilters:a={}}={})=>{const[n,i]=r.useState([]),[g,h]=r.useState(!1),[o,u]=r.useState(null),[d,f]=r.useState(!0),[P,l]=r.useState({limit:s,skip:0,total:0}),[p,y]=r.useState({neId:"ALL",cellId:"ALL",startDate:null,endDate:null,status:"",...a}),v=r.useCallback((x,b={})=>{console.log(`[useAnalysisResults] ${x}`,b)},[]),k=r.useCallback((x,b)=>{console.error(`[useAnalysisResults] ${x}`,b)},[]),_=r.useCallback(async({limit:x=P.limit,skip:b=0,append:F=!1,showToast:T=!0}={})=>{var q,se,ie,O,R,U,B,S,M,C,K;try{h(!0),u(null),v("분석 결과 조회 시작",{limit:x,skip:b,filters:p});const H={limit:x,skip:b};(q=p.neId)!=null&&q.trim()&&(H.ne_id=p.neId.trim()),(se=p.cellId)!=null&&se.trim()&&(H.cell_id=p.cellId.trim()),p.startDate&&(H.date_from=p.startDate),p.endDate&&(H.date_to=p.endDate),(ie=p.status)!=null&&ie.trim()&&(H.status=p.status.trim());const V=await ge.get("/api/analysis/results",{params:H});v("분석 결과 조회 성공",{resultCount:((R=(O=V.data)==null?void 0:O.items)==null?void 0:R.length)||0,total:((U=V.data)==null?void 0:U.total)||0,totalRequested:x});const de=(((B=V.data)==null?void 0:B.items)||[]).filter(me=>((me==null?void 0:me.analysis_type)||(me==null?void 0:me.analysisType))==="llm_analysis");return i(F?me=>[...me,...de]:de),l(me=>{var ke;return{...me,skip:F?me.skip+de.length:b+de.length,total:((ke=V.data)==null?void 0:ke.total)||0}}),f(((S=V.data)==null?void 0:S.has_next)||!1),T&&!F&&Q.success(`${de.length}개의 분석 결과를 불러왔습니다.`),de}catch(H){const V=((K=(C=(M=H==null?void 0:H.response)==null?void 0:M.data)==null?void 0:C.error)==null?void 0:K.message)||(H==null?void 0:H.message)||"분석 결과를 불러오는 중 오류가 발생했습니다.";return k("분석 결과 조회 실패",H),u(V),T&&Q.error(`데이터 조회 실패: ${V}`),[]}finally{h(!1)}},[P.limit,p,v,k]),c=r.useCallback(x=>{v("필터 업데이트",{이전:p,새로운:x}),y(b=>({...b,...x})),l(b=>({...b,skip:0}))},[p,v]),D=r.useCallback(()=>{v("필터 초기화"),y({neId:"",cellId:"",startDate:null,endDate:null,status:""}),l(x=>({...x,skip:0}))},[v]),A=r.useCallback(async()=>{if(g||!d){v("추가 로딩 건너뜀",{loading:g,hasMore:d});return}v("추가 결과 로딩 시작"),await _({skip:P.skip,append:!0,showToast:!1})},[g,d,_,P.skip,v]),j=r.useCallback(async()=>{v("데이터 새로고침 시작"),l(x=>({...x,skip:0})),await _({skip:0,append:!1})},[_,v]),$=r.useCallback(async x=>{var b,F,T;try{v("분석 결과 삭제 시작",{resultId:x}),await ge.delete(`/api/analysis/results/${x}`),i(q=>q.filter(se=>se.id!==x)),v("분석 결과 삭제 성공",{resultId:x}),Q.success("분석 결과가 삭제되었습니다.")}catch(q){const se=((T=(F=(b=q==null?void 0:q.response)==null?void 0:b.data)==null?void 0:F.error)==null?void 0:T.message)||(q==null?void 0:q.message)||"분석 결과 삭제 중 오류가 발생했습니다.";k("분석 결과 삭제 실패",q),Q.error(`삭제 실패: ${se}`)}},[v,k]);r.useEffect(()=>{t&&(v("컴포넌트 마운트 - 자동 데이터 조회 시작"),_({skip:0,append:!1,showToast:!1}))},[t]),r.useEffect(()=>{t&&(v("필터 변경 감지 - 데이터 재조회"),_({skip:0,append:!1,showToast:!1}))},[t,p,_,v]);const G=r.useMemo(()=>!g&&n.length===0,[g,n.length]),w=r.useMemo(()=>Object.values(p).some(x=>x!=null&&x!==""),[p]),E=r.useMemo(()=>n.length,[n.length]),m=r.useMemo(()=>({resultCount:E,loading:g,hasMore:d,isEmpty:G,isFiltered:w,pagination:P,filters:p,error:o}),[E,g,d,G,w,P,p,o]);return r.useEffect(()=>{},[m]),{results:n,loading:g,error:o,isEmpty:G,hasMore:d,isFiltered:w,resultCount:E,pagination:P,filters:p,updateFilters:c,clearFilters:D,fetchResults:_,refresh:j,loadMore:A,deleteResult:$,debugInfo:m}},Cn=({filters:s={},onFilterChange:t,onClearFilters:a,isCollapsed:n=!1,onToggleCollapse:i,showActiveCount:g=!0})=>{const h=r.useCallback((j,$={})=>{console.log(`[ResultFilter] ${j}`,$)},[]),{neId:o="",cellId:u="",startDate:d=null,endDate:f=null,status:P=""}=s,l={...o&&{"NE ID":o},...u&&{"Cell ID":u},...d&&{시작일:new Date(d).toLocaleDateString("ko-KR")},...f&&{종료일:new Date(f).toLocaleDateString("ko-KR")},...P&&{상태:P}},p=Object.keys(l).length,y=p>0,v=r.useCallback((j,$)=>{h("필터 변경",{key:j,value:$}),t&&t(j,$)},[t,h]),k=r.useCallback(j=>{h("개별 필터 초기화",{key:j}),v(j,j==="startDate"||j==="endDate"?null:"")},[v,h]),_=r.useCallback(()=>{h("전체 필터 초기화"),a&&a()},[a,h]),c=r.useCallback(j=>{if(!j)return"";try{return new Date(j).toISOString().split("T")[0]}catch{return""}},[]),D=r.useCallback(j=>{if(!j)return null;try{return new Date(j).toISOString()}catch{return null}},[]),A=r.useCallback(()=>{h("필터 패널 토글",{isCollapsed:!n}),i&&i()},[n,i,h]);return e.jsxs(re,{className:"w-full",children:[e.jsxs(he,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(xe,{className:"text-lg flex items-center gap-2",children:[e.jsx(Fs,{className:"h-5 w-5"}),"필터"]}),g&&y&&e.jsxs(Z,{variant:"secondary",className:"text-xs",children:[p,"개 활성"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[y&&e.jsxs(J,{variant:"ghost",size:"sm",onClick:_,className:"text-destructive hover:text-destructive",children:[e.jsx(Le,{className:"h-4 w-4 mr-1"}),"전체 초기화"]}),e.jsx(J,{variant:"ghost",size:"sm",onClick:A,children:n?e.jsx(Xe,{className:"h-4 w-4"}):e.jsx(ys,{className:"h-4 w-4"})})]})]}),y&&!n&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:Object.entries(l).map(([j,$])=>e.jsxs(Z,{variant:"outline",className:"flex items-center gap-1 pr-1",children:[e.jsxs("span",{className:"text-xs",children:[j,": ",$]}),e.jsx(J,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 hover:bg-destructive hover:text-destructive-foreground",onClick:()=>{const w={"NE ID":"neId","Cell ID":"cellId",시작일:"startDate",종료일:"endDate",상태:"status"}[j];w&&k(w)},children:e.jsx(Le,{className:"h-3 w-3"})})]},j))})]}),!n&&e.jsxs(ne,{className:"pt-0",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(W,{htmlFor:"filter-ne",className:"flex items-center gap-2",children:[e.jsx(xr,{className:"h-4 w-4"}),"NE ID"]}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{id:"filter-ne",placeholder:"NE ID 검색...",value:o,onChange:j=>v("neId",j.target.value),className:"pr-8"}),o&&e.jsx(J,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-6 w-6 p-0",onClick:()=>k("neId"),children:e.jsx(Le,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(W,{htmlFor:"filter-cell",className:"flex items-center gap-2",children:[e.jsx(gr,{className:"h-4 w-4"}),"Cell ID"]}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{id:"filter-cell",placeholder:"Cell ID 검색...",value:u,onChange:j=>v("cellId",j.target.value),className:"pr-8"}),u&&e.jsx(J,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-6 w-6 p-0",onClick:()=>k("cellId"),children:e.jsx(Le,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(W,{htmlFor:"filter-start",className:"flex items-center gap-2",children:[e.jsx(ds,{className:"h-4 w-4"}),"시작 날짜"]}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{id:"filter-start",type:"date",value:c(d),onChange:j=>v("startDate",D(j.target.value)),className:"pr-8"}),d&&e.jsx(J,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-6 w-6 p-0",onClick:()=>k("startDate"),children:e.jsx(Le,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(W,{htmlFor:"filter-end",className:"flex items-center gap-2",children:[e.jsx(ds,{className:"h-4 w-4"}),"종료 날짜"]}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{id:"filter-end",type:"date",value:c(f),onChange:j=>v("endDate",D(j.target.value)),className:"pr-8"}),f&&e.jsx(J,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-6 w-6 p-0",onClick:()=>k("endDate"),children:e.jsx(Le,{className:"h-3 w-3"})})]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx(W,{className:"text-sm font-medium mb-3 block",children:"빠른 날짜 선택"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{label:"오늘",days:0},{label:"어제",days:1},{label:"최근 7일",days:7},{label:"최근 30일",days:30},{label:"최근 90일",days:90}].map(({label:j,days:$})=>e.jsx(J,{variant:"outline",size:"sm",onClick:()=>{const G=new Date,w=new Date;$===0?(w.setHours(0,0,0,0),G.setHours(23,59,59,999)):$===1?(w.setDate(w.getDate()-1),w.setHours(0,0,0,0),G.setDate(G.getDate()-1),G.setHours(23,59,59,999)):(w.setDate(w.getDate()-$),w.setHours(0,0,0,0),G.setHours(23,59,59,999)),v("startDate",w.toISOString()),v("endDate",G.toISOString()),h("빠른 날짜 선택",{label:j,startDate:w,endDate:G})},children:j},j))})]})]})]})},Yt=({isOpen:s,onClose:t,resultIds:a=[],mode:n="single"})=>{const[i,g]=r.useState([]),[h,o]=r.useState(!1),[u,d]=r.useState(null),[f,P]=r.useState("overview"),[l,p]=r.useState(!1);r.useEffect(()=>{const R=U=>{U.key==="F11"?(U.preventDefault(),p(B=>!B)):U.key==="Escape"&&l&&p(!1)};if(s)return window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)},[s,l]);const[y,v]=r.useState(0),[k,_]=r.useState(10),[c,D]=r.useState(""),[A,j]=r.useState("all"),[$,G]=r.useState("all"),w=n==="compare"&&a.length>1;n==="single"&&a.length;const E=async R=>{o(!0),d(null);try{console.log("📊 분석 결과 상세 정보 요청:",R);const U=R.map(async S=>{try{return{...(await ge.get(`/api/analysis/results/${S}`)).data,id:S}}catch(M){return console.error(`❌ 결과 ${S} 로딩 실패:`,M),{id:S,error:M.message||"로딩 실패",analysisDate:new Date().toISOString(),neId:"-",cellId:"-",status:"error"}}}),B=await Promise.all(U);g(B),console.log("✅ 분석 결과 상세 정보 로딩 완료:",B)}catch(U){console.error("❌ 분석 결과 상세 정보 로딩 실패:",U),d(U.message||"데이터 로딩에 실패했습니다"),Q.error("분석 결과를 불러오는데 실패했습니다")}finally{o(!1)}};r.useEffect(()=>{s&&a.length>0&&E(a)},[s,a]);const m=R=>{switch(R==null?void 0:R.toLowerCase()){case"success":return"default";case"error":case"failed":return"destructive";case"warning":return"secondary";case"pending":case"processing":return"outline";default:return"secondary"}},x=R=>{try{return new Date(R).toLocaleString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",weekday:"short"})}catch{return R||"-"}},b=r.useMemo(()=>i.filter(R=>!R.error),[i]),F=r.useMemo(()=>{var U,B;return w?(((B=(U=b[0])==null?void 0:U.kpiResults)==null?void 0:B.map(S=>S.name))||[]).map(S=>{const M={name:S};return b.forEach((C,K)=>{var V;const H=(V=C.kpiResults)==null?void 0:V.find(Y=>Y.name===S);M[`결과${K+1}`]=parseFloat((H==null?void 0:H.value)||0)}),M}):null},[b,w]),T=r.useMemo(()=>{var z;if(w||!b.length||!b[0].stats)return{kpiResults:[],sortedKpiResults:[],filteredResults:[],dataWithTrends:[],trendFilteredResults:[],totalPages:0,paginatedResults:[],data:[],summaryStats:{improved:0,declined:0,stable:0,avgChange:0,weightedAvgChange:0}};const R=b[0],U=R.stats||[],B={};U.forEach(I=>{const L=I.kpi_name;B[L]||(B[L]={peg_name:L,weight:5}),I.period==="N-1"?B[L]["N-1"]=I.avg:I.period==="N"&&(B[L].N=I.avg)});const S=((z=R.request_params)==null?void 0:z.peg_definitions)||{};Object.keys(B).forEach(I=>{var L;(L=S[I])!=null&&L.weight&&(B[I].weight=S[I].weight)});const M=Object.values(B).filter(I=>I["N-1"]!==void 0&&I.N!==void 0),C=[...M].sort((I,L)=>(L.weight||0)-(I.weight||0)),K=C.filter(I=>{const L=!c||I.peg_name.toLowerCase().includes(c.toLowerCase()),ue=I.weight||0;let X=!0;return A==="high"?X=ue>=8:A==="medium"?X=ue>=6&&ue<8:A==="low"&&(X=ue<6),L&&X}),H=K.map(I=>{const L=I["N-1"]||0,X=(I.N||0)-L,Ne=L!==0?X/L*100:0,pe=X>0?"up":X<0?"down":"stable";return{...I,change:X,changePercent:Ne,trend:pe}}),V=H.filter(I=>$==="all"?!0:I.trend===$),Y=Math.ceil(V.length/k),de=V.slice(y*k,(y+1)*k),me=de.map(I=>({name:I.peg_name,"N-1":I["N-1"]||0,N:I.N||0,change:I.change,changePercent:I.changePercent,trend:I.trend,weight:I.weight,unit:"%",peg:I.weight||0})),ke=me.filter(I=>I.trend==="up").length,ae=me.filter(I=>I.trend==="down").length,fe=me.filter(I=>I.trend==="stable").length,be=me.length>0?me.reduce((I,L)=>I+L.change,0)/me.length:0,ce=me.length>0?me.reduce((I,L)=>I+L.change*L.weight,0)/me.reduce((I,L)=>I+L.weight,0):0;return{kpiResults:M,sortedKpiResults:C,filteredResults:K,dataWithTrends:H,trendFilteredResults:V,totalPages:Y,paginatedResults:de,data:me,summaryStats:{improved:ke,declined:ae,stable:fe,avgChange:be,weightedAvgChange:ce}}},[w,b,c,A,$,y,k]),q=()=>{const{kpiResults:R,trendFilteredResults:U,totalPages:B,data:S,summaryStats:M}=T;return w?e.jsx(Ie,{width:"100%",height:400,children:e.jsxs(vs,{data:F,children:[e.jsx(He,{strokeDasharray:"3 3"}),e.jsx(qe,{dataKey:"name"}),e.jsx(ze,{}),e.jsx(Re,{}),e.jsx(Me,{}),b.map((C,K)=>e.jsx(Te,{dataKey:`결과${K+1}`,fill:`hsl(${K*60}, 70%, 50%)`},`result${K+1}`))]})}):R.length?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:M.improved}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"개선 📈"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-red-600",children:M.declined}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"하락 📉"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-600",children:M.stable}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"안정 ➡️"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-lg font-bold ${M.avgChange>=0?"text-green-600":"text-red-600"}`,children:[M.avgChange>0?"+":"",M.avgChange.toFixed(2),"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"평균 변화"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-lg font-bold ${M.weightedAvgChange>=0?"text-green-600":"text-red-600"}`,children:[M.weightedAvgChange>0?"+":"",M.weightedAvgChange.toFixed(2),"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"가중 평균 변화"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"📊 PEG별 N-1/N 성능 비교 (가중치 높은 순)"}),e.jsxs(Z,{variant:"outline",children:["전체 ",R.length,"개 중 ",U.length,"개 표시"]})]}),e.jsxs("div",{className:`grid gap-3 transition-all duration-300 ${l?"grid-cols-1 md:grid-cols-6 lg:grid-cols-8":"grid-cols-1 md:grid-cols-5"}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(js,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(ve,{placeholder:"PEG 이름 검색...",value:c,onChange:C=>{D(C.target.value),v(0)},className:"pl-8"})]}),e.jsxs(Ee,{value:A,onValueChange:C=>{j(C),v(0)},children:[e.jsxs($e,{children:[e.jsx(Fs,{className:"h-4 w-4 mr-2"}),e.jsx(Pe,{placeholder:"가중치 필터"})]}),e.jsxs(Ae,{children:[e.jsx(le,{value:"all",children:"전체"}),e.jsx(le,{value:"high",children:"높음 (≥8)"}),e.jsx(le,{value:"medium",children:"중간 (6-7.9)"}),e.jsx(le,{value:"low",children:"낮음 (<6)"})]})]}),e.jsxs(Ee,{value:$,onValueChange:C=>{G(C),v(0)},children:[e.jsx($e,{children:e.jsx(Pe,{placeholder:"트렌드 필터"})}),e.jsxs(Ae,{children:[e.jsx(le,{value:"all",children:"전체 트렌드"}),e.jsx(le,{value:"up",children:"개선 📈"}),e.jsx(le,{value:"down",children:"하락 📉"}),e.jsx(le,{value:"stable",children:"안정 ➡️"})]})]}),e.jsxs(Ee,{value:k.toString(),onValueChange:C=>{_(parseInt(C)),v(0)},children:[e.jsx($e,{children:e.jsx(Pe,{placeholder:"표시 개수"})}),e.jsxs(Ae,{children:[e.jsx(le,{value:"5",children:"5개씩"}),e.jsx(le,{value:"10",children:"10개씩"}),e.jsx(le,{value:"20",children:"20개씩"}),e.jsx(le,{value:"50",children:"50개씩"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(J,{variant:"outline",size:"sm",onClick:()=>v(Math.max(0,y-1)),disabled:y===0,children:e.jsx(fr,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:[y+1," / ",B||1]}),e.jsx(J,{variant:"outline",size:"sm",onClick:()=>v(Math.min(B-1,y+1)),disabled:y>=B-1,children:e.jsx(pr,{className:"h-4 w-4"})})]})]})]}),e.jsx(Ie,{width:"100%",height:l?Math.min(window.innerHeight*.55,900):Math.min(window.innerHeight*.4,500),className:"transition-all duration-300",children:e.jsxs(vs,{data:S,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(He,{strokeDasharray:"3 3"}),e.jsx(qe,{dataKey:"name",angle:-45,textAnchor:"end",height:100,interval:0,fontSize:10}),e.jsx(ze,{}),e.jsx(Re,{formatter:(C,K,H)=>[`${C==null?void 0:C.toFixed(2)} ${H.payload.unit}`,K],labelFormatter:C=>{const K=S.find(H=>H.name===C);return`${C} (가중치: ${(K==null?void 0:K.weight)||0})`},content:({active:C,payload:K,label:H})=>{var me,ke,ae,fe,be;if(!C||!(K!=null&&K.length))return null;const V=(me=K[0])==null?void 0:me.payload;if(!V)return null;const Y=ce=>{switch(ce){case"up":return"📈";case"down":return"📉";default:return"➡️"}},de=ce=>{switch(ce){case"up":return"text-green-600";case"down":return"text-red-600";default:return"text-gray-600"}};return e.jsxs("div",{className:"bg-white border rounded-lg shadow-lg p-3 min-w-[200px]",children:[e.jsx("div",{className:"font-semibold mb-2",children:H}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-orange-600",children:"N-1 기간:"}),e.jsxs("span",{className:"font-medium",children:[(ke=V["N-1"])==null?void 0:ke.toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-600",children:"N 기간:"}),e.jsxs("span",{className:"font-medium",children:[(ae=V.N)==null?void 0:ae.toFixed(2),"%"]})]}),e.jsxs("div",{className:"border-t pt-1 mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"성능 변화:"}),e.jsxs("div",{className:`flex items-center gap-1 font-medium ${de(V.trend)}`,children:[e.jsx("span",{children:Y(V.trend)}),e.jsxs("span",{children:[V.change>0?"+":"",(fe=V.change)==null?void 0:fe.toFixed(2),"%"]}),e.jsxs("span",{className:"text-xs",children:["(",V.changePercent>0?"+":"",(be=V.changePercent)==null?void 0:be.toFixed(1),"%)"]})]})]}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{className:"text-gray-600",children:"가중치:"}),e.jsxs("span",{className:"font-medium",children:[V.weight,"/10"]})]})]})]})]})}}),e.jsx(Me,{}),e.jsx(Te,{dataKey:"N-1",fill:"#ff7300",name:"N-1 기간"}),e.jsx(Te,{dataKey:"N",fill:"#8884d8",name:"N 기간"})]})})]}):e.jsx("div",{className:"text-center text-muted-foreground",children:"PEG 비교 데이터가 없습니다."})},se=R=>{var V;const U=(R==null?void 0:R[0])||{},B=((V=U==null?void 0:U.data)==null?void 0:V.data)||(U==null?void 0:U.data)||U,S=(B==null?void 0:B.analysis)||{},M=S.executive_summary||S.overall_summary||S.comprehensive_summary||"요약 정보가 없습니다.",C=Array.isArray(S.diagnostic_findings)&&S.diagnostic_findings.length?S.diagnostic_findings:Array.isArray(S.key_findings)?S.key_findings.map(Y=>({primary_hypothesis:String(Y)})):[],H=(Array.isArray(S.recommended_actions)?S.recommended_actions:[]).map(Y=>Y&&typeof Y=="object"?Y:{priority:"",action:String(Y||""),details:""});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(re,{children:[e.jsx(he,{children:e.jsx(xe,{children:"종합 분석 요약"})}),e.jsx(ne,{children:e.jsx("div",{className:"text-sm text-muted-foreground whitespace-pre-line",children:M})})]}),C.length>0&&e.jsxs(re,{children:[e.jsx(he,{children:e.jsx(xe,{children:"핵심 관찰 사항"})}),e.jsx(ne,{children:e.jsx("div",{className:"space-y-3",children:C.map((Y,de)=>e.jsxs("div",{className:"space-y-1",children:[Y.primary_hypothesis&&e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"font-semibold",children:["가설 ",de+1,":"]})," ",Y.primary_hypothesis]}),Y.supporting_evidence&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["증거: ",Y.supporting_evidence]}),Y.confounding_factors_assessment&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["교란 변수 평가: ",Y.confounding_factors_assessment]})]},de))})})]}),H.length>0&&e.jsxs(re,{children:[e.jsx(he,{children:e.jsx(xe,{children:"권장 조치"})}),e.jsx(ne,{children:e.jsx("div",{className:"space-y-3",children:H.map((Y,de)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5",children:e.jsx(Ms,{className:"h-5 w-5 text-green-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[Y.priority&&e.jsx(Z,{variant:"outline",children:Y.priority}),e.jsx("div",{className:"text-sm font-medium",children:Y.action||"-"})]}),Y.details&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1 whitespace-pre-line",children:Y.details})]})]},de))})})]})]})},ie=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:[b.length,"개 결과 비교"]}),e.jsx("div",{className:"flex gap-2",children:b.map((R,U)=>e.jsxs(Z,{variant:"outline",className:"gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`hsl(${U*60}, 70%, 50%)`}}),"결과 ",U+1]},R.id))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.map((R,U)=>e.jsx(re,{className:"border-l-4",style:{borderLeftColor:`hsl(${U*60}, 70%, 50%)`},children:e.jsx(ne,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium",children:["결과 ",U+1]}),e.jsx(Z,{variant:m(R.status),children:R.status})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:x(R.analysisDate)}),e.jsxs("div",{className:"text-sm",children:["NE: ",R.neId," | Cell: ",R.cellId]})]})})},R.id))})]}),O=()=>h?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ms,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"분석 결과를 불러오는 중..."})]})}):u?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ce,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"데이터 로딩 오류"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:u}),e.jsxs(J,{onClick:()=>E(a),variant:"outline",children:[e.jsx(os,{className:"h-4 w-4 mr-2"}),"다시 시도"]})]})}):b.length===0?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ce,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"분석 결과를 찾을 수 없습니다."})]})}):e.jsxs(ws,{value:f,onValueChange:P,className:"w-full",children:[e.jsxs(Ss,{className:"grid w-full grid-cols-3",children:[e.jsx(De,{value:"overview",children:"개요"}),e.jsx(De,{value:"kpi",children:"PEG 비교 결과"}),e.jsx(De,{value:"recommendations",children:"LLM 분석 리포트"})]}),e.jsx(_e,{value:"overview",className:"space-y-4 mt-6",children:w?ie():renderSingleOverview(b[0])}),e.jsx(_e,{value:"kpi",className:"space-y-4 mt-6",children:e.jsxs(re,{children:[e.jsx(he,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5"}),w?"PEG 성능 비교 차트":"PEG 비교 결과 (N-1 vs N)"]})}),e.jsx(ne,{children:q()})]})}),e.jsx(_e,{value:"recommendations",className:"space-y-4 mt-6",children:se(b)})]});return e.jsx(St,{open:s,onOpenChange:t,children:e.jsxs(Ct,{className:`transition-all duration-500 ease-in-out transform ${l?"max-w-[99vw] h-[98vh] w-[99vw] scale-100":"max-w-6xl max-h-[85vh] w-[90vw] scale-100"}`,children:[e.jsx(kt,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Dt,{className:"flex items-center gap-2",children:[e.jsx(vt,{className:"h-5 w-5"}),w?"분석 결과 비교":"분석 결과 상세"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(J,{variant:"ghost",size:"sm",onClick:()=>p(!l),className:"transition-all duration-200 hover:scale-110 hover:bg-accent",title:l?"원래 크기로 (ESC)":"최대화 (F11)",children:l?e.jsx(pt,{className:"h-4 w-4"}):e.jsx(jt,{className:"h-4 w-4"})})})]})}),e.jsx(bs,{className:`transition-all duration-300 ${l?"h-[85vh]":"max-h-[70vh]"}`,children:e.jsx("div",{className:"px-1",children:O()})})]})})},kn=Object.freeze(Object.defineProperty({__proto__:null,default:Yt},Symbol.toStringTag,{value:"Module"})),Jt=()=>{const{results:s,loading:t,error:a,isEmpty:n,hasMore:i,isFiltered:g,resultCount:h,filters:o,updateFilters:u,clearFilters:d,refresh:f,loadMore:P,deleteResult:l}=Sn({initialLimit:20,autoFetch:!0}),[p,y]=r.useState(!1),[v,k]=r.useState(new Set),[_,c]=r.useState({key:"analysisDate",direction:"desc"}),[D,A]=r.useState({isOpen:!1,resultIds:[],mode:"single"}),j=r.useCallback((O,R={})=>{console.log(`[ResultsList] ${O}`,R)},[]),$=r.useMemo(()=>s!=null&&s.length?[...s].sort((R,U)=>{const B=R[_.key],S=U[_.key];if(B==null)return 1;if(S==null)return-1;if(_.key==="analysisDate"){const M=new Date(B),C=new Date(S);return _.direction==="asc"?M-C:C-M}if(typeof B=="string"&&typeof S=="string"){const M=B.localeCompare(S);return _.direction==="asc"?M:-M}return typeof B=="number"&&typeof S=="number"?_.direction==="asc"?B-S:S-B:0}):[],[s,_]),G=r.useCallback(O=>{c(R=>{const U=R.key===O&&R.direction==="asc"?"desc":"asc";return j("정렬 변경",{key:O,direction:U}),{key:O,direction:U}})},[j]),w=r.useCallback(O=>{k(R=>{const U=new Set(R);return U.has(O)?U.delete(O):U.add(O),U})},[]),E=r.useCallback(()=>{v.size===$.length?k(new Set):k(new Set($.map(O=>O.id)))},[v.size,$]),m=r.useCallback(async O=>{try{j("분석 결과 삭제 시작",{resultId:O}),await l(O),k(R=>{const U=new Set(R);return U.delete(O),U})}catch(R){j("분석 결과 삭제 실패",{resultId:O,error:R})}},[l,j]),x=r.useCallback(async()=>{if(v.size!==0)try{j("벌크 삭제 시작",{count:v.size});const O=Array.from(v).map(R=>l(R));await Promise.all(O),k(new Set),Q.success(`${v.size}개의 결과가 삭제되었습니다.`)}catch(O){j("벌크 삭제 실패",{error:O}),Q.error("일부 결과 삭제에 실패했습니다.")}},[v,l,j]),b=r.useCallback(O=>{j("상세 보기 요청",{resultId:O}),A({isOpen:!0,resultIds:[O],mode:"single"})},[j]),F=r.useCallback(()=>{if(v.size<2){Q.error("비교할 결과를 2개 이상 선택해주세요");return}if(v.size>5){Q.error("최대 5개까지만 비교할 수 있습니다");return}const O=Array.from(v);j("비교 보기 요청",{resultIds:O,count:O.length}),A({isOpen:!0,resultIds:O,mode:"compare"})},[v,j]),T=r.useCallback(()=>{A({isOpen:!1,resultIds:[],mode:"single"})},[]),q=r.useCallback(()=>{if(!($!=null&&$.length)){Q.error("내보낼 데이터가 없습니다.");return}try{j("데이터 내보내기 시작",{count:$.length});const O=$.map(S=>{var M,C;return{"분석 날짜":new Date(S.analysisDate).toLocaleString("ko-KR"),"NE ID":S.neId,"Cell ID":S.cellId,상태:S.status,"결과 수":((M=S.results)==null?void 0:M.length)||0,"통계 수":((C=S.stats)==null?void 0:C.length)||0}}),R=[Object.keys(O[0]).join(","),...O.map(S=>Object.values(S).join(","))].join(`
`),U=new Blob([R],{type:"text/csv;charset=utf-8;"}),B=document.createElement("a");B.href=URL.createObjectURL(U),B.download=`analysis_results_${new Date().toISOString().split("T")[0]}.csv`,B.click(),Q.success("데이터가 내보내기 되었습니다."),j("데이터 내보내기 완료")}catch(O){j("데이터 내보내기 실패",{error:O}),Q.error("데이터 내보내기에 실패했습니다.")}},[$,j]),se=r.useCallback(O=>{switch(O==null?void 0:O.toLowerCase()){case"success":return"default";case"error":case"failed":return"destructive";case"warning":return"secondary";case"pending":case"processing":return"outline";default:return"secondary"}},[]),ie=r.useCallback(O=>{try{return new Date(O).toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return O||"-"}},[]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"LLM 분석 결과"}),e.jsxs("p",{className:"text-muted-foreground",children:["총 ",h,"개의 분석 결과",g&&" (필터 적용됨)"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[v.size>0&&e.jsxs(e.Fragment,{children:[v.size>=2&&e.jsxs(J,{variant:"default",size:"sm",onClick:F,children:[e.jsx(BarChart3,{className:"h-4 w-4 mr-2"}),"비교하기 (",v.size,")"]}),e.jsxs(at,{children:[e.jsx(rt,{asChild:!0,children:e.jsxs(J,{variant:"destructive",size:"sm",children:[e.jsx(Ts,{className:"h-4 w-4 mr-2"}),"선택 삭제 (",v.size,")"]})}),e.jsxs(nt,{children:[e.jsxs(lt,{children:[e.jsx(ct,{children:"선택된 결과 삭제"}),e.jsxs(ot,{children:["선택된 ",v.size,"개의 분석 결과를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),e.jsxs(it,{children:[e.jsx(mt,{children:"취소"}),e.jsx(dt,{onClick:x,children:"삭제"})]})]})]})]}),e.jsxs(J,{variant:"outline",size:"sm",onClick:q,disabled:!($!=null&&$.length),children:[e.jsx(cs,{className:"h-4 w-4 mr-2"}),"내보내기"]}),e.jsxs(J,{variant:"outline",size:"sm",onClick:()=>y(!p),children:[e.jsx(Fs,{className:"h-4 w-4 mr-2"}),"필터",e.jsx(Xe,{className:`h-4 w-4 ml-2 transition-transform ${p?"rotate-180":""}`})]}),e.jsxs(J,{variant:"outline",size:"sm",onClick:f,disabled:t,children:[e.jsx(Hs,{className:`h-4 w-4 mr-2 ${t?"animate-spin":""}`}),"새로고침"]})]})]}),p&&e.jsx(Cn,{filters:o,onFilterChange:(O,R)=>u({[O]:R}),onClearFilters:d,isCollapsed:!1,onToggleCollapse:()=>y(!1),showActiveCount:!0}),e.jsx(re,{children:e.jsxs(ne,{className:"p-0",children:[a&&e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(Ce,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"데이터 로딩 오류"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:a}),e.jsxs(J,{onClick:f,variant:"outline",children:[e.jsx(Hs,{className:"h-4 w-4 mr-2"}),"다시 시도"]})]}),t&&n&&e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(ms,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"분석 결과를 불러오는 중..."})]}),!t&&n&&!a&&e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(js,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:g?"검색 결과가 없습니다":"분석 결과가 없습니다"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:g?"다른 조건으로 검색해보세요.":"아직 생성된 분석 결과가 없습니다."}),g&&e.jsxs(J,{onClick:d,variant:"outline",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"필터 초기화"]})]}),!n&&!a&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(vn,{children:[e.jsx(bn,{children:e.jsxs(tt,{children:[e.jsx(Ue,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:v.size===$.length&&$.length>0,onChange:E,className:"rounded border-gray-300"})}),e.jsxs(Ue,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>G("analysisDate"),children:["분석 날짜",_.key==="analysisDate"&&e.jsx("span",{className:"ml-2",children:_.direction==="asc"?"↑":"↓"})]}),e.jsxs(Ue,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>G("neId"),children:["NE ID",_.key==="neId"&&e.jsx("span",{className:"ml-2",children:_.direction==="asc"?"↑":"↓"})]}),e.jsxs(Ue,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>G("cellId"),children:["Cell ID",_.key==="cellId"&&e.jsx("span",{className:"ml-2",children:_.direction==="asc"?"↑":"↓"})]}),e.jsx(Ue,{children:"상태"}),e.jsx(Ue,{className:"text-center",children:"결과 수"}),e.jsx(Ue,{className:"text-center",children:"통계 수"}),e.jsx(Ue,{className:"w-20",children:"작업"})]})}),e.jsx(yn,{children:$.map(O=>{var R,U;return e.jsxs(tt,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>b(O.id),children:[e.jsx(Ke,{onClick:B=>B.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:v.has(O.id),onChange:()=>w(O.id),className:"rounded border-gray-300"})}),e.jsx(Ke,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"h-4 w-4 text-muted-foreground"}),ie(O.analysisDate)]})}),e.jsx(Ke,{className:"font-medium",children:O.neId||"-"}),e.jsx(Ke,{className:"font-medium",children:O.cellId||"-"}),e.jsx(Ke,{children:e.jsx(Z,{variant:se(O.status),children:O.status||"unknown"})}),e.jsx(Ke,{className:"text-center",children:((R=O.results)==null?void 0:R.length)||0}),e.jsx(Ke,{className:"text-center",children:((U=O.stats)==null?void 0:U.length)||0}),e.jsx(Ke,{onClick:B=>B.stopPropagation(),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{variant:"ghost",size:"sm",onClick:()=>b(O.id),title:"상세 보기",children:e.jsx(js,{className:"h-4 w-4"})}),e.jsxs(at,{children:[e.jsx(rt,{asChild:!0,children:e.jsx(J,{variant:"ghost",size:"sm",title:"삭제",children:e.jsx(Ts,{className:"h-4 w-4 text-destructive"})})}),e.jsxs(nt,{children:[e.jsxs(lt,{children:[e.jsx(ct,{children:"분석 결과 삭제"}),e.jsx(ot,{children:"이 분석 결과를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."})]}),e.jsxs(it,{children:[e.jsx(mt,{children:"취소"}),e.jsx(dt,{onClick:()=>m(O.id),children:"삭제"})]})]})]})]})})]},O.id)})})]})}),i&&!t&&!a&&e.jsx("div",{className:"p-6 text-center border-t",children:e.jsxs(J,{variant:"outline",onClick:P,disabled:t,children:[t?e.jsx(ms,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Xe,{className:"h-4 w-4 mr-2"}),"더 보기"]})})]})}),e.jsx(Yt,{isOpen:D.isOpen,onClose:T,resultIds:D.resultIds,mode:D.mode})]})},Zt=Object.freeze(Object.defineProperty({__proto__:null,default:Jt},Symbol.toStringTag,{value:"Module"})),Qt=()=>{var v;const{settings:s}=Ye(),t=(s==null?void 0:s.databaseSettings)||{host:"",port:5432,user:"postgres",password:"",dbname:"postgres",table:"summary"},[a,n]=r.useState({n_minus_1:"",n:"",table:"summary",ne:"",cellid:"",preference:"",columns:{time:"datetime",peg_name:"peg_name",value:"value",ne:"ne",cellid:"cellid"}}),[i,g]=r.useState(null),[h,o]=r.useState(!1),[u,d]=r.useState(null),[f,P]=r.useState([]),l=async()=>{if(!a.n_minus_1||!a.n){Q.error("분석 기간(N-1, N)을 모두 입력해주세요.");return}if((i==null?void 0:i.type)!=="success"){Q.error("먼저 Database 연결을 확인해주세요.");return}o(!0);try{console.log("🚀 LLM 분석 시작:",{dbConfig:t,analysisParams:a});const k=await zr(t,a,"default");console.log("✅ LLM 분석 트리거 성공:",k),d({id:k.analysis_id,status:"processing",message:k.message,startTime:new Date}),Q.success("LLM 분석이 시작되었습니다. 잠시 후 결과를 확인할 수 있습니다."),p(k.analysis_id)}catch(k){console.error("❌ LLM 분석 요청 실패:",k),Q.error(`분석 요청 실패: ${k.message}`),o(!1)}},p=k=>{const _=setInterval(async()=>{try{const c=await Fr(k);console.log("📊 폴링 결과:",c),(c.status==="completed"||c.status==="error")&&(clearInterval(_),o(!1),d(D=>({...D,status:c.status,result:c,endTime:new Date})),P(D=>[{id:k,status:c.status,startTime:new Date,params:a,result:c},...D]),c.status==="completed"?Q.success("LLM 분석이 완료되었습니다!"):Q.error("LLM 분석 중 오류가 발생했습니다."))}catch(c){console.error("폴링 오류:",c),clearInterval(_),o(!1)}},5e3);setTimeout(()=>{clearInterval(_),h&&(o(!1),Q.error("분석 시간이 초과되었습니다. 관리자에게 문의하세요."))},6e5)},y=(k,_)=>{n(c=>({...c,[k]:_}))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(re,{children:[e.jsx(he,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-5 w-5"}),"LLM 분석 관리자"]})}),e.jsx(ne,{children:e.jsx("p",{className:"text-muted-foreground",children:"PostgreSQL Database에서 데이터를 조회하여 LLM 기반 성능 분석을 수행합니다."})})]}),e.jsxs(re,{children:[e.jsx(he,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-5 w-5"}),"Database 설정"]})}),e.jsxs(ne,{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Database 설정은 이제 ",e.jsx("strong",{children:"환경설정 > Database"})," 탭에서 통합 관리됩니다. 이 화면에서는 Preference에 저장된 설정을 사용합니다."]}),e.jsxs("div",{className:"mt-3 text-sm",children:[e.jsxs("div",{children:["Host: ",e.jsx("span",{className:"font-mono",children:t.host||"-"})]}),e.jsxs("div",{children:["Port: ",e.jsx("span",{className:"font-mono",children:t.port||"-"})]}),e.jsxs("div",{children:["User: ",e.jsx("span",{className:"font-mono",children:t.user||"-"})]}),e.jsxs("div",{children:["DB: ",e.jsx("span",{className:"font-mono",children:t.dbname||"-"})]}),e.jsxs("div",{children:["Table: ",e.jsx("span",{className:"font-mono",children:t.table||"-"})]})]})]})]}),e.jsxs(re,{children:[e.jsx(he,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-5 w-5"}),"분석 파라미터"]})}),e.jsxs(ne,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(W,{htmlFor:"n_minus_1",children:"N-1 기간"}),e.jsx(ve,{id:"n_minus_1",value:a.n_minus_1,onChange:k=>y("n_minus_1",k.target.value),placeholder:"YYYY-MM-DD_HH:mm~YYYY-MM-DD_HH:mm"})]}),e.jsxs("div",{children:[e.jsx(W,{htmlFor:"n",children:"N 기간"}),e.jsx(ve,{id:"n",value:a.n,onChange:k=>y("n",k.target.value),placeholder:"YYYY-MM-DD_HH:mm~YYYY-MM-DD_HH:mm"})]}),e.jsxs("div",{children:[e.jsx(W,{htmlFor:"table",children:"테이블명"}),e.jsx(ve,{id:"table",value:a.table,onChange:k=>y("table",k.target.value),placeholder:"summary"})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(J,{onClick:l,disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(ms,{className:"h-4 w-4 animate-spin mr-2"})," 분석 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(zs,{className:"h-4 w-4 mr-2"})," 분석 시작"]})})})]})]}),u&&e.jsxs(re,{children:[e.jsx(he,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5"}),"현재 분석 상태"]})}),e.jsxs(ne,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["분석 ID: ",u.id]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:u.message})]}),e.jsx(Z,{variant:u.status==="processing"?"default":u.status==="completed"?"success":"destructive",children:u.status==="processing"?"처리 중":u.status==="completed"?"완료":"오류"})]}),u.result&&u.status==="completed"&&e.jsxs("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"font-medium mb-2",children:"분석 결과"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[u.result.report_path&&e.jsxs("p",{children:["📄 리포트: ",u.result.report_path]}),((v=u.result.results)==null?void 0:v.analysis)&&e.jsx("p",{children:"🧠 LLM 분석: 완료"})]})]})]})]}),f.length>0&&e.jsxs(re,{children:[e.jsx(he,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(jr,{className:"h-5 w-5"}),"분석 히스토리"]})}),e.jsx(ne,{children:e.jsx("div",{className:"space-y-3",children:f.map((k,_)=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("p",{className:"font-medium text-sm",children:["분석 #",_+1]}),e.jsx(Z,{variant:k.status==="completed"?"success":"destructive",children:k.status==="completed"?"완료":"오류"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["기간: ",k.params.n_minus_1," vs ",k.params.n]}),e.jsxs("p",{children:["시간: ",k.startTime.toLocaleString()]}),e.jsxs("p",{children:["ID: ",k.id]})]})]},k.id))})})]})]})},Xt=Object.freeze(Object.defineProperty({__proto__:null,default:Qt},Symbol.toStringTag,{value:"Module"}));class Dn extends na.Component{constructor(a){super(a);Cs(this,"handleRetry",()=>{console.log("🔄 앱 재시도 중..."),this.setState(a=>({hasError:!1,error:null,errorInfo:null,retryCount:a.retryCount+1}))});Cs(this,"handleReload",()=>{console.log("🔄 페이지 새로고침 중..."),window.location.reload()});this.state={hasError:!1,error:null,errorInfo:null,retryCount:0}}static getDerivedStateFromError(a){return{hasError:!0}}componentDidCatch(a,n){var h,o,u,d;console.error("🚨 ErrorBoundary에서 에러 발생:",a),console.error("🚨 에러 메시지:",a.message),console.error("🚨 에러 스택:",a.stack),console.error("🚨 에러 정보:",n),console.error("🚨 컴포넌트 스택:",n.componentStack),console.error("🚨🚨🚨 === ERROR SUMMARY === 🚨🚨🚨"),console.error(`📝 Error Type: ${a.name}`),console.error(`📝 Error Message: ${a.message}`),console.error(`📝 First Stack Line: ${((o=(h=a.stack)==null?void 0:h.split(`
`))==null?void 0:o[1])||"N/A"}`),console.error("🚨🚨🚨 =================== 🚨🚨🚨"),console.error("🚨 에러 객체 전체:",{name:a.name,message:a.message,stack:a.stack,cause:a.cause,fileName:a.fileName,lineNumber:a.lineNumber,columnNumber:a.columnNumber}),console.error("🚨 에러 객체 모든 속성:");for(const f in a)try{console.error(`  ${f}:`,a[f])}catch{console.error(`  ${f}: [접근 불가]`)}console.error("🚨 에러 객체 프로토타입 체인:");let i=a,g=0;for(;i&&g<5;)console.error(`  Level ${g}:`,((d=(u=Object.getPrototypeOf(i))==null?void 0:u.constructor)==null?void 0:d.name)||"Unknown"),i=Object.getPrototypeOf(i),g++;a.name==="ReferenceError"&&(console.error("🔍 ReferenceError 상세 분석:"),console.error("  - 변수/함수가 정의되지 않았거나 접근할 수 없음"),console.error("  - 모듈 import 순서 문제 가능성"),console.error("  - 호이스팅 문제 가능성")),a.name==="TypeError"&&(console.error("🔍 TypeError 상세 분석:"),console.error("  - 객체가 null/undefined인데 속성에 접근 시도"),console.error("  - 함수가 아닌 것을 함수로 호출"),console.error("  - 잘못된 타입의 값 사용")),a.message.includes("Cannot access")&&(console.error("🔍 순환참조 또는 초기화 순서 문제로 추정됩니다."),console.error("🔍 해결 방안: 모듈 import 순서 확인, 지연 초기화 적용")),a.message.includes("before initialization")&&(console.error("🔍 변수/함수 초기화 순서 문제로 추정됩니다."),console.error("🔍 해결 방안: 함수 선언을 상단으로 이동, 호이스팅 확인")),a.message.includes("is not a function")&&(console.error("🔍 함수 호출 문제로 추정됩니다."),console.error("🔍 해결 방안: 함수 존재 여부 확인, import 확인")),console.error("🔍 현재 URL:",window.location.href),console.error("🔍 User Agent:",navigator.userAgent),console.error("🔍 현재 시간:",new Date().toISOString()),typeof window<"u"&&console.error("🔍 window 객체 상태:",{hasReact:!!window.React,hasReactDOM:!!window.ReactDOM,hasPreferenceContext:!!window.__PREFERENCE_CONTEXT_DEBUG__,runtimeConfig:window.__RUNTIME_CONFIG__}),this.setState({error:a,errorInfo:n})}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsx("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",children:e.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"앱 초기화 중 문제가 발생했습니다"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"순환참조나 초기화 오류로 인해 앱을 로드할 수 없습니다. 아래 버튼을 클릭하여 다시 시도해주세요."}),!1,e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:this.handleRetry,className:"w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:["다시 시도 (",this.state.retryCount+1,"번째)"]}),e.jsx("button",{onClick:this.handleReload,className:"w-full bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition-colors",children:"페이지 새로고침"})]}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:[e.jsx("p",{children:"문제가 지속되면 브라우저 캐시를 정리해보세요."}),e.jsx("p",{children:"Chrome: Ctrl+Shift+R (Windows) / Cmd+Shift+R (Mac)"})]})]})})}):this.props.children}}const we=(s,t,a=null)=>{const i=`[App:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${i} ${t}`,a);break;case"error":console.error(`${i} ${t}`,a);break;case"warn":console.warn(`${i} ${t}`,a);break;case"debug":console.debug(`${i} ${t}`,a);break;default:console.log(`${i} ${t}`,a)}},ss={DASHBOARD:"dashboard",STATISTICS:"statistics",PREFERENCE:"preference",RESULTS:"results",LLM_ANALYSIS:"llm-analysis"};function _n(){we("info","App 컴포넌트 초기화");const[s,t]=r.useState(ss.DASHBOARD),[a,n]=r.useState(!1);if(r.useEffect(()=>{we("debug","App 초기화 시작");const o=setTimeout(()=>{var u,d;try{if(we("info","App 초기화 완료"),typeof window<"u"){const f={hasReact:!!window.React,hasReactDOM:!!window.ReactDOM,hasStrictMode:!!((u=window.React)!=null&&u.StrictMode),hasCreateRoot:!!((d=window.ReactDOM)!=null&&d.createRoot),hasPreferenceContext:!!window.hasPreferenceContext};we("debug","React 상태 확인",f),(!f.hasReact||!f.hasReactDOM)&&we("warn","React 상태가 비정상입니다",f)}n(!0),we("info","App 준비 상태 설정 완료")}catch(f){we("error","App 초기화 중 오류 발생",f),n(!0)}},500);return()=>{we("debug","App 초기화 타이머 정리"),clearTimeout(o)}},[]),!a)return we("debug","로딩 화면 렌더링"),e.jsxs("div",{className:"flex items-center justify-center min-h-screen",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"앱 초기화 중..."})]});const i=()=>{we("debug","콘텐츠 렌더링",{activeMenu:s});try{switch(s){case ss.DASHBOARD:return we("debug","Dashboard 컴포넌트 렌더링"),e.jsx(It,{});case ss.STATISTICS:return we("debug","Statistics 컴포넌트 렌더링"),e.jsx(Ft,{});case ss.PREFERENCE:return we("debug","PreferenceManager 컴포넌트 렌더링"),e.jsx(qt,{});case ss.RESULTS:return we("debug","ResultsList 컴포넌트 렌더링"),e.jsx(Jt,{});case ss.LLM_ANALYSIS:return we("debug","LLMAnalysisManager 컴포넌트 렌더링"),e.jsx(Qt,{});default:return we("warn","알 수 없는 메뉴 선택",{activeMenu:s}),g()}}catch(o){return we("error","콘텐츠 렌더링 중 오류 발생",{activeMenu:s,error:o}),h(o)}},g=()=>(we("info","기본 콘텐츠 렌더링"),e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"🎉 KPI Dashboard - 리팩토링 완료!"}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"✅ 모든 컴포넌트가 안전하게 리팩토링되었습니다"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["현재 선택된 메뉴: ",e.jsx("strong",{children:s})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:e.jsxs("p",{className:"text-green-800",children:[e.jsx("strong",{children:"안정성 테스트 완료!"})," 모든 컴포넌트가 정상적으로 작동하고 있습니다."]})}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-md",children:e.jsx("p",{className:"text-blue-800 text-sm",children:"리팩토링이 완료되어 코드가 더 안전하고 유지보수하기 쉬워졌습니다! 🚀"})}),e.jsx("div",{className:"mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsxs("p",{className:"text-yellow-800 text-sm",children:[e.jsx("strong",{children:"리팩토링 내용:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2",children:[e.jsx("li",{children:"모든 파일에 상세한 주석과 로깅 추가"}),e.jsx("li",{children:"에러 처리 강화"}),e.jsx("li",{children:"코드 모듈화 및 분리"}),e.jsx("li",{children:"타입 안전성 개선"}),e.jsx("li",{children:"성능 최적화"})]})]})})]})]})})),h=o=>(we("error","오류 콘텐츠 렌더링",{error:o}),e.jsx("div",{className:"min-h-screen bg-red-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-red-900 mb-8",children:"⚠️ 오류가 발생했습니다"}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-800 mb-4",children:"콘텐츠 렌더링 중 오류가 발생했습니다"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["메뉴: ",e.jsx("strong",{children:s})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[e.jsx("p",{className:"text-red-800",children:e.jsx("strong",{children:"오류 정보:"})}),e.jsx("pre",{className:"mt-2 text-sm text-red-700 bg-red-100 p-2 rounded",children:(o==null?void 0:o.message)||"알 수 없는 오류"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded",children:"페이지 새로고침"})})]})]})}));return we("debug","App 메인 렌더링",{activeMenu:s,isReady:a}),e.jsx(Dn,{children:e.jsx(Zr,{children:e.jsx(Ir,{activeMenu:s,setActiveMenu:t,children:i()})})})}const En=({...s})=>{const{theme:t="system"}=la();return e.jsx(ia,{theme:t,className:"toaster group",style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...s})};if(typeof window<"u")try{window.React={StrictMode:r.StrictMode},window.ReactDOM={createRoot:xt.createRoot},window.hasReact=!0,window.hasReactDOM=!0,console.log("🔧 React 전역 등록 완료")}catch(s){console.error("❌ React 전역 등록 실패:",s)}const Pn=async()=>{try{console.log("🔍 Web Vitals 측정 시작..."),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",async()=>{await ut()}):await ut(),setTimeout(async()=>{try{const{generatePerformanceReport:s}=await Se(async()=>{const{generatePerformanceReport:t}=await import("./webVitals-CCkPJBQ5.js");return{generatePerformanceReport:t}},__vite__mapDeps([0,1,2,3,4,5]));s()}catch(s){console.warn("⚠️ 성능 리포트 생성 실패:",s)}},5e3)}catch(s){console.warn("⚠️ Web Vitals 초기화 실패:",s)}},ut=async()=>{try{const{measureWebVitals:s}=await Se(async()=>{const{measureWebVitals:t}=await import("./webVitals-CCkPJBQ5.js");return{measureWebVitals:t}},__vite__mapDeps([0,1,2,3,4,5]));await s()}catch(s){console.warn("⚠️ Web Vitals 측정 실패:",s)}};typeof window<"u"&&setTimeout(Pn,100);const ht=()=>{try{console.log("🔄 React 앱 렌더링 시작");const s=document.getElementById("root");if(!s){console.error("❌ root 엘리먼트를 찾을 수 없습니다");return}console.log("✅ root 엘리먼트 발견:",s);const t=xt.createRoot(s);console.log("✅ React Root 생성 완료"),t.render(e.jsxs(e.Fragment,{children:[e.jsx(_n,{}),e.jsx(En,{position:"top-right",richColors:!0})]})),console.log("✅ React 앱 렌더링 완료")}catch(s){console.error("❌ React 앱 렌더링 실패:",s);const t=document.getElementById("root");t&&(t.innerHTML=`
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-family: Arial, sans-serif;">
          <div style="text-align: center; padding: 20px;">
            <h2>앱 초기화 중 문제가 발생했습니다</h2>
            <p>페이지를 새로고침해주세요.</p>
            <button onclick="window.location.reload()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
              새로고침
            </button>
          </div>
        </div>
      `)}},ea=()=>{try{console.log("✅ 앱 초기화 시작"),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{setTimeout(ht,100)}):setTimeout(ht,100)}catch(s){console.error("❌ startApp 실행 중 오류:",s),setTimeout(ea,500)}};ea();export{Se as _};

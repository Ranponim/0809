import{r as a,j as e,Z as R,a6 as q,d as J}from"./react-vendor-BbkKAD8O.js";import{u as W,a as X,B as c,C as P,b as M,c as G,d as K,e as Y}from"./index-CvEd_8oR.js";import{C as z,X as H,Y as Q,T as Z,L as U,R as S,a as V,b as F,B as ee,c as se,A as te,d as ae}from"./chart-vendor-DLa56ojw.js";import"./vendor-B4aOkbPy.js";import"./ui-vendor-BA32w1ww.js";import"./utils-vendor-DgsWbSrd.js";const O=a.memo(({chartData:l,chartStyle:i,showGrid:n,showLegend:v,colorFor:u,idx:m})=>{console.log(`[KPIChart] 렌더링 - 스타일: ${i}, 데이터포인트: ${l.length}`);const f=a.useMemo(()=>l.length>0?Object.keys(l[0]).filter(r=>r!=="time"):[],[l]),x=a.useMemo(()=>({data:l,className:"h-64"}),[l]),d=a.useMemo(()=>[n&&e.jsx(z,{strokeDasharray:"3 3"},"grid"),e.jsx(H,{dataKey:"time"},"xaxis"),e.jsx(Q,{},"yaxis"),e.jsx(Z,{},"tooltip"),v&&e.jsx(U,{},"legend")].filter(Boolean),[n,v]);return a.useMemo(()=>{switch(i){case"area":return e.jsx(S,{width:"100%",height:"100%",children:e.jsxs(te,{...x,children:[d,f.map((r,o)=>e.jsx(ae,{type:"monotone",dataKey:r,stroke:u((m+o)%12),fill:u((m+o)%12),fillOpacity:.3,strokeWidth:2},r))]})});case"bar":return e.jsx(S,{width:"100%",height:"100%",children:e.jsxs(ee,{...x,children:[d,f.map((r,o)=>e.jsx(se,{dataKey:r,fill:u((m+o)%12)},r))]})});case"line":default:return e.jsx(S,{width:"100%",height:"100%",children:e.jsxs(V,{...x,children:[d,f.map((r,o)=>e.jsx(F,{type:"monotone",dataKey:r,stroke:u((m+o)%12),strokeWidth:2},r))]})})}},[i,x,d,f,u,m])},(l,i)=>l.chartStyle===i.chartStyle&&l.showGrid===i.showGrid&&l.showLegend===i.showLegend&&l.idx===i.idx&&JSON.stringify(l.chartData)===JSON.stringify(i.chartData));O.displayName="KPIChart";const B=a.memo(({kpiKey:l,title:i,chartData:n,chartStyle:v,showGrid:u,showLegend:m,colorFor:f,idx:x})=>{console.log(`[KPICard] 렌더링 - ${i}`);const{entityCount:d,dataPointCount:j}=a.useMemo(()=>({entityCount:(n.length>0?Object.keys(n[0]).filter(o=>o!=="time"):[]).length,dataPointCount:n.length}),[n]);return e.jsxs(P,{children:[e.jsx(M,{children:e.jsxs(G,{className:"flex items-center justify-between",children:[i,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{variant:"outline",className:"text-xs",children:[d,"개 엔터티"]}),e.jsxs(c,{variant:"secondary",className:"text-xs",children:[j,"개 데이터포인트"]})]})]})}),e.jsx(K,{children:e.jsx("div",{className:"h-64",children:n.length>0?e.jsx(O,{chartData:n,chartStyle:v,showGrid:u,showLegend:m,colorFor:f,idx:x}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:"데이터가 없습니다"})})})]})});B.displayName="KPICard";const oe=()=>{const[l,i]=a.useState({}),[n,v]=a.useState(!0),[u,m]=a.useState(null),[f,x]=a.useState(0),d=a.useRef(null),j=a.useRef(null),{settings:r,saving:o,error:b}=W(),k=a.useMemo(()=>["availability","rrc","erab","sar","mobility_intra","cqi"],[]),s=a.useMemo(()=>{var t;return{selectedPegs:((t=r.selectedPegs)==null?void 0:t.length)>0?r.selectedPegs:k,defaultNe:r.defaultNe||"",defaultCellId:r.defaultCellId||"",autoRefreshInterval:r.autoRefreshInterval||30,chartStyle:r.chartStyle||"line",showLegend:r.showLegend!==!1,showGrid:r.showGrid!==!1}},[r,k]),D=a.useMemo(()=>({availability:"Availability (%)",rrc:"RRC Success Rate (%)",erab:"ERAB Success Rate (%)",sar:"SAR",mobility_intra:"Mobility Intra (%)",cqi:"CQI"}),[]),w=a.useCallback(t=>D[t]||t,[D]),A=a.useCallback(t=>{const h=["#8884d8","#82ca9d","#ffc658","#ff7300","#8dd1e1","#d084d0"];return t<h.length?h[t]:`hsl(${t*47%360}, 70%, 50%)`},[]),L=a.useCallback(t=>{if(!t||t.length===0)return[];const h=t.reduce((y,C)=>{const g=new Date(C.timestamp).toLocaleDateString();return y[g]||(y[g]={time:g}),y[g][C.entity_id]=C.value,y},{});return Object.values(h)},[]),p=a.useCallback(async()=>{try{v(!0),console.log("[Dashboard] 데이터 fetching 시작",{selectedPegs:s.selectedPegs,defaultNe:s.defaultNe,defaultCellId:s.defaultCellId,chartStyle:s.chartStyle});const t=new Date().toISOString().split("T")[0],h=new Date(Date.now()-10080*60*1e3).toISOString().split("T")[0],y=s.selectedPegs.map(N=>X.post("/api/kpi/query",{start_date:h,end_date:t,kpi_type:N,ne:s.defaultNe,cellid:s.defaultCellId,ids:2})),C=await Promise.all(y),g={};C.forEach((N,I)=>{var E;g[s.selectedPegs[I]]=((E=N==null?void 0:N.data)==null?void 0:E.data)||[]}),i(g),m(new Date),console.log("[Dashboard] 데이터 fetching 완료",{kpiCount:Object.keys(g).length,totalRows:Object.values(g).reduce((N,I)=>N+I.length,0)})}catch(t){console.error("[Dashboard] 데이터 fetching 오류:",t)}finally{v(!1)}},[s]),T=a.useCallback(()=>{console.log("[Dashboard] 수동 새로고침 실행"),p()},[p]);a.useEffect(()=>(d.current&&clearInterval(d.current),j.current&&clearInterval(j.current),s.autoRefreshInterval>0&&(console.log("[Dashboard] 자동 새로고침 설정:",s.autoRefreshInterval,"초"),d.current=setInterval(()=>{p()},s.autoRefreshInterval*1e3),x(s.autoRefreshInterval),j.current=setInterval(()=>{x(t=>t<=1?s.autoRefreshInterval:t-1)},1e3)),()=>{d.current&&clearInterval(d.current),j.current&&clearInterval(j.current)}),[s.autoRefreshInterval,p]),a.useEffect(()=>{p()},[p]);const $=a.useMemo(()=>{const t={};return Object.keys(l).forEach(h=>{t[h]=L(l[h])}),t},[l,L]),_=a.useMemo(()=>n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Dashboard"}),e.jsxs("div",{className:"flex items-center gap-2",children:[o&&e.jsxs(c,{variant:"secondary",className:"text-xs",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),"설정 저장 중"]}),b&&e.jsx(c,{variant:"destructive",className:"text-xs",children:"설정 오류"})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:s.selectedPegs.map(t=>e.jsxs(P,{children:[e.jsx(M,{children:e.jsxs(G,{className:"flex items-center justify-between",children:[w(t),e.jsx(c,{variant:"outline",className:"text-xs",children:s.chartStyle})]})}),e.jsx(K,{children:e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading..."})})})]},t))})]}):null,[n,o,b,s.selectedPegs,s.chartStyle,w]);return n?_:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Dashboard"}),e.jsxs("p",{className:"text-muted-foreground",children:[s.selectedPegs.length,"개 PEG 항목 • 차트 스타일: ",s.chartStyle,s.defaultNe&&` • NE: ${s.defaultNe}`,s.defaultCellId&&` • Cell: ${s.defaultCellId}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o&&e.jsxs(c,{variant:"secondary",className:"text-xs",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),"설정 저장 중"]}),b&&e.jsx(c,{variant:"destructive",className:"text-xs",children:"설정 오류"}),s.autoRefreshInterval>0&&f>0&&e.jsxs(c,{variant:"outline",className:"text-xs",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),f,"초 후 새로고침"]}),u&&e.jsxs(c,{variant:"secondary",className:"text-xs",children:["마지막 업데이트: ",u.toLocaleTimeString()]}),e.jsxs(Y,{variant:"outline",size:"sm",onClick:T,disabled:n,children:[e.jsx(q,{className:`h-4 w-4 mr-2 ${n?"animate-spin":""}`}),"새로고침"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(c,{variant:"default",children:["선택된 PEG: ",s.selectedPegs.join(", ")]}),s.autoRefreshInterval>0&&e.jsxs(c,{variant:"outline",children:["자동 새로고침: ",s.autoRefreshInterval,"초"]}),e.jsxs(c,{variant:"outline",children:["차트 스타일: ",s.chartStyle]}),!s.showLegend&&e.jsx(c,{variant:"secondary",children:"범례 숨김"}),!s.showGrid&&e.jsx(c,{variant:"secondary",children:"격자 숨김"})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:s.selectedPegs.map((t,h)=>e.jsx(B,{kpiKey:t,title:w(t),chartData:$[t]||[],chartStyle:s.chartStyle,showGrid:s.showGrid,showLegend:s.showLegend,colorFor:A,idx:h},t))}),s.selectedPegs.length===0&&e.jsx(P,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(J,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"표시할 PEG가 선택되지 않았습니다"}),e.jsx("p",{className:"text-muted-foreground",children:"Preference 메뉴에서 표시할 PEG 항목을 선택하세요."})]})})})]})};export{oe as default};

import{r as d,M as s,a3 as c}from"./vendor-CIPdjx1t.js";import{C as m,b as o,c as x,d as h,L as N,I as v,i as w,B as _,z as A,E as H}from"./index-Q594mB1I.js";import{a as S}from"./usePreference-BdPvxwX6.js";import{B as I,D as P,S as T,L as B,P as F,c as z,K as E}from"./icon-vendor-CWV3Q6sV.js";import"./utils-vendor-DrCDvq1f.js";import"./ui-vendor-C5A5DcrM.js";import"./chart-vendor-CWmmjCk1.js";const J=()=>{var b;const{settings:u}=S(),l=(u==null?void 0:u.databaseSettings)||{host:"",port:5432,user:"postgres",password:"",dbname:"postgres",table:"summary"},[r,M]=d.useState({n_minus_1:"",n:"",table:"summary",ne:"",cellid:"",preference:"",columns:{time:"datetime",peg_name:"peg_name",value:"value",ne:"ne",cellid:"cellid"}}),[j,R]=d.useState(null),[p,i]=d.useState(!1),[a,y]=d.useState(null),[L,D]=d.useState([]),C=async()=>{if(!r.n_minus_1||!r.n){c.error("ë¶„ì„ ê¸°ê°„(N-1, N)ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}if((j==null?void 0:j.type)!=="success"){c.error("ë¨¼ì € Database ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");return}i(!0);try{console.log("ğŸš€ LLM ë¶„ì„ ì‹œì‘:",{dbConfig:l,analysisParams:r});const e=await A(l,r,"default");console.log("âœ… LLM ë¶„ì„ íŠ¸ë¦¬ê±° ì„±ê³µ:",e),y({id:e.analysis_id,status:"processing",message:e.message,startTime:new Date}),c.success("LLM ë¶„ì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."),Y(e.analysis_id)}catch(e){console.error("âŒ LLM ë¶„ì„ ìš”ì²­ ì‹¤íŒ¨:",e),c.error(`ë¶„ì„ ìš”ì²­ ì‹¤íŒ¨: ${e.message}`),i(!1)}},Y=e=>{const n=setInterval(async()=>{try{const t=await H(e);console.log("ğŸ“Š í´ë§ ê²°ê³¼:",t),(t.status==="completed"||t.status==="error")&&(clearInterval(n),i(!1),y(f=>({...f,status:t.status,result:t,endTime:new Date})),D(f=>[{id:e,status:t.status,startTime:new Date,params:r,result:t},...f]),t.status==="completed"?c.success("LLM ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"):c.error("LLM ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."))}catch(t){console.error("í´ë§ ì˜¤ë¥˜:",t),clearInterval(n),i(!1)}},5e3);setTimeout(()=>{clearInterval(n),p&&(i(!1),c.error("ë¶„ì„ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”."))},6e5)},g=(e,n)=>{M(t=>({...t,[e]:n}))};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs(m,{children:[s.jsx(o,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(I,{className:"h-5 w-5"}),"LLM ë¶„ì„ ê´€ë¦¬ì"]})}),s.jsx(h,{children:s.jsx("p",{className:"text-muted-foreground",children:"PostgreSQL Databaseì—ì„œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ì—¬ LLM ê¸°ë°˜ ì„±ëŠ¥ ë¶„ì„ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤."})})]}),s.jsxs(m,{children:[s.jsx(o,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(P,{className:"h-5 w-5"}),"Database ì„¤ì •"]})}),s.jsxs(h,{children:[s.jsxs("p",{className:"text-sm text-muted-foreground",children:["Database ì„¤ì •ì€ ì´ì œ ",s.jsx("strong",{children:"í™˜ê²½ì„¤ì • > Database"})," íƒ­ì—ì„œ í†µí•© ê´€ë¦¬ë©ë‹ˆë‹¤. ì´ í™”ë©´ì—ì„œëŠ” Preferenceì— ì €ì¥ëœ ì„¤ì •ì„ ì‚¬ìš©í•©ë‹ˆë‹¤."]}),s.jsxs("div",{className:"mt-3 text-sm",children:[s.jsxs("div",{children:["Host: ",s.jsx("span",{className:"font-mono",children:l.host||"-"})]}),s.jsxs("div",{children:["Port: ",s.jsx("span",{className:"font-mono",children:l.port||"-"})]}),s.jsxs("div",{children:["User: ",s.jsx("span",{className:"font-mono",children:l.user||"-"})]}),s.jsxs("div",{children:["DB: ",s.jsx("span",{className:"font-mono",children:l.dbname||"-"})]}),s.jsxs("div",{children:["Table: ",s.jsx("span",{className:"font-mono",children:l.table||"-"})]})]})]})]}),s.jsxs(m,{children:[s.jsx(o,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(T,{className:"h-5 w-5"}),"ë¶„ì„ íŒŒë¼ë¯¸í„°"]})}),s.jsxs(h,{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(N,{htmlFor:"n_minus_1",children:"N-1 ê¸°ê°„"}),s.jsx(v,{id:"n_minus_1",value:r.n_minus_1,onChange:e=>g("n_minus_1",e.target.value),placeholder:"YYYY-MM-DD_HH:mm~YYYY-MM-DD_HH:mm"})]}),s.jsxs("div",{children:[s.jsx(N,{htmlFor:"n",children:"N ê¸°ê°„"}),s.jsx(v,{id:"n",value:r.n,onChange:e=>g("n",e.target.value),placeholder:"YYYY-MM-DD_HH:mm~YYYY-MM-DD_HH:mm"})]}),s.jsxs("div",{children:[s.jsx(N,{htmlFor:"table",children:"í…Œì´ë¸”ëª…"}),s.jsx(v,{id:"table",value:r.table,onChange:e=>g("table",e.target.value),placeholder:"summary"})]})]}),s.jsx("div",{className:"flex items-center gap-3",children:s.jsx(w,{onClick:C,disabled:p,children:p?s.jsxs(s.Fragment,{children:[s.jsx(B,{className:"h-4 w-4 animate-spin mr-2"})," ë¶„ì„ ì¤‘..."]}):s.jsxs(s.Fragment,{children:[s.jsx(F,{className:"h-4 w-4 mr-2"})," ë¶„ì„ ì‹œì‘"]})})})]})]}),a&&s.jsxs(m,{children:[s.jsx(o,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(z,{className:"h-5 w-5"}),"í˜„ì¬ ë¶„ì„ ìƒíƒœ"]})}),s.jsxs(h,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"font-medium",children:["ë¶„ì„ ID: ",a.id]}),s.jsx("p",{className:"text-sm text-muted-foreground",children:a.message})]}),s.jsx(_,{variant:a.status==="processing"?"default":a.status==="completed"?"success":"destructive",children:a.status==="processing"?"ì²˜ë¦¬ ì¤‘":a.status==="completed"?"ì™„ë£Œ":"ì˜¤ë¥˜"})]}),a.result&&a.status==="completed"&&s.jsxs("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:[s.jsx("p",{className:"font-medium mb-2",children:"ë¶„ì„ ê²°ê³¼"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[a.result.report_path&&s.jsxs("p",{children:["ğŸ“„ ë¦¬í¬íŠ¸: ",a.result.report_path]}),((b=a.result.results)==null?void 0:b.analysis)&&s.jsx("p",{children:"ğŸ§  LLM ë¶„ì„: ì™„ë£Œ"})]})]})]})]}),L.length>0&&s.jsxs(m,{children:[s.jsx(o,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(E,{className:"h-5 w-5"}),"ë¶„ì„ íˆìŠ¤í† ë¦¬"]})}),s.jsx(h,{children:s.jsx("div",{className:"space-y-3",children:L.map((e,n)=>s.jsxs("div",{className:"border rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("p",{className:"font-medium text-sm",children:["ë¶„ì„ #",n+1]}),s.jsx(_,{variant:e.status==="completed"?"success":"destructive",children:e.status==="completed"?"ì™„ë£Œ":"ì˜¤ë¥˜"})]}),s.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[s.jsxs("p",{children:["ê¸°ê°„: ",e.params.n_minus_1," vs ",e.params.n]}),s.jsxs("p",{children:["ì‹œê°„: ",e.startTime.toLocaleString()]}),s.jsxs("p",{children:["ID: ",e.id]})]})]},e.id))})})]})]})};export{J as default};

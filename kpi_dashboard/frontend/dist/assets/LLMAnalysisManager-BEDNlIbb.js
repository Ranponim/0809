import{r as d,M as s,a3 as c}from"./vendor-CIPdjx1t.js";import{C as m,b as o,c as x,d as h,L as N,I as v,i as w,B as _,z as A,E as H}from"./index-Q594mB1I.js";import{a as S}from"./usePreference-BdPvxwX6.js";import{B as I,D as P,S as T,L as B,P as F,c as z,K as E}from"./icon-vendor-CWV3Q6sV.js";import"./utils-vendor-DrCDvq1f.js";import"./ui-vendor-C5A5DcrM.js";import"./chart-vendor-CWmmjCk1.js";const J=()=>{var b;const{settings:u}=S(),l=(u==null?void 0:u.databaseSettings)||{host:"",port:5432,user:"postgres",password:"",dbname:"postgres",table:"summary"},[r,M]=d.useState({n_minus_1:"",n:"",table:"summary",ne:"",cellid:"",preference:"",columns:{time:"datetime",peg_name:"peg_name",value:"value",ne:"ne",cellid:"cellid"}}),[j,R]=d.useState(null),[p,i]=d.useState(!1),[a,y]=d.useState(null),[L,D]=d.useState([]),C=async()=>{if(!r.n_minus_1||!r.n){c.error("분석 기간(N-1, N)을 모두 입력해주세요.");return}if((j==null?void 0:j.type)!=="success"){c.error("먼저 Database 연결을 확인해주세요.");return}i(!0);try{console.log("🚀 LLM 분석 시작:",{dbConfig:l,analysisParams:r});const e=await A(l,r,"default");console.log("✅ LLM 분석 트리거 성공:",e),y({id:e.analysis_id,status:"processing",message:e.message,startTime:new Date}),c.success("LLM 분석이 시작되었습니다. 잠시 후 결과를 확인할 수 있습니다."),Y(e.analysis_id)}catch(e){console.error("❌ LLM 분석 요청 실패:",e),c.error(`분석 요청 실패: ${e.message}`),i(!1)}},Y=e=>{const n=setInterval(async()=>{try{const t=await H(e);console.log("📊 폴링 결과:",t),(t.status==="completed"||t.status==="error")&&(clearInterval(n),i(!1),y(f=>({...f,status:t.status,result:t,endTime:new Date})),D(f=>[{id:e,status:t.status,startTime:new Date,params:r,result:t},...f]),t.status==="completed"?c.success("LLM 분석이 완료되었습니다!"):c.error("LLM 분석 중 오류가 발생했습니다."))}catch(t){console.error("폴링 오류:",t),clearInterval(n),i(!1)}},5e3);setTimeout(()=>{clearInterval(n),p&&(i(!1),c.error("분석 시간이 초과되었습니다. 관리자에게 문의하세요."))},6e5)},g=(e,n)=>{M(t=>({...t,[e]:n}))};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs(m,{children:[s.jsx(o,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(I,{className:"h-5 w-5"}),"LLM 분석 관리자"]})}),s.jsx(h,{children:s.jsx("p",{className:"text-muted-foreground",children:"PostgreSQL Database에서 데이터를 조회하여 LLM 기반 성능 분석을 수행합니다."})})]}),s.jsxs(m,{children:[s.jsx(o,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(P,{className:"h-5 w-5"}),"Database 설정"]})}),s.jsxs(h,{children:[s.jsxs("p",{className:"text-sm text-muted-foreground",children:["Database 설정은 이제 ",s.jsx("strong",{children:"환경설정 > Database"})," 탭에서 통합 관리됩니다. 이 화면에서는 Preference에 저장된 설정을 사용합니다."]}),s.jsxs("div",{className:"mt-3 text-sm",children:[s.jsxs("div",{children:["Host: ",s.jsx("span",{className:"font-mono",children:l.host||"-"})]}),s.jsxs("div",{children:["Port: ",s.jsx("span",{className:"font-mono",children:l.port||"-"})]}),s.jsxs("div",{children:["User: ",s.jsx("span",{className:"font-mono",children:l.user||"-"})]}),s.jsxs("div",{children:["DB: ",s.jsx("span",{className:"font-mono",children:l.dbname||"-"})]}),s.jsxs("div",{children:["Table: ",s.jsx("span",{className:"font-mono",children:l.table||"-"})]})]})]})]}),s.jsxs(m,{children:[s.jsx(o,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(T,{className:"h-5 w-5"}),"분석 파라미터"]})}),s.jsxs(h,{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(N,{htmlFor:"n_minus_1",children:"N-1 기간"}),s.jsx(v,{id:"n_minus_1",value:r.n_minus_1,onChange:e=>g("n_minus_1",e.target.value),placeholder:"YYYY-MM-DD_HH:mm~YYYY-MM-DD_HH:mm"})]}),s.jsxs("div",{children:[s.jsx(N,{htmlFor:"n",children:"N 기간"}),s.jsx(v,{id:"n",value:r.n,onChange:e=>g("n",e.target.value),placeholder:"YYYY-MM-DD_HH:mm~YYYY-MM-DD_HH:mm"})]}),s.jsxs("div",{children:[s.jsx(N,{htmlFor:"table",children:"테이블명"}),s.jsx(v,{id:"table",value:r.table,onChange:e=>g("table",e.target.value),placeholder:"summary"})]})]}),s.jsx("div",{className:"flex items-center gap-3",children:s.jsx(w,{onClick:C,disabled:p,children:p?s.jsxs(s.Fragment,{children:[s.jsx(B,{className:"h-4 w-4 animate-spin mr-2"})," 분석 중..."]}):s.jsxs(s.Fragment,{children:[s.jsx(F,{className:"h-4 w-4 mr-2"})," 분석 시작"]})})})]})]}),a&&s.jsxs(m,{children:[s.jsx(o,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(z,{className:"h-5 w-5"}),"현재 분석 상태"]})}),s.jsxs(h,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"font-medium",children:["분석 ID: ",a.id]}),s.jsx("p",{className:"text-sm text-muted-foreground",children:a.message})]}),s.jsx(_,{variant:a.status==="processing"?"default":a.status==="completed"?"success":"destructive",children:a.status==="processing"?"처리 중":a.status==="completed"?"완료":"오류"})]}),a.result&&a.status==="completed"&&s.jsxs("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:[s.jsx("p",{className:"font-medium mb-2",children:"분석 결과"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[a.result.report_path&&s.jsxs("p",{children:["📄 리포트: ",a.result.report_path]}),((b=a.result.results)==null?void 0:b.analysis)&&s.jsx("p",{children:"🧠 LLM 분석: 완료"})]})]})]})]}),L.length>0&&s.jsxs(m,{children:[s.jsx(o,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(E,{className:"h-5 w-5"}),"분석 히스토리"]})}),s.jsx(h,{children:s.jsx("div",{className:"space-y-3",children:L.map((e,n)=>s.jsxs("div",{className:"border rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("p",{className:"font-medium text-sm",children:["분석 #",n+1]}),s.jsx(_,{variant:e.status==="completed"?"success":"destructive",children:e.status==="completed"?"완료":"오류"})]}),s.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[s.jsxs("p",{children:["기간: ",e.params.n_minus_1," vs ",e.params.n]}),s.jsxs("p",{children:["시간: ",e.startTime.toLocaleString()]}),s.jsxs("p",{children:["ID: ",e.id]})]})]},e.id))})})]})]})};export{J as default};

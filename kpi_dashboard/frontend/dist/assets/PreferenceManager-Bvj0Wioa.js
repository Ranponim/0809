import{r as i,M as e,a3 as te}from"./vendor-CPBPwzYD.js";import{C as S,b as P,c as k,d as C,S as le,L as h,h as De,i as Ee,j as Pe,k as ke,l as E,e as b,I as re,B as A,T as Oe,m as Te,n as _e,o as Le,a as K,p as me,q as Re}from"./index-BifUC4c9.js";import{S as Ae,T as $e,a as Me,b as $,c as M}from"./scroll-area-DQuTYI96.js";import{m as T,P as ze,g as He,n as Fe,b as Ve,o as qe,i as Ge,p as Ze,e as Ke,X as Ue,D as U,q as Je,r as Qe,h as Be,C as Xe,s as We,S as Ie,l as Ye}from"./icon-vendor-DwJrfwQP.js";import"./ui-vendor-nq4IHmv4.js";import"./utils-vendor-DrCDvq1f.js";const es=({derivedPegSettings:a,updateDerivedPegSettings:j,availablePegs:v=[],saving:ce=!1})=>{var D;const[I,_]=i.useState(null),[c,d]=i.useState(null),[F,z]=i.useState(""),[G,J]=i.useState(null),[H,L]=i.useState(null),u=(a==null?void 0:a.formulas)||[],g=(a==null?void 0:a.settings)||{autoValidate:!0,showInDashboard:!0,showInStatistics:!0,evaluationPrecision:4},Q=[{id:"success_rate",name:"Success Rate (%)",formula:"(success_count / total_count) * 100",description:"성공률 계산 템플릿",category:"percentage"},{id:"efficiency",name:"Efficiency (%)",formula:"(good_values / all_values) * 100",description:"효율성 계산 템플릿",category:"percentage"},{id:"delta",name:"Delta Calculation",formula:"current_value - previous_value",description:"변화량 계산 템플릿",category:"difference"},{id:"ratio",name:"Simple Ratio",formula:"numerator / denominator",description:"단순 비율 계산 템플릿",category:"ratio"}],ne=[{symbol:"+",name:"더하기",example:"a + b"},{symbol:"-",name:"빼기",example:"a - b"},{symbol:"*",name:"곱하기",example:"a * b"},{symbol:"/",name:"나누기",example:"a / b"},{symbol:"%",name:"나머지",example:"a % b"},{symbol:"^",name:"거듭제곱",example:"a ^ 2"},{symbol:"()",name:"괄호",example:"(a + b) * c"},{symbol:"sqrt()",name:"제곱근",example:"sqrt(a)"},{symbol:"log()",name:"로그",example:"log(a)"},{symbol:"abs()",name:"절댓값",example:"abs(a)"},{symbol:"min()",name:"최솟값",example:"min(a, b)"},{symbol:"max()",name:"최댓값",example:"max(a, b)"}],ie=i.useMemo(()=>F?u.filter(s=>{var r;return s.name.toLowerCase().includes(F.toLowerCase())||s.formula.toLowerCase().includes(F.toLowerCase())||((r=s.description)==null?void 0:r.toLowerCase().includes(F.toLowerCase()))}):u,[u,F]),V=i.useCallback(s=>{try{const r=[],o=[],N=(s.match(/\(/g)||[]).length,w=(s.match(/\)/g)||[]).length;N!==w&&r.push("괄호가 일치하지 않습니다");const Y=s.match(/\$\{[^}]+\}/g)||[],R=s.replace(/\$\{[^}]+\}/g," ").match(/[a-zA-Z_][a-zA-Z0-9_]*/g)||[],ee=[...v.map(p=>p.value),...u.filter(p=>p.active).map(p=>p.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase())],q=R.filter(p=>!ee.includes(p)&&!["sqrt","log","abs","min","max","if"].includes(p));if(q.length>0&&o.push(`알 수 없는 PEG: ${q.join(", ")}`),c){const p=c.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase();R.includes(p)&&r.push("수식이 자기 자신을 참조할 수 없습니다 (순환 참조)")}const Z=s.replace(/\$\{[^}]+\}/g,"").match(/[^a-zA-Z0-9_+\-*/()^%.,\s]/g);Z&&r.push(`지원하지 않는 문자: ${Z.join(", ")}`);const se=R.filter(p=>v.some(O=>O.value===p)),ae=R.filter(p=>u.some(O=>O.active&&O.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()===p));return{isValid:r.length===0,errors:r,warnings:o,dependencies:se,derivedDependencies:ae}}catch{return{isValid:!1,errors:["수식 분석 중 오류가 발생했습니다"],warnings:[],dependencies:[],derivedDependencies:[]}}},[v,u,c]),de=i.useCallback(s=>{try{const r={};v.forEach(w=>{r[w.value]=Math.random()*100+50});let o=s;Object.keys(r).forEach(w=>{const Y=new RegExp(`\\b${w}\\b`,"g");o=o.replace(Y,r[w].toString())}),o=o.replace(/sqrt\(([^)]+)\)/g,"Math.sqrt($1)"),o=o.replace(/log\(([^)]+)\)/g,"Math.log($1)"),o=o.replace(/abs\(([^)]+)\)/g,"Math.abs($1)"),o=o.replace(/\^/g,"**");const N=Function(`"use strict"; return (${o})`)();return{success:!0,result:Number(N).toFixed(g.evaluationPrecision||4),mockData:r}}catch(r){return{success:!1,error:r.message}}},[v,g.evaluationPrecision]),y=()=>{const s={id:`formula_${Date.now()}`,name:"새 수식",formula:"",description:"",active:!0,category:"custom",unit:"",dependencies:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};d(s),_(s.id)},X=()=>{if(!c)return;const s=V(c.formula);if(!s.isValid){te.error(`수식 저장 실패: ${s.errors.join(", ")}`);return}const r={...c,dependencies:s.dependencies,derivedDependencies:s.derivedDependencies||[],updatedAt:new Date().toISOString()},o=u.findIndex(w=>w.id===c.id);let N;o>=0?(N=[...u],N[o]=r):N=[...u,r],j({...a,formulas:N}),d(null),te.success("수식이 저장되었습니다")},oe=s=>{const r=u.filter(o=>o.id!==s);j({...a,formulas:r}),I===s&&_(null),(c==null?void 0:c.id)===s&&d(null),te.success("수식이 삭제되었습니다")},W=s=>{c&&(d({...c,formula:s.formula,description:s.description,category:s.category}),te.success(`템플릿 "${s.name}"이 적용되었습니다`))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{children:[e.jsx(P,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Derived PEG 관리"]})}),e.jsx(C,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{id:"auto-validate",checked:g.autoValidate,onCheckedChange:s=>j({...a,settings:{...g,autoValidate:s}})}),e.jsx(h,{htmlFor:"auto-validate",children:"실시간 검증"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{id:"show-dashboard",checked:g.showInDashboard,onCheckedChange:s=>j({...a,settings:{...g,showInDashboard:s}})}),e.jsx(h,{htmlFor:"show-dashboard",children:"Dashboard에 표시"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{id:"show-statistics",checked:g.showInStatistics,onCheckedChange:s=>j({...a,settings:{...g,showInStatistics:s}})}),e.jsx(h,{htmlFor:"show-statistics",children:"Statistics에 표시"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"계산 정밀도"}),e.jsxs(De,{value:(D=g.evaluationPrecision)==null?void 0:D.toString(),onValueChange:s=>j({...a,settings:{...g,evaluationPrecision:parseInt(s)}}),children:[e.jsx(Ee,{children:e.jsx(Pe,{})}),e.jsxs(ke,{children:[e.jsx(E,{value:"2",children:"소수점 2자리"}),e.jsx(E,{value:"4",children:"소수점 4자리"}),e.jsx(E,{value:"6",children:"소수점 6자리"})]})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S,{children:[e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(k,{children:"수식 목록"}),e.jsxs(b,{onClick:y,size:"sm",children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"새 수식"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(He,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(re,{placeholder:"수식 검색...",className:"pl-8",value:F,onChange:s=>z(s.target.value)})]})]}),e.jsx(C,{children:e.jsx(Ae,{className:"h-96",children:e.jsx("div",{className:"space-y-2",children:ie.map(s=>e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${I===s.id?"bg-blue-50 border-blue-200":"hover:bg-gray-50"}`,onClick:()=>_(s.id),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:s.name}),e.jsx(A,{variant:s.active?"default":"secondary",className:"text-xs",children:s.active?"활성":"비활성"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1 font-mono",children:s.formula}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(A,{variant:"outline",className:"text-xs",children:s.category}),s.unit&&e.jsx(A,{variant:"outline",className:"text-xs",children:s.unit})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[e.jsx(b,{variant:"ghost",size:"sm",onClick:r=>{r.stopPropagation(),d({...s})},children:e.jsx(Fe,{className:"h-3 w-3"})}),e.jsx(b,{variant:"ghost",size:"sm",onClick:r=>{r.stopPropagation(),oe(s.id)},children:e.jsx(Ve,{className:"h-3 w-3"})})]})]})},s.id))})})})]}),e.jsxs(S,{children:[e.jsx(P,{children:e.jsx(k,{children:c?"수식 편집":"수식 상세"})}),e.jsx(C,{children:c?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-name",children:"수식 이름"}),e.jsx(re,{id:"formula-name",value:c.name,onChange:s=>d({...c,name:s.target.value}),placeholder:"예: RACH Success Rate (%)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-input",children:"수식"}),e.jsx(Oe,{id:"formula-input",value:c.formula,onChange:s=>{d({...c,formula:s.target.value}),g.autoValidate&&J(V(s.target.value))},placeholder:"예: (randomaccesspremable / randomaccessresponse) * 100",className:"font-mono text-sm",rows:4}),G&&e.jsxs("div",{className:"space-y-2",children:[G.isValid?e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(qe,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"수식이 유효합니다"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:G.errors.join(", ")})]}),G.warnings.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:G.warnings.join(", ")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-description",children:"설명"}),e.jsx(re,{id:"formula-description",value:c.description,onChange:s=>d({...c,description:s.target.value}),placeholder:"수식에 대한 설명을 입력하세요"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-category",children:"카테고리"}),e.jsxs(De,{value:c.category,onValueChange:s=>d({...c,category:s}),children:[e.jsx(Ee,{children:e.jsx(Pe,{})}),e.jsxs(ke,{children:[e.jsx(E,{value:"percentage",children:"비율 (%)"}),e.jsx(E,{value:"success_rate",children:"성공률"}),e.jsx(E,{value:"efficiency",children:"효율성"}),e.jsx(E,{value:"quality",children:"품질"}),e.jsx(E,{value:"performance",children:"성능"}),e.jsx(E,{value:"custom",children:"사용자 정의"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"formula-unit",children:"단위"}),e.jsx(re,{id:"formula-unit",value:c.unit,onChange:s=>d({...c,unit:s.target.value}),placeholder:"예: %, ms, Mbps"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{id:"formula-active",checked:c.active,onCheckedChange:s=>d({...c,active:s})}),e.jsx(h,{htmlFor:"formula-active",children:"수식 활성화"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{onClick:()=>{const s=V(c.formula);J(s);const r=de(c.formula);L(r)},children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"테스트"]}),e.jsxs(b,{onClick:X,disabled:ce,children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),"저장"]}),e.jsxs(b,{variant:"outline",onClick:()=>d(null),children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"취소"]})]}),H&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Te,{}),e.jsx("h4",{className:"font-medium",children:"테스트 결과"}),H.success?e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-green-700",children:e.jsxs("strong",{children:["결과: ",H.result]})}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"모의 데이터를 사용한 계산 결과입니다"})]}):e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-700",children:["오류: ",H.error]})})]})]}):I?e.jsx("div",{className:"space-y-4",children:(()=>{const s=u.find(r=>r.id===I);return s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"수식"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg font-mono text-sm",children:s.formula})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"카테고리"}),e.jsx("p",{className:"text-sm",children:s.category})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"단위"}),e.jsx("p",{className:"text-sm",children:s.unit||"없음"})]})]}),(s.dependencies&&s.dependencies.length>0||s.derivedDependencies&&s.derivedDependencies.length>0)&&e.jsxs("div",{className:"space-y-2",children:[s.dependencies&&s.dependencies.length>0&&e.jsxs("div",{children:[e.jsxs(h,{className:"text-xs flex items-center gap-1",children:[e.jsx(U,{className:"h-3 w-3"}),"기본 PEG 의존성"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.dependencies.map(r=>e.jsx(A,{variant:"outline",className:"text-xs",children:r},r))})]}),s.derivedDependencies&&s.derivedDependencies.length>0&&e.jsxs("div",{children:[e.jsxs(h,{className:"text-xs flex items-center gap-1",children:[e.jsx(T,{className:"h-3 w-3"}),"Derived PEG 의존성"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.derivedDependencies.map(r=>e.jsx(A,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700",children:r},r))})]})]}),e.jsxs(b,{onClick:()=>d({...s}),className:"w-full",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"편집"]})]}):e.jsx("p",{children:"수식을 찾을 수 없습니다."})})()}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(T,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"수식을 선택하거나 새로 만들어보세요"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S,{children:[e.jsx(P,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-5 w-5"}),"템플릿 라이브러리"]})}),e.jsx(C,{children:e.jsx("div",{className:"space-y-2",children:Q.map(s=>e.jsx("div",{className:"p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>W(s),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",children:s.name}),e.jsx("p",{className:"text-xs font-mono text-muted-foreground",children:s.formula}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description})]}),e.jsx(b,{variant:"ghost",size:"sm",children:e.jsx(Qe,{className:"h-3 w-3"})})]})},s.id))})})]}),e.jsxs(S,{children:[e.jsx(P,{children:e.jsx(k,{children:"지원 연산자"})}),e.jsx(C,{children:e.jsx(Ae,{className:"h-64",children:e.jsx("div",{className:"space-y-2",children:ne.map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("code",{className:"font-mono font-medium",children:s.symbol}),e.jsx("span",{className:"text-sm text-muted-foreground ml-2",children:s.name})]}),e.jsx("code",{className:"text-xs text-muted-foreground",children:s.example})]},r))})})})]})]}),e.jsxs(S,{children:[e.jsxs(P,{children:[e.jsx(k,{children:"사용 가능한 PEG"}),e.jsx(_e,{children:"수식에 사용할 수 있는 기본 PEG와 생성된 Derived PEG 목록입니다"})]}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-4",children:[v.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"기본 PEG (",v.length,"개)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:v.map(s=>e.jsx(b,{variant:"outline",size:"sm",onClick:()=>{c&&d({...c,formula:c.formula+s.value})},className:"text-xs",children:s.label||s.value},s.value))})]}),u.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),"Derived PEG (",u.filter(s=>s.active).length,"개)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.filter(s=>s.active).map(s=>e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>{if(c){const r=`${s.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()}`;d({...c,formula:c.formula+r})}},className:"text-xs bg-blue-50 border-blue-200 hover:bg-blue-100",title:s.description,children:[e.jsx(T,{className:"h-3 w-3 mr-1"}),s.name,s.unit&&e.jsxs("span",{className:"ml-1 text-muted-foreground",children:["(",s.unit,")"]})]},s.id))}),u.filter(s=>s.active).length===0&&e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(T,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"아직 생성된 Derived PEG가 없습니다"}),e.jsx("p",{className:"text-xs",children:"새 수식을 추가하고 활성화하면 여기에 표시됩니다"})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-sm text-blue-700 mb-1",children:"💡 사용법"}),e.jsxs("ul",{className:"text-xs text-blue-600 space-y-1",children:[e.jsx("li",{children:"• 기본 PEG: 클릭하면 수식에 바로 삽입됩니다"}),e.jsx("li",{children:"• Derived PEG: 다른 수식에서 참조할 수 있는 계산된 값입니다"}),e.jsx("li",{children:"• 비활성화된 Derived PEG는 목록에 표시되지 않습니다"}),e.jsx("li",{children:"• Derived PEG끼리 순환 참조하지 않도록 주의하세요"})]})]})]})})]})]})};function ss(a=[]){return a.map(j=>({value:j.value,label:j.label,type:j.type,color:j.type==="derived"?"#3b82f6":"#6b7280",isDerived:j.type==="derived",description:j.description,formula:j.formula}))}const is=()=>{var ee,q,Z,se,ae,p,O,xe,he,ue,pe,je,ge,fe,be,Ne,ve,ye,we,Se,Ce;const{settings:a,isLoading:j,isSaving:v,error:ce,lastSaved:I,updateSettings:_,saveImmediately:c}=Le(),[d,F]=i.useState([]),[z,G]=i.useState(!1),[J,H]=i.useState(!0),[L,u]=i.useState(null),g=i.useCallback(async()=>{var l,m;try{G(!0),console.info("[PreferenceManager] Fetching DB PEGs");const t=(a==null?void 0:a.databaseSettings)||{};if(!t.host){console.warn("[PreferenceManager] No DB config found");return}const x=await K.post("/api/master/pegs",{host:String(t.host).trim(),port:Number(t.port)||5432,user:String(t.user||"").trim(),password:String(t.password||"").trim(),dbname:String(t.dbname||"").trim(),table:String(t.table||"summary").trim(),limit:500}),n=((l=x==null?void 0:x.data)==null?void 0:l.pegs)||(Array.isArray((m=x==null?void 0:x.data)==null?void 0:m.items)?x.data.items.map(f=>({id:f,name:f})):Array.isArray(x==null?void 0:x.data)?x.data.map(f=>({id:f,name:f})):[]);console.info("[PreferenceManager] DB PEGs loaded:",n.length);const B=n.map(f=>({value:f.id||f.name||f.peg_name,label:String(f.name||f.id||f.peg_name)}));F(B),u(new Date)}catch(t){console.error("[PreferenceManager] Error fetching DB PEGs:",t)}finally{G(!1)}},[]),Q=i.useCallback(()=>{const l=ss(d);return console.log("✅ 최종 PEG 옵션:",l),l},[d]),ne=JSON.stringify({host:(ee=a==null?void 0:a.databaseSettings)==null?void 0:ee.host,port:(q=a==null?void 0:a.databaseSettings)==null?void 0:q.port,user:(Z=a==null?void 0:a.databaseSettings)==null?void 0:Z.user,dbname:(se=a==null?void 0:a.databaseSettings)==null?void 0:se.dbname,table:(ae=a==null?void 0:a.databaseSettings)==null?void 0:ae.table});i.useEffect(()=>{g()},[g,ne]);const ie=[{key:"selectedPegs",label:"Dashboard에 표시할 PEG 목록",type:"multiselect",required:!1,options:Q(),placeholder:"Database PEG에서 선택하세요"},{key:"defaultHours",label:"기본 기간 (시간)",type:"number",min:1,max:336,placeholder:"기본 조회 시간 (최대 336시간 = 14일)"},{key:"chartLayout",label:"그래프 정렬 방식",type:"select",options:[{value:"byPeg",label:"PEG별 (PEG마다 Cell/NE 시리즈)"},{value:"byEntity",label:"Cell/NE별 (엔터티마다 PEG 시리즈)"}]}],[V,de]=i.useState([]),[y,X]=i.useState([]),[oe,W]=i.useState([]),[D,s]=i.useState([]),[r,o]=i.useState([]),[N,w]=i.useState([]);i.useEffect(()=>{const l=(a==null?void 0:a.statisticsSettings)||{};X(Array.isArray(l.selectedHosts)?l.selectedHosts:[]),s(Array.isArray(l.selectedNEs)?l.selectedNEs:[]),w(Array.isArray(l.selectedCellIds)?l.selectedCellIds:[])},[a==null?void 0:a.statisticsSettings]),i.useEffect(()=>{(async()=>{var m;try{const t=(a==null?void 0:a.databaseSettings)||{};if(!t.host)return;const x={host:String(t.host||"").trim(),port:Number(t.port)||5432,user:String(t.user||"").trim(),password:String(t.password||"").trim(),dbname:String(t.dbname||"").trim(),table:String(t.table||"summary").trim()},n=await K.post("/api/master/hosts",x);de(Array.isArray((m=n==null?void 0:n.data)==null?void 0:m.hosts)?n.data.hosts:[])}catch(t){console.error("[PreferenceManager] HOST 목록 조회 실패",t)}})()},[(p=a==null?void 0:a.databaseSettings)==null?void 0:p.host,(O=a==null?void 0:a.databaseSettings)==null?void 0:O.port,(xe=a==null?void 0:a.databaseSettings)==null?void 0:xe.user,(he=a==null?void 0:a.databaseSettings)==null?void 0:he.password,(ue=a==null?void 0:a.databaseSettings)==null?void 0:ue.dbname,(pe=a==null?void 0:a.databaseSettings)==null?void 0:pe.table]),i.useEffect(()=>{(async()=>{var m;try{const t=(a==null?void 0:a.databaseSettings)||{};if(!t.host||y.length===0){W([]);return}const x={host:String(t.host||"").trim(),port:Number(t.port)||5432,user:String(t.user||"").trim(),password:String(t.password||"").trim(),dbname:String(t.dbname||"").trim(),table:String(t.table||"summary").trim(),hosts:y},n=await K.post("/api/master/nes-by-host",x);W(Array.isArray((m=n==null?void 0:n.data)==null?void 0:m.nes)?n.data.nes:[])}catch(t){console.error("[PreferenceManager] NE 목록 조회 실패",t)}})()},[y,a==null?void 0:a.databaseSettings]),i.useEffect(()=>{(async()=>{var m;try{const t=(a==null?void 0:a.databaseSettings)||{};if(!t.host||y.length===0||D.length===0){o([]);return}const x={host:String(t.host||"").trim(),port:Number(t.port)||5432,user:String(t.user||"").trim(),password:String(t.password||"").trim(),dbname:String(t.dbname||"").trim(),table:String(t.table||"summary").trim(),hosts:y,nes:D},n=await K.post("/api/master/cells-by-host-ne",x);o(Array.isArray((m=n==null?void 0:n.data)==null?void 0:m.cellids)?n.data.cellids:[])}catch(t){console.error("[PreferenceManager] CellID 목록 조회 실패",t)}})()},[D,y,a==null?void 0:a.databaseSettings]);const Y=[{key:"host",label:"Host",type:"text",placeholder:"예: 127.0.0.1"},{key:"port",label:"Port",type:"number",min:1,max:65535,placeholder:"5432"},{key:"user",label:"User",type:"text",placeholder:"postgres"},{key:"password",label:"Password",type:"text",placeholder:"비밀번호"},{key:"dbname",label:"DB Name",type:"text",placeholder:"postgres"},{key:"table",label:"기본 테이블명",type:"text",placeholder:"summary"}],R=[{key:"enableNotifications",label:"알림 활성화",type:"switch"},{key:"emailNotifications",label:"이메일 알림",type:"switch"},{key:"soundEnabled",label:"소리 알림",type:"switch"},{key:"notificationFrequency",label:"알림 빈도",type:"select",options:[{value:"immediate",label:"즉시"},{value:"hourly",label:"매시간"},{value:"daily",label:"매일"},{value:"weekly",label:"매주"}]}];return j?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"환경설정"}),e.jsxs(A,{variant:"secondary",className:"text-xs",children:[e.jsx(Be,{className:"h-3 w-3 mr-1"}),"로딩 중..."]})]}),e.jsx(S,{children:e.jsx(C,{className:"pt-6",children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"설정을 불러오는 중입니다..."})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"환경설정"}),e.jsx("p",{className:"text-muted-foreground",children:"Dashboard와 Statistics의 동작을 설정할 수 있습니다"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[v&&e.jsxs(A,{variant:"secondary",className:"text-xs",children:[e.jsx(Be,{className:"h-3 w-3 mr-1"}),"저장 중..."]}),ce&&e.jsx(A,{variant:"destructive",className:"text-xs",children:"오류 발생"}),I&&e.jsxs(A,{variant:"outline",className:"text-xs",children:["마지막 저장: ",new Date(I).toLocaleTimeString()]})]})]}),e.jsxs($e,{defaultValue:"dashboard",className:"w-full",children:[e.jsxs(Me,{className:"grid w-full grid-cols-6",children:[e.jsxs($,{value:"dashboard",className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-4 w-4"}),"Dashboard"]}),e.jsxs($,{value:"statistics",className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Statistics"]}),e.jsxs($,{value:"database",className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Database"]}),e.jsxs($,{value:"derived-peg",className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),"Derived PEG"]}),e.jsxs($,{value:"notifications",className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4"}),"알림"]}),e.jsxs($,{value:"backup",className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),"백업/복원"]})]}),e.jsxs(M,{value:"dashboard",className:"space-y-6",children:[e.jsxs(S,{children:[e.jsx(P,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"PEG 데이터 소스"]})}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"PEG 데이터 소스"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Database Settings에서 연결된 실제 PEG 목록을 사용합니다"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(b,{variant:"outline",size:"sm",onClick:g,disabled:z,children:[e.jsx(Ye,{className:`h-3 w-3 ${z?"animate-spin":""}`}),"새로고침"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"사용 가능한 PEG"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[d.length,"개"]})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"마지막 업데이트"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:L?L.toLocaleTimeString():"없음"})]})]}),d.length===0&&!z&&e.jsx("div",{className:"p-3 border rounded-lg bg-amber-50 border-amber-200",children:e.jsx("p",{className:"text-sm text-amber-700",children:"⚠️ DB PEG를 불러올 수 없습니다. Database Settings에서 DB 연결을 확인하세요."})}),d.length>0&&e.jsx("div",{className:"p-3 border rounded-lg bg-green-50 border-green-200",children:e.jsxs("p",{className:"text-sm text-green-700",children:["✅ ",d.length,"개의 실제 DB PEG를 사용할 수 있습니다"]})})]})})]}),e.jsx(me,{title:"Dashboard 설정",description:"DB에서 연동된 PEG만 선택하여 표시합니다",settingKey:"dashboardSettings",fields:ie,defaultOpen:!0,showResetButton:!0,showSaveButton:!0},`dashboard-settings-${d.length}-${L?L.getTime():0}`)]}),e.jsx(M,{value:"statistics",className:"space-y-6",children:e.jsxs(S,{children:[e.jsx(P,{children:e.jsx(k,{children:"데이터 선택 (HOST → NE → CellID)"})}),e.jsxs(C,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"block mb-2",children:"HOST (다중 선택)"}),e.jsx("select",{multiple:!0,className:"w-full border rounded p-2 h-48",value:y,onChange:l=>{const m=Array.from(l.target.selectedOptions).map(t=>t.value);X(m)},children:V.map(l=>e.jsx("option",{value:l,children:l},l))})]}),e.jsxs("div",{children:[e.jsx(h,{className:"block mb-2",children:"NE (다중 선택)"}),e.jsx("select",{multiple:!0,className:"w-full border rounded p-2 h-48",value:D,onChange:l=>{const m=Array.from(l.target.selectedOptions).map(t=>t.value);s(m)},children:oe.map(l=>e.jsx("option",{value:l,children:l},l))})]}),e.jsxs("div",{children:[e.jsx(h,{className:"block mb-2",children:"CellID (다중 선택)"}),e.jsx("select",{multiple:!0,className:"w-full border rounded p-2 h-48",value:N,onChange:l=>{const m=Array.from(l.target.selectedOptions).map(t=>t.value);w(m)},children:r.map(l=>e.jsx("option",{value:l,children:l},l))})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsxs("div",{className:"mb-1",children:["HOST: ",y.length,"개"]}),e.jsxs("div",{className:"mb-1",children:["NE: ",D.length,"개"]}),e.jsxs("div",{children:["CellID: ",N.length,"개"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(b,{size:"sm",onClick:async()=>{try{_({statisticsSettings:{...(a==null?void 0:a.statisticsSettings)||{},selectedHosts:y,selectedNEs:D,selectedCellIds:N}}),await c(),alert("데이터 선택이 저장되었습니다")}catch(l){alert("저장 실패: "+((l==null?void 0:l.message)||"알 수 없는 오류"))}},children:"저장"})})]})]})]})}),e.jsxs(M,{value:"database",className:"space-y-6",children:[e.jsx(me,{title:"Database 설정",description:"LLM 분석과 Statistics에서 공통으로 사용할 PostgreSQL DB 설정입니다 (테이블명 포함).",settingKey:"databaseSettings",fields:Y,defaultOpen:!0,showResetButton:!0,showSaveButton:!0}),e.jsx("div",{className:"flex items-center justify-end gap-2",children:e.jsx(b,{size:"sm",onClick:async()=>{var l,m,t,x;try{const n=(a==null?void 0:a.databaseSettings)||{},B=await K.post("/api/master/test-connection",{host:(n.host||"").trim(),port:Number(n.port)||5432,user:(n.user||"").trim(),password:(n.password||"").trim(),dbname:(n.dbname||"").trim(),table:(n.table||"summary").trim()}),f=(l=B==null?void 0:B.data)==null?void 0:l.success;alert(f?"DB 연결 성공. table_exists="+((m=B==null?void 0:B.data)==null?void 0:m.table_exists):"DB 연결 실패: 응답 형식 확인 필요")}catch(n){alert("DB 연결 실패: "+(((x=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:x.detail)||(n==null?void 0:n.message)))}},children:"Test Connection"})})]}),e.jsx(M,{value:"derived-peg",className:"space-y-6",children:e.jsx(es,{derivedPegSettings:(a==null?void 0:a.derivedPegSettings)||{formulas:[],settings:{}},updateDerivedPegSettings:l=>{_({derivedPegSettings:l})},availablePegs:Q(),saving:v})}),e.jsx(M,{value:"notifications",className:"space-y-6",children:e.jsx(me,{title:"알림 설정",description:"이메일, 소리 알림 등 알림 관련 설정을 관리합니다",settingKey:"notificationSettings",fields:R,defaultOpen:!0,showResetButton:!0,showSaveButton:!1})}),e.jsx(M,{value:"backup",className:"space-y-6",children:e.jsx(Re,{title:"설정 백업 및 복원",description:"모든 환경설정을 JSON 파일로 내보내거나 백업 파일에서 복원할 수 있습니다",defaultOpen:!0})})]}),e.jsxs(S,{children:[e.jsx(P,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-5 w-5"}),"현재 설정 요약"]})}),e.jsx(C,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Dashboard"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["선택된 PEG: ",((ge=(je=a==null?void 0:a.dashboardSettings)==null?void 0:je.selectedPegs)==null?void 0:ge.length)||0,"개"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["PEG 소스: ",J?`DB (${d.length}개)`:"기본 KPI"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["차트 스타일: ",((fe=a==null?void 0:a.dashboardSettings)==null?void 0:fe.chartStyle)||"line"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["자동 새로고침: ",((be=a==null?void 0:a.dashboardSettings)==null?void 0:be.autoRefreshInterval)||0,"초"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Statistics"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["기본 기간: ",((Ne=a==null?void 0:a.statisticsSettings)==null?void 0:Ne.defaultDateRange)||7,"일"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["소수점: ",((ve=a==null?void 0:a.statisticsSettings)==null?void 0:ve.decimalPlaces)||2,"자리"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["비교 옵션: ",(ye=a==null?void 0:a.statisticsSettings)!=null&&ye.showComparisonOptions?"활성":"비활성"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"알림"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["알림: ",(we=a==null?void 0:a.notificationSettings)!=null&&we.enableNotifications?"활성":"비활성"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["이메일: ",(Se=a==null?void 0:a.notificationSettings)!=null&&Se.emailNotifications?"활성":"비활성"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["소리: ",(Ce=a==null?void 0:a.notificationSettings)!=null&&Ce.soundEnabled?"활성":"비활성"]})]})]})]})})]})]})};export{is as default};

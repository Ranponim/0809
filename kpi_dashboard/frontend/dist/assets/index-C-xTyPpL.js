const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/webVitals-R2ejtCUT.js","assets/vendor-C-HZcing.js","assets/utils-vendor-DrCDvq1f.js","assets/ui-vendor-CtEEaYRX.js","assets/icon-vendor-BXbr4vD6.js","assets/chart-vendor-CSmpywC9.js"])))=>i.map(i=>d[i]);
var ea=Object.defineProperty;var sa=(s,t,a)=>t in s?ea(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var Ss=(s,t,a)=>sa(s,typeof t!="symbol"?t+"":t,a);import{a1 as ta,M as e,r,a2 as aa,a3 as se,R as ra,a4 as na,a5 as la,a6 as ht}from"./vendor-C-HZcing.js";import{S as xt,R as ia,C as ca,a as oa,T as da,P as ma,O as ua,b as ha,c as xa,I as ga,V as fa,d as pa,e as ja,f as va,g as ba,h as ya,i as Na,j as wa,k as Sa,l as Ca,m as ka,n as Da,o as _a,L as Ea,p as Pa,q as $a,r as Aa,s as Ta,t as Oa,u as Ia,v as La,w as Ra,x as Ma,y as za,z as Fa,A as Ga,B as Va,D as Ba,E as Ka,F as Ua,G as Ha,H as Wa,J as qa,K as Ya,M as Ja,N as Za,Q as Qa,U as Xa}from"./ui-vendor-CtEEaYRX.js";import{f as er,D as Ls}from"./utils-vendor-DrCDvq1f.js";import{C as Pe,D as We,T as gs,B as gt,S as Xe,X as Oe,a as qe,R as es,b as ss,c as ze,d as bs,e as ds,f as Ee,g as Rs,M as ft,h as pt,A as Bs,i as sr,P as Ms,j as As,E as jt,k as os,l as tr,m as ar,n as Ts,o as rr,F as nr,U as lr,p as ir,q as cr,r as Qe,s as or,t as ps,u as Ks,v as Os,w as dr,x as mr,y as ur,L as ms,z as zs,G as hr,H as xr,I as gr,J as fr,K as Us,N as pr}from"./icon-vendor-BXbr4vD6.js";import{R as Te,L as Fs,a as Ge,B as js,b as Ie,A as vt,c as ns,C as Ue,X as He,Y as Me,T as Le,d as Re,e as jr,f as Cs,g as vr,h as br,P as yr,i as Nr,j as wr,k as Hs,l as Sr,m as Cr}from"./chart-vendor-CSmpywC9.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const h of i)if(h.type==="childList")for(const d of h.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function a(i){const h={};return i.integrity&&(h.integrity=i.integrity),i.referrerPolicy&&(h.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?h.credentials="include":i.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function l(i){if(i.ep)return;i.ep=!0;const h=a(i);fetch(i.href,h)}})();const kr="modulepreload",Dr=function(s){return"/"+s},Ws={},_e=function(t,a,l){let i=Promise.resolve();if(a&&a.length>0){let d=function(o){return Promise.all(o.map(b=>Promise.resolve(b).then(O=>({status:"fulfilled",value:O}),O=>({status:"rejected",reason:O}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),u=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));i=d(a.map(o=>{if(o=Dr(o),o in Ws)return;Ws[o]=!0;const b=o.endsWith(".css"),O=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${O}`))return;const g=document.createElement("link");if(g.rel=b?"stylesheet":kr,b||(g.as="script"),g.crossOrigin="",g.href=o,u&&g.setAttribute("nonce",u),document.head.appendChild(g),b)return new Promise((x,v)=>{g.addEventListener("load",x),g.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${o}`)))})}))}function h(d){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=d,window.dispatchEvent(c),!c.defaultPrevented)throw d}return i.then(d=>{for(const c of d||[])c.status==="rejected"&&h(c.reason);return t().catch(h)})};function ne(...s){return ta(er(s))}const Gs=Ls("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function J({className:s,variant:t,size:a,asChild:l=!1,...i}){const h=l?xt:"button";return e.jsx(h,{"data-slot":"button",className:ne(Gs({variant:t,size:a,className:s})),...i})}r.lazy(()=>_e(()=>Promise.resolve().then(()=>Tt),void 0));r.lazy(()=>_e(()=>Promise.resolve().then(()=>Ft),void 0));r.lazy(()=>_e(()=>Promise.resolve().then(()=>Wt),void 0));r.lazy(()=>_e(()=>Promise.resolve().then(()=>Jt),void 0));r.lazy(()=>_e(()=>Promise.resolve().then(()=>Qt),void 0));r.lazy(()=>_e(()=>Promise.resolve().then(()=>Lt),void 0));r.lazy(()=>_e(()=>Promise.resolve().then(()=>Rt),void 0));r.lazy(()=>_e(()=>Promise.resolve().then(()=>ln),void 0));r.lazy(()=>_e(()=>Promise.resolve().then(()=>Cn),void 0));const Is=()=>_e(()=>Promise.resolve().then(()=>Tt),void 0),bt=()=>_e(()=>Promise.resolve().then(()=>Ft),void 0),yt=()=>_e(()=>Promise.resolve().then(()=>Wt),void 0),Nt=()=>_e(()=>Promise.resolve().then(()=>Jt),void 0),_r=()=>_e(()=>Promise.resolve().then(()=>Qt),void 0),Er=()=>_e(()=>Promise.resolve().then(()=>Lt),void 0),Pr=()=>_e(()=>Promise.resolve().then(()=>Rt),void 0),$r=()=>{if("connection"in navigator){const t=navigator.connection.effectiveType;console.log(`🌐 네트워크 속도: ${t}`),t==="4g"||t==="3g"?(console.log("🚀 빠른 네트워크 감지 - 컴포넌트 프리로딩 시작"),setTimeout(()=>{Is().catch(console.warn),bt().catch(console.warn)},1e3),setTimeout(()=>{yt().catch(console.warn),Nt().catch(console.warn)},2e3),setTimeout(()=>{Er().catch(console.warn),Pr().catch(console.warn)},3e3)):console.log("📶 느린 네트워크 - 필요시에만 로드")}else console.log("📶 네트워크 정보 불가 - 기본 프리로딩"),setTimeout(()=>{Is().catch(console.warn)},2e3)},Ar=({children:s,activeMenu:t,setActiveMenu:a})=>{const l=[{id:"dashboard",label:"Dashboard",icon:Pe,preload:Is},{id:"results",label:"분석 결과",icon:We,preload:Nt},{id:"statistics",label:"Statistics",icon:gs,preload:bt},{id:"llm-analysis",label:"LLM 분석",icon:gt,preload:_r},{id:"preference",label:"Preference",icon:Xe,preload:yt}];r.useEffect(()=>{$r()},[]);const i=h=>{h.preload&&t!==h.id&&(console.log(`🎯 메뉴 호버 감지 - ${h.label} 프리로딩 시작`),h.preload().catch(d=>{console.warn(`⚠️ ${h.label} 프리로딩 실패:`,d)}))};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"px-6 py-4",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"PVT  KPI Dashboard"})})}),e.jsxs("div",{className:"flex",children:[e.jsxs("aside",{className:"w-64 bg-white shadow-sm min-h-screen flex flex-col",children:[e.jsx("nav",{className:"p-4",children:e.jsx("div",{className:"space-y-2",children:l.map(h=>{const d=h.icon;return e.jsxs(J,{variant:t===h.id?"default":"ghost",className:"w-full justify-start",onClick:()=>a(h.id),onMouseEnter:()=>i(h),children:[e.jsx(d,{className:"mr-2 h-4 w-4"}),h.label]},h.id)})})}),e.jsx("div",{className:"mt-auto p-4 text-xs text-gray-400",children:"Powered by PVT AI Crew"})]}),e.jsx("main",{className:"flex-1 p-6",children:s})]})]})};function le({className:s,...t}){return e.jsx("div",{"data-slot":"card",className:ne("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",s),...t})}function ge({className:s,...t}){return e.jsx("div",{"data-slot":"card-header",className:ne("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",s),...t})}function fe({className:s,...t}){return e.jsx("div",{"data-slot":"card-title",className:ne("leading-none font-semibold",s),...t})}function ys({className:s,...t}){return e.jsx("div",{"data-slot":"card-description",className:ne("text-muted-foreground text-sm",s),...t})}function ie({className:s,...t}){return e.jsx("div",{"data-slot":"card-content",className:ne("px-6",s),...t})}const Tr=Ls("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function X({className:s,variant:t,asChild:a=!1,...l}){const i=a?xt:"span";return e.jsx(i,{"data-slot":"badge",className:ne(Tr({variant:t}),s),...l})}function wt({...s}){return e.jsx(ia,{"data-slot":"dialog",...s})}function Or({...s}){return e.jsx(ma,{"data-slot":"dialog-portal",...s})}function Ir({className:s,...t}){return e.jsx(ua,{"data-slot":"dialog-overlay",className:ne("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...t})}function St({className:s,children:t,...a}){return e.jsxs(Or,{"data-slot":"dialog-portal",children:[e.jsx(Ir,{}),e.jsxs(ca,{"data-slot":"dialog-content",className:ne("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",s),...a,children:[t,e.jsxs(oa,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(Oe,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function Ct({className:s,...t}){return e.jsx("div",{"data-slot":"dialog-header",className:ne("flex flex-col gap-2 text-center sm:text-left",s),...t})}function kt({className:s,...t}){return e.jsx(da,{"data-slot":"dialog-title",className:ne("text-lg leading-none font-semibold",s),...t})}const xe=(s,t,a=null)=>{const i=`[ApiClient:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${i} ${t}`,a);break;case"error":console.error(`${i} ${t}`,a);break;case"warn":console.warn(`${i} ${t}`,a);break;case"debug":console.debug(`${i} ${t}`,a);break;default:console.log(`${i} ${t}`,a)}},Lr=()=>{try{const s=typeof window<"u"?window.__RUNTIME_CONFIG__||{}:{},t=s.BACKEND_BASE_URL||s.VITE_API_BASE_URL,a=t&&String(t).trim()||"http://localhost:8000";return xe("info","API 기본 URL 설정",{baseURL:a,runtimeCfg:Object.keys(s)}),a}catch(s){return xe("error","API 기본 URL 설정 오류",s),"http://localhost:8000"}},ts=s=>{var t,a;try{return(a=(t=s==null?void 0:s.response)==null?void 0:t.data)!=null&&a.detail?s.response.data.detail:s!=null&&s.message?s.message:"알 수 없는 오류가 발생했습니다."}catch(l){return xe("error","에러 메시지 추출 실패",l),"알 수 없는 오류가 발생했습니다."}},Rr=(s,t=["password","token","secret"])=>{if(!s||typeof s!="object")return s;const a={...s};return t.forEach(l=>{a[l]&&(a[l]="[HIDDEN]")}),a},Dt=Lr(),ve=aa.create({baseURL:Dt,timeout:15e3});xe("info","API 클라이언트 초기화 완료",{baseURL:Dt,timeout:15e3});ve.interceptors.request.use(s=>{var t;return xe("debug","API 요청 시작",{method:(t=s.method)==null?void 0:t.toUpperCase(),url:s.url,baseURL:s.baseURL,hasData:!!s.data,hasParams:!!s.params}),s},s=>(xe("error","API 요청 인터셉터 오류",s),Promise.reject(s)));ve.interceptors.response.use(s=>{var t;return xe("debug","API 응답 성공",{status:s.status,url:s.config.url,method:(t=s.config.method)==null?void 0:t.toUpperCase()}),s},s=>{var a,l,i,h;const t=ts(s);return xe("error","API 응답 오류",{status:(a=s==null?void 0:s.response)==null?void 0:a.status,url:(l=s==null?void 0:s.config)==null?void 0:l.url,method:(h=(i=s==null?void 0:s.config)==null?void 0:i.method)==null?void 0:h.toUpperCase(),message:t}),se.error(`요청 실패: ${t}`),Promise.reject(s)});const Mr=async(s,t,a="default")=>{var l;xe("info","LLM 분석 요청 시작",{dbConfig:Rr(s),analysisParams:t,userId:a});try{const i=await ve.post("/api/analysis/trigger-llm-analysis",{user_id:a,db_config:s,...t});return xe("info","LLM 분석 트리거 성공",{analysisId:(l=i.data)==null?void 0:l.analysis_id}),i.data}catch(i){throw xe("error","LLM 분석 트리거 실패",i),i}},zr=async s=>{xe("info","LLM 분석 결과 조회",{analysisId:s});try{const t=await ve.get(`/api/analysis/llm-analysis/${s}`);return xe("info","LLM 분석 결과 조회 성공",{analysisId:s,hasData:!!t.data}),t.data}catch(t){throw xe("error","LLM 분석 결과 조회 실패",{analysisId:s,error:t}),t}},ks=async(s="default")=>{var t;xe("info","사용자 설정 조회",{userId:s});try{const a=await ve.get("/api/preference/settings",{params:{user_id:s}});return xe("info","사용자 설정 조회 성공",{userId:s}),{success:!0,data:a.data}}catch(a){return((t=a==null?void 0:a.response)==null?void 0:t.status)===404?(xe("info","사용자 설정이 없음 (신규 사용자)",{userId:s}),{success:!0,data:null,isNew:!0}):(xe("error","사용자 설정 조회 실패",{userId:s,error:a}),{success:!1,error:ts(a)})}},Ds=async(s="default",t)=>{xe("info","사용자 설정 저장",{userId:s,hasData:!!t,dataKeys:t?Object.keys(t):[]});try{const a=await ve.put("/api/preference/settings",t,{params:{user_id:s}});return xe("info","사용자 설정 저장 성공",{userId:s}),{success:!0,data:a.data}}catch(a){return xe("error","사용자 설정 저장 실패",{userId:s,error:a}),{success:!1,error:ts(a)}}},qs=async s=>{const t=s.user_id||s.userId;xe("info","사용자 설정 생성",{userId:t});try{const a=await ve.post("/api/preference/settings",s);return xe("info","사용자 설정 생성 성공",{userId:t}),{success:!0,data:a.data}}catch(a){return xe("error","사용자 설정 생성 실패",{userId:t,error:a}),{success:!1,error:ts(a)}}},Fr=async(s="default")=>{xe("info","사용자 설정 삭제",{userId:s});try{return await ve.delete("/api/preference/settings",{params:{user_id:s}}),xe("info","사용자 설정 삭제 성공",{userId:s}),{success:!0}}catch(t){return xe("error","사용자 설정 삭제 실패",{userId:s,error:t}),{success:!1,error:ts(t)}}},Gr=async(s="default")=>{xe("info","사용자 설정 내보내기",{userId:s});try{const t=await ve.get("/api/preference/export",{params:{user_id:s}});return xe("info","사용자 설정 내보내기 성공",{userId:s}),{success:!0,data:t.data}}catch(t){return xe("error","사용자 설정 내보내기 실패",{userId:s,error:t}),{success:!1,error:ts(t)}}},Vr=async(s="default",t,a=!1)=>{xe("info","사용자 설정 가져오기",{userId:s,fileName:t==null?void 0:t.name,fileSize:t==null?void 0:t.size,overwrite:a});try{const l=new FormData;l.append("file",t);const i=await ve.post("/api/preference/import",l,{params:{user_id:s,overwrite:a},headers:{"Content-Type":"multipart/form-data"}});return xe("info","사용자 설정 가져오기 성공",{userId:s}),{success:!0,data:i.data}}catch(l){return xe("error","사용자 설정 가져오기 실패",{userId:s,error:l}),{success:!1,error:ts(l)}}},k=(s,t,a=null)=>{const i=`[PreferenceUtils] ${new Date().toISOString()}`;switch(s){case"info":console.log(`${i} ℹ️ ${t}`,a);break;case"warn":console.warn(`${i} ⚠️ ${t}`,a);break;case"error":console.error(`${i} ❌ ${t}`,a);break;default:console.log(`${i} ${t}`,a)}},Br=()=>{try{if(k("info","런타임 설정 접근 시도"),typeof window<"u"&&window.__RUNTIME_CONFIG__){const s=window.__RUNTIME_CONFIG__;return k("info","런타임 설정 로드 성공",s),s}return k("warn","런타임 설정이 없음 - 기본값 사용"),{}}catch(s){return k("error","런타임 설정 접근 실패",s.message),{}}},_t=()=>{k("info","기본 설정값 생성 시작");const s=Br(),t={dashboardSettings:{selectedPegs:[],defaultNe:"",defaultCellId:"",autoRefreshInterval:30,chartStyle:"line",showLegend:!0,showGrid:!0,theme:"light",defaultTimeRange:30,timeUnit:"minutes",time1Start:null,time1End:null,time2Start:null,time2End:null,enableTimeComparison:!1},statisticsSettings:{defaultDateRange:7,comparisonEnabled:!0,showDelta:!0,showRsd:!0,defaultPegs:["availability","rrc"],chartType:"bar",decimalPlaces:2,autoAnalysis:!1},databaseSettings:{host:s.DB_HOST||"postgres",port:parseInt(s.DB_PORT,10)||5432,user:s.DB_USER||"postgres",password:s.DB_PASSWORD||"postgres",dbname:s.DB_NAME||"netperf",table:"summary"},notificationSettings:{enableToasts:!0,enableSounds:!1,saveNotification:!0,errorNotification:!0},generalSettings:{language:"ko",timezone:"Asia/Seoul",dateFormat:"YYYY-MM-DD",numberFormat:"comma"},pegConfigurations:[],statisticsConfigurations:[]};return k("info","기본 설정값 생성 완료",{sections:Object.keys(t),runtimeConfigKeys:Object.keys(s)}),t},_s={dashboardSettings:{selectedPegs:{required:!1,type:"array",message:"selectedPegs는 배열이어야 합니다."},autoRefreshInterval:{required:!1,type:"number",min:5,max:300,message:"자동 새로고침 간격은 5초~300초 사이여야 합니다."},defaultNe:{type:"string",maxLength:50,message:"NE ID는 50자를 초과할 수 없습니다."},defaultCellId:{type:"string",maxLength:50,message:"Cell ID는 50자를 초과할 수 없습니다."}},statisticsSettings:{defaultDateRange:{required:!1,type:"number",min:1,max:365,message:"기본 날짜 범위는 1일~365일 사이여야 합니다."},decimalPlaces:{required:!1,type:"number",min:0,max:6,message:"소수점 자릿수는 0~6자리 사이여야 합니다."},defaultPegs:{required:!1,type:"array",message:"defaultPegs는 배열이어야 합니다."}}},Kr=(s,t=null)=>{k("info","설정 유효성 검증 시작",{section:t,hasSettings:!!s});const a={};if(!s||typeof s!="object")return k("error","설정 객체가 유효하지 않음"),{general:"설정 객체가 유효하지 않습니다."};if(t&&!_s[t])return k("warn","지정된 섹션에 대한 검증 규칙이 없음",t),a;const l=t?{[t]:_s[t]}:_s;Object.entries(l).forEach(([h,d])=>{if(!s[h]){k("info","섹션이 없음 - 검증 스킵",h);return}Object.entries(d).forEach(([c,u])=>{const o=s[h][c],b=`${h}.${c}`;if(u.required&&(o==null||o==="")){a[b]=u.message||`${c}는 필수 항목입니다.`,k("warn","필수 필드 누락",{fieldPath:b,value:o});return}if(o==null||o===""){k("info","필드 값이 없음 - 검증 스킵",b);return}if(u.type==="array"&&!Array.isArray(o)){a[b]=u.message||`${c}는 배열이어야 합니다.`,k("warn","타입 검증 실패 - 배열이 아님",{fieldPath:b,value:o,expectedType:"array"});return}if(u.type==="number"&&typeof o!="number"){a[b]=u.message||`${c}는 숫자여야 합니다.`,k("warn","타입 검증 실패 - 숫자가 아님",{fieldPath:b,value:o,expectedType:"number"});return}if(u.type==="string"&&typeof o!="string"){a[b]=u.message||`${c}는 문자열이어야 합니다.`,k("warn","타입 검증 실패 - 문자열이 아님",{fieldPath:b,value:o,expectedType:"string"});return}if(u.type==="number"){if(u.min!==void 0&&o<u.min){a[b]=u.message||`${c}는 ${u.min} 이상이어야 합니다.`,k("warn","숫자 범위 검증 실패 - 최소값 미달",{fieldPath:b,value:o,min:u.min});return}if(u.max!==void 0&&o>u.max){a[b]=u.message||`${c}는 ${u.max} 이하여야 합니다.`,k("warn","숫자 범위 검증 실패 - 최대값 초과",{fieldPath:b,value:o,max:u.max});return}}if(u.type==="array"){if(u.minLength!==void 0&&o.length<u.minLength){a[b]=u.message||`${c}는 최소 ${u.minLength}개 항목이 필요합니다.`,k("warn","배열 길이 검증 실패 - 최소 길이 미달",{fieldPath:b,length:o.length,minLength:u.minLength});return}if(u.maxLength!==void 0&&o.length>u.maxLength){a[b]=u.message||`${c}는 최대 ${u.maxLength}개 항목만 허용됩니다.`,k("warn","배열 길이 검증 실패 - 최대 길이 초과",{fieldPath:b,length:o.length,maxLength:u.maxLength});return}}if(u.type==="string"){if(u.minLength!==void 0&&o.length<u.minLength){a[b]=u.message||`${c}는 최소 ${u.minLength}자 이상이어야 합니다.`,k("warn","문자열 길이 검증 실패 - 최소 길이 미달",{fieldPath:b,length:o.length,minLength:u.minLength});return}if(u.maxLength!==void 0&&o.length>u.maxLength){a[b]=u.message||`${c}는 최대 ${u.maxLength}자까지 허용됩니다.`,k("warn","문자열 길이 검증 실패 - 최대 길이 초과",{fieldPath:b,length:o.length,maxLength:u.maxLength});return}}})});const i=Object.keys(a).length;return k("info","설정 유효성 검증 완료",{errorCount:i,hasErrors:i>0,errorFields:Object.keys(a)}),a},Ys=(s,t)=>{if(k("info","설정 병합 시작",{hasSavedSettings:!!s,hasDefaultSettings:!!t}),!s)return k("info","저장된 설정이 없음 - 기본값 반환"),t;try{const a={...t};return Object.keys(t).forEach(l=>{s[l]&&typeof s[l]=="object"?(a[l]={...t[l],...s[l]},k("info","섹션 병합 완료",{section:l,mergedKeys:Object.keys(a[l])})):k("info","섹션이 없거나 객체가 아님 - 기본값 사용",{section:l})}),k("info","설정 병합 완료",{mergedSections:Object.keys(a),totalSections:Object.keys(t).length}),a}catch(a){return k("error","설정 병합 실패",a.message),t}},us="kpi-dashboard-preferences",hs=()=>{try{const s="__localStorage_test__";return localStorage.setItem(s,s),localStorage.removeItem(s),!0}catch(s){return k("warn","localStorage 사용 불가",s.message),!1}},Ur=s=>{if(k("info","localStorage 저장 시작",{hasSettings:!!s}),!hs()){const t="localStorage를 사용할 수 없습니다";throw k("error","localStorage 저장 실패",t),new Error(t)}try{const t={settings:s,lastSaved:new Date().toISOString(),version:1};return localStorage.setItem(us,JSON.stringify(t)),k("info","localStorage 저장 완료",{lastSaved:t.lastSaved,settingsKeys:Object.keys(s)}),{success:!0,lastSaved:t.lastSaved}}catch(t){throw k("error","localStorage 저장 실패",t.message),new Error(`설정 저장 실패: ${t.message}`)}},Hr=()=>{if(k("info","localStorage 로드 시작"),!hs())return k("warn","localStorage 사용 불가 - null 반환"),null;try{const s=localStorage.getItem(us);if(!s)return k("info","localStorage에 저장된 설정 없음"),null;const t=JSON.parse(s);return k("info","localStorage 로드 완료",{lastSaved:t.lastSaved,version:t.version,settingsKeys:Object.keys(t.settings||{})}),t.settings}catch(s){k("error","localStorage 로드 실패",s.message);try{localStorage.removeItem(us),k("info","손상된 데이터 제거 완료")}catch(t){k("error","손상된 데이터 제거 실패",t.message)}throw new Error(`설정 로드 실패: ${s.message}`)}},Wr=()=>{if(k("info","localStorage 삭제 시작"),!hs()){const s="localStorage를 사용할 수 없습니다";return k("error","localStorage 삭제 실패",s),{success:!1,error:s}}try{return localStorage.removeItem(us),k("info","localStorage 삭제 완료"),{success:!0}}catch(s){return k("error","localStorage 삭제 실패",s.message),{success:!1,error:s.message}}},qr=()=>{const[s,t]=r.useState(!1),[a,l]=r.useState(null),[i,h]=r.useState(null);r.useEffect(()=>{k("info","localStorage 사용 가능 여부 확인 시작");const g=hs();t(g),k("info","localStorage 사용 가능 여부 확인 완료",{available:g})},[]);const d=r.useCallback(async g=>{k("info","설정 저장 시작",{hasSettings:!!g}),h(null);try{const x=Ur(g);return l(x.lastSaved),k("info","설정 저장 완료",x),{success:!0,lastSaved:x.lastSaved}}catch(x){const v=x.message;return h(v),k("error","설정 저장 실패",v),{success:!1,error:v}}},[]),c=r.useCallback(async()=>{k("info","설정 로드 시작"),h(null);try{const g=Hr();return k("info","설정 로드 완료",{hasSettings:!!g}),{success:!0,settings:g}}catch(g){const x=g.message;return h(x),k("error","설정 로드 실패",x),{success:!1,error:x,settings:null}}},[]),u=r.useCallback(async()=>{k("info","설정 삭제 시작"),h(null);try{const g=Wr();return g.success?(l(null),k("info","설정 삭제 완료")):(h(g.error),k("error","설정 삭제 실패",g.error)),g}catch(g){const x=g.message;return h(x),k("error","설정 삭제 실패",x),{success:!1,error:x}}},[]),o=r.useCallback(async(g,x=null)=>{k("info","설정 백업 시작",{hasSettings:!!g}),h(null);try{const v={settings:g,metadata:{exportedAt:new Date().toISOString(),version:"1.0.0",type:"backup"}},n=JSON.stringify(v,null,2),D=new Blob([n],{type:"application/json"}),p=document.createElement("a");return p.href=URL.createObjectURL(D),p.download=x||`preference-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(p.href),k("info","설정 백업 완료",{filename:p.download}),{success:!0,filename:p.download}}catch(v){const n=v.message;return h(n),k("error","설정 백업 실패",n),{success:!1,error:n}}},[]),b=r.useCallback(async g=>(k("info","설정 복원 시작",{fileName:g==null?void 0:g.name}),h(null),new Promise((x,v)=>{const n=new FileReader;n.onload=D=>{try{const p=JSON.parse(D.target.result);if(!p.settings)throw new Error("유효하지 않은 백업 파일입니다.");k("info","설정 복원 완료",{fileName:g.name,settingsKeys:Object.keys(p.settings)}),x({success:!0,settings:p.settings,metadata:p.metadata})}catch(p){const N=p.message;h(N),k("error","설정 복원 실패",N),v(p)}},n.onerror=()=>{const D=new Error("파일 읽기 실패");h(D.message),k("error","설정 복원 실패",D.message),v(D)},n.readAsText(g)})),[]),O=r.useCallback(()=>{if(k("info","동기화 상태 확인 시작"),!s)return k("warn","localStorage 사용 불가 - 동기화 불가"),{synced:!1,reason:"localStorage_unavailable"};try{const g=localStorage.getItem(us);if(!g)return k("info","저장된 설정 없음 - 동기화 불필요"),{synced:!0,reason:"no_data"};const x=JSON.parse(g),v=!!x.settings;return k("info","동기화 상태 확인 완료",{synced:v,lastSaved:x.lastSaved,hasData:v}),{synced:v,lastSaved:x.lastSaved,reason:v?"synced":"no_data"}}catch(g){return k("error","동기화 상태 확인 실패",g.message),{synced:!1,reason:"error",error:g.message}}},[s]);return{isAvailable:s,lastSaved:a,error:i,saveSettings:d,loadSettings:c,clearSettings:u,backupSettings:o,restoreSettings:b,checkSyncStatus:O,isLocalStorageAvailable:hs}},Yr=()=>{const[s,t]=r.useState(!1),[a,l]=r.useState(null),[i,h]=r.useState(null),d=r.useCallback(async N=>{var P,C;k("info","API 작업 시작"),t(!0),l(null);try{const f=await N();return h(new Date),k("info","API 작업 완료",{success:!0}),f}catch(f){const w=((C=(P=f==null?void 0:f.response)==null?void 0:P.data)==null?void 0:C.detail)||(f==null?void 0:f.message)||"알 수 없는 오류가 발생했습니다.";throw l(w),k("error","API 작업 실패",w),f}finally{t(!1)}},[]),c=r.useCallback(async(N="default")=>(k("info","사용자 설정 조회 시작",{userId:N}),await d(async()=>{const P=await ks(N);if(P.success)return k("info","사용자 설정 조회 성공",{hasData:!!P.data,isNew:P.isNew}),P;throw new Error(P.error||"설정 조회 실패")})),[d]),u=r.useCallback(async(N="default",P)=>(k("info","사용자 설정 저장 시작",{userId:N,hasData:!!P,dataKeys:P?Object.keys(P):[]}),await d(async()=>{const C=await Ds(N,P);if(C.success)return k("info","사용자 설정 저장 성공"),se.success("설정이 서버에 저장되었습니다"),C;throw new Error(C.error||"설정 저장 실패")})),[d]),o=r.useCallback(async N=>(k("info","사용자 설정 생성 시작",{userId:N.user_id||N.userId,hasData:!!N}),await d(async()=>{const P=await qs(N);if(P.success)return k("info","사용자 설정 생성 성공"),se.success("새로운 설정이 생성되었습니다"),P;throw new Error(P.error||"설정 생성 실패")})),[d]),b=r.useCallback(async(N="default")=>(k("info","사용자 설정 삭제 시작",{userId:N}),await d(async()=>{const P=await Fr(N);if(P.success)return k("info","사용자 설정 삭제 성공"),se.success("설정이 삭제되었습니다"),P;throw new Error(P.error||"설정 삭제 실패")})),[d]),O=r.useCallback(async(N="default")=>(k("info","설정 내보내기 시작",{userId:N}),await d(async()=>{const P=await Gr(N);if(P.success){k("info","설정 내보내기 성공");const C=JSON.stringify(P.data,null,2),f=new Blob([C],{type:"application/json"}),w=document.createElement("a");return w.href=URL.createObjectURL(f),w.download=`preference-export-${N}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(w.href),se.success("설정이 파일로 내보내졌습니다"),{...P,filename:w.download}}else throw new Error(P.error||"설정 내보내기 실패")})),[d]),g=r.useCallback(async(N="default",P,C=!1)=>(k("info","설정 가져오기 시작",{userId:N,fileName:P==null?void 0:P.name,overwrite:C}),await d(async()=>{const f=await Vr(N,P,C);if(f.success)return k("info","설정 가져오기 성공"),se.success("설정이 성공적으로 가져와졌습니다"),f;throw new Error(f.error||"설정 가져오기 실패")})),[d]),x=r.useCallback(async(N="default",P)=>(k("info","서버 동기화 시작",{userId:N,hasLocalSettings:!!P}),await d(async()=>{try{const C=await ks(N);if(C.success&&C.data){const f=await Ds(N,P);if(f.success)return k("info","서버 동기화 완료 - 업데이트"),se.success("설정이 서버와 동기화되었습니다"),{success:!0,action:"updated"};throw new Error(f.error||"설정 업데이트 실패")}else{const f={user_id:N,...P},w=await qs(f);if(w.success)return k("info","서버 동기화 완료 - 생성"),se.success("새로운 설정이 서버에 생성되었습니다"),{success:!0,action:"created"};throw new Error(w.error||"설정 생성 실패")}}catch(C){throw k("error","서버 동기화 실패",C.message),C}})),[d]),v=r.useCallback(async(N="default")=>(k("info","서버에서 동기화 시작",{userId:N}),await d(async()=>{const P=await ks(N);if(P.success)return k("info","서버에서 동기화 완료",{hasData:!!P.data,isNew:P.isNew}),P.data?se.success("서버에서 설정을 가져왔습니다"):se.info("서버에 저장된 설정이 없습니다"),P;throw new Error(P.error||"서버 동기화 실패")})),[d]),n=r.useCallback(async(N="default",P,C,f="local")=>(k("info","설정 충돌 해결 시작",{userId:N,strategy:f,hasLocalSettings:!!P,hasServerSettings:!!C}),await d(async()=>{let w=null;switch(f){case"local":w=P,k("info","로컬 설정으로 충돌 해결");break;case"server":w=C,k("info","서버 설정으로 충돌 해결");break;case"merge":w={...P,...C},k("info","설정 병합으로 충돌 해결");break;default:throw new Error("알 수 없는 충돌 해결 전략입니다")}const R=await Ds(N,w);if(R.success)return k("info","충돌 해결 완료"),se.success("설정 충돌이 해결되었습니다"),{success:!0,resolvedSettings:w,strategy:f};throw new Error(R.error||"충돌 해결 실패")})),[d]),D=r.useCallback(async()=>{k("info","네트워크 상태 확인 시작");try{const N=await ve.get("/api/health",{timeout:5e3}),P=N.status===200;return k("info","네트워크 상태 확인 완료",{isOnline:P}),{isOnline:P,status:N.status}}catch(N){return k("warn","네트워크 상태 확인 실패",N.message),{isOnline:!1,error:N.message}}},[]),p=r.useCallback(()=>{k("info","에러 상태 초기화"),l(null)},[]);return{loading:s,error:a,lastSync:i,getUserPreferences:c,saveUserPreferences:u,createUserPreferences:o,deleteUserPreferences:b,exportUserPreferences:O,importUserPreferences:g,syncToServer:x,syncFromServer:v,resolveConflict:n,checkNetworkStatus:D,clearError:p}},Et=r.createContext(null),Jr=({children:s})=>{const t=r.useMemo(()=>_t(),[]),[a,l]=r.useState(t),[i,h]=r.useState(!1),[d,c]=r.useState(!1),[u,o]=r.useState(null),[b,O]=r.useState(!1),[g,x]=r.useState(!1),[v,n]=r.useState(null),D=r.useRef(!1),p=qr(),N=Yr();r.useEffect(()=>(k("info","PreferenceProvider 초기화 시작"),D.current=!0,(async()=>{try{if(h(!0),o(null),await new Promise(j=>setTimeout(j,100)),!D.current)return;if(p.isAvailable)try{k("info","초기화 시 localStorage에서 설정 로드 시작");const j=await p.loadSettings();if(j.success&&j.settings){const S=Ys(j.settings,t);l(S),x(!1),k("info","초기화 시 설정 로드 완료",{settingsKeys:Object.keys(S)})}else k("info","저장된 설정 없음 - 기본값 사용"),l(t)}catch(j){k("warn","초기화 시 설정 로드 실패, 기본값 사용",j.message),l(t)}else k("warn","localStorage 사용 불가 - 기본값 사용"),l(t);O(!0),k("info","PreferenceProvider 초기화 완료")}catch(j){k("error","PreferenceProvider 초기화 오류",j.message),o(j.message),l(t),O(!0)}finally{h(!1)}})(),()=>{D.current=!1}),[p.isAvailable]);const P=r.useCallback((m,j,S)=>{k("info","설정 업데이트",{section:m,key:j,value:S}),l(G=>{const M={...G,[m]:{...G[m],[j]:S}};return x(!0),n(new Date),k("info","설정 업데이트 완료",{section:m,key:j}),M})},[]),C=r.useCallback(m=>{k("info","다중 설정 업데이트 시작",{newSettingsKeys:Object.keys(m)}),l(j=>{const S={...j};return Object.entries(m).forEach(([G,M])=>{typeof M=="object"&&(S[G]={...S[G],...M})}),x(!0),n(new Date),k("info","다중 설정 업데이트 완료"),S})},[]),f=r.useCallback(async()=>{k("info","설정 저장 시작");try{c(!0),o(null);const m=await p.saveSettings(a);if(m.success)return x(!1),k("info","설정 저장 완료"),{success:!0};throw new Error(m.error)}catch(m){const j=m.message;return o(j),k("error","설정 저장 실패",j),{success:!1,error:j}}finally{c(!1)}},[a,p]),w=r.useCallback(async()=>{k("info","설정 로드 시작");try{h(!0),o(null);const m=await p.loadSettings();if(m.success){if(m.settings){const j=Ys(m.settings,t);l(j),x(!1),k("info","설정 로드 완료",{settingsKeys:Object.keys(j)})}else k("info","저장된 설정 없음");return{success:!0,settings:m.settings}}else throw new Error(m.error)}catch(m){const j=m.message;return o(j),k("error","설정 로드 실패",j),{success:!1,error:j}}finally{h(!1)}},[t,p]),R=r.useCallback(async(m=null)=>{k("info","설정 초기화 시작",{sections:m});try{h(!0),o(null);let j=t;return m&&Array.isArray(m)&&(j={...a},m.forEach(S=>{t[S]&&(j[S]={...t[S]})})),l(j),x(!0),n(new Date),m===null&&await p.clearSettings(),k("info","설정 초기화 완료"),{success:!0}}catch(j){const S=j.message;return o(S),k("error","설정 초기화 실패",S),{success:!1,error:S}}finally{h(!1)}},[t,a,p]),y=r.useCallback((m=null)=>{k("info","설정 유효성 검증 시작",{section:m});const j=Kr(a,m);return Object.keys(j).length>0?(k("warn","설정 유효성 검증 실패",j),o(`설정 오류: ${Object.values(j)[0]}`)):(k("info","설정 유효성 검증 통과"),o(null)),j},[a]),A={state:{settings:a,loading:i||p.loading||N.loading,saving:d||p.saving||N.saving,error:u||p.error||N.error,initialized:b,hasUnsavedChanges:g,lastModified:v,lastSaved:p.lastSaved,lastSync:N.lastSync,localStorageAvailable:p.isAvailable},settings:a,dashboardSettings:a.dashboardSettings||{},statisticsSettings:a.statisticsSettings||{},databaseSettings:a.databaseSettings||{},notificationSettings:a.notificationSettings||{},generalSettings:a.generalSettings||{},updateSetting:P,updateSettings:C,saveSettings:f,loadSettings:w,resetSettings:R,validateCurrentSettings:y,storage:p,api:N};return e.jsx(Et.Provider,{value:A,children:s})},Zr=()=>{const s=r.useContext(Et);if(!s){k("warn","usePreference: PreferenceProvider 외부에서 사용됨 - 기본값 반환");const t=_t();return{state:{settings:t,loading:!1,saving:!1,error:null,initialized:!1,hasUnsavedChanges:!1,lastModified:null,lastSaved:null,lastSync:null,localStorageAvailable:!1},settings:t,dashboardSettings:t.dashboardSettings||{},statisticsSettings:t.statisticsSettings||{},databaseSettings:t.databaseSettings||{},notificationSettings:t.notificationSettings||{},generalSettings:t.generalSettings||{},updateSetting:()=>{},updateSettings:()=>{},saveSettings:()=>Promise.resolve({success:!1}),loadSettings:()=>Promise.resolve({success:!1}),resetSettings:()=>Promise.resolve({success:!1}),validateCurrentSettings:()=>({}),storage:{isAvailable:!1,saveSettings:()=>Promise.resolve({success:!1}),loadSettings:()=>Promise.resolve({success:!1}),clearSettings:()=>Promise.resolve({success:!1}),error:null},api:{loading:!1,error:null,getUserPreferences:()=>Promise.resolve({success:!1}),saveUserPreferences:()=>Promise.resolve({success:!1}),clearError:()=>{}}}}return s},re=(s,t,a=null)=>{const i=`[usePreference:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${i} ${t}`,a);break;case"error":console.error(`${i} ${t}`,a);break;case"warn":console.warn(`${i} ${t}`,a);break;case"debug":console.debug(`${i} ${t}`,a);break;default:console.log(`${i} ${t}`,a)}},Es={dashboardSettings:{selectedPegs:{required:!0,type:"array",minLength:1,message:"최소 하나의 PEG를 선택해야 합니다."},autoRefreshInterval:{required:!0,type:"number",min:5,max:300,message:"자동 새로고침 간격은 5초~300초 사이여야 합니다."},defaultNe:{type:"string",maxLength:50,message:"NE ID는 50자를 초과할 수 없습니다."},defaultCellId:{type:"string",maxLength:50,message:"Cell ID는 50자를 초과할 수 없습니다."}},statisticsSettings:{defaultDateRange:{required:!0,type:"number",min:1,max:365,message:"기본 날짜 범위는 1일~365일 사이여야 합니다."},decimalPlaces:{required:!0,type:"number",min:0,max:6,message:"소수점 자릿수는 0~6자리 사이여야 합니다."},defaultPegs:{required:!0,type:"array",minLength:1,message:"최소 하나의 기본 PEG를 선택해야 합니다."}}},Js=(s,t=null)=>{re("debug","설정 유효성 검증 시작",{section:t,settings:s});const a={};if(t&&!Es[t])return re("warn",`검증 규칙이 없는 섹션: ${t}`),a;const l=t?{[t]:Es[t]}:Es;return Object.entries(l).forEach(([i,h])=>{if(!s[i]){re("debug",`섹션 ${i}가 설정에 없음`);return}Object.entries(h).forEach(([d,c])=>{const u=s[i][d],o=`${i}.${d}`;if(c.required&&(u==null||u==="")){a[o]=c.message||`${d}는 필수 항목입니다.`,re("error",`필수 필드 누락: ${o}`);return}if(u==null||u===""){re("debug",`필드 ${o} 값이 없어 검증 스킵`);return}if(c.type==="array"&&!Array.isArray(u)){a[o]=c.message||`${d}는 배열이어야 합니다.`,re("error",`타입 오류: ${o}는 배열이어야 함`);return}if(c.type==="number"&&typeof u!="number"){a[o]=c.message||`${d}는 숫자여야 합니다.`,re("error",`타입 오류: ${o}는 숫자여야 함`);return}if(c.type==="string"&&typeof u!="string"){a[o]=c.message||`${d}는 문자열이어야 합니다.`,re("error",`타입 오류: ${o}는 문자열이어야 함`);return}if(c.type==="number"){if(c.min!==void 0&&u<c.min){a[o]=c.message||`${d}는 ${c.min} 이상이어야 합니다.`,re("error",`범위 오류: ${o}는 ${c.min} 이상이어야 함`);return}if(c.max!==void 0&&u>c.max){a[o]=c.message||`${d}는 ${c.max} 이하여야 합니다.`,re("error",`범위 오류: ${o}는 ${c.max} 이하여야 함`);return}}if(c.type==="array"){if(c.minLength!==void 0&&u.length<c.minLength){a[o]=c.message||`${d}는 최소 ${c.minLength}개 항목이 필요합니다.`,re("error",`배열 길이 오류: ${o}는 최소 ${c.minLength}개 필요`);return}if(c.maxLength!==void 0&&u.length>c.maxLength){a[o]=c.message||`${d}는 최대 ${c.maxLength}개 항목만 허용됩니다.`,re("error",`배열 길이 오류: ${o}는 최대 ${c.maxLength}개만 허용`);return}}if(c.type==="string"){if(c.minLength!==void 0&&u.length<c.minLength){a[o]=c.message||`${d}는 최소 ${c.minLength}자 이상이어야 합니다.`,re("error",`문자열 길이 오류: ${o}는 최소 ${c.minLength}자 필요`);return}if(c.maxLength!==void 0&&u.length>c.maxLength){a[o]=c.message||`${d}는 최대 ${c.maxLength}자까지 허용됩니다.`,re("error",`문자열 길이 오류: ${o}는 최대 ${c.maxLength}자만 허용`);return}}})}),re("debug","설정 유효성 검증 완료",{errors:a}),a},Ye=()=>{const s=r.useRef(!1);s.current||(re("debug","usePreference 훅 초기화"),s.current=!0);const t=Zr(),[a,l]=r.useState({}),i=r.useMemo(()=>{const x=(t==null?void 0:t.settings)||{};return re("debug","설정 접근",{hasSettings:!!x}),x},[t==null?void 0:t.settings]),h=r.useCallback(x=>{re("info","설정 업데이트 시작",{newSettings:x}),t!=null&&t.updateSetting?(Object.entries(x).forEach(([v,n])=>{typeof n=="object"&&Object.entries(n).forEach(([D,p])=>{re("debug",`설정 업데이트: ${v}.${D}`,{value:p}),t.updateSetting(v,D,p)})}),re("info","설정 업데이트 완료")):re("error","updateSetting 함수를 사용할 수 없음")},[t==null?void 0:t.updateSetting]),d=r.useCallback(async()=>{if(re("info","설정 저장 시작"),t!=null&&t.saveSettings)try{const x=await t.saveSettings();return re("info","설정 저장 완료",{result:x}),x}catch(x){throw re("error","설정 저장 실패",x),x}else return re("error","saveSettings 함수를 사용할 수 없음"),!1},[t==null?void 0:t.saveSettings]),c=r.useCallback(async()=>{if(re("info","설정 로드 시작"),t!=null&&t.loadSettings)try{const x=await t.loadSettings();return re("info","설정 로드 완료",{result:x}),x}catch(x){throw re("error","설정 로드 실패",x),x}else return re("error","loadSettings 함수를 사용할 수 없음"),!1},[t==null?void 0:t.loadSettings]),u=r.useCallback(async x=>{if(re("info","설정 리셋 시작",{sections:x}),t!=null&&t.resetSettings)try{const v=await t.resetSettings(x);return re("info","설정 리셋 완료",{result:v}),v}catch(v){return re("error","설정 리셋 실패",v),{success:!1,error:v.message}}else return re("error","resetSettings 함수를 사용할 수 없음"),{success:!1,error:"resetSettings 함수를 사용할 수 없습니다"}},[t==null?void 0:t.resetSettings]),o=r.useCallback((x,v=null)=>{var p;re("info","설정 업데이트 및 검증 시작",{newSettings:x,section:v});const n=v?{...i,[v]:{...i[v],...x[v]}}:{...i,...x},D=Js(n,v);if(l(D),Object.keys(D).length>0){re("error","설정 유효성 검증 실패",D);const N=Object.values(D)[0];return(p=i.notificationSettings)!=null&&p.errorNotification&&se.error(`설정 오류: ${N}`),!1}return h(x),re("info","설정 업데이트 완료"),!0},[i,h]),b=r.useCallback((x=null,v=null)=>{var n,D;re("info","설정 내보내기 시작",{filename:x,partial:v});try{const p={settings:v&&Object.keys(v).length>0?{...i,...v}:i,metadata:{exportedAt:new Date().toISOString(),version:"1.0.0",userId:(t==null?void 0:t.userId)||"default"}},N=JSON.stringify(p,null,2),P=new Blob([N],{type:"application/json"}),C=document.createElement("a");return C.href=URL.createObjectURL(P),C.download=x||`preference-settings-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(C.href),re("info","설정 내보내기 완료",{filename:C.download}),(n=i.notificationSettings)!=null&&n.enableToasts&&se.success("설정이 파일로 내보내졌습니다"),!0}catch(p){return re("error","설정 내보내기 실패",p),(D=i.notificationSettings)!=null&&D.errorNotification&&se.error("설정 내보내기 실패: "+p.message),!1}},[i,t==null?void 0:t.userId]),O=r.useCallback(x=>(re("info","설정 가져오기 시작",{filename:x.name}),new Promise((v,n)=>{const D=new FileReader;D.onload=p=>{var N,P;try{const C=JSON.parse(p.target.result);if(!C.settings)throw new Error("유효하지 않은 설정 파일입니다.");h(C.settings),re("info","설정 가져오기 완료",{filename:x.name}),(N=i.notificationSettings)!=null&&N.enableToasts&&se.success("설정이 성공적으로 가져와졌습니다"),v(C)}catch(C){re("error","설정 가져오기 실패",C),(P=i.notificationSettings)!=null&&P.errorNotification&&se.error("설정 가져오기 실패: "+C.message),n(C)}},D.onerror=()=>{const p=new Error("파일 읽기 실패");re("error","설정 가져오기 실패",p),n(p)},D.readAsText(x)})),[i,h]),g={settings:i,dashboardSettings:i.dashboardSettings||{},statisticsSettings:i.statisticsSettings||{},databaseSettings:i.databaseSettings||{},notificationSettings:i.notificationSettings||{},generalSettings:i.generalSettings||{},loading:(t==null?void 0:t.loading)||!1,saving:(t==null?void 0:t.saving)||!1,error:(t==null?void 0:t.error)||null,initialized:(t==null?void 0:t.initialized)||!1,updateSettings:h,updateSettingsWithValidation:o,saveSettings:d,loadSettings:c,exportSettings:b,importSettings:O,resetSettings:u,validationErrors:a,validateSettings:(x,v)=>Js(x,v),logInfo:(x,v)=>re("info",x,v),logError:(x,v)=>re("error",x,v)};return re("debug","usePreference 훅 반환값 생성 완료"),g},Qr=()=>{const s=r.useRef(!1);s.current||(re("debug","useDashboardSettings 훅 초기화"),s.current=!0);const{dashboardSettings:t,updateSettings:a,saving:l,error:i,validationErrors:h,logInfo:d}=Ye(),c=r.useMemo(()=>{const b={selectedPegs:[],defaultNe:"",defaultCellId:"",autoRefreshInterval:0,chartStyle:"line",showLegend:!0,showGrid:!0},O={...b,...t};return Array.isArray(t==null?void 0:t.selectedPegs)&&t.selectedPegs.length>0?O.selectedPegs=t.selectedPegs:O.selectedPegs=b.selectedPegs,re("debug","Dashboard 설정 처리 완료",{settings:O}),O},[t]),u=r.useCallback(b=>(d("Dashboard 설정 업데이트",b),a({dashboardSettings:b})),[a,d]),o=r.useMemo(()=>Object.fromEntries(Object.entries(h).filter(([b])=>b.startsWith("dashboardSettings."))),[h]);return{settings:c,updateSettings:u,saving:l,error:i,validationErrors:o,hasErrors:Object.keys(o).length>0}},Pt=()=>{const s=r.useRef(!1);s.current||(re("debug","useStatisticsSettings 훅 초기화"),s.current=!0);const{statisticsSettings:t,updateSettings:a,saving:l,error:i,validationErrors:h,logInfo:d}=Ye(),c=r.useCallback(o=>(d("Statistics 설정 업데이트",o),a({statisticsSettings:o})),[a,d]),u=r.useMemo(()=>Object.fromEntries(Object.entries(h).filter(([o])=>o.startsWith("statisticsSettings."))),[h]);return{settings:t,updateSettings:c,saving:l,error:i,validationErrors:u,hasErrors:Object.keys(u).length>0}},Xr=(s,t,a=null)=>{const i=`[DashboardHeader:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${i} ${t}`,a);break;case"error":console.error(`${i} ${t}`,a);break;case"warn":console.warn(`${i} ${t}`,a);break;case"debug":console.debug(`${i} ${t}`,a);break;default:console.log(`${i} ${t}`,a)}},Zs=({loading:s,saving:t,settingsError:a,selectedPegs:l,chartStyle:i,enableTimeComparison:h,defaultNe:d,defaultCellId:c,lastRefresh:u,onManualRefresh:o})=>(Xr("debug","DashboardHeader 렌더링",{loading:s,saving:t,settingsError:a,selectedPegsCount:l==null?void 0:l.length,chartStyle:i,enableTimeComparison:h,defaultNe:d,defaultCellId:c,lastRefresh:u}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Dashboard"}),e.jsxs("p",{className:"text-muted-foreground",children:[(l==null?void 0:l.length)||0,"개 PEG 항목 • 차트 스타일: ",i,h&&" • Time1/Time2 비교 모드",d&&` • NE: ${d}`,c&&` • Cell: ${c}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t&&e.jsxs(X,{variant:"secondary",className:"text-xs",children:[e.jsx(qe,{className:"h-3 w-3 mr-1"}),"설정 저장 중"]}),a&&e.jsx(X,{variant:"destructive",className:"text-xs",children:"설정 오류"}),h&&e.jsx(X,{variant:"default",className:"text-xs bg-blue-100 text-blue-800",children:"Time1/Time2 비교"}),u&&e.jsxs(X,{variant:"secondary",className:"text-xs",children:["마지막 업데이트: ",u.toLocaleTimeString()]}),e.jsxs(J,{variant:"outline",size:"sm",onClick:o,disabled:s,children:[e.jsx(es,{className:`h-4 w-4 mr-2 ${s?"animate-spin":""}`}),"새로고침"]})]})]}));function Ne({...s}){return e.jsx(ha,{"data-slot":"select",...s})}function we({...s}){return e.jsx(fa,{"data-slot":"select-value",...s})}function Se({className:s,size:t="default",children:a,...l}){return e.jsxs(xa,{"data-slot":"select-trigger","data-size":t,className:ne("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...l,children:[a,e.jsx(ga,{asChild:!0,children:e.jsx(ss,{className:"size-4 opacity-50"})})]})}function Ce({className:s,children:t,position:a="popper",...l}){return e.jsx(pa,{children:e.jsxs(ja,{"data-slot":"select-content",className:ne("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:a,...l,children:[e.jsx(en,{}),e.jsx(va,{className:ne("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),e.jsx(sn,{})]})})}function Q({className:s,children:t,...a}){return e.jsxs(ba,{"data-slot":"select-item",className:ne("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",s),...a,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(ya,{children:e.jsx(ze,{className:"size-4"})})}),e.jsx(Na,{children:t})]})}function en({className:s,...t}){return e.jsx(wa,{"data-slot":"select-scroll-up-button",className:ne("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(bs,{className:"size-4"})})}function sn({className:s,...t}){return e.jsx(Sa,{"data-slot":"select-scroll-down-button",className:ne("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(ss,{className:"size-4"})})}function ls({className:s,...t}){return e.jsx(Ca,{"data-slot":"switch",className:ne("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(ka,{"data-slot":"switch-thumb",className:ne("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}function V({className:s,...t}){return e.jsx(Da,{"data-slot":"label",className:ne("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...t})}const tn=(s,t,a=null)=>{const i=`[DashboardSettings:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${i} ${t}`,a);break;case"error":console.error(`${i} ${t}`,a);break;case"warn":console.warn(`${i} ${t}`,a);break;case"debug":console.debug(`${i} ${t}`,a);break;default:console.log(`${i} ${t}`,a)}},an=({defaultTimeRange:s,enableTimeComparison:t,tempTimeSettings:a,inputCompleted:l,loading:i,onUpdateDefaultTimeRange:h,onUpdateEnableTimeComparison:d,onUpdateTempTimeSetting:c,onApplyTime1Settings:u,onApplyTime2Settings:o,onToggleTime1Settings:b,onToggleTime2Settings:O,onManualRefresh:g})=>{var x,v,n,D,p,N,P,C;return tn("debug","DashboardSettings 렌더링",{defaultTimeRange:s,enableTimeComparison:t,tempTimeSettings:a,inputCompleted:l,onToggleTime1Settings:!!b,onToggleTime2Settings:!!O,loading:i}),e.jsxs(le,{children:[e.jsx(ge,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"h-5 w-5"}),"기본시간 설정"]})}),e.jsxs(ie,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(V,{htmlFor:"defaultTimeRange",className:"text-sm font-medium",children:"기본 시간 범위"}),e.jsxs(Ne,{value:s.toString(),onValueChange:h,children:[e.jsx(Se,{children:e.jsx(we,{placeholder:"시간 범위 선택"})}),e.jsxs(Ce,{children:[e.jsx(Q,{value:"5",children:"5분"}),e.jsx(Q,{value:"15",children:"15분"}),e.jsx(Q,{value:"30",children:"30분"}),e.jsx(Q,{value:"60",children:"1시간"}),e.jsx(Q,{value:"120",children:"2시간"}),e.jsx(Q,{value:"360",children:"6시간"}),e.jsx(Q,{value:"720",children:"12시간"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ls,{id:"enableTimeComparison",checked:t,onCheckedChange:d}),e.jsx(V,{htmlFor:"enableTimeComparison",className:"text-sm font-medium",children:"Time1/Time2 비교 활성화"})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-600",children:"Time1 설정"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(V,{className:"text-xs text-muted-foreground",children:"시작 시간"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx(V,{htmlFor:"time1StartDate",className:"text-xs",children:"날짜"}),e.jsx("input",{type:"date",id:"time1StartDate",className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",value:a.time1Start?a.time1Start.split("T")[0]:"",onChange:f=>{const w=a.time1Start?a.time1Start.split("T")[1]:"00:00";c("time1","Start",`${f.target.value}T${w}`)}})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"time1StartHour",className:"text-xs",children:"시간"}),e.jsxs(Ne,{value:a.time1Start&&((x=a.time1Start.split("T")[1])==null?void 0:x.split(":")[0])||"00",onValueChange:f=>{var y;const w=a.time1Start?a.time1Start.split("T")[0]:new Date().toISOString().split("T")[0],R=a.time1Start&&((y=a.time1Start.split("T")[1])==null?void 0:y.split(":")[1])||"00";c("time1","Start",`${w}T${f}:${R}`)},children:[e.jsx(Se,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:e.jsx(we,{})}),e.jsx(Ce,{children:Array.from({length:24},(f,w)=>e.jsx(Q,{value:w.toString().padStart(2,"0"),children:w.toString().padStart(2,"0")},w))})]})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"time1StartMinute",className:"text-xs",children:"분"}),e.jsxs(Ne,{value:a.time1Start&&((v=a.time1Start.split("T")[1])==null?void 0:v.split(":")[1])||"00",onValueChange:f=>{var y;const w=a.time1Start?a.time1Start.split("T")[0]:new Date().toISOString().split("T")[0],R=a.time1Start&&((y=a.time1Start.split("T")[1])==null?void 0:y.split(":")[0])||"00";c("time1","Start",`${w}T${R}:${f}`)},children:[e.jsx(Se,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:e.jsx(we,{})}),e.jsxs(Ce,{children:[e.jsx(Q,{value:"00",children:"00"}),e.jsx(Q,{value:"15",children:"15"}),e.jsx(Q,{value:"30",children:"30"}),e.jsx(Q,{value:"45",children:"45"})]})]})]})]})]}),e.jsxs("div",{children:[e.jsx(V,{className:"text-xs text-muted-foreground",children:"끝 시간"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx(V,{htmlFor:"time1EndDate",className:"text-xs",children:"날짜"}),e.jsx("input",{type:"date",id:"time1EndDate",className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",value:a.time1End?a.time1End.split("T")[0]:"",onChange:f=>{const w=a.time1End?a.time1End.split("T")[1]:"00:00";c("time1","End",`${f.target.value}T${w}`)}})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"time1EndHour",className:"text-xs",children:"시간"}),e.jsxs(Ne,{value:a.time1End&&((n=a.time1End.split("T")[1])==null?void 0:n.split(":")[0])||"00",onValueChange:f=>{var y;const w=a.time1End?a.time1End.split("T")[0]:new Date().toISOString().split("T")[0],R=a.time1End&&((y=a.time1End.split("T")[1])==null?void 0:y.split(":")[1])||"00";c("time1","End",`${w}T${f}:${R}`)},children:[e.jsx(Se,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:e.jsx(we,{})}),e.jsx(Ce,{children:Array.from({length:24},(f,w)=>e.jsx(Q,{value:w.toString().padStart(2,"0"),children:w.toString().padStart(2,"0")},w))})]})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"time1EndMinute",className:"text-xs",children:"분"}),e.jsxs(Ne,{value:a.time1End&&((D=a.time1End.split("T")[1])==null?void 0:D.split(":")[1])||"00",onValueChange:f=>{var y;const w=a.time1End?a.time1End.split("T")[0]:new Date().toISOString().split("T")[0],R=a.time1End&&((y=a.time1End.split("T")[1])==null?void 0:y.split(":")[0])||"00";c("time1","End",`${w}T${R}:${f}`)},children:[e.jsx(Se,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:e.jsx(we,{})}),e.jsxs(Ce,{children:[e.jsx(Q,{value:"00",children:"00"}),e.jsx(Q,{value:"15",children:"15"}),e.jsx(Q,{value:"30",children:"30"}),e.jsx(Q,{value:"45",children:"45"})]})]})]})]})]}),e.jsx(J,{onClick:u,disabled:!a.time1Start||!a.time1End||l.time1,size:"sm",className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:l.time1?e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Time1 설정 완료"]}):"Time1 설정 입력"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-green-600",children:"Time2 설정"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(V,{className:"text-xs text-muted-foreground",children:"시작 시간"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx(V,{htmlFor:"time2StartDate",className:"text-xs",children:"날짜"}),e.jsx("input",{type:"date",id:"time2StartDate",className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",value:a.time2Start?a.time2Start.split("T")[0]:"",onChange:f=>{const w=a.time2Start?a.time2Start.split("T")[1]:"00:00";c("time2","Start",`${f.target.value}T${w}`)}})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"time2StartHour",className:"text-xs",children:"시간"}),e.jsxs(Ne,{value:a.time2Start&&((p=a.time2Start.split("T")[1])==null?void 0:p.split(":")[0])||"00",onValueChange:f=>{var y;const w=a.time2Start?a.time2Start.split("T")[0]:new Date().toISOString().split("T")[0],R=a.time2Start&&((y=a.time2Start.split("T")[1])==null?void 0:y.split(":")[1])||"00";c("time2","Start",`${w}T${f}:${R}`)},children:[e.jsx(Se,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:e.jsx(we,{})}),e.jsx(Ce,{children:Array.from({length:24},(f,w)=>e.jsx(Q,{value:w.toString().padStart(2,"0"),children:w.toString().padStart(2,"0")},w))})]})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"time2StartMinute",className:"text-xs",children:"분"}),e.jsxs(Ne,{value:a.time2Start&&((N=a.time2Start.split("T")[1])==null?void 0:N.split(":")[1])||"00",onValueChange:f=>{var y;const w=a.time2Start?a.time2Start.split("T")[0]:new Date().toISOString().split("T")[0],R=a.time2Start&&((y=a.time2Start.split("T")[1])==null?void 0:y.split(":")[0])||"00";c("time2","Start",`${w}T${R}:${f}`)},children:[e.jsx(Se,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:e.jsx(we,{})}),e.jsxs(Ce,{children:[e.jsx(Q,{value:"00",children:"00"}),e.jsx(Q,{value:"15",children:"15"}),e.jsx(Q,{value:"30",children:"30"}),e.jsx(Q,{value:"45",children:"45"})]})]})]})]})]}),e.jsxs("div",{children:[e.jsx(V,{className:"text-xs text-muted-foreground",children:"끝 시간"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx(V,{htmlFor:"time2EndDate",className:"text-xs",children:"날짜"}),e.jsx("input",{type:"date",id:"time2EndDate",className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",value:a.time2End?a.time2End.split("T")[0]:"",onChange:f=>{const w=a.time2End?a.time2End.split("T")[1]:"00:00";c("time2","End",`${f.target.value}T${w}`)}})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"time2EndHour",className:"text-xs",children:"시간"}),e.jsxs(Ne,{value:a.time2End&&((P=a.time2End.split("T")[1])==null?void 0:P.split(":")[0])||"00",onValueChange:f=>{var y;const w=a.time2End?a.time2End.split("T")[0]:new Date().toISOString().split("T")[0],R=a.time2End&&((y=a.time2End.split("T")[1])==null?void 0:y.split(":")[1])||"00";c("time2","End",`${w}T${f}:${R}`)},children:[e.jsx(Se,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:e.jsx(we,{})}),e.jsx(Ce,{children:Array.from({length:24},(f,w)=>e.jsx(Q,{value:w.toString().padStart(2,"0"),children:w.toString().padStart(2,"0")},w))})]})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"time2EndMinute",className:"text-xs",children:"분"}),e.jsxs(Ne,{value:a.time2End&&((C=a.time2End.split("T")[1])==null?void 0:C.split(":")[1])||"00",onValueChange:f=>{var y;const w=a.time2End?a.time2End.split("T")[0]:new Date().toISOString().split("T")[0],R=a.time2End&&((y=a.time2End.split("T")[1])==null?void 0:y.split(":")[0])||"00";c("time2","End",`${w}T${R}:${f}`)},children:[e.jsx(Se,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:e.jsx(we,{})}),e.jsxs(Ce,{children:[e.jsx(Q,{value:"00",children:"00"}),e.jsx(Q,{value:"15",children:"15"}),e.jsx(Q,{value:"30",children:"30"}),e.jsx(Q,{value:"45",children:"45"})]})]})]})]})]}),e.jsx(J,{onClick:o,disabled:!a.time2Start||!a.time2End||l.time2,size:"sm",className:"w-full bg-green-600 hover:bg-green-700 text-white",children:l.time2?e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Time2 설정 완료"]}):"Time2 설정 입력"})]})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(J,{onClick:g,disabled:i||!l.time1||!l.time2,className:"bg-purple-600 hover:bg-purple-700 text-white",children:i?"데이터 로딩 중...":"Time1/Time2 비교 데이터 로드"})}),e.jsxs("div",{className:"flex justify-center gap-6 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`flex items-center gap-1 ${l.time1?"text-green-600":"text-gray-500"}`,children:[l.time1?e.jsx(ze,{className:"h-3 w-3"}):e.jsx(Oe,{className:"h-3 w-3"}),"Time1 설정 ",l.time1?"완료":"대기"]}),e.jsx(J,{variant:"outline",size:"sm",onClick:b,className:"h-6 px-2 text-xs",disabled:!b,children:l.time1?"수정":"완료"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`flex items-center gap-1 ${l.time2?"text-green-600":"text-gray-500"}`,children:[l.time2?e.jsx(ze,{className:"h-3 w-3"}):e.jsx(Oe,{className:"h-3 w-3"}),"Time2 설정 ",l.time2?"완료":"대기"]}),e.jsx(J,{variant:"outline",size:"sm",onClick:O,className:"h-6 px-2 text-xs",disabled:!O,children:l.time2?"수정":"완료"})]})]})]}),!t&&e.jsx(J,{onClick:g,disabled:i,className:"w-full",children:i?"데이터 로딩 중...":"데이터 새로고침"})]})]})]})},Ze=(s,t,a=null)=>{const i=`[DashboardChart:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${i} ${t}`,a);break;case"error":console.error(`${i} ${t}`,a);break;case"warn":console.warn(`${i} ${t}`,a);break;case"debug":console.debug(`${i} ${t}`,a);break;default:console.log(`${i} ${t}`,a)}},Ve=s=>{const t=["#8884d8","#82ca9d","#ffc658","#ff7300","#8dd1e1","#d084d0"];return s<t.length?t[s]:`hsl(${s*47%360}, 70%, 50%)`},$t=({chartData:s,chartKey:t,idx:a,chartStyle:l,showGrid:i,showLegend:h,enableTimeComparison:d,loading:c=!1,onRefresh:u,error:o=null})=>{const[b,O]=r.useState(!1),g=r.useCallback(async()=>{if(u){O(!0),Ze("info","차트별 새로고침 시작",{chartKey:t});try{await u(),Ze("info","차트별 새로고침 완료",{chartKey:t})}catch(p){Ze("error","차트별 새로고침 실패",{chartKey:t,error:p.message})}finally{O(!1)}}},[u,t]);if(Ze("debug","DashboardChart 렌더링",{chartKey:t,chartStyle:l,dataLength:s==null?void 0:s.length,loading:c,chartLoading:b,hasError:!!o,showGrid:i,showLegend:h,enableTimeComparison:d}),c||b)return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-pulse",children:e.jsx(Pe,{className:"h-12 w-12 text-muted-foreground mb-2"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:b?"차트 새로고침 중...":"데이터 로딩 중..."}),e.jsxs("div",{className:"flex space-x-1 mt-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]});if(o)return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-destructive",children:[e.jsx(Ee,{className:"h-12 w-12 mb-2"}),e.jsx("p",{className:"text-sm font-medium mb-1",children:"차트 로드 오류"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3 text-center max-w-32",children:o.message||"데이터를 불러올 수 없습니다"}),u&&e.jsxs(J,{variant:"outline",size:"sm",onClick:g,disabled:b,className:"text-xs",children:[e.jsx(es,{className:`h-3 w-3 mr-1 ${b?"animate-spin":""}`}),"다시 시도"]})]});if(!s||s.length===0)return Ze("warn","차트 데이터가 없음",{chartKey:t}),e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-muted-foreground",children:[e.jsx(Pe,{className:"h-12 w-12 mb-2 opacity-50"}),e.jsx("p",{className:"text-sm font-medium mb-1",children:"데이터가 없습니다"}),e.jsx("p",{className:"text-xs text-center max-w-32 mb-3",children:"선택한 조건에 맞는 데이터가 존재하지 않습니다"}),u&&e.jsxs(J,{variant:"outline",size:"sm",onClick:g,disabled:b,className:"text-xs",children:[e.jsx(es,{className:`h-3 w-3 mr-1 ${b?"animate-spin":""}`}),"새로고침"]})]});const x=s.length>0?Object.keys(s[0]).filter(p=>p!=="time"&&p!=="_originalTime"&&p!=="_isTime2"):[];Ze("debug","차트 엔티티 정보",{chartKey:t,entities:x,entitiesCount:x.length,hasTimeComparison:d,time1Entities:x.filter(p=>p.includes("_Time1")),time2Entities:x.filter(p=>p.includes("_Time2")),chartDataLength:s.length,sampleChartData:s.slice(0,2).map(p=>({time:p.time,_isTime2:p._isTime2,entityKeys:Object.keys(p).filter(N=>!N.startsWith("_"))}))});const v={data:s,className:"h-64"},n=(p,N)=>p,D=[i&&e.jsx(Ue,{strokeDasharray:"3 3"},"grid"),e.jsx(He,{dataKey:"time",tickFormatter:d?n:void 0,angle:d?-45:0,textAnchor:d?"end":"middle",height:d?80:60},"xaxis"),e.jsx(Me,{},"yaxis"),e.jsx(Le,{formatter:(p,N)=>{if(d){const P=N.replace("_Time1","").replace("_Time2","");return[p,P]}return[p,N]}},"tooltip"),h&&e.jsx(Re,{formatter:(p,N,P)=>d?p.replace("_Time1","").replace("_Time2",""):p},"legend")].filter(Boolean);try{switch(l){case"area":return e.jsx(Te,{width:"100%",height:"100%",children:e.jsxs(vt,{...v,children:[D,x.map((p,N)=>{if(d&&p.includes("_Time")){const P=p.replace("_Time1","").replace("_Time2",""),C=p.includes("_Time1");return e.jsx(ns,{type:"monotone",dataKey:p,stroke:Ve((a+N)%12),fill:Ve((a+N)%12),fillOpacity:.3,strokeWidth:2,strokeDasharray:C?void 0:"5 5",name:`${P} (${C?"Time1":"Time2"})`},p)}else return e.jsx(ns,{type:"monotone",dataKey:p,stroke:Ve((a+N)%12),fill:Ve((a+N)%12),fillOpacity:.3,strokeWidth:2},p)})]})});case"bar":return e.jsx(Te,{width:"100%",height:"100%",children:e.jsxs(js,{...v,children:[D,x.map((p,N)=>{if(d&&p.includes("_Time")){const P=p.replace("_Time1","").replace("_Time2",""),C=p.includes("_Time1");return e.jsx(Ie,{dataKey:p,fill:Ve((a+N)%12),name:`${P} (${C?"Time1":"Time2"})`},p)}else return e.jsx(Ie,{dataKey:p,fill:Ve((a+N)%12)},p)})]})});case"line":default:return e.jsx(Te,{width:"100%",height:"100%",children:e.jsxs(Fs,{...v,children:[D,x.map((p,N)=>{if(d&&p.includes("_Time")){const P=p.replace("_Time1","").replace("_Time2",""),C=p.includes("_Time1");return e.jsx(Ge,{type:"monotone",dataKey:p,stroke:Ve((a+N)%12),strokeWidth:2,strokeDasharray:C?void 0:"5 5",name:`${P} (${C?"Time1":"Time2"})`},p)}else return e.jsx(Ge,{type:"monotone",dataKey:p,stroke:Ve((a+N)%12),strokeWidth:2},p)})]})})}}catch(p){return Ze("error","차트 렌더링 오류",{key,error:p}),e.jsx("div",{className:"h-full flex items-center justify-center text-red-500",children:"차트 렌더링 오류"})}},rn=(s,t,a=null)=>{const i=`[DashboardCard:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${i} ${t}`,a);break;case"error":console.error(`${i} ${t}`,a);break;case"warn":console.warn(`${i} ${t}`,a);break;case"debug":console.debug(`${i} ${t}`,a);break;default:console.log(`${i} ${t}`,a)}},Qs=s=>s,Xs=({chartKey:s,idx:t,title:a,chartData:l,chartStyle:i,chartLayout:h,enableTimeComparison:d,showGrid:c,showLegend:u,onZoom:o,loading:b=!1,onRefresh:O,error:g=null})=>{rn("debug","DashboardCard 렌더링",{chartKey:s,idx:t,title:a,chartStyle:i,chartLayout:h,dataLength:l==null?void 0:l.length,loading:b,hasError:!!g,enableTimeComparison:d,chartDataType:Array.isArray(l)?"array":typeof l,chartDataSample:(l==null?void 0:l.length)>0?{firstItem:{time:l[0].time,_isTime2:l[0]._isTime2,entityCount:Object.keys(l[0]).filter(n=>!n.startsWith("_")).length,entities:Object.keys(l[0]).filter(n=>!n.startsWith("_"))},totalItems:l.length}:null});const x=(l==null?void 0:l.length)>0?Object.keys(l[0]).filter(n=>n!=="time"):[],v=`w-full ${g?"border-destructive":""} ${b?"opacity-75":""}`;return e.jsxs(le,{className:v,children:[e.jsx(ge,{children:e.jsxs(fe,{className:"flex items-center justify-between",children:[Qs(a),e.jsxs("div",{className:"flex items-center gap-2",children:[d&&e.jsx(X,{variant:"default",className:"text-xs bg-blue-100 text-blue-800",children:"Time1/Time2 비교"}),e.jsxs(X,{variant:"outline",className:"text-xs",children:[x.length,"개 시리즈"]}),e.jsxs(X,{variant:"secondary",className:"text-xs",children:[(l==null?void 0:l.length)||0,"개 데이터포인트"]})]})]})}),e.jsx(ie,{children:e.jsx("div",{className:"h-64 cursor-zoom-in",onClick:()=>o({open:!0,title:Qs(a),data:l}),children:e.jsx($t,{chartData:l,chartKey:s,idx:t,chartStyle:i,showGrid:c,showLegend:u,enableTimeComparison:d,loading:b,onRefresh:O,error:g})})})]},`${s}-${t}`)},he=(s,t,a=null)=>{const i=`[Dashboard:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${i} ${t}`,a);break;case"error":console.error(`${i} ${t}`,a);break;case"warn":console.warn(`${i} ${t}`,a);break;case"debug":console.debug(`${i} ${t}`,a);break;default:console.log(`${i} ${t}`,a)}},At=()=>{const s=r.useRef(!1);s.current||(he("debug","Dashboard 컴포넌트 초기화"),s.current=!0);const[t,a]=r.useState({}),[l,i]=r.useState(null),[h,d]=r.useState(!1),[c,u]=r.useState(null),[o,b]=r.useState({open:!1,title:"",data:[]}),[O,g]=r.useState({time1Start:"",time1End:"",time2Start:"",time2End:""}),[x,v]=r.useState({time1:!1,time2:!1}),{settings:n={},saving:D=!1,error:p=null,updateSettings:N=()=>{}}=Qr(),{settings:P={}}=Ye(),C=r.useMemo(()=>Array.isArray(n==null?void 0:n.selectedPegs)?n.selectedPegs:[],[n==null?void 0:n.selectedPegs]),f=r.useMemo(()=>(P==null?void 0:P.statisticsSettings)||{},[P==null?void 0:P.statisticsSettings]),w=r.useMemo(()=>Array.isArray(f.selectedNEs)?f.selectedNEs:[],[f.selectedNEs]),R=r.useMemo(()=>Array.isArray(f.selectedCellIds)?f.selectedCellIds:[],[f.selectedCellIds]),y=r.useMemo(()=>(n==null?void 0:n.chartStyle)||"line",[n==null?void 0:n.chartStyle]),A=r.useMemo(()=>(n==null?void 0:n.chartLayout)||"byPeg",[n==null?void 0:n.chartLayout]),m=r.useMemo(()=>(n==null?void 0:n.showLegend)!==!1,[n==null?void 0:n.showLegend]),j=r.useMemo(()=>(n==null?void 0:n.showGrid)!==!1,[n==null?void 0:n.showGrid]),S=r.useMemo(()=>(n==null?void 0:n.defaultNe)||"",[n==null?void 0:n.defaultNe]),G=r.useMemo(()=>(n==null?void 0:n.defaultCellId)||"",[n==null?void 0:n.defaultCellId]),M=r.useMemo(()=>(n==null?void 0:n.defaultTimeRange)||30,[n==null?void 0:n.defaultTimeRange]),K=r.useMemo(()=>(n==null?void 0:n.time1Start)||"",[n==null?void 0:n.time1Start]),te=r.useMemo(()=>(n==null?void 0:n.time1End)||"",[n==null?void 0:n.time1End]),de=r.useMemo(()=>(n==null?void 0:n.time2Start)||"",[n==null?void 0:n.time2Start]),L=r.useMemo(()=>(n==null?void 0:n.time2End)||"",[n==null?void 0:n.time2End]),I=r.useMemo(()=>(n==null?void 0:n.enableTimeComparison)||!1,[n==null?void 0:n.enableTimeComparison]),Y=r.useCallback(z=>{he("info","기본시간범위 업데이트",{value:z}),N({defaultTimeRange:parseInt(z)})},[N]),U=r.useCallback(z=>{he("info","토글 상태 변경",{checked:z}),N({enableTimeComparison:z})},[N]),E=r.useCallback((z,me,ue)=>{he("debug","임시 시간 설정 업데이트",{type:z,field:me,value:ue}),g(ce=>({...ce,[`${z}${me}`]:ue}))},[]),q=r.useCallback(()=>{O.time1Start&&O.time1End&&(he("info","Time1 설정 적용",{start:O.time1Start,end:O.time1End}),N({time1Start:O.time1Start,time1End:O.time1End}),v(z=>({...z,time1:!0})))},[O.time1Start,O.time1End,N]),_=r.useCallback(()=>{O.time2Start&&O.time2End&&(he("info","Time2 설정 적용",{start:O.time2Start,end:O.time2End}),N({time2Start:O.time2Start,time2End:O.time2End}),v(z=>({...z,time2:!0})))},[O.time2Start,O.time2End,N]),H=r.useCallback(()=>{he("info","Time1 설정 토글",{currentState:x.time1,newState:!x.time1}),v(z=>({...z,time1:!z.time1}))},[x.time1]),W=r.useCallback(()=>{he("info","Time2 설정 토글",{currentState:x.time2,newState:!x.time2}),v(z=>({...z,time2:!z.time2}))},[x.time2]),B=r.useCallback(async()=>{var ce,ke,oe,T;he("info","데이터 fetching 시작");const z=C.length>0?C:["randomaccessproblem"],me=w.length>0?w:["NVGNB#101086"],ue=R.length>0?R.map(F=>parseInt(F)):[8418];if(he("debug","데이터 fetching 파라미터",{selectedPegs:C,safeSelectedPegs:z,selectedNEs:w,safeSelectedNEs:me,selectedCellIds:R,safeSelectedCellIds:ue,defaultNe:S,defaultCellId:G,enableTimeComparison:I,time1Start:K,time1End:te,time2Start:de,time2End:L}),z.length===0){he("warn","선택된 PEG가 없음 - 데이터 fetching 중단"),a({}),i(null),d(!1);return}try{if(d(!0),I&&K&&te&&de&&L){he("info","Time1/Time2 비교 모드로 데이터 fetching");const F={start_date:K,end_date:te,kpi_types:z,ne:me,cellid:ue};he("debug","Time1 API 파라미터",F);const $=await ve.post("/api/kpi/query",F),ee={start_date:de,end_date:L,kpi_types:z,ne:me,cellid:ue};he("debug","Time2 API 파라미터",ee),he("debug","설정된 시간 범위",{time1Start:K,time1End:te,time2Start:de,time2End:L,time1Duration:`${Math.abs(new Date(te)-new Date(K))/(1e3*60)}분`,time2Duration:`${Math.abs(new Date(L)-new Date(de))/(1e3*60)}분`});const ae=await ve.post("/api/kpi/query",ee),pe=((ce=$==null?void 0:$.data)==null?void 0:ce.data)||{},je=((ke=ae==null?void 0:ae.data)==null?void 0:ke.data)||{};a(pe),i(je),he("debug","데이터 저장 후 상태",{kpiDataKeys:Object.keys(pe),time2DataKeys:Object.keys(je),time2DataSample:Object.keys(je).length>0?{firstKey:Object.keys(je)[0],firstKeyDataLength:((oe=je[Object.keys(je)[0]])==null?void 0:oe.length)||0}:null}),he("info","Time1/Time2 데이터 fetching 완료",{time1KpiCount:Object.keys(pe).length,time1TotalRows:Object.values(pe).reduce((Fe,Je)=>Fe+((Je==null?void 0:Je.length)||0),0),time2KpiCount:Object.keys(je).length,time2TotalRows:Object.values(je).reduce((Fe,Je)=>Fe+((Je==null?void 0:Je.length)||0),0),time1DataKeys:Object.keys(pe),time2DataKeys:Object.keys(je)})}else{he("info","일반 모드로 데이터 fetching");const F=new Date,$=new Date(F.getTime()-((n==null?void 0:n.defaultHours)||1)*60*60*1e3),ee={kpi_types:z,ne:me,cellid:ue,start:$.toISOString(),end:F.toISOString()};he("debug","일반 모드 API 파라미터",ee);const ae=await ve.post("/api/kpi/timeseries",ee),pe=((T=ae==null?void 0:ae.data)==null?void 0:T.data)||{};a(pe),i(null),he("info","일반 모드 데이터 fetching 완료",{kpiCount:Object.keys(pe).length,totalRows:Object.values(pe).reduce((je,Fe)=>je+((Fe==null?void 0:Fe.length)||0),0),dataKeys:Object.keys(pe)})}u(new Date)}catch(F){he("error","데이터 fetching 오류",F),a({}),i(null)}finally{d(!1)}},[C,w,R,n==null?void 0:n.defaultHours,S,G,I,K,te,de,L]);r.useEffect(()=>{const z=setTimeout(()=>{he("info","설정 변경으로 인한 데이터 로드 시작"),B()},500);return()=>clearTimeout(z)},[C,w,R,n==null?void 0:n.defaultHours,S,G,I,K,te,de,L]);const Z=r.useCallback(()=>{he("info","수동 새로고침 실행"),B()},[B]),be=r.useCallback(z=>{he("debug","차트 데이터 구성",{kpiKey:z,chartLayout:A});const me=Array.isArray(t[z])?t[z]:[],ue=I&&l?Array.isArray(l[z])?l[z]:[]:[];if(he("debug","차트 데이터 구성 - 데이터 상태 확인",{kpiKey:z,kpiDataExists:!!t,time2DataExists:!!l,kpiDataKeys:Object.keys(t||{}),time2DataKeys:Object.keys(l||{}),kpiDataHasKey:!!(t&&t[z]),time2DataHasKey:!!(l&&l[z]),flatRowsLength:me.length,time2RowsLength:ue.length}),me.length===0&&ue.length===0)return he("warn","차트 데이터 없음 - 데이터 구성 실패",{kpiKey:z,flatRowsLength:me.length,time2RowsLength:ue.length}),[];if(A==="byPeg"){const ce={};let ke=0;he("debug","차트 데이터 구성 시작",{kpiKey:z,time1RowsCount:me.length,time2RowsCount:ue.length,enableTimeComparison:I,time2DataKeys:Object.keys(l||{}),time2DataHasKpiKey:!!(l&&l[z])}),me.forEach(T=>{const F=new Date(T.timestamp),$=`T1_${ke++}_${F.getTime()}`,ee=F.toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"});ce[$]||(ce[$]={time:ee,_originalTime:F});const ae=I?`${T.entity_id}_Time1`:T.entity_id;ce[$][ae]=T.value}),I&&ue.length>0?(he("debug","Time2 데이터 처리 시작",{time2RowsCount:ue.length,time2RowsSample:ue.slice(0,2).map(T=>({entity_id:T.entity_id,timestamp:T.timestamp,value:T.value}))}),ue.forEach(T=>{const F=new Date(T.timestamp),$=`T2_${ke++}_${F.getTime()}`,ee=F.toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"});ce[$]||(ce[$]={time:ee,_originalTime:F,_isTime2:!0});const ae=`${T.entity_id}_Time2`;ce[$][ae]=T.value}),he("debug","Time2 데이터 처리 완료",{processedTime2Rows:ue.length,groupedByTimeKeys:Object.keys(ce).length,time2KeysInGrouped:Object.keys(ce).filter(T=>T.startsWith("T2_")).length})):he("debug","Time2 데이터 처리 건너뜀",{enableTimeComparison:I,time2RowsLength:ue.length,reason:I?"Time2 데이터 없음":"비교 모드 비활성화"});const oe=Object.values(ce).sort((T,F)=>T._originalTime.getTime()-F._originalTime.getTime());return he("info","Time1/Time2 데이터 구성 완료",{kpiKey:z,time1Count:me.length,time2Count:ue.length,totalDataPoints:oe.length,timeRange:oe.length>0?{first:oe[0].time,last:oe[oe.length-1].time}:null,sampleDataPoints:oe.slice(0,3).map(T=>({time:T.time,_isTime2:T._isTime2,entityCount:Object.keys(T).filter(F=>!F.startsWith("_")).length,entities:Object.keys(T).filter(F=>!F.startsWith("_"))})),time1Entities:me.length>0?Object.keys(me[0]).filter(T=>T!=="timestamp"):[],time2Entities:ue.length>0?Object.keys(ue[0]).filter(T=>T!=="timestamp"):[]}),he("debug","buildChartDataByLayout 최종 반환 데이터",{kpiKey:z,returnedDataLength:oe.length,totalTime1Data:oe.filter(T=>!T._isTime2).length,totalTime2Data:oe.filter(T=>T._isTime2).length,returnedData:oe.slice(0,3).map(T=>({time:T.time,_isTime2:T._isTime2,entityCount:Object.keys(T).filter(F=>!F.startsWith("_")).length,entities:Object.keys(T).filter(F=>!F.startsWith("_")),sampleValues:Object.keys(T).filter(F=>!F.startsWith("_")).slice(0,2).map(F=>({key:F,value:T[F]}))}))}),oe}else{const ce={};me.forEach(oe=>{const T=new Date(oe.timestamp).toLocaleString(),F=oe.entity_id;ce[F]=ce[F]||{},ce[F][T]=ce[F][T]||{time:T},ce[F][T][oe.peg_name]=oe.value}),I&&ue.forEach(oe=>{const T=new Date(oe.timestamp).toLocaleString()+" (T2)",F=oe.entity_id;ce[F]=ce[F]||{},ce[F][T]=ce[F][T]||{time:T},ce[F][T][oe.peg_name+"_Time2"]=oe.value});const ke={};return Object.keys(ce).forEach(oe=>{ke[oe]=Object.values(ce[oe]).sort((T,F)=>new Date(T.time.replace(" (T2)",""))-new Date(F.time.replace(" (T2)","")))}),ke}},[t,l,I,A]);return h?(he("debug","로딩 상태 렌더링"),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Zs,{loading:h,saving:D,settingsError:p,selectedPegs:C,chartStyle:y,enableTimeComparison:I,defaultNe:S,defaultCellId:G,lastRefresh:c,onManualRefresh:Z}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:C.map(z=>e.jsx(le,{children:e.jsx(ie,{className:"pt-6",children:e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading..."})})})},z))})]})):(he("debug","Dashboard 메인 렌더링"),e.jsxs("div",{className:"space-y-6",children:[e.jsx(an,{defaultTimeRange:M,enableTimeComparison:I,tempTimeSettings:O,inputCompleted:x,loading:h,onUpdateDefaultTimeRange:Y,onUpdateEnableTimeComparison:U,onUpdateTempTimeSetting:E,onApplyTime1Settings:q,onApplyTime2Settings:_,onToggleTime1Settings:H,onToggleTime2Settings:W,onManualRefresh:Z}),e.jsx(Zs,{loading:h,saving:D,settingsError:p,selectedPegs:C,chartStyle:y,enableTimeComparison:I,defaultNe:S,defaultCellId:G,lastRefresh:c,onManualRefresh:Z}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(X,{variant:"default",children:["선택된 PEG: ",C.join(", ")]}),I&&e.jsx(X,{variant:"default",className:"bg-blue-100 text-blue-800",children:"Time1/Time2 비교 활성화"}),e.jsxs(X,{variant:"outline",children:["차트 스타일: ",y]}),!m&&e.jsx(X,{variant:"secondary",children:"범례 숨김"}),!j&&e.jsx(X,{variant:"secondary",children:"격자 숨김"})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:C.map((z,me)=>{he("debug","차트 렌더링 시작",{key:z,idx:me,selectedPegs:C,totalSelectedPegs:C.length});const ue=be(z);if(A==="byPeg"){const ce=Array.isArray(ue)?ue:[];return he("debug","차트 데이터 생성 결과",{key:z,chartDataLength:ce.length,builtType:Array.isArray(ue)?"array":typeof ue}),e.jsx(Xs,{chartKey:z,idx:me,title:z,chartData:ce,chartStyle:y,chartLayout:A,enableTimeComparison:I,showGrid:j,showLegend:m,onZoom:b,loading:h,onRefresh:Z,error:null},`${z}-${me}`)}else{const ce=ue||{};return Object.keys(ce).map((ke,oe)=>{const T=ce[ke];return e.jsx(Xs,{idx:me+oe,title:ke,chartData:T,chartStyle:y,chartLayout:A,enableTimeComparison:I,showGrid:j,showLegend:m,onZoom:b,loading:h,onRefresh:Z,error:null},`${z}-${ke}-${oe}`)})}})}),e.jsx(wt,{open:o.open,onOpenChange:z=>b(me=>({...me,open:z})),children:e.jsxs(St,{className:"max-w-6xl",children:[e.jsx(Ct,{children:e.jsx(kt,{children:o.title})}),e.jsx("div",{className:"h-[480px]",children:Array.isArray(o.data)&&o.data.length>0&&e.jsx($t,{chartData:o.data,idx:0,chartStyle:y,showGrid:j,showLegend:m,enableTimeComparison:I,loading:!1,onRefresh:null,error:null},"zoom")})]})}),C.length===0&&e.jsx(le,{children:e.jsx(ie,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Xe,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"표시할 PEG가 선택되지 않았습니다"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Preference 메뉴에서 표시할 PEG 항목을 선택하세요."}),e.jsxs(J,{variant:"outline",onClick:()=>{console.log("Navigate to Preference menu")},children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),"Preference 설정"]})]})})}),h&&C.length>0&&e.jsx(le,{children:e.jsx(ie,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-pulse",children:e.jsx(Pe,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"})}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"데이터 로딩 중..."}),e.jsx("p",{className:"text-muted-foreground",children:"선택한 PEG의 데이터를 불러오고 있습니다."}),e.jsxs("div",{className:"flex justify-center space-x-1 mt-4",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})})})]}))},Tt=Object.freeze(Object.defineProperty({__proto__:null,default:At},Symbol.toStringTag,{value:"Module"}));function Ns({className:s,...t}){return e.jsx(_a,{"data-slot":"tabs",className:ne("flex flex-col gap-2",s),...t})}function ws({className:s,...t}){return e.jsx(Ea,{"data-slot":"tabs-list",className:ne("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",s),...t})}function $e({className:s,...t}){return e.jsx(Pa,{"data-slot":"tabs-trigger",className:ne("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...t})}function Ae({className:s,...t}){return e.jsx($a,{"data-slot":"tabs-content",className:ne("flex-1 outline-none",s),...t})}function ye({className:s,type:t,...a}){return e.jsx("input",{type:t,"data-slot":"input",className:ne("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...a})}function is({className:s,...t}){return e.jsx(Aa,{"data-slot":"checkbox",className:ne("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Ta,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(ze,{className:"size-3.5"})})})}const Ot=r.memo(({chartConfig:s,onConfigChange:t,kpiOptions:a,loading:l,onGenerate:i,useDbPegs:h,onToggleDbPegs:d,pegOptionsLoading:c,dbPegOptions:u})=>{const o=(g,x)=>{t(v=>({...v,[g]:x}))},b=()=>{var g,x;try{const v=localStorage.getItem("activePreference");if(!v)return;const n=JSON.parse(v),D=Array.isArray((g=n==null?void 0:n.config)==null?void 0:g.defaultNEs)?n.config.defaultNEs.map(String):[],p=Array.isArray((x=n==null?void 0:n.config)==null?void 0:x.defaultCellIDs)?n.config.defaultCellIDs.map(String):[];t(N=>({...N,ne:D.join(","),cellid:p.join(",")}))}catch{}},O=()=>h&&u.length>0?u:a;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(V,{className:"text-sm font-medium",children:"PEG 데이터 소스"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:h?"Database에서 실제 PEG 목록을 사용합니다":"기본 KPI 목록을 사용합니다"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{variant:h?"secondary":"default",size:"sm",onClick:()=>d(!1),children:"기본 KPI"}),e.jsx(J,{variant:h?"default":"secondary",size:"sm",onClick:()=>d(!0),disabled:c,children:c?"로딩 중...":"DB PEG"})]})]}),h&&u.length===0&&!c&&e.jsx("p",{className:"text-xs text-amber-600 mt-2",children:"⚠️ DB PEG를 불러올 수 없습니다. Database Settings를 확인하세요."}),h&&u.length>0&&e.jsxs("p",{className:"text-xs text-green-600 mt-2",children:["✅ ",u.length,"개의 DB PEG를 사용할 수 있습니다"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Primary KPI"}),e.jsxs(Ne,{value:s.primaryKPI,onValueChange:g=>o("primaryKPI",g),children:[e.jsx(Se,{children:e.jsx(we,{})}),e.jsx(Ce,{children:O().map(g=>e.jsx(Q,{value:g.value,children:g.label},g.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Secondary KPI (Dual Axis)"}),e.jsxs(Ne,{value:s.secondaryKPI,onValueChange:g=>o("secondaryKPI",g),disabled:!s.showSecondaryAxis,children:[e.jsx(Se,{children:e.jsx(we,{})}),e.jsx(Ce,{children:O().map(g=>e.jsx(Q,{value:g.value,children:g.label},g.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Period 1 Start"}),e.jsx(ye,{type:"date",value:s.startDate1,onChange:g=>o("startDate1",g.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Period 1 End"}),e.jsx(ye,{type:"date",value:s.endDate1,onChange:g=>o("endDate1",g.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Period 2 Start"}),e.jsx(ye,{type:"date",value:s.startDate2,onChange:g=>o("startDate2",g.target.value),disabled:!s.showComparison})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Period 2 End"}),e.jsx(ye,{type:"date",value:s.endDate2,onChange:g=>o("endDate2",g.target.value),disabled:!s.showComparison})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"NE"}),e.jsx(ye,{placeholder:"e.g., nvgnb#10000 or nvgnb#10000,nvgnb#20000",value:s.ne,onChange:g=>o("ne",g.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Cell ID"}),e.jsx(ye,{placeholder:"e.g., 2010 or 2010,2011",value:s.cellid,onChange:g=>o("cellid",g.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Use Preference (NE/Cell)"}),e.jsx(J,{type:"button",variant:"outline",onClick:b,children:"Load from Preference"})]})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(is,{id:"showComparison",checked:s.showComparison,onCheckedChange:g=>o("showComparison",g)}),e.jsx(V,{htmlFor:"showComparison",children:"Show Period Comparison"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(is,{id:"showSecondaryAxis",checked:s.showSecondaryAxis,onCheckedChange:g=>o("showSecondaryAxis",g)}),e.jsx(V,{htmlFor:"showSecondaryAxis",children:"Show Secondary Y-Axis"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(is,{id:"showThreshold",checked:s.showThreshold,onCheckedChange:g=>o("showThreshold",g)}),e.jsx(V,{htmlFor:"showThreshold",children:"Show Threshold Line"})]}),s.showThreshold&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{htmlFor:"threshold",children:"Threshold Value:"}),e.jsx(ye,{id:"threshold",type:"number",step:"0.1",value:s.thresholdValue,onChange:g=>o("thresholdValue",parseFloat(g.target.value)),className:"w-24"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(J,{onClick:i,disabled:l,className:"flex items-center gap-2",children:[e.jsx(gs,{className:"h-4 w-4"}),l?"Generating...":"Generate Chart"]})})]})});Ot.displayName="ChartControls";const It=r.memo(({chartData:s,chartConfig:t,loading:a,kpiOptions:l,useDbPegs:i,dbPegOptions:h})=>{const d=r.useMemo(()=>{if(s.length===0)return{primary:[],secondary:[]};const o=Object.keys(s[0]).filter(g=>g!=="time"),b=o.filter(g=>g.endsWith("_period1")||g.endsWith("_period2")),O=o.filter(g=>g.endsWith("_secondary"));return{primary:b,secondary:O}},[s]),{primary:c,secondary:u}=d;return s.length===0?e.jsx("div",{className:"flex items-center justify-center h-96 text-gray-500",children:a?"Generating chart...":'Click "Generate Chart" to create visualization'}):e.jsx("div",{className:"h-96",children:e.jsx(Te,{width:"100%",height:"100%",children:e.jsxs(Fs,{data:s,children:[e.jsx(Ue,{strokeDasharray:"3 3"}),e.jsx(He,{dataKey:"time"}),e.jsx(Me,{yAxisId:"left"}),t.showSecondaryAxis&&e.jsx(Me,{yAxisId:"right",orientation:"right"}),e.jsx(Le,{}),e.jsx(Re,{}),t.showThreshold&&e.jsx(jr,{y:t.thresholdValue,stroke:"red",strokeDasharray:"5 5",yAxisId:"left"}),c.map((o,b)=>e.jsx(Ge,{yAxisId:"left",type:"monotone",dataKey:o,stroke:o.includes("period1")?`hsl(${b*60}, 70%, 40%)`:`hsl(${b*60}, 70%, 60%)`,strokeWidth:2,strokeDasharray:o.includes("period1")?"0":"5 5"},o)),t.showSecondaryAxis&&u.map((o,b)=>e.jsx(Ge,{yAxisId:"right",type:"monotone",dataKey:o,stroke:`hsl(${(b+c.length)*60}, 70%, 50%)`,strokeWidth:2,strokeDasharray:"10 5"},o))]})})})});It.displayName="ChartDisplay";const Ps=[{value:"availability",label:"Availability (%)",threshold:99},{value:"rrc",label:"RRC Success Rate (%)",threshold:98.5},{value:"erab",label:"ERAB Success Rate (%)",threshold:99},{value:"sar",label:"SAR",threshold:2.5},{value:"mobility_intra",label:"Mobility Intra (%)",threshold:95},{value:"cqi",label:"CQI",threshold:8}],Vs=r.memo(()=>{var N,P;const[s,t]=r.useState({primaryKPI:"availability",secondaryKPI:"rrc",startDate1:new Date(Date.now()-12096e5).toISOString().split("T")[0],endDate1:new Date(Date.now()-6048e5).toISOString().split("T")[0],startDate2:new Date(Date.now()-6048e5).toISOString().split("T")[0],endDate2:new Date().toISOString().split("T")[0],ne:"",cellid:"",showSecondaryAxis:!0,showComparison:!0,showThreshold:!0,thresholdValue:99}),[a,l]=r.useState([]),[i,h]=r.useState(!1),[d,c]=r.useState(!1),[u,o]=r.useState(Ps),[b,O]=r.useState([]),[g,x]=r.useState(!1),v=r.useMemo(()=>g&&b.length>0?b:u,[g,b,u]),n=r.useCallback(async()=>{var C;try{c(!0),console.info("[AdvancedChart] Fetching DB PEGs");let f={};try{const A=localStorage.getItem("dbConfig");A&&(f=JSON.parse(A))}catch(A){console.error("Error parsing dbConfig from localStorage",A)}if(!f.host){console.warn("[AdvancedChart] No DB config found");return}const w=await ve.post("/api/master/pegs",{db:f,table:f.table||"summary",limit:100}),R=((C=w==null?void 0:w.data)==null?void 0:C.pegs)||[];console.info("[AdvancedChart] DB PEGs loaded:",R.length);const y=R.map(A=>({value:A.id||A.name,label:`${A.name||A.id} (DB)`,threshold:0,isDbPeg:!0}));O(y)}catch(f){console.error("[AdvancedChart] Error fetching DB PEGs:",f)}finally{c(!1)}},[]),D=r.useCallback((C,f)=>{var j,S;if(!C||C.length===0)return[];const w=((S=(j=C[0])==null?void 0:j.data)==null?void 0:S.data)||[],R=f.showComparison&&C[1]?C[1].data.data:[],y=f.showSecondaryAxis&&C[2]?C[2].data.data:[],A={};function m(G,M){const K={};G.forEach(te=>{const de=new Date(te.timestamp).toLocaleString();K[de]||(K[de]={sum:0,cnt:0}),K[de].sum+=Number(te.value)||0,K[de].cnt+=1}),Object.keys(K).forEach(te=>{A[te]||(A[te]={time:te});const de=K[te].cnt>0?+(K[te].sum/K[te].cnt).toFixed(2):0;A[te][M]=de})}return m(w,`${f.primaryKPI}_period1`),f.showComparison&&m(R,`${f.primaryKPI}_period2`),f.showSecondaryAxis&&m(y,`${f.secondaryKPI}_secondary`),Object.values(A).sort((G,M)=>new Date(G.time)-new Date(M.time)).slice(0,200)},[]),p=r.useCallback(async()=>{try{h(!0),console.info("[AdvancedChart] Generate with config:",s,"useDbPegs:",g);const C=[];C.push(ve.post("/api/kpi/query",{start_date:s.startDate1,end_date:s.endDate1,kpi_type:s.primaryKPI,ne:s.ne,cellid:s.cellid,ids:2})),s.showComparison&&C.push(ve.post("/api/kpi/query",{start_date:s.startDate2,end_date:s.endDate2,kpi_type:s.primaryKPI,ne:s.ne,cellid:s.cellid,ids:2})),s.showSecondaryAxis&&s.secondaryKPI!==s.primaryKPI&&C.push(ve.post("/api/kpi/query",{start_date:s.startDate2,end_date:s.endDate2,kpi_type:s.secondaryKPI,ne:s.ne,cellid:s.cellid,ids:2}));const f=await Promise.all(C);console.info("[AdvancedChart] API responses:",f.map(R=>{var y,A;return((A=(y=R==null?void 0:R.data)==null?void 0:y.data)==null?void 0:A.length)??0}));const w=D(f,s);l(w)}catch(C){console.error("[AdvancedChart] Error generating advanced chart:",C)}finally{h(!1)}},[s,g,D]);return r.useEffect(()=>{var C;try{const f=localStorage.getItem("activePreference");if(f){const w=JSON.parse(f),R=Array.isArray((C=w==null?void 0:w.config)==null?void 0:C.availableKPIs)&&w.config.availableKPIs.length>0?w.config.availableKPIs.map(A=>({value:String((A==null?void 0:A.value)||""),label:String((A==null?void 0:A.label)||(A==null?void 0:A.value)||""),threshold:Number((A==null?void 0:A.threshold)??0)})):Ps;o(R);const y=R.map(A=>A.value);t(A=>{var m,j,S,G;return{...A,primaryKPI:y.includes(A.primaryKPI)?A.primaryKPI:((m=R[0])==null?void 0:m.value)||"availability",secondaryKPI:y.includes(A.secondaryKPI)?A.secondaryKPI:((j=R[1])==null?void 0:j.value)||((S=R[0])==null?void 0:S.value)||"rrc",thresholdValue:((G=R.find(M=>{var K;return M.value===(y.includes(A.primaryKPI)?A.primaryKPI:((K=R[0])==null?void 0:K.value)||"availability")}))==null?void 0:G.threshold)??A.thresholdValue}})}}catch{o(Ps)}},[]),r.useEffect(()=>{g&&b.length===0&&n()},[g,b.length,n]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(le,{children:[e.jsx(ge,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-5 w-5"}),"Advanced Chart Configuration"]})}),e.jsx(ie,{children:e.jsx(Ot,{chartConfig:s,onConfigChange:t,kpiOptions:u,loading:i,onGenerate:p,useDbPegs:g,pegOptionsLoading:d,dbPegOptions:b})})]}),e.jsxs(le,{children:[e.jsx(ge,{children:e.jsxs(fe,{children:[((N=v.find(C=>C.value===s.primaryKPI))==null?void 0:N.label)||"KPI"," Analysis",s.showSecondaryAxis&&` vs ${(P=v.find(C=>C.value===s.secondaryKPI))==null?void 0:P.label}`]})}),e.jsx(ie,{children:e.jsx(It,{chartData:a,chartConfig:s,loading:i,kpiOptions:u,useDbPegs:g,dbPegOptions:b})})]})]})});Vs.displayName="AdvancedChart";const Lt=Object.freeze(Object.defineProperty({__proto__:null,default:Vs},Symbol.toStringTag,{value:"Module"}));function xs({className:s,orientation:t="horizontal",decorative:a=!0,...l}){return e.jsx(Oa,{"data-slot":"separator-root",decorative:a,orientation:t,className:ne("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",s),...l})}function vs({className:s,children:t,...a}){return e.jsxs(Ia,{"data-slot":"scroll-area",className:ne("relative",s),...a,children:[e.jsx(La,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:t}),e.jsx(nn,{}),e.jsx(Ra,{})]})}function nn({className:s,orientation:t="vertical",...a}){return e.jsx(Ma,{"data-slot":"scroll-area-scrollbar",orientation:t,className:ne("flex touch-none p-px transition-colors select-none",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",s),...a,children:e.jsx(za,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}const et=({title:s="날짜 범위",description:t="분석할 기간을 선택하세요",startDate:a,endDate:l,onDateChange:i,preset:h="",onPresetChange:d,disabled:c=!1,error:u=null,className:o="",showPresets:b=!0,minDate:O=null,maxDate:g=null})=>{const[x,v]=r.useState(a||""),[n,D]=r.useState(l||""),[p,N]=r.useState(null),P=[{value:"last7days",label:"최근 7일",days:7},{value:"last14days",label:"최근 14일",days:14},{value:"last30days",label:"최근 30일",days:30},{value:"thisweek",label:"이번 주",custom:!0},{value:"lastweek",label:"지난 주",custom:!0},{value:"thismonth",label:"이번 달",custom:!0},{value:"lastmonth",label:"지난 달",custom:!0},{value:"custom",label:"직접 선택",custom:!0}];r.useEffect(()=>{v(a||""),D(l||"")},[a,l]);const C=(j,S)=>{if(!j||!S)return"시작 날짜와 종료 날짜를 모두 입력해주세요";const G=new Date(j),M=new Date(S);return isNaN(G)||isNaN(M)?"올바른 날짜 형식을 입력해주세요":G>=M?"종료 날짜는 시작 날짜보다 이후여야 합니다":(M-G)/(1e3*60*60*24)>365?"날짜 범위는 최대 365일까지 선택할 수 있습니다":O&&G<new Date(O)?`시작 날짜는 ${O} 이후여야 합니다`:g&&M>new Date(g)?`종료 날짜는 ${g} 이전이어야 합니다`:null},f=(j,S)=>{let G=x,M=n;j==="start"?(G=S,v(S)):j==="end"&&(M=S,D(S));const K=C(G,M);N(K),!K&&i&&i({startDate:G,endDate:M})},w=j=>{const S=new Date;let G,M;switch(j){case"last7days":M=new Date(S),G=new Date(S.getTime()-10080*60*1e3);break;case"last14days":M=new Date(S),G=new Date(S.getTime()-336*60*60*1e3);break;case"last30days":M=new Date(S),G=new Date(S.getTime()-720*60*60*1e3);break;case"thisweek":const L=new Date(S);L.setDate(S.getDate()-S.getDay()),G=L,M=new Date(S);break;case"lastweek":const I=new Date(S);I.setDate(S.getDate()-S.getDay()-1);const Y=new Date(I);Y.setDate(I.getDate()-6),G=Y,M=I;break;case"thismonth":G=new Date(S.getFullYear(),S.getMonth(),1),M=new Date(S);break;case"lastmonth":const U=new Date(S.getFullYear(),S.getMonth()-1,1),E=new Date(S.getFullYear(),S.getMonth(),0);G=U,M=E;break;case"custom":d&&d(j);return;default:return}const K=G.toISOString().split("T")[0],te=M.toISOString().split("T")[0];v(K),D(te);const de=C(K,te);N(de),!de&&i&&i({startDate:K,endDate:te}),d&&d(j)},y=(()=>{if(!x||!n)return null;try{const j=new Date(x),S=new Date(n);return{days:Math.ceil((S-j)/(1e3*60*60*24)),startFormatted:j.toLocaleDateString("ko-KR"),endFormatted:S.toLocaleDateString("ko-KR")}}catch{return null}})(),A=u||p,m=!A&&x&&n;return e.jsxs(le,{className:`${o} ${c?"opacity-50":""}`,children:[e.jsxs(ge,{className:"pb-3",children:[e.jsxs(fe,{className:"flex items-center gap-2 text-base",children:[e.jsx(ds,{className:"h-4 w-4"}),s]}),t&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t})]}),e.jsxs(ie,{className:"space-y-4",children:[b&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"text-sm font-medium",children:"빠른 선택"}),e.jsxs(Ne,{value:h,onValueChange:w,disabled:c,children:[e.jsx(Se,{children:e.jsx(we,{placeholder:"기간을 선택하세요"})}),e.jsx(Ce,{children:P.map(j=>e.jsx(Q,{value:j.value,children:j.label},j.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:`start-${s}`,className:"text-sm",children:"시작 날짜"}),e.jsx(ye,{id:`start-${s}`,type:"date",value:x,onChange:j=>f("start",j.target.value),disabled:c,min:O,max:g,className:A?"border-red-500":""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:`end-${s}`,className:"text-sm",children:"종료 날짜"}),e.jsx(ye,{id:`end-${s}`,type:"date",value:n,onChange:j=>f("end",j.target.value),disabled:c,min:O,max:g,className:A?"border-red-500":""})]})]}),A&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(Ee,{className:"h-4 w-4 text-red-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-red-700",children:A})]}),y&&m&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(Rs,{className:"h-4 w-4 text-green-500 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsxs("span",{className:"font-medium",children:[y.days,"일 기간"]}),e.jsxs("span",{className:"text-green-600 ml-2",children:["(",y.startFormatted," ~ ",y.endFormatted,")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(X,{variant:m?"default":"secondary",className:"text-xs",children:[e.jsx(qe,{className:"h-3 w-3 mr-1"}),m?"유효한 범위":"범위 설정 필요"]}),y&&m&&e.jsxs(X,{variant:"outline",className:"text-xs",children:[y.days,"일 데이터"]})]})]})]})},rs=({comparisonResults:s,title:t="비교 분석 차트",className:a="",showControls:l=!0,defaultChartType:i="bar",height:h=400})=>{const[d,c]=r.useState(i),[u,o]=r.useState(!1),[b,O]=r.useState("mean"),g=[{value:"bar",label:"막대 차트",icon:Pe},{value:"line",label:"라인 차트",icon:Bs},{value:"area",label:"영역 차트",icon:gs},{value:"pie",label:"파이 차트",icon:sr},{value:"radar",label:"레이더 차트",icon:Bs},{value:"composed",label:"복합 차트",icon:Pe}],x=[{value:"mean",label:"평균값",description:"두 기간의 평균 비교"},{value:"delta",label:"Delta",description:"절대값 변화량"},{value:"delta_percentage",label:"Delta %",description:"상대적 변화율"}],v=r.useMemo(()=>s!=null&&s.analysis_results?(console.log("📊 차트 데이터 생성 중:",s.analysis_results),s.analysis_results.map(y=>{var G,M;const A=parseFloat((G=y.period1_stats)==null?void 0:G.mean)||0,m=parseFloat((M=y.period2_stats)==null?void 0:M.mean)||0,j=parseFloat(y.delta)||0,S=parseFloat(y.delta_percentage)||0;return{name:y.peg_name,peg_name:y.peg_name,period1:A,period2:m,delta:j,delta_percentage:S,improvement_status:y.improvement_status,improvement_magnitude:y.improvement_magnitude,rsd_period1:parseFloat(y.rsd_period1)||0,rsd_period2:parseFloat(y.rsd_period2)||0,color:y.improvement_status==="improved"?"#22c55e":y.improvement_status==="degraded"?"#ef4444":"#3b82f6",abs_delta:Math.abs(j),abs_delta_percentage:Math.abs(S)}})):[],[s]),n=r.useMemo(()=>{if(!v.length)return[];const y=v.filter(j=>j.improvement_status==="improved").length,A=v.filter(j=>j.improvement_status==="degraded").length,m=v.filter(j=>j.improvement_status==="stable").length;return[{name:"개선",value:y,color:"#22c55e"},{name:"악화",value:A,color:"#ef4444"},{name:"안정",value:m,color:"#3b82f6"}].filter(j=>j.value>0)},[v]),D=({active:y,payload:A,label:m})=>{if(y&&A&&A.length){const j=A[0].payload;return e.jsxs("div",{className:"bg-white p-3 border rounded-lg shadow-lg",children:[e.jsx("h4",{className:"font-semibold text-sm",children:m}),e.jsxs("div",{className:"space-y-1 mt-2",children:[A.map((S,G)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:S.color}}),e.jsxs("span",{children:[S.name,": ",S.value]})]},G)),j.improvement_status&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-2 pt-2 border-t",children:["상태: ",j.improvement_status==="improved"?"개선":j.improvement_status==="degraded"?"악화":"안정",j.improvement_magnitude&&` (${j.improvement_magnitude})`]})]})]})}return null},p=()=>e.jsx(Te,{width:"100%",height:u?"80vh":h,children:e.jsxs(js,{data:v,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(Ue,{strokeDasharray:"3 3"}),e.jsx(He,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(Me,{fontSize:12}),e.jsx(Le,{content:e.jsx(D,{})}),e.jsx(Re,{}),b==="mean"&&e.jsxs(e.Fragment,{children:[e.jsx(Ie,{dataKey:"period1",fill:"#8884d8",name:"기간 1"}),e.jsx(Ie,{dataKey:"period2",fill:"#82ca9d",name:"기간 2"})]}),b==="delta"&&e.jsx(Ie,{dataKey:"delta",name:"Delta",children:v.map((y,A)=>e.jsx(Cs,{fill:y.color},`cell-${A}`))}),b==="delta_percentage"&&e.jsx(Ie,{dataKey:"delta_percentage",name:"Delta %",children:v.map((y,A)=>e.jsx(Cs,{fill:y.color},`cell-${A}`))})]})}),N=()=>e.jsx(Te,{width:"100%",height:u?"80vh":h,children:e.jsxs(Fs,{data:v,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(Ue,{strokeDasharray:"3 3"}),e.jsx(He,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(Me,{fontSize:12}),e.jsx(Le,{content:e.jsx(D,{})}),e.jsx(Re,{}),b==="mean"&&e.jsxs(e.Fragment,{children:[e.jsx(Ge,{type:"monotone",dataKey:"period1",stroke:"#8884d8",strokeWidth:2,name:"기간 1"}),e.jsx(Ge,{type:"monotone",dataKey:"period2",stroke:"#82ca9d",strokeWidth:2,name:"기간 2"})]}),b==="delta"&&e.jsx(Ge,{type:"monotone",dataKey:"delta",stroke:"#ff7300",strokeWidth:2,name:"Delta"}),b==="delta_percentage"&&e.jsx(Ge,{type:"monotone",dataKey:"delta_percentage",stroke:"#ff7300",strokeWidth:2,name:"Delta %"})]})}),P=()=>e.jsx(Te,{width:"100%",height:u?"80vh":h,children:e.jsxs(vt,{data:v,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(Ue,{strokeDasharray:"3 3"}),e.jsx(He,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(Me,{fontSize:12}),e.jsx(Le,{content:e.jsx(D,{})}),e.jsx(Re,{}),b==="mean"&&e.jsxs(e.Fragment,{children:[e.jsx(ns,{type:"monotone",dataKey:"period1",stackId:"1",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.6,name:"기간 1"}),e.jsx(ns,{type:"monotone",dataKey:"period2",stackId:"2",stroke:"#82ca9d",fill:"#82ca9d",fillOpacity:.6,name:"기간 2"})]}),b==="delta"&&e.jsx(ns,{type:"monotone",dataKey:"delta",stroke:"#ff7300",fill:"#ff7300",fillOpacity:.6,name:"Delta"}),b==="delta_percentage"&&e.jsx(ns,{type:"monotone",dataKey:"delta_percentage",stroke:"#ff7300",fill:"#ff7300",fillOpacity:.6,name:"Delta %"})]})}),C=()=>e.jsx(Te,{width:"100%",height:u?"80vh":h,children:e.jsxs(Sr,{children:[e.jsx(Cr,{data:n,cx:"50%",cy:"50%",labelLine:!1,label:({name:y,value:A,percent:m})=>`${y}: ${A}개 (${(m*100).toFixed(0)}%)`,outerRadius:u?200:100,fill:"#8884d8",dataKey:"value",children:n.map((y,A)=>e.jsx(Cs,{fill:y.color},`cell-${A}`))}),e.jsx(Le,{}),e.jsx(Re,{})]})}),f=()=>{const y=v.map(A=>({peg:A.name.length>10?A.name.substring(0,8)+"...":A.name,period1:Math.min(Math.max(A.period1/Math.max(...v.map(m=>m.period1))*100,0),100),period2:Math.min(Math.max(A.period2/Math.max(...v.map(m=>m.period2))*100,0),100)}));return e.jsx(Te,{width:"100%",height:u?"80vh":h,children:e.jsxs(br,{data:y,children:[e.jsx(yr,{}),e.jsx(Nr,{dataKey:"peg",fontSize:10}),e.jsx(wr,{angle:90,domain:[0,100],fontSize:10,tick:!1}),e.jsx(Hs,{name:"기간 1",dataKey:"period1",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.3}),e.jsx(Hs,{name:"기간 2",dataKey:"period2",stroke:"#82ca9d",fill:"#82ca9d",fillOpacity:.3}),e.jsx(Re,{}),e.jsx(Le,{})]})})},w=()=>e.jsx(Te,{width:"100%",height:u?"80vh":h,children:e.jsxs(vr,{data:v,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(Ue,{strokeDasharray:"3 3"}),e.jsx(He,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(Me,{yAxisId:"left",fontSize:12}),e.jsx(Me,{yAxisId:"right",orientation:"right",fontSize:12}),e.jsx(Le,{content:e.jsx(D,{})}),e.jsx(Re,{}),e.jsx(Ie,{yAxisId:"left",dataKey:"period1",fill:"#8884d8",name:"기간 1"}),e.jsx(Ie,{yAxisId:"left",dataKey:"period2",fill:"#82ca9d",name:"기간 2"}),e.jsx(Ge,{yAxisId:"right",type:"monotone",dataKey:"delta_percentage",stroke:"#ff7300",strokeWidth:3,name:"Delta %"})]})}),R=()=>{switch(d){case"bar":return p();case"line":return N();case"area":return P();case"pie":return C();case"radar":return f();case"composed":return w();default:return p()}};return!s||!v.length?e.jsx(le,{className:a,children:e.jsxs(ie,{className:"flex flex-col items-center justify-center h-64",children:[e.jsx(Pe,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"차트 데이터 없음"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"비교 분석을 실행하면 결과를 차트로 볼 수 있습니다"})]})}):e.jsxs(le,{className:`${a} ${u?"fixed inset-4 z-50 bg-white":""}`,children:[e.jsxs(ge,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-5 w-5"}),t,e.jsxs(X,{variant:"outline",className:"ml-2",children:[v.length,"개 PEG"]})]}),l&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(J,{variant:"ghost",size:"sm",onClick:()=>o(!u),children:u?e.jsx(ft,{className:"h-4 w-4"}):e.jsx(pt,{className:"h-4 w-4"})})})]}),l&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"차트 타입"}),e.jsxs(Ne,{value:d,onValueChange:c,children:[e.jsx(Se,{children:e.jsx(we,{})}),e.jsx(Ce,{children:g.map(y=>{const A=y.icon;return e.jsx(Q,{value:y.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),y.label]})},y.value)})})]})]}),!["pie","radar"].includes(d)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"표시 메트릭"}),e.jsxs(Ne,{value:b,onValueChange:O,children:[e.jsx(Se,{children:e.jsx(we,{})}),e.jsx(Ce,{children:x.map(y=>e.jsx(Q,{value:y.value,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:y.label}),e.jsx("div",{className:"text-xs text-muted-foreground",children:y.description})]})},y.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"차트 정보"}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("div",{children:["총 ",v.length,"개 PEG 비교"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(X,{variant:"secondary",className:"text-xs",children:["개선: ",v.filter(y=>y.improvement_status==="improved").length]}),e.jsxs(X,{variant:"destructive",className:"text-xs",children:["악화: ",v.filter(y=>y.improvement_status==="degraded").length]})]})]})]})]})]}),e.jsxs(ie,{children:[e.jsx("div",{className:"w-full",children:R()}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsx("div",{className:"text-xs text-muted-foreground space-y-1",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsxs("span",{children:["개선 (",v.filter(y=>y.improvement_status==="improved").length,"개)"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsxs("span",{children:["악화 (",v.filter(y=>y.improvement_status==="degraded").length,"개)"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),e.jsxs("span",{children:["안정 (",v.filter(y=>y.improvement_status==="stable").length,"개)"]})]}),e.jsxs("div",{className:"text-muted-foreground",children:["총 ",v.length,"개 PEG 분석"]})]})})})]})]})},Rt=Object.freeze(Object.defineProperty({__proto__:null,default:rs},Symbol.toStringTag,{value:"Module"})),Mt=()=>{var L,I,Y,U,E,q;const{settings:s}=Pt(),{updatePreference:t,isSaving:a}=Ye(),[l,i]=r.useState({startDate:"",endDate:"",preset:"last7days"}),[h,d]=r.useState({startDate:"",endDate:"",preset:"last14days"}),[c,u]=r.useState(["availability","rrc","erab"]),[o,b]=r.useState(!0),[O,g]=r.useState(4),[x,v]=r.useState(null),[n,D]=r.useState(!1),[p,N]=r.useState(null),[P,C]=r.useState(null),[f,w]=r.useState(new Set),R=r.useMemo(()=>s!=null&&s.table?[{value:"availability",label:"Availability (%)"},{value:"rrc",label:"RRC Success Rate (%)"},{value:"erab",label:"ERAB Success Rate (%)"},{value:"sar",label:"SAR"},{value:"mobility_intra",label:"Mobility Intra (%)"},{value:"cqi",label:"CQI"}]:[],[s==null?void 0:s.table]),y=r.useCallback(async()=>{console.log("🔍 Available PEGs 로드 시작");try{const _=localStorage.getItem("dbConfig"),H=localStorage.getItem("useDbPegs")==="true";console.log("📊 DB 설정 상태:",{hasDbConfig:!!_,useDbPegs:H,dbConfigData:_?JSON.parse(_):null});let W=[];if(H&&_){console.log("🔗 Database에서 PEG 목록 조회 중...");const B=await ve.get("/api/master/pegs");console.log("📥 Database PEG 응답:",B.data),B.data&&Array.isArray(B.data)&&(W=B.data.map(Z=>({value:Z.peg_name||Z.value||Z.id,label:Z.display_name||Z.label||`${Z.peg_name} (${Z.unit||"N/A"})`})))}if(W.length===0&&(console.log("📝 기본 PEG 목록 사용"),W=[{value:"availability",label:"Availability (%)"},{value:"rrc",label:"RRC Success Rate (%)"},{value:"erab",label:"ERAB Success Rate (%)"},{value:"sar",label:"SAR"},{value:"mobility_intra",label:"Mobility Intra (%)"},{value:"cqi",label:"CQI"},{value:"se",label:"Spectral Efficiency"},{value:"dl_thp",label:"DL Throughput"},{value:"ul_int",label:"UL Interference"}]),console.log("✅ PEG 목록 로드 완료:",W),c.length===0&&W.length>0){const B=W.slice(0,3).map(Z=>Z.value);u(B),console.log("🎯 기본 PEG 선택:",B)}}catch(_){console.error("❌ PEG 목록 로드 실패:",_)}finally{}},[c.length]);r.useEffect(()=>{const _=new Date,H=new Date(_),W=new Date(_.getTime()-10080*60*1e3),B=new Date(W),Z=new Date(W.getTime()-10080*60*1e3);i({startDate:W.toISOString().split("T")[0],endDate:H.toISOString().split("T")[0],preset:"last7days"}),d({startDate:Z.toISOString().split("T")[0],endDate:B.toISOString().split("T")[0],preset:"custom"}),y()},[y]),r.useEffect(()=>{s.defaultPegs&&u(s.defaultPegs),s.decimalPlaces!==void 0&&g(s.decimalPlaces),s.includeOutliers!==void 0&&b(s.includeOutliers)},[s]);const A=r.useCallback(({startDate:_,endDate:H})=>{i(W=>({...W,startDate:_,endDate:H,preset:"custom"}))},[]),m=r.useCallback(({startDate:_,endDate:H})=>{d(W=>({...W,startDate:_,endDate:H,preset:"custom"}))},[]),j=async()=>{var _,H,W;if(!l.startDate||!l.endDate||!h.startDate||!h.endDate){se.error("두 기간의 날짜를 모두 설정해주세요");return}if(c.length===0){se.error("분석할 PEG를 최소 1개 이상 선택해주세요");return}D(!0),N(null);try{console.log("🔍 Statistics 비교 분석 시작:",{period1:l,period2:h,selectedPegs:c,includeOutliers:o,decimalPlaces:O});const B={period1:{start_date:`${l.startDate}T00:00:00`,end_date:`${l.endDate}T23:59:59`},period2:{start_date:`${h.startDate}T00:00:00`,end_date:`${h.endDate}T23:59:59`},peg_names:c,include_outliers:o,decimal_places:O,ne_filter:s.defaultNe?[s.defaultNe]:null,cell_id_filter:s.defaultCellId?[s.defaultCellId]:null};console.log("📤 API 요청 페이로드:",B);const Z=await ve.post("/api/statistics/compare",B);console.log("📥 API 응답:",Z.data),v(Z.data),C(new Date),se.success(`비교 분석 완료! ${((_=Z.data.analysis_results)==null?void 0:_.length)||0}개 PEG 분석됨`)}catch(B){console.error("❌ 비교 분석 실패:",B);let Z="비교 분석 중 오류가 발생했습니다";(W=(H=B.response)==null?void 0:H.data)!=null&&W.error_message?Z=B.response.data.error_message:B.message&&(Z=B.message),N(Z),se.error(Z)}finally{D(!1)}},S=_=>{const H=new Set(f);H.has(_)?H.delete(_):H.add(_),w(H)},G=()=>{var _,H;if(f.size===((_=x==null?void 0:x.analysis_results)==null?void 0:_.length))w(new Set);else{const W=((H=x==null?void 0:x.analysis_results)==null?void 0:H.map(B=>B.peg_name))||[];w(new Set(W))}},M=async()=>{if(f.size===0){se.error("저장할 PEG를 선택해주세요");return}try{console.log("💾 Dashboard에 저장할 PEG:",Array.from(f));const _=dashboardSettings||{},H=(_==null?void 0:_.selectedPegs)||[],W=Array.from(f).filter(Z=>!H.includes(Z)),B=[...H,...W];console.log("📊 현재 Dashboard PEG:",H),console.log("🆕 추가할 새 PEG:",W),console.log("📈 업데이트된 PEG 목록:",B),await t("dashboardSettings",{..._,selectedPegs:B}),se.success(`${f.size}개 PEG가 Dashboard에 추가되었습니다`,{description:`총 ${B.length}개 PEG가 Dashboard에 설정되어 있습니다. Dashboard로 이동해서 확인해보세요!`,duration:5e3}),w(new Set)}catch(_){console.error("❌ Dashboard 저장 실패:",_),se.error("Dashboard 저장 중 오류가 발생했습니다",{description:_.message||"네트워크 오류일 수 있습니다"})}},K=l.startDate&&l.endDate&&h.startDate&&h.endDate&&c.length>0,te=_=>{switch(_){case"improved":return e.jsx(gs,{className:"h-4 w-4 text-green-500"});case"degraded":return e.jsx(ar,{className:"h-4 w-4 text-red-500"});case"stable":return e.jsx(tr,{className:"h-4 w-4 text-blue-500"});default:return e.jsx(As,{className:"h-4 w-4 text-yellow-500"})}},de=(_,H)=>{const W={improved:"bg-green-100 text-green-800 border-green-200",degraded:"bg-red-100 text-red-800 border-red-200",stable:"bg-blue-100 text-blue-800 border-blue-200"},B={significant:"상당한",moderate:"보통",minor:"미미한",none:"변화없음"};return e.jsxs(X,{className:`${W[_]||"bg-gray-100 text-gray-800"} text-xs`,children:[te(_),e.jsxs("span",{className:"ml-1",children:[_==="improved"?"개선":_==="degraded"?"악화":"안정",H&&` (${B[H]})`]})]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Basic 비교 분석"}),e.jsx("p",{className:"text-muted-foreground",children:"두 기간의 KPI 데이터를 비교하여 성능 변화를 분석합니다"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[P&&e.jsxs(X,{variant:"outline",className:"text-xs",children:["마지막 분석: ",P.toLocaleTimeString("ko-KR")]}),e.jsx(J,{onClick:j,disabled:!K||n,className:"bg-blue-600 hover:bg-blue-700",children:n?e.jsxs(e.Fragment,{children:[e.jsx(es,{className:"h-4 w-4 mr-2 animate-spin"}),"분석 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ms,{className:"h-4 w-4 mr-2"}),"비교 분석 실행"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(et,{title:"기간 1 (기준)",description:"비교의 기준이 되는 첫 번째 기간",startDate:l.startDate,endDate:l.endDate,preset:l.preset,onDateChange:A,onPresetChange:_=>i(H=>({...H,preset:_}))}),e.jsx(et,{title:"기간 2 (비교 대상)",description:"기준과 비교할 두 번째 기간",startDate:h.startDate,endDate:h.endDate,preset:h.preset,onDateChange:m,onPresetChange:_=>d(H=>({...H,preset:_}))}),e.jsxs(le,{children:[e.jsx(ge,{className:"pb-3",children:e.jsxs(fe,{className:"flex items-center gap-2 text-base",children:[e.jsx(Xe,{className:"h-4 w-4"}),"분석 옵션"]})}),e.jsxs(ie,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"text-sm font-medium flex items-center justify-between",children:e.jsx("span",{children:"분석할 PEG"})}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:R.length>0?R.map(_=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(is,{id:`peg-${_.value}`,checked:c.includes(_.value),onCheckedChange:H=>{u(H?W=>[...W,_.value]:W=>W.filter(B=>B!==_.value))}}),e.jsx(V,{htmlFor:`peg-${_.value}`,className:"text-sm cursor-pointer flex-1",children:_.label})]},_.value)):e.jsxs("div",{className:"text-center text-muted-foreground py-4",children:[e.jsx(We,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"사용 가능한 PEG가 없습니다"}),e.jsx("p",{className:"text-xs",children:"Database 설정을 확인해주세요"})]})}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(X,{variant:"outline",className:"text-xs",children:[c.length,"개 선택됨"]})})]}),e.jsx(xs,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{className:"text-sm",children:"이상치 포함"}),e.jsx(J,{variant:o?"default":"outline",size:"sm",onClick:()=>b(!o),children:o?"포함":"제외"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"text-sm",children:"소수점 자릿수"}),e.jsxs(Ne,{value:O.toString(),onValueChange:_=>g(parseInt(_)),children:[e.jsx(Se,{children:e.jsx(we,{})}),e.jsxs(Ce,{children:[e.jsx(Q,{value:"2",children:"2자리"}),e.jsx(Q,{value:"3",children:"3자리"}),e.jsx(Q,{value:"4",children:"4자리"}),e.jsx(Q,{value:"5",children:"5자리"})]})]})]})]})]})]})]}),p&&e.jsx(le,{className:"border-red-200 bg-red-50",children:e.jsxs(ie,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(As,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"text-red-700 font-medium",children:"분석 오류"})]}),e.jsx("p",{className:"text-red-600 mt-2",children:p})]})}),x&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(xs,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"비교 분석 결과"}),e.jsx("div",{className:"mb-6",children:e.jsx(rs,{comparisonResults:x,title:"PEG 비교 분석 차트",showControls:!0,defaultChartType:"bar",height:400})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(le,{children:e.jsx(ie,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((L=x.summary)==null?void 0:L.total_pegs_analyzed)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"분석된 PEG"})]})})}),e.jsx(le,{children:e.jsx(ie,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:((I=x.summary)==null?void 0:I.improved_count)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"개선"})]})})}),e.jsx(le,{children:e.jsx(ie,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:((Y=x.summary)==null?void 0:Y.degraded_count)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"악화"})]})})}),e.jsx(le,{children:e.jsx(ie,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((U=x.summary)==null?void 0:U.stable_count)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"안정"})]})})})]}),e.jsxs(le,{children:[e.jsx(ge,{children:e.jsx(fe,{children:"상세 비교 결과"})}),e.jsx(ie,{children:e.jsxs(Ns,{defaultValue:"table",className:"w-full",children:[e.jsxs(ws,{className:"grid w-full grid-cols-2",children:[e.jsxs($e,{value:"table",className:"flex items-center gap-2",children:[e.jsx(jt,{className:"h-4 w-4"}),"테이블 뷰"]}),e.jsxs($e,{value:"chart",className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),"차트 뷰"]})]}),e.jsxs(Ae,{value:"table",className:"space-y-4",children:[((E=x==null?void 0:x.analysis_results)==null?void 0:E.length)>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 border border-slate-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:f.size===x.analysis_results.length&&f.size>0,onChange:G,className:"w-4 h-4 text-blue-600 rounded"}),e.jsxs("span",{className:"text-sm font-medium",children:["전체 선택 (",f.size,"/",x.analysis_results.length,")"]})]}),f.size>0&&e.jsxs(X,{variant:"secondary",className:"bg-blue-100 text-blue-700",children:[f.size,"개 선택됨"]})]}),f.size>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{variant:"outline",size:"sm",onClick:()=>w(new Set),children:"선택 해제"}),e.jsx(J,{size:"sm",onClick:M,disabled:a,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400",children:a?e.jsxs(e.Fragment,{children:[e.jsx(es,{className:"h-3 w-3 mr-1 animate-spin"}),"저장 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(os,{className:"h-3 w-3 mr-1"}),"Dashboard에 저장"]})})]})]}),e.jsx(vs,{className:"h-96",children:e.jsx("div",{className:"space-y-4",children:(q=x.analysis_results)==null?void 0:q.map((_,H)=>{var W,B;return e.jsx(le,{className:`border-l-4 border-l-blue-500 ${f.has(_.peg_name)?"ring-2 ring-blue-500 bg-blue-50":""}`,children:e.jsxs(ie,{className:"pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:f.has(_.peg_name),onChange:()=>S(_.peg_name),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("h4",{className:"font-semibold",children:_.peg_name})]}),de(_.improvement_status,_.improvement_magnitude)]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"기간 1 평균"}),e.jsx("div",{className:"font-medium",children:(W=_.period1_stats)==null?void 0:W.mean})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"기간 2 평균"}),e.jsx("div",{className:"font-medium",children:(B=_.period2_stats)==null?void 0:B.mean})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Delta"}),e.jsxs("div",{className:`font-medium ${_.delta>0?"text-green-600":_.delta<0?"text-red-600":"text-blue-600"}`,children:[_.delta>0?"+":"",_.delta]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Delta %"}),e.jsxs("div",{className:`font-medium ${_.delta_percentage>0?"text-green-600":_.delta_percentage<0?"text-red-600":"text-blue-600"}`,children:[_.delta_percentage>0?"+":"",_.delta_percentage,"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3 pt-3 border-t text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"기간 1 RSD"}),e.jsxs("div",{className:"font-medium",children:[_.rsd_period1,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"기간 2 RSD"}),e.jsxs("div",{className:"font-medium",children:[_.rsd_period2,"%"]})]})]})]})},H)})})})]}),e.jsx(Ae,{value:"chart",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(rs,{comparisonResults:x,title:"막대 차트",showControls:!1,defaultChartType:"bar",height:300}),e.jsx(rs,{comparisonResults:x,title:"라인 차트",showControls:!1,defaultChartType:"line",height:300}),e.jsx(rs,{comparisonResults:x,title:"개선 상태 분포",showControls:!1,defaultChartType:"pie",height:300}),e.jsx(rs,{comparisonResults:x,title:"레이더 차트",showControls:!1,defaultChartType:"radar",height:300})]})})})]})})]})]})]}),!x&&!p&&e.jsx(le,{className:"text-center py-12",children:e.jsxs(ie,{children:[e.jsx(Pe,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"비교 분석 준비"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"두 기간과 분석할 PEG를 선택한 후 '비교 분석 실행' 버튼을 클릭하세요"}),e.jsx(X,{variant:"outline",children:K?"분석 준비 완료":"설정 필요"})]})})]})},ln=Object.freeze(Object.defineProperty({__proto__:null,default:Mt},Symbol.toStringTag,{value:"Module"})),zt=()=>{const{settings:s}=Pt(),t=s.defaultDateRange||7,a=s.defaultNe||"",l=s.defaultCellId||"",i=s.decimalPlaces||2,h=s.showComparisonOptions!==!1,d=s.autoCalculateStats!==!1;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Statistics"}),e.jsxs("p",{className:"text-muted-foreground",children:["기본 날짜 범위: ",t,"일 • 소수점: ",i,"자리",a&&` • 기본 NE: ${a}`,l&&` • 기본 Cell: ${l}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[d&&e.jsxs(X,{variant:"outline",className:"text-xs",children:[e.jsx(gs,{className:"h-3 w-3 mr-1"}),"자동 통계 계산"]}),h&&e.jsxs(X,{variant:"outline",className:"text-xs",children:[e.jsx(Pe,{className:"h-3 w-3 mr-1"}),"비교 옵션 활성"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(X,{variant:"default",children:["기본 기간: ",t,"일"]}),e.jsxs(X,{variant:"outline",children:["소수점: ",i,"자리"]}),d&&e.jsx(X,{variant:"secondary",children:"자동 통계 계산"}),h&&e.jsx(X,{variant:"secondary",children:"비교 옵션"})]}),e.jsxs(Ns,{defaultValue:"basic",className:"w-full",children:[e.jsxs(ws,{className:"grid w-full grid-cols-2",children:[e.jsx($e,{value:"basic",children:"Basic Analysis"}),e.jsx($e,{value:"advanced",children:"Advanced Analysis"})]}),e.jsx(Ae,{value:"basic",className:"space-y-6",children:e.jsx(Mt,{})}),e.jsx(Ae,{value:"advanced",className:"space-y-6",children:e.jsx(Vs,{})})]})]})},Ft=Object.freeze(Object.defineProperty({__proto__:null,default:zt},Symbol.toStringTag,{value:"Module"}));function Gt({...s}){return e.jsx(Fa,{"data-slot":"collapsible",...s})}function Vt({...s}){return e.jsx(Ga,{"data-slot":"collapsible-trigger",...s})}function Bt({...s}){return e.jsx(Va,{"data-slot":"collapsible-content",...s})}const cn=Ls("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function Kt({className:s,variant:t,...a}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:ne(cn({variant:t}),s),...a})}function Ut({className:s,...t}){return e.jsx("div",{"data-slot":"alert-description",className:ne("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),...t})}const cs={text:{placeholder:"텍스트를 입력하세요",maxLength:100},number:{placeholder:"숫자를 입력하세요",min:0,max:999999},select:{placeholder:"선택하세요",options:[]},multiselect:{placeholder:"하나 이상 선택하세요",options:[]},checkbox:{label:"활성화"},switch:{label:"켜기/끄기"}},on=({field:s,value:t,onChange:a,error:l,disabled:i})=>{var h,d,c,u;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(V,{htmlFor:s.key,className:"text-sm font-medium",children:[s.label,s.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),e.jsx(ye,{id:s.key,type:s.type==="number"?"number":"text",value:t||"",onChange:o=>{const b=s.type==="number"?o.target.value===""?"":Number(o.target.value):o.target.value;a(b)},placeholder:s.placeholder||((h=cs[s.type])==null?void 0:h.placeholder),maxLength:s.maxLength||((d=cs[s.type])==null?void 0:d.maxLength),min:s.min||((c=cs[s.type])==null?void 0:c.min),max:s.max||((u=cs[s.type])==null?void 0:u.max),disabled:i,className:l?"border-destructive":""}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description}),l&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(Ee,{className:"h-3 w-3"}),l]})]})},dn=({field:s,value:t,onChange:a,error:l,disabled:i})=>{var h;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(V,{htmlFor:s.key,className:"text-sm font-medium",children:[s.label,s.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),e.jsxs(Ne,{value:t||"",onValueChange:a,disabled:i,children:[e.jsx(Se,{className:l?"border-destructive":"",children:e.jsx(we,{placeholder:s.placeholder||cs.select.placeholder})}),e.jsx(Ce,{children:(h=s.options)==null?void 0:h.map(d=>e.jsx(Q,{value:d.value,children:d.label},d.value))})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description}),l&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(Ee,{className:"h-3 w-3"}),l]})]})},mn=({field:s,value:t,onChange:a,error:l,disabled:i})=>{var c,u;const h=Array.isArray(t)?t:[],d=o=>{const b=h.includes(o)?h.filter(O=>O!==o):[...h,o];a(b)};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(V,{className:"text-sm font-medium",children:[s.label,s.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),e.jsxs("div",{className:`border rounded-md p-3 space-y-2 ${l?"border-destructive":"border-input"}`,children:[(c=s.options)==null?void 0:c.map(o=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(is,{id:`${s.key}-${o.value}`,checked:h.includes(o.value),onCheckedChange:()=>d(o.value),disabled:i}),e.jsx(V,{htmlFor:`${s.key}-${o.value}`,className:"text-sm cursor-pointer",children:o.label})]},o.value)),((u=s.options)==null?void 0:u.length)===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"선택 가능한 옵션이 없습니다"})]}),h.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:h.map(o=>{var O;const b=(O=s.options)==null?void 0:O.find(g=>g.value===o);return b?e.jsx(X,{variant:"secondary",className:"text-xs",children:b.label},o):null})}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description}),l&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(Ee,{className:"h-3 w-3"}),l]})]})},un=({field:s,value:t,onChange:a,error:l,disabled:i})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs(V,{htmlFor:s.key,className:"text-sm font-medium",children:[s.label,s.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description})]}),e.jsx(ls,{id:s.key,checked:!!t,onCheckedChange:a,disabled:i})]}),l&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(Ee,{className:"h-3 w-3"}),l]})]}),$s=({title:s,description:t,settingKey:a,fields:l=[],defaultOpen:i=!1,disabled:h=!1,className:d="",onFieldChange:c,showSaveButton:u=!1,showResetButton:o=!1})=>{const[b,O]=r.useState(i),[g,x]=r.useState(!1),{settings:v,updateSettings:n,updateSectionLocal:D,saving:p,error:N,validationErrors:P,logInfo:C,saveImmediately:f,defaultSettings:w}=Ye(),R=v[a]||{},y=r.useMemo(()=>{const M={};return Object.entries(P).forEach(([K,te])=>{if(K.startsWith(`${a}.`)){const de=K.replace(`${a}.`,"");M[de]=te}}),M},[P,a]),A=Object.keys(y).length>0,m=r.useCallback((M,K)=>{C(`SettingBox 필드 변경: ${a}.${M}`,{oldValue:R[M],newValue:K});const te={...R,[M]:K};u?D(a,te):n({[a]:te}),c==null||c(M,K,te),x(!0)},[a,R,n,c,C]),j=r.useCallback(async()=>{C(`SettingBox 즉시 저장: ${a}`),await f()},[f,C,a]),S=r.useCallback(()=>{C(`SettingBox 초기화: ${a}`);const M=w[a]||{};n({[a]:M}),x(!1)},[a,n,w,C]),G=r.useCallback(M=>{const K=R[M.key],te=g?y[M.key]:null,L={field:M,value:K,onChange:I=>m(M.key,I),error:te,disabled:h||p};switch(M.type){case"text":case"number":return e.jsx(on,{...L},M.key);case"select":return e.jsx(dn,{...L},M.key);case"multiselect":return e.jsx(mn,{...L},M.key);case"switch":case"checkbox":return e.jsx(un,{...L},M.key);default:return e.jsxs("div",{className:"text-sm text-muted-foreground",children:["지원하지 않는 필드 타입: ",M.type]},M.key)}},[R,y,g,h,p,m]);return e.jsx(le,{className:`w-full ${d}`,children:e.jsxs(Gt,{open:b,onOpenChange:O,children:[e.jsx(Vt,{asChild:!0,children:e.jsx(ge,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(fe,{className:"text-lg flex items-center gap-2",children:[s,p&&e.jsxs(X,{variant:"secondary",className:"text-xs",children:[e.jsx(qe,{className:"h-3 w-3 mr-1"}),"저장 중"]}),g&&A&&e.jsxs(X,{variant:"destructive",className:"text-xs",children:[e.jsx(Ee,{className:"h-3 w-3 mr-1"}),"오류"]}),g&&!A&&!p&&e.jsxs(X,{variant:"default",className:"text-xs",children:[e.jsx(ze,{className:"h-3 w-3 mr-1"}),"유효"]})]}),t&&e.jsx(ys,{children:t})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(X,{variant:"outline",className:"text-xs",children:[l.length,"개 설정"]}),b?e.jsx(bs,{className:"h-4 w-4"}):e.jsx(ss,{className:"h-4 w-4"})]})]})})}),e.jsx(Bt,{children:e.jsxs(ie,{className:"space-y-6",children:[N&&e.jsxs(Kt,{variant:"destructive",children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx(Ut,{children:N})]}),l.length>0?e.jsx("div",{className:"space-y-4",children:l.map(G)}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"설정할 수 있는 항목이 없습니다."}),(u||o||A)&&e.jsxs(e.Fragment,{children:[e.jsx(xs,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:o&&e.jsxs(J,{variant:"outline",size:"sm",onClick:S,disabled:h||p,children:[e.jsx(Ts,{className:"h-4 w-4 mr-1"}),"초기화"]})}),e.jsx("div",{className:"flex items-center gap-2",children:u&&e.jsxs(J,{size:"sm",onClick:j,disabled:h||p||A,children:[e.jsx(rr,{className:"h-4 w-4 mr-1"}),"저장"]})})]})]})]})})]})})};function hn({className:s,value:t,...a}){return e.jsx(Ba,{"data-slot":"progress",className:ne("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",s),...a,children:e.jsx(Ka,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})})}const fs=[{key:"dashboardSettings",label:"Dashboard 설정",description:"선택된 PEG, 차트 스타일, 새로고침 간격 등"},{key:"statisticsSettings",label:"Statistics 설정",description:"기본 날짜 범위, 비교 옵션, 소수점 자릿수 등"},{key:"derivedPegSettings",label:"Derived PEG 설정",description:"사용자 정의 수식, 활성화 상태, 계산 정밀도 등"},{key:"notificationSettings",label:"알림 설정",description:"토스트, 사운드, 알림 타입 설정"},{key:"generalSettings",label:"일반 설정",description:"언어, 시간대, 날짜 형식 등"}],xn=({title:s="설정 백업 & 복원",description:t="설정을 JSON 파일로 내보내거나 가져올 수 있습니다",defaultOpen:a=!1,className:l=""})=>{const[i,h]=r.useState(a),[d,c]=r.useState(!1),[u,o]=r.useState(!1),[b,O]=r.useState(0),[g,x]=r.useState(!1),[v,n]=r.useState(null),[D,p]=r.useState(null),[N,P]=r.useState(fs.reduce((E,q)=>({...E,[q.key]:!0}),{})),[C,f]=r.useState(""),w=r.useRef(null),{settings:R,exportSettings:y,importSettings:A,hasUnsavedChanges:m,saving:j,logInfo:S,logError:G}=Ye(),M=r.useCallback(async(E="full")=>{o(!0),n(null);try{S("설정 내보내기 시작",{exportType:E,customFileName:C});let q=R;if(E==="partial"){const B=Object.entries(N).filter(([Z,be])=>be).map(([Z])=>Z);if(B.length===0){se.error("내보낼 설정 섹션을 하나 이상 선택해주세요");return}q=B.reduce((Z,be)=>(R[be]&&(Z[be]=R[be]),Z),{}),S("부분 내보내기 선택된 섹션",B)}const _=new Date().toISOString().split("T")[0],H=C.trim()||(E==="partial"?`preference-settings-partial-${_}.json`:`preference-settings-${_}.json`);await y(H,q)&&(se.success(`설정이 "${H}" 파일로 내보내졌습니다`),f(""))}catch(q){G("설정 내보내기 실패",q),se.error("설정 내보내기 실패: "+q.message)}finally{o(!1)}},[R,N,C,y,S,G]),K=r.useCallback(async E=>{if(E){c(!0),O(0),n(null);try{if(S("설정 가져오기 시작",{fileName:E.name,fileSize:E.size}),!E.name.toLowerCase().endsWith(".json"))throw new Error("JSON 파일만 지원됩니다");if(E.size>5*1024*1024)throw new Error("파일 크기가 너무 큽니다 (최대 5MB)");O(20);const q=await A(E);O(80),p({name:E.name,size:E.size,importedAt:new Date,sectionsCount:Object.keys(q).length}),O(100),S("설정 가져오기 완료",{fileName:E.name,sectionsImported:Object.keys(q).length}),se.success(`"${E.name}"에서 설정을 성공적으로 가져왔습니다`)}catch(q){G("설정 가져오기 실패",q),n(q.message),se.error("설정 가져오기 실패: "+q.message)}finally{c(!1),setTimeout(()=>{O(0)},3e3)}}},[A,S,G]),te=r.useCallback(E=>{const q=E.target.files[0];q&&(K(q),E.target.value="")},[K]),de=r.useCallback(E=>{E.preventDefault(),x(!0)},[]),L=r.useCallback(E=>{E.preventDefault(),x(!1)},[]),I=r.useCallback(E=>{E.preventDefault(),x(!1);const q=E.dataTransfer.files;q.length>0&&K(q[0])},[K]),Y=r.useCallback(E=>{P(q=>({...q,[E]:!q[E]}))},[]),U=r.useCallback(()=>{const E=Object.values(N).every(Boolean),q=fs.reduce((_,H)=>({..._,[H.key]:!E}),{});P(q)},[N]);return e.jsx(le,{className:`w-full ${l}`,children:e.jsxs(Gt,{open:i,onOpenChange:h,children:[e.jsx(Vt,{asChild:!0,children:e.jsx(ge,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(fe,{className:"text-lg flex items-center gap-2",children:[e.jsx(nr,{className:"h-5 w-5"}),s,d&&e.jsxs(X,{variant:"secondary",className:"text-xs",children:[e.jsx(qe,{className:"h-3 w-3 mr-1"}),"가져오는 중"]}),u&&e.jsxs(X,{variant:"secondary",className:"text-xs",children:[e.jsx(qe,{className:"h-3 w-3 mr-1"}),"내보내는 중"]}),m&&e.jsxs(X,{variant:"outline",className:"text-xs",children:[e.jsx(Ee,{className:"h-3 w-3 mr-1"}),"저장되지 않은 변경사항"]})]}),t&&e.jsx(ys,{children:t})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[D&&e.jsxs(X,{variant:"default",className:"text-xs",children:[e.jsx(ze,{className:"h-3 w-3 mr-1"}),"가져옴"]}),i?e.jsx(bs,{className:"h-4 w-4"}):e.jsx(ss,{className:"h-4 w-4"})]})]})})}),e.jsx(Bt,{children:e.jsxs(ie,{className:"space-y-6",children:[v&&e.jsxs(Kt,{variant:"destructive",children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx(Ut,{children:v})]}),d&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"파일 가져오는 중..."}),e.jsxs("span",{children:[b,"%"]})]}),e.jsx(hn,{value:b,className:"h-2"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(lr,{className:"h-4 w-4"}),"설정 가져오기"]}),e.jsx("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${g?"border-primary bg-primary/5":d?"border-muted bg-muted/20":"border-muted-foreground/25 hover:border-muted-foreground/50"}`,onDragOver:de,onDragLeave:L,onDrop:I,children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(ir,{className:`h-8 w-8 mx-auto ${g?"text-primary":"text-muted-foreground"}`}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:`text-sm font-medium ${g?"text-primary":""}`,children:g?"파일을 여기에 놓으세요":"JSON 파일을 드래그하거나 클릭하여 선택하세요"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"최대 5MB, .json 파일만 지원"})]}),e.jsxs(J,{variant:"outline",size:"sm",onClick:()=>{var E;return(E=w.current)==null?void 0:E.click()},disabled:d,className:"mt-2",children:[e.jsx(cr,{className:"h-4 w-4 mr-2"}),"파일 선택"]})]})}),e.jsx("input",{ref:w,type:"file",accept:".json",onChange:te,style:{display:"none"}}),D&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ze,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-medium",children:"마지막 가져온 파일:"}),e.jsx("span",{children:D.name}),e.jsxs(X,{variant:"secondary",className:"text-xs",children:[D.sectionsCount,"개 섹션"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:D.importedAt.toLocaleString()})]})]}),e.jsx(xs,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(os,{className:"h-4 w-4"}),"설정 내보내기"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"fileName",className:"text-sm",children:"파일명 (선택사항)"}),e.jsx(ye,{id:"fileName",value:C,onChange:E=>f(E.target.value),placeholder:"preference-settings-custom.json",disabled:u}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"비워두면 자동으로 날짜가 포함된 파일명이 생성됩니다"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{className:"text-sm font-medium",children:"내보낼 설정 선택"}),e.jsx(J,{variant:"outline",size:"sm",onClick:U,disabled:u,children:Object.values(N).every(Boolean)?"전체 해제":"전체 선택"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:fs.map(E=>e.jsxs("div",{className:"flex items-start space-x-2 p-2 rounded border",children:[e.jsx(is,{id:E.key,checked:N[E.key],onCheckedChange:()=>Y(E.key),disabled:u}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsx(V,{htmlFor:E.key,className:"text-sm font-medium cursor-pointer",children:E.label}),e.jsx("p",{className:"text-xs text-muted-foreground",children:E.description})]})]},E.key))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(J,{onClick:()=>M("full"),disabled:u||j,className:"flex-1",children:[e.jsx(os,{className:"h-4 w-4 mr-2"}),"전체 설정 내보내기"]}),e.jsxs(J,{variant:"outline",onClick:()=>M("partial"),disabled:u||j||Object.values(N).every(E=>!E),className:"flex-1",children:[e.jsx(os,{className:"h-4 w-4 mr-2"}),"선택된 설정만 내보내기"]})]}),Object.values(N).every(E=>!E)&&e.jsx("p",{className:"text-xs text-destructive",children:"내보낼 설정 섹션을 하나 이상 선택해주세요"})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[e.jsx("h5",{className:"text-sm font-medium mb-2",children:"현재 설정 상태"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs",children:fs.map(E=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[E.label,":"]}),e.jsx("span",{className:"text-muted-foreground",children:R[E.key]?"설정됨":"기본값"})]},E.key))}),m&&e.jsxs("p",{className:"text-xs text-amber-600 mt-2 flex items-center gap-1",children:[e.jsx(Ee,{className:"h-3 w-3"}),"저장되지 않은 변경사항이 있습니다"]})]})]})})]})})};function gn({className:s,...t}){return e.jsx("textarea",{"data-slot":"textarea",className:ne("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...t})}const fn=({derivedPegSettings:s,updateDerivedPegSettings:t,availablePegs:a=[],saving:l=!1})=>{var A;const[i,h]=r.useState(null),[d,c]=r.useState(null),[u,o]=r.useState(""),[b,O]=r.useState(null),[g,x]=r.useState(null),v=(s==null?void 0:s.formulas)||[],n=(s==null?void 0:s.settings)||{autoValidate:!0,showInDashboard:!0,showInStatistics:!0,evaluationPrecision:4},D=[{id:"success_rate",name:"Success Rate (%)",formula:"(success_count / total_count) * 100",description:"성공률 계산 템플릿",category:"percentage"},{id:"efficiency",name:"Efficiency (%)",formula:"(good_values / all_values) * 100",description:"효율성 계산 템플릿",category:"percentage"},{id:"delta",name:"Delta Calculation",formula:"current_value - previous_value",description:"변화량 계산 템플릿",category:"difference"},{id:"ratio",name:"Simple Ratio",formula:"numerator / denominator",description:"단순 비율 계산 템플릿",category:"ratio"}],p=[{symbol:"+",name:"더하기",example:"a + b"},{symbol:"-",name:"빼기",example:"a - b"},{symbol:"*",name:"곱하기",example:"a * b"},{symbol:"/",name:"나누기",example:"a / b"},{symbol:"%",name:"나머지",example:"a % b"},{symbol:"^",name:"거듭제곱",example:"a ^ 2"},{symbol:"()",name:"괄호",example:"(a + b) * c"},{symbol:"sqrt()",name:"제곱근",example:"sqrt(a)"},{symbol:"log()",name:"로그",example:"log(a)"},{symbol:"abs()",name:"절댓값",example:"abs(a)"},{symbol:"min()",name:"최솟값",example:"min(a, b)"},{symbol:"max()",name:"최댓값",example:"max(a, b)"}],N=r.useMemo(()=>u?v.filter(m=>{var j;return m.name.toLowerCase().includes(u.toLowerCase())||m.formula.toLowerCase().includes(u.toLowerCase())||((j=m.description)==null?void 0:j.toLowerCase().includes(u.toLowerCase()))}):v,[v,u]),P=r.useCallback(m=>{try{const j=[],S=[],G=(m.match(/\(/g)||[]).length,M=(m.match(/\)/g)||[]).length;G!==M&&j.push("괄호가 일치하지 않습니다");const K=m.replace(/\$\{[^}]+\}/g," ").match(/[a-zA-Z_][a-zA-Z0-9_]*/g)||[],te=[...a.map(U=>U.value),...v.filter(U=>U.active).map(U=>U.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase())],de=K.filter(U=>!te.includes(U)&&!["sqrt","log","abs","min","max","if"].includes(U));if(de.length>0&&S.push(`알 수 없는 PEG: ${de.join(", ")}`),d){const U=d.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase();K.includes(U)&&j.push("수식이 자기 자신을 참조할 수 없습니다 (순환 참조)")}const L=m.replace(/\$\{[^}]+\}/g,"").match(/[^a-zA-Z0-9_+\-*/()^%.,\s]/g);L&&j.push(`지원하지 않는 문자: ${L.join(", ")}`);const I=K.filter(U=>a.some(E=>E.value===U)),Y=K.filter(U=>v.some(E=>E.active&&E.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()===U));return{isValid:j.length===0,errors:j,warnings:S,dependencies:I,derivedDependencies:Y}}catch{return{isValid:!1,errors:["수식 분석 중 오류가 발생했습니다"],warnings:[],dependencies:[],derivedDependencies:[]}}},[a,v,d]),C=r.useCallback(m=>{try{const j={};a.forEach(M=>{j[M.value]=Math.random()*100+50});let S=m;Object.keys(j).forEach(M=>{const K=new RegExp(`\\b${M}\\b`,"g");S=S.replace(K,j[M].toString())}),S=S.replace(/sqrt\(([^)]+)\)/g,"Math.sqrt($1)"),S=S.replace(/log\(([^)]+)\)/g,"Math.log($1)"),S=S.replace(/abs\(([^)]+)\)/g,"Math.abs($1)"),S=S.replace(/\^/g,"**");const G=Function(`"use strict"; return (${S})`)();return{success:!0,result:Number(G).toFixed(n.evaluationPrecision||4),mockData:j}}catch(j){return{success:!1,error:j.message}}},[a,n.evaluationPrecision]),f=()=>{const m={id:`formula_${Date.now()}`,name:"새 수식",formula:"",description:"",active:!0,category:"custom",unit:"",dependencies:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};c(m),h(m.id)},w=()=>{if(!d)return;const m=P(d.formula);if(!m.isValid){se.error(`수식 저장 실패: ${m.errors.join(", ")}`);return}const j={...d,dependencies:m.dependencies,derivedDependencies:m.derivedDependencies||[],updatedAt:new Date().toISOString()},S=v.findIndex(M=>M.id===d.id);let G;S>=0?(G=[...v],G[S]=j):G=[...v,j],t({...s,formulas:G}),c(null),se.success("수식이 저장되었습니다")},R=m=>{const j=v.filter(S=>S.id!==m);t({...s,formulas:j}),i===m&&h(null),(d==null?void 0:d.id)===m&&c(null),se.success("수식이 삭제되었습니다")},y=m=>{d&&(c({...d,formula:m.formula,description:m.description,category:m.category}),se.success(`템플릿 "${m.name}"이 적용되었습니다`))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(le,{children:[e.jsx(ge,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-5 w-5"}),"Derived PEG 관리"]})}),e.jsx(ie,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ls,{id:"auto-validate",checked:n.autoValidate,onCheckedChange:m=>t({...s,settings:{...n,autoValidate:m}})}),e.jsx(V,{htmlFor:"auto-validate",children:"실시간 검증"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ls,{id:"show-dashboard",checked:n.showInDashboard,onCheckedChange:m=>t({...s,settings:{...n,showInDashboard:m}})}),e.jsx(V,{htmlFor:"show-dashboard",children:"Dashboard에 표시"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ls,{id:"show-statistics",checked:n.showInStatistics,onCheckedChange:m=>t({...s,settings:{...n,showInStatistics:m}})}),e.jsx(V,{htmlFor:"show-statistics",children:"Statistics에 표시"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"계산 정밀도"}),e.jsxs(Ne,{value:(A=n.evaluationPrecision)==null?void 0:A.toString(),onValueChange:m=>t({...s,settings:{...n,evaluationPrecision:parseInt(m)}}),children:[e.jsx(Se,{children:e.jsx(we,{})}),e.jsxs(Ce,{children:[e.jsx(Q,{value:"2",children:"소수점 2자리"}),e.jsx(Q,{value:"4",children:"소수점 4자리"}),e.jsx(Q,{value:"6",children:"소수점 6자리"})]})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(le,{children:[e.jsxs(ge,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(fe,{children:"수식 목록"}),e.jsxs(J,{onClick:f,size:"sm",children:[e.jsx(or,{className:"h-4 w-4 mr-2"}),"새 수식"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ps,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(ye,{placeholder:"수식 검색...",className:"pl-8",value:u,onChange:m=>o(m.target.value)})]})]}),e.jsx(ie,{children:e.jsx(vs,{className:"h-96",children:e.jsx("div",{className:"space-y-2",children:N.map(m=>e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${i===m.id?"bg-blue-50 border-blue-200":"hover:bg-gray-50"}`,onClick:()=>h(m.id),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:m.name}),e.jsx(X,{variant:m.active?"default":"secondary",className:"text-xs",children:m.active?"활성":"비활성"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1 font-mono",children:m.formula}),m.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:m.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(X,{variant:"outline",className:"text-xs",children:m.category}),m.unit&&e.jsx(X,{variant:"outline",className:"text-xs",children:m.unit})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[e.jsx(J,{variant:"ghost",size:"sm",onClick:j=>{j.stopPropagation(),c({...m})},children:e.jsx(Ks,{className:"h-3 w-3"})}),e.jsx(J,{variant:"ghost",size:"sm",onClick:j=>{j.stopPropagation(),R(m.id)},children:e.jsx(Os,{className:"h-3 w-3"})})]})]})},m.id))})})})]}),e.jsxs(le,{children:[e.jsx(ge,{children:e.jsx(fe,{children:d?"수식 편집":"수식 상세"})}),e.jsx(ie,{children:d?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"formula-name",children:"수식 이름"}),e.jsx(ye,{id:"formula-name",value:d.name,onChange:m=>c({...d,name:m.target.value}),placeholder:"예: RACH Success Rate (%)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"formula-input",children:"수식"}),e.jsx(gn,{id:"formula-input",value:d.formula,onChange:m=>{c({...d,formula:m.target.value}),n.autoValidate&&O(P(m.target.value))},placeholder:"예: (randomaccesspremable / randomaccessresponse) * 100",className:"font-mono text-sm",rows:4}),b&&e.jsxs("div",{className:"space-y-2",children:[b.isValid?e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(Rs,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"수식이 유효합니다"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:b.errors.join(", ")})]}),b.warnings.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:b.warnings.join(", ")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"formula-description",children:"설명"}),e.jsx(ye,{id:"formula-description",value:d.description,onChange:m=>c({...d,description:m.target.value}),placeholder:"수식에 대한 설명을 입력하세요"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"formula-category",children:"카테고리"}),e.jsxs(Ne,{value:d.category,onValueChange:m=>c({...d,category:m}),children:[e.jsx(Se,{children:e.jsx(we,{})}),e.jsxs(Ce,{children:[e.jsx(Q,{value:"percentage",children:"비율 (%)"}),e.jsx(Q,{value:"success_rate",children:"성공률"}),e.jsx(Q,{value:"efficiency",children:"효율성"}),e.jsx(Q,{value:"quality",children:"품질"}),e.jsx(Q,{value:"performance",children:"성능"}),e.jsx(Q,{value:"custom",children:"사용자 정의"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"formula-unit",children:"단위"}),e.jsx(ye,{id:"formula-unit",value:d.unit,onChange:m=>c({...d,unit:m.target.value}),placeholder:"예: %, ms, Mbps"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ls,{id:"formula-active",checked:d.active,onCheckedChange:m=>c({...d,active:m})}),e.jsx(V,{htmlFor:"formula-active",children:"수식 활성화"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(J,{onClick:()=>{const m=P(d.formula);O(m);const j=C(d.formula);x(j)},children:[e.jsx(Ms,{className:"h-4 w-4 mr-2"}),"테스트"]}),e.jsxs(J,{onClick:w,disabled:l,children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"저장"]}),e.jsxs(J,{variant:"outline",onClick:()=>c(null),children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"취소"]})]}),g&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(xs,{}),e.jsx("h4",{className:"font-medium",children:"테스트 결과"}),g.success?e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-green-700",children:e.jsxs("strong",{children:["결과: ",g.result]})}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"모의 데이터를 사용한 계산 결과입니다"})]}):e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-700",children:["오류: ",g.error]})})]})]}):i?e.jsx("div",{className:"space-y-4",children:(()=>{const m=v.find(j=>j.id===i);return m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:m.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:m.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"수식"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg font-mono text-sm",children:m.formula})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(V,{className:"text-xs",children:"카테고리"}),e.jsx("p",{className:"text-sm",children:m.category})]}),e.jsxs("div",{children:[e.jsx(V,{className:"text-xs",children:"단위"}),e.jsx("p",{className:"text-sm",children:m.unit||"없음"})]})]}),(m.dependencies&&m.dependencies.length>0||m.derivedDependencies&&m.derivedDependencies.length>0)&&e.jsxs("div",{className:"space-y-2",children:[m.dependencies&&m.dependencies.length>0&&e.jsxs("div",{children:[e.jsxs(V,{className:"text-xs flex items-center gap-1",children:[e.jsx(We,{className:"h-3 w-3"}),"기본 PEG 의존성"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:m.dependencies.map(j=>e.jsx(X,{variant:"outline",className:"text-xs",children:j},j))})]}),m.derivedDependencies&&m.derivedDependencies.length>0&&e.jsxs("div",{children:[e.jsxs(V,{className:"text-xs flex items-center gap-1",children:[e.jsx(Qe,{className:"h-3 w-3"}),"Derived PEG 의존성"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:m.derivedDependencies.map(j=>e.jsx(X,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700",children:j},j))})]})]}),e.jsxs(J,{onClick:()=>c({...m}),className:"w-full",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"편집"]})]}):e.jsx("p",{children:"수식을 찾을 수 없습니다."})})()}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Qe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"수식을 선택하거나 새로 만들어보세요"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(le,{children:[e.jsx(ge,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(dr,{className:"h-5 w-5"}),"템플릿 라이브러리"]})}),e.jsx(ie,{children:e.jsx("div",{className:"space-y-2",children:D.map(m=>e.jsx("div",{className:"p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>y(m),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",children:m.name}),e.jsx("p",{className:"text-xs font-mono text-muted-foreground",children:m.formula}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:m.description})]}),e.jsx(J,{variant:"ghost",size:"sm",children:e.jsx(mr,{className:"h-3 w-3"})})]})},m.id))})})]}),e.jsxs(le,{children:[e.jsx(ge,{children:e.jsx(fe,{children:"지원 연산자"})}),e.jsx(ie,{children:e.jsx(vs,{className:"h-64",children:e.jsx("div",{className:"space-y-2",children:p.map((m,j)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("code",{className:"font-mono font-medium",children:m.symbol}),e.jsx("span",{className:"text-sm text-muted-foreground ml-2",children:m.name})]}),e.jsx("code",{className:"text-xs text-muted-foreground",children:m.example})]},j))})})})]})]}),e.jsxs(le,{children:[e.jsxs(ge,{children:[e.jsx(fe,{children:"사용 가능한 PEG"}),e.jsx(ys,{children:"수식에 사용할 수 있는 기본 PEG와 생성된 Derived PEG 목록입니다"})]}),e.jsx(ie,{children:e.jsxs("div",{className:"space-y-4",children:[a.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4"}),"기본 PEG (",a.length,"개)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.map(m=>e.jsx(J,{variant:"outline",size:"sm",onClick:()=>{d&&c({...d,formula:d.formula+m.value})},className:"text-xs",children:m.label||m.value},m.value))})]}),v.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),"Derived PEG (",v.filter(m=>m.active).length,"개)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:v.filter(m=>m.active).map(m=>e.jsxs(J,{variant:"outline",size:"sm",onClick:()=>{if(d){const j=`${m.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()}`;c({...d,formula:d.formula+j})}},className:"text-xs bg-blue-50 border-blue-200 hover:bg-blue-100",title:m.description,children:[e.jsx(Qe,{className:"h-3 w-3 mr-1"}),m.name,m.unit&&e.jsxs("span",{className:"ml-1 text-muted-foreground",children:["(",m.unit,")"]})]},m.id))}),v.filter(m=>m.active).length===0&&e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(Qe,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"아직 생성된 Derived PEG가 없습니다"}),e.jsx("p",{className:"text-xs",children:"새 수식을 추가하고 활성화하면 여기에 표시됩니다"})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-sm text-blue-700 mb-1",children:"💡 사용법"}),e.jsxs("ul",{className:"text-xs text-blue-600 space-y-1",children:[e.jsx("li",{children:"• 기본 PEG: 클릭하면 수식에 바로 삽입됩니다"}),e.jsx("li",{children:"• Derived PEG: 다른 수식에서 참조할 수 있는 계산된 값입니다"}),e.jsx("li",{children:"• 비활성화된 Derived PEG는 목록에 표시되지 않습니다"}),e.jsx("li",{children:"• Derived PEG끼리 순환 참조하지 않도록 주의하세요"})]})]})]})})]})]})};function pn(s=[]){return s.map(t=>({value:t.value,label:t.label,type:t.type,color:t.type==="derived"?"#3b82f6":"#6b7280",isDerived:t.type==="derived",description:t.description,formula:t.formula}))}const Ht=()=>{var te,de,L,I,Y,U,E,q,_,H,W,B,Z,be,z,me,ue,ce,ke,oe;const{settings:s,isLoading:t,isSaving:a,error:l,lastSaved:i,updateSettings:h,saveSettings:d,resetSettings:c}=Ye(),[u,o]=r.useState([]),[b,O]=r.useState(!1),[g,x]=r.useState(null),v=r.useCallback(async()=>{var T,F;try{O(!0),console.info("[PreferenceManager] Fetching DB PEGs");const $=(s==null?void 0:s.databaseSettings)||{};if(!$.host){console.warn("[PreferenceManager] No DB config found");return}const ee=await ve.post("/api/master/pegs",{host:String($.host).trim(),port:Number($.port)||5432,user:String($.user||"").trim(),password:String($.password||"").trim(),dbname:String($.dbname||"").trim(),table:String($.table||"summary").trim(),limit:500}),ae=((T=ee==null?void 0:ee.data)==null?void 0:T.pegs)||(Array.isArray((F=ee==null?void 0:ee.data)==null?void 0:F.items)?ee.data.items.map(je=>({id:je,name:je})):Array.isArray(ee==null?void 0:ee.data)?ee.data.map(je=>({id:je,name:je})):[]);console.info("[PreferenceManager] DB PEGs loaded:",ae.length);const pe=ae.map(je=>({value:je.id||je.name||je.peg_name,label:String(je.name||je.id||je.peg_name)}));o(pe),x(new Date)}catch($){console.error("[PreferenceManager] Error fetching DB PEGs:",$)}finally{O(!1)}},[s==null?void 0:s.databaseSettings]),n=r.useCallback(()=>{const T=pn(u);return console.log("✅ 최종 PEG 옵션:",T),T},[u]),D=JSON.stringify({host:(te=s==null?void 0:s.databaseSettings)==null?void 0:te.host,port:(de=s==null?void 0:s.databaseSettings)==null?void 0:de.port,user:(L=s==null?void 0:s.databaseSettings)==null?void 0:L.user,dbname:(I=s==null?void 0:s.databaseSettings)==null?void 0:I.dbname,table:(Y=s==null?void 0:s.databaseSettings)==null?void 0:Y.table});r.useEffect(()=>{v()},[v,D]);const p=[{key:"selectedPegs",label:"Dashboard에 표시할 PEG 목록",type:"multiselect",required:!1,options:n(),placeholder:"Database PEG에서 선택하세요"},{key:"chartLayout",label:"그래프 정렬 방식",type:"select",options:[{value:"byPeg",label:"PEG별 (PEG마다 Cell/NE 시리즈)"},{value:"byEntity",label:"Cell/NE별 (엔터티마다 PEG 시리즈)"}]}],[N,P]=r.useState([]),[C,f]=r.useState([]),[w,R]=r.useState([]),[y,A]=r.useState([]),[m,j]=r.useState([]),[S,G]=r.useState([]);r.useEffect(()=>{const T=(s==null?void 0:s.statisticsSettings)||{};f(Array.isArray(T.selectedHosts)?T.selectedHosts:[]),A(Array.isArray(T.selectedNEs)?T.selectedNEs:[]),G(Array.isArray(T.selectedCellIds)?T.selectedCellIds:[])},[s==null?void 0:s.statisticsSettings]),r.useEffect(()=>{(async()=>{var F;try{const $=(s==null?void 0:s.databaseSettings)||{};if(!$.host)return;const ee={host:String($.host||"").trim(),port:Number($.port)||5432,user:String($.user||"").trim(),password:String($.password||"").trim(),dbname:String($.dbname||"").trim(),table:String($.table||"summary").trim()},ae=await ve.post("/api/master/hosts",ee);P(Array.isArray((F=ae==null?void 0:ae.data)==null?void 0:F.hosts)?ae.data.hosts:[])}catch($){console.error("[PreferenceManager] HOST 목록 조회 실패",$)}})()},[(U=s==null?void 0:s.databaseSettings)==null?void 0:U.host,(E=s==null?void 0:s.databaseSettings)==null?void 0:E.port,(q=s==null?void 0:s.databaseSettings)==null?void 0:q.user,(_=s==null?void 0:s.databaseSettings)==null?void 0:_.password,(H=s==null?void 0:s.databaseSettings)==null?void 0:H.dbname,(W=s==null?void 0:s.databaseSettings)==null?void 0:W.table]),r.useEffect(()=>{(async()=>{var F;try{const $=(s==null?void 0:s.databaseSettings)||{};if(!$.host||C.length===0){R([]);return}const ee={host:String($.host||"").trim(),port:Number($.port)||5432,user:String($.user||"").trim(),password:String($.password||"").trim(),dbname:String($.dbname||"").trim(),table:String($.table||"summary").trim(),hosts:C},ae=await ve.post("/api/master/nes-by-host",ee);R(Array.isArray((F=ae==null?void 0:ae.data)==null?void 0:F.nes)?ae.data.nes:[])}catch($){console.error("[PreferenceManager] NE 목록 조회 실패",$)}})()},[C,s==null?void 0:s.databaseSettings]),r.useEffect(()=>{(async()=>{var F;try{const $=(s==null?void 0:s.databaseSettings)||{};if(!$.host||C.length===0||y.length===0){j([]);return}const ee={host:String($.host||"").trim(),port:Number($.port)||5432,user:String($.user||"").trim(),password:String($.password||"").trim(),dbname:String($.dbname||"").trim(),table:String($.table||"summary").trim(),hosts:C,nes:y},ae=await ve.post("/api/master/cells-by-host-ne",ee);j(Array.isArray((F=ae==null?void 0:ae.data)==null?void 0:F.cellids)?ae.data.cellids:[])}catch($){console.error("[PreferenceManager] CellID 목록 조회 실패",$)}})()},[y,C,s==null?void 0:s.databaseSettings]);const M=[{key:"host",label:"Host",type:"text",placeholder:"예: 127.0.0.1"},{key:"port",label:"Port",type:"number",min:1,max:65535,placeholder:"5432"},{key:"user",label:"User",type:"text",placeholder:"postgres"},{key:"password",label:"Password",type:"text",placeholder:"비밀번호"},{key:"dbname",label:"DB Name",type:"text",placeholder:"postgres"},{key:"table",label:"기본 테이블명",type:"text",placeholder:"summary"}],K=[{key:"enableNotifications",label:"알림 활성화",type:"switch"},{key:"emailNotifications",label:"이메일 알림",type:"switch"},{key:"soundEnabled",label:"소리 알림",type:"switch"},{key:"notificationFrequency",label:"알림 빈도",type:"select",options:[{value:"immediate",label:"즉시"},{value:"hourly",label:"매시간"},{value:"daily",label:"매일"},{value:"weekly",label:"매주"}]}];return t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"환경설정"}),e.jsxs(X,{variant:"secondary",className:"text-xs",children:[e.jsx(qe,{className:"h-3 w-3 mr-1"}),"로딩 중..."]})]}),e.jsx(le,{children:e.jsx(ie,{className:"pt-6",children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"설정을 불러오는 중입니다..."})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"환경설정"}),e.jsx("p",{className:"text-muted-foreground",children:"Dashboard와 Statistics의 동작을 설정할 수 있습니다"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a&&e.jsxs(X,{variant:"secondary",className:"text-xs",children:[e.jsx(qe,{className:"h-3 w-3 mr-1"}),"저장 중..."]}),l&&e.jsx(X,{variant:"destructive",className:"text-xs",children:"오류 발생"}),i&&e.jsxs(X,{variant:"outline",className:"text-xs",children:["마지막 저장: ",new Date(i).toLocaleTimeString()]})]})]}),e.jsxs(Ns,{defaultValue:"dashboard",className:"w-full",children:[e.jsxs(ws,{className:"grid w-full grid-cols-6",children:[e.jsxs($e,{value:"dashboard",className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),"Dashboard"]}),e.jsxs($e,{value:"statistics",className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4"}),"Statistics"]}),e.jsxs($e,{value:"database",className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4"}),"Database"]}),e.jsxs($e,{value:"derived-peg",className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),"Derived PEG"]}),e.jsxs($e,{value:"notifications",className:"flex items-center gap-2",children:[e.jsx(ur,{className:"h-4 w-4"}),"알림"]}),e.jsxs($e,{value:"backup",className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-4 w-4"}),"백업/복원"]})]}),e.jsxs(Ae,{value:"dashboard",className:"space-y-6",children:[e.jsxs(le,{children:[e.jsx(ge,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-5 w-5"}),"PEG 데이터 소스"]})}),e.jsx(ie,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"PEG 데이터 소스"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Database Settings에서 연결된 실제 PEG 목록을 사용합니다"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(J,{variant:"outline",size:"sm",onClick:v,disabled:b,children:[e.jsx(es,{className:`h-3 w-3 ${b?"animate-spin":""}`}),"새로고침"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"사용 가능한 PEG"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[u.length,"개"]})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"마지막 업데이트"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g?g.toLocaleTimeString():"없음"})]})]}),u.length===0&&!b&&e.jsx("div",{className:"p-3 border rounded-lg bg-amber-50 border-amber-200",children:e.jsx("p",{className:"text-sm text-amber-700",children:"⚠️ DB PEG를 불러올 수 없습니다. Database Settings에서 DB 연결을 확인하세요."})}),u.length>0&&e.jsx("div",{className:"p-3 border rounded-lg bg-green-50 border-green-200",children:e.jsxs("p",{className:"text-sm text-green-700",children:["✅ ",u.length,"개의 실제 DB PEG를 사용할 수 있습니다"]})})]})})]}),e.jsx($s,{title:"Dashboard 설정",description:"DB에서 연동된 PEG만 선택하여 표시합니다",settingKey:"dashboardSettings",fields:p,defaultOpen:!0,showResetButton:!0,showSaveButton:!1},`dashboard-settings-${u.length}-${g?g.getTime():0}`),e.jsx("div",{className:"flex items-center justify-end gap-2",children:e.jsx(J,{size:"sm",onClick:async()=>{try{await d(),alert("Dashboard 설정이 저장되었습니다")}catch(T){alert("저장 실패: "+((T==null?void 0:T.message)||"알 수 없는 오류"))}},disabled:a,children:a?"저장 중...":"저장"})})]}),e.jsx(Ae,{value:"statistics",className:"space-y-6",children:e.jsxs(le,{children:[e.jsx(ge,{children:e.jsx(fe,{children:"데이터 선택 (HOST → NE → CellID)"})}),e.jsxs(ie,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(V,{className:"block mb-2",children:"HOST (다중 선택)"}),e.jsx("select",{multiple:!0,className:"w-full border rounded p-2 h-48",value:C,onChange:T=>{const F=Array.from(T.target.selectedOptions).map($=>$.value);f(F)},children:N.map(T=>e.jsx("option",{value:T,children:T},T))})]}),e.jsxs("div",{children:[e.jsx(V,{className:"block mb-2",children:"NE (다중 선택)"}),e.jsx("select",{multiple:!0,className:"w-full border rounded p-2 h-48",value:y,onChange:T=>{const F=Array.from(T.target.selectedOptions).map($=>$.value);A(F)},children:w.map(T=>e.jsx("option",{value:T,children:T},T))})]}),e.jsxs("div",{children:[e.jsx(V,{className:"block mb-2",children:"CellID (다중 선택)"}),e.jsx("select",{multiple:!0,className:"w-full border rounded p-2 h-48",value:S,onChange:T=>{const F=Array.from(T.target.selectedOptions).map($=>$.value);G(F)},children:m.map(T=>e.jsx("option",{value:T,children:T},T))})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsxs("div",{className:"mb-1",children:["HOST: ",C.length,"개"]}),e.jsxs("div",{className:"mb-1",children:["NE: ",y.length,"개"]}),e.jsxs("div",{children:["CellID: ",S.length,"개"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(J,{size:"sm",onClick:async()=>{try{h({statisticsSettings:{...(s==null?void 0:s.statisticsSettings)||{},selectedHosts:C,selectedNEs:y,selectedCellIds:S}}),await d(),alert("Statistics 설정이 저장되었습니다")}catch(T){alert("저장 실패: "+((T==null?void 0:T.message)||"알 수 없는 오류"))}},disabled:a,children:a?"저장 중...":"저장"})})]})]})]})}),e.jsxs(Ae,{value:"database",className:"space-y-6",children:[e.jsx($s,{title:"Database 설정",description:"LLM 분석과 Statistics에서 공통으로 사용할 PostgreSQL DB 설정입니다 (테이블명 포함).",settingKey:"databaseSettings",fields:M,defaultOpen:!0,showResetButton:!0,showSaveButton:!1}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(J,{size:"sm",onClick:async()=>{try{await d(),alert("Database 설정이 저장되었습니다")}catch(T){alert("저장 실패: "+((T==null?void 0:T.message)||"알 수 없는 오류"))}},disabled:a,children:a?"저장 중...":"저장"}),e.jsx(J,{size:"sm",onClick:async()=>{var T,F,$,ee;try{const ae=(s==null?void 0:s.databaseSettings)||{},pe=await ve.post("/api/master/test-connection",{host:(ae.host||"").trim(),port:Number(ae.port)||5432,user:(ae.user||"").trim(),password:(ae.password||"").trim(),dbname:(ae.dbname||"").trim(),table:(ae.table||"summary").trim()}),je=(T=pe==null?void 0:pe.data)==null?void 0:T.success;alert(je?"DB 연결 성공. table_exists="+((F=pe==null?void 0:pe.data)==null?void 0:F.table_exists):"DB 연결 실패: 응답 형식 확인 필요")}catch(ae){alert("DB 연결 실패: "+(((ee=($=ae==null?void 0:ae.response)==null?void 0:$.data)==null?void 0:ee.detail)||(ae==null?void 0:ae.message)))}},children:"Test Connection"})]})]}),e.jsx(Ae,{value:"derived-peg",className:"space-y-6",children:e.jsx(fn,{derivedPegSettings:(s==null?void 0:s.derivedPegSettings)||{formulas:[],settings:{}},updateDerivedPegSettings:T=>{h({derivedPegSettings:T})},availablePegs:n(),saving:a})}),e.jsx(Ae,{value:"notifications",className:"space-y-6",children:e.jsx($s,{title:"알림 설정",description:"이메일, 소리 알림 등 알림 관련 설정을 관리합니다",settingKey:"notificationSettings",fields:K,defaultOpen:!0,showResetButton:!0,showSaveButton:!1})}),e.jsxs(Ae,{value:"backup",className:"space-y-6",children:[e.jsx(xn,{title:"설정 백업 및 복원",description:"모든 환경설정을 JSON 파일로 내보내거나 백업 파일에서 복원할 수 있습니다",defaultOpen:!0}),e.jsxs(le,{children:[e.jsxs(ge,{children:[e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(Ts,{className:"h-5 w-5 text-orange-500"}),"설정 초기화"]}),e.jsx(ys,{children:"Dashboard, Statistics, Database 설정을 기본값으로 초기화합니다. 이 작업은 되돌릴 수 없습니다."})]}),e.jsxs(ie,{className:"space-y-4",children:[e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-md p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(As,{className:"h-5 w-5 text-orange-500 mt-0.5"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-orange-800",children:"주의사항"}),e.jsxs("ul",{className:"text-sm text-orange-700 space-y-1",children:[e.jsx("li",{children:"• Dashboard의 선택된 PEG 목록이 초기화됩니다"}),e.jsx("li",{children:"• Statistics의 기본 설정이 초기화됩니다"}),e.jsx("li",{children:"• Database 연결 설정이 기본값으로 초기화됩니다"}),e.jsx("li",{children:"• 이 작업은 되돌릴 수 없습니다"})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"초기화할 설정"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Dashboard, Statistics, Database 설정을 기본값으로 초기화"})]}),e.jsx(J,{variant:"destructive",size:"sm",onClick:async()=>{if(window.confirm(`정말로 Dashboard, Statistics, Database 설정을 초기화하시겠습니까?

이 작업은 되돌릴 수 없습니다.`))try{const F=await c(["dashboardSettings","statisticsSettings","databaseSettings"]);F.success?alert("✅ 설정이 성공적으로 초기화되었습니다!"):alert("❌ 설정 초기화 실패: "+(F.error||"알 수 없는 오류"))}catch(F){alert("❌ 설정 초기화 중 오류 발생: "+F.message)}},disabled:t,children:t?e.jsxs(e.Fragment,{children:[e.jsx(ms,{className:"h-4 w-4 mr-2 animate-spin"}),"초기화 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ts,{className:"h-4 w-4 mr-2"}),"설정 초기화"]})})]})]})]})]})]}),e.jsxs(le,{children:[e.jsx(ge,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-5 w-5"}),"현재 설정 요약"]})}),e.jsx(ie,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Dashboard"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["선택된 PEG: ",((Z=(B=s==null?void 0:s.dashboardSettings)==null?void 0:B.selectedPegs)==null?void 0:Z.length)||0,"개"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["PEG 소스: ",`DB (${u.length}개)`]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["차트 스타일: ",((be=s==null?void 0:s.dashboardSettings)==null?void 0:be.chartStyle)||"line"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Statistics"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["기본 기간: ",((z=s==null?void 0:s.statisticsSettings)==null?void 0:z.defaultDateRange)||7,"일"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["소수점: ",((me=s==null?void 0:s.statisticsSettings)==null?void 0:me.decimalPlaces)||2,"자리"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["비교 옵션: ",(ue=s==null?void 0:s.statisticsSettings)!=null&&ue.showComparisonOptions?"활성":"비활성"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"알림"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["알림: ",(ce=s==null?void 0:s.notificationSettings)!=null&&ce.enableNotifications?"활성":"비활성"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["이메일: ",(ke=s==null?void 0:s.notificationSettings)!=null&&ke.emailNotifications?"활성":"비활성"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["소리: ",(oe=s==null?void 0:s.notificationSettings)!=null&&oe.soundEnabled?"활성":"비활성"]})]})]})]})})]})]})},Wt=Object.freeze(Object.defineProperty({__proto__:null,default:Ht},Symbol.toStringTag,{value:"Module"}));function jn({className:s,...t}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:ne("w-full caption-bottom text-sm",s),...t})})}function vn({className:s,...t}){return e.jsx("thead",{"data-slot":"table-header",className:ne("[&_tr]:border-b",s),...t})}function bn({className:s,...t}){return e.jsx("tbody",{"data-slot":"table-body",className:ne("[&_tr:last-child]:border-0",s),...t})}function st({className:s,...t}){return e.jsx("tr",{"data-slot":"table-row",className:ne("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",s),...t})}function Be({className:s,...t}){return e.jsx("th",{"data-slot":"table-head",className:ne("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}function Ke({className:s,...t}){return e.jsx("td",{"data-slot":"table-cell",className:ne("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}function tt({...s}){return e.jsx(Ua,{"data-slot":"alert-dialog",...s})}function at({...s}){return e.jsx(Ha,{"data-slot":"alert-dialog-trigger",...s})}function yn({...s}){return e.jsx(Qa,{"data-slot":"alert-dialog-portal",...s})}function Nn({className:s,...t}){return e.jsx(Xa,{"data-slot":"alert-dialog-overlay",className:ne("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...t})}function rt({className:s,...t}){return e.jsxs(yn,{children:[e.jsx(Nn,{}),e.jsx(Wa,{"data-slot":"alert-dialog-content",className:ne("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",s),...t})]})}function nt({className:s,...t}){return e.jsx("div",{"data-slot":"alert-dialog-header",className:ne("flex flex-col gap-2 text-center sm:text-left",s),...t})}function lt({className:s,...t}){return e.jsx("div",{"data-slot":"alert-dialog-footer",className:ne("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",s),...t})}function it({className:s,...t}){return e.jsx(qa,{"data-slot":"alert-dialog-title",className:ne("text-lg font-semibold",s),...t})}function ct({className:s,...t}){return e.jsx(Ya,{"data-slot":"alert-dialog-description",className:ne("text-muted-foreground text-sm",s),...t})}function ot({className:s,...t}){return e.jsx(Za,{className:ne(Gs(),s),...t})}function dt({className:s,...t}){return e.jsx(Ja,{className:ne(Gs({variant:"outline"}),s),...t})}const wn=({initialLimit:s=20,autoFetch:t=!0,initialFilters:a={}}={})=>{const[l,i]=r.useState([]),[h,d]=r.useState(!1),[c,u]=r.useState(null),[o,b]=r.useState(!0),[O,g]=r.useState({limit:s,skip:0,total:0}),[x,v]=r.useState({neId:"ALL",cellId:"ALL",startDate:null,endDate:null,status:"",...a}),n=r.useCallback((j,S={})=>{console.log(`[useAnalysisResults] ${j}`,S)},[]),D=r.useCallback((j,S)=>{console.error(`[useAnalysisResults] ${j}`,S)},[]),p=r.useCallback(async({limit:j=O.limit,skip:S=0,append:G=!1,showToast:M=!0}={})=>{var K,te,de,L,I,Y,U,E,q,_,H;try{d(!0),u(null),n("분석 결과 조회 시작",{limit:j,skip:S,filters:x});const W={limit:j,skip:S};(K=x.neId)!=null&&K.trim()&&(W.ne_id=x.neId.trim()),(te=x.cellId)!=null&&te.trim()&&(W.cell_id=x.cellId.trim()),x.startDate&&(W.date_from=x.startDate),x.endDate&&(W.date_to=x.endDate),(de=x.status)!=null&&de.trim()&&(W.status=x.status.trim());const B=await ve.get("/api/analysis/results",{params:W});n("분석 결과 조회 성공",{resultCount:((I=(L=B.data)==null?void 0:L.items)==null?void 0:I.length)||0,total:((Y=B.data)==null?void 0:Y.total)||0,totalRequested:j});const be=(((U=B.data)==null?void 0:U.items)||[]).filter(z=>((z==null?void 0:z.analysis_type)||(z==null?void 0:z.analysisType))==="llm_analysis");return i(G?z=>[...z,...be]:be),g(z=>{var me;return{...z,skip:G?z.skip+be.length:S+be.length,total:((me=B.data)==null?void 0:me.total)||0}}),b(((E=B.data)==null?void 0:E.has_next)||!1),M&&!G&&se.success(`${be.length}개의 분석 결과를 불러왔습니다.`),be}catch(W){const B=((H=(_=(q=W==null?void 0:W.response)==null?void 0:q.data)==null?void 0:_.error)==null?void 0:H.message)||(W==null?void 0:W.message)||"분석 결과를 불러오는 중 오류가 발생했습니다.";return D("분석 결과 조회 실패",W),u(B),M&&se.error(`데이터 조회 실패: ${B}`),[]}finally{d(!1)}},[O.limit,x,n,D]),N=r.useCallback(j=>{n("필터 업데이트",{이전:x,새로운:j}),v(S=>({...S,...j})),g(S=>({...S,skip:0}))},[x,n]),P=r.useCallback(()=>{n("필터 초기화"),v({neId:"",cellId:"",startDate:null,endDate:null,status:""}),g(j=>({...j,skip:0}))},[n]),C=r.useCallback(async()=>{if(h||!o){n("추가 로딩 건너뜀",{loading:h,hasMore:o});return}n("추가 결과 로딩 시작"),await p({skip:O.skip,append:!0,showToast:!1})},[h,o,p,O.skip,n]),f=r.useCallback(async()=>{n("데이터 새로고침 시작"),g(j=>({...j,skip:0})),await p({skip:0,append:!1})},[p,n]),w=r.useCallback(async j=>{var S,G,M;try{n("분석 결과 삭제 시작",{resultId:j}),await ve.delete(`/api/analysis/results/${j}`),i(K=>K.filter(te=>te.id!==j)),n("분석 결과 삭제 성공",{resultId:j}),se.success("분석 결과가 삭제되었습니다.")}catch(K){const te=((M=(G=(S=K==null?void 0:K.response)==null?void 0:S.data)==null?void 0:G.error)==null?void 0:M.message)||(K==null?void 0:K.message)||"분석 결과 삭제 중 오류가 발생했습니다.";D("분석 결과 삭제 실패",K),se.error(`삭제 실패: ${te}`)}},[n,D]);r.useEffect(()=>{t&&(n("컴포넌트 마운트 - 자동 데이터 조회 시작"),p({skip:0,append:!1,showToast:!1}))},[t]),r.useEffect(()=>{t&&(n("필터 변경 감지 - 데이터 재조회"),p({skip:0,append:!1,showToast:!1}))},[t,x,p,n]);const R=r.useMemo(()=>!h&&l.length===0,[h,l.length]),y=r.useMemo(()=>Object.values(x).some(j=>j!=null&&j!==""),[x]),A=r.useMemo(()=>l.length,[l.length]),m=r.useMemo(()=>({resultCount:A,loading:h,hasMore:o,isEmpty:R,isFiltered:y,pagination:O,filters:x,error:c}),[A,h,o,R,y,O,x,c]);return r.useEffect(()=>{},[m]),{results:l,loading:h,error:c,isEmpty:R,hasMore:o,isFiltered:y,resultCount:A,pagination:O,filters:x,updateFilters:N,clearFilters:P,fetchResults:p,refresh:f,loadMore:C,deleteResult:w,debugInfo:m}},Sn=({filters:s={},onFilterChange:t,onClearFilters:a,isCollapsed:l=!1,onToggleCollapse:i,showActiveCount:h=!0})=>{const d=r.useCallback((f,w={})=>{console.log(`[ResultFilter] ${f}`,w)},[]),{neId:c="",cellId:u="",startDate:o=null,endDate:b=null,status:O=""}=s,g={...c&&{"NE ID":c},...u&&{"Cell ID":u},...o&&{시작일:new Date(o).toLocaleDateString("ko-KR")},...b&&{종료일:new Date(b).toLocaleDateString("ko-KR")},...O&&{상태:O}},x=Object.keys(g).length,v=x>0,n=r.useCallback((f,w)=>{d("필터 변경",{key:f,value:w}),t&&t(f,w)},[t,d]),D=r.useCallback(f=>{d("개별 필터 초기화",{key:f}),n(f,f==="startDate"||f==="endDate"?null:"")},[n,d]),p=r.useCallback(()=>{d("전체 필터 초기화"),a&&a()},[a,d]),N=r.useCallback(f=>{if(!f)return"";try{return new Date(f).toISOString().split("T")[0]}catch{return""}},[]),P=r.useCallback(f=>{if(!f)return null;try{return new Date(f).toISOString()}catch{return null}},[]),C=r.useCallback(()=>{d("필터 패널 토글",{isCollapsed:!l}),i&&i()},[l,i,d]);return e.jsxs(le,{className:"w-full",children:[e.jsxs(ge,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(fe,{className:"text-lg flex items-center gap-2",children:[e.jsx(zs,{className:"h-5 w-5"}),"필터"]}),h&&v&&e.jsxs(X,{variant:"secondary",className:"text-xs",children:[x,"개 활성"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[v&&e.jsxs(J,{variant:"ghost",size:"sm",onClick:p,className:"text-destructive hover:text-destructive",children:[e.jsx(Oe,{className:"h-4 w-4 mr-1"}),"전체 초기화"]}),e.jsx(J,{variant:"ghost",size:"sm",onClick:C,children:l?e.jsx(ss,{className:"h-4 w-4"}):e.jsx(bs,{className:"h-4 w-4"})})]})]}),v&&!l&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:Object.entries(g).map(([f,w])=>e.jsxs(X,{variant:"outline",className:"flex items-center gap-1 pr-1",children:[e.jsxs("span",{className:"text-xs",children:[f,": ",w]}),e.jsx(J,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 hover:bg-destructive hover:text-destructive-foreground",onClick:()=>{const y={"NE ID":"neId","Cell ID":"cellId",시작일:"startDate",종료일:"endDate",상태:"status"}[f];y&&D(y)},children:e.jsx(Oe,{className:"h-3 w-3"})})]},f))})]}),!l&&e.jsxs(ie,{className:"pt-0",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(V,{htmlFor:"filter-ne",className:"flex items-center gap-2",children:[e.jsx(hr,{className:"h-4 w-4"}),"NE ID"]}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{id:"filter-ne",placeholder:"NE ID 검색...",value:c,onChange:f=>n("neId",f.target.value),className:"pr-8"}),c&&e.jsx(J,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-6 w-6 p-0",onClick:()=>D("neId"),children:e.jsx(Oe,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(V,{htmlFor:"filter-cell",className:"flex items-center gap-2",children:[e.jsx(xr,{className:"h-4 w-4"}),"Cell ID"]}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{id:"filter-cell",placeholder:"Cell ID 검색...",value:u,onChange:f=>n("cellId",f.target.value),className:"pr-8"}),u&&e.jsx(J,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-6 w-6 p-0",onClick:()=>D("cellId"),children:e.jsx(Oe,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(V,{htmlFor:"filter-start",className:"flex items-center gap-2",children:[e.jsx(ds,{className:"h-4 w-4"}),"시작 날짜"]}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{id:"filter-start",type:"date",value:N(o),onChange:f=>n("startDate",P(f.target.value)),className:"pr-8"}),o&&e.jsx(J,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-6 w-6 p-0",onClick:()=>D("startDate"),children:e.jsx(Oe,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(V,{htmlFor:"filter-end",className:"flex items-center gap-2",children:[e.jsx(ds,{className:"h-4 w-4"}),"종료 날짜"]}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{id:"filter-end",type:"date",value:N(b),onChange:f=>n("endDate",P(f.target.value)),className:"pr-8"}),b&&e.jsx(J,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-6 w-6 p-0",onClick:()=>D("endDate"),children:e.jsx(Oe,{className:"h-3 w-3"})})]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx(V,{className:"text-sm font-medium mb-3 block",children:"빠른 날짜 선택"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{label:"오늘",days:0},{label:"어제",days:1},{label:"최근 7일",days:7},{label:"최근 30일",days:30},{label:"최근 90일",days:90}].map(({label:f,days:w})=>e.jsx(J,{variant:"outline",size:"sm",onClick:()=>{const R=new Date,y=new Date;w===0?(y.setHours(0,0,0,0),R.setHours(23,59,59,999)):w===1?(y.setDate(y.getDate()-1),y.setHours(0,0,0,0),R.setDate(R.getDate()-1),R.setHours(23,59,59,999)):(y.setDate(y.getDate()-w),y.setHours(0,0,0,0),R.setHours(23,59,59,999)),n("startDate",y.toISOString()),n("endDate",R.toISOString()),d("빠른 날짜 선택",{label:f,startDate:y,endDate:R})},children:f},f))})]})]})]})},qt=({isOpen:s,onClose:t,resultIds:a=[],mode:l="single"})=>{const[i,h]=r.useState([]),[d,c]=r.useState(!1),[u,o]=r.useState(null),[b,O]=r.useState("overview"),[g,x]=r.useState(!1);r.useEffect(()=>{const I=Y=>{Y.key==="F11"?(Y.preventDefault(),x(U=>!U)):Y.key==="Escape"&&g&&x(!1)};if(s)return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[s,g]);const[v,n]=r.useState(0),[D,p]=r.useState(10),[N,P]=r.useState(""),[C,f]=r.useState("all"),[w,R]=r.useState("all"),y=l==="compare"&&a.length>1;l==="single"&&a.length;const A=async I=>{c(!0),o(null);try{console.log("📊 분석 결과 상세 정보 요청:",I);const Y=I.map(async E=>{try{return{...(await ve.get(`/api/analysis/results/${E}`)).data,id:E}}catch(q){return console.error(`❌ 결과 ${E} 로딩 실패:`,q),{id:E,error:q.message||"로딩 실패",analysisDate:new Date().toISOString(),neId:"-",cellId:"-",status:"error"}}}),U=await Promise.all(Y);h(U),console.log("✅ 분석 결과 상세 정보 로딩 완료:",U)}catch(Y){console.error("❌ 분석 결과 상세 정보 로딩 실패:",Y),o(Y.message||"데이터 로딩에 실패했습니다"),se.error("분석 결과를 불러오는데 실패했습니다")}finally{c(!1)}};r.useEffect(()=>{s&&a.length>0&&A(a)},[s,a]);const m=I=>{switch(I==null?void 0:I.toLowerCase()){case"success":return"default";case"error":case"failed":return"destructive";case"warning":return"secondary";case"pending":case"processing":return"outline";default:return"secondary"}},j=I=>{try{return new Date(I).toLocaleString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",weekday:"short"})}catch{return I||"-"}},S=r.useMemo(()=>i.filter(I=>!I.error),[i]),G=r.useMemo(()=>{var Y,U;return y?(((U=(Y=S[0])==null?void 0:Y.kpiResults)==null?void 0:U.map(E=>E.name))||[]).map(E=>{const q={name:E};return S.forEach((_,H)=>{var B;const W=(B=_.kpiResults)==null?void 0:B.find(Z=>Z.name===E);q[`결과${H+1}`]=parseFloat((W==null?void 0:W.value)||0)}),q}):null},[S,y]),M=r.useMemo(()=>{var F;if(y||!S.length||!S[0].stats)return{kpiResults:[],sortedKpiResults:[],filteredResults:[],dataWithTrends:[],trendFilteredResults:[],totalPages:0,paginatedResults:[],data:[],summaryStats:{improved:0,declined:0,stable:0,avgChange:0,weightedAvgChange:0}};const I=S[0],Y=I.stats||[],U={};Y.forEach($=>{const ee=$.kpi_name;U[ee]||(U[ee]={peg_name:ee,weight:5}),$.period==="N-1"?U[ee]["N-1"]=$.avg:$.period==="N"&&(U[ee].N=$.avg)});const E=((F=I.request_params)==null?void 0:F.peg_definitions)||{};Object.keys(U).forEach($=>{var ee;(ee=E[$])!=null&&ee.weight&&(U[$].weight=E[$].weight)});const q=Object.values(U).filter($=>$["N-1"]!==void 0&&$.N!==void 0),_=[...q].sort(($,ee)=>(ee.weight||0)-($.weight||0)),H=_.filter($=>{const ee=!N||$.peg_name.toLowerCase().includes(N.toLowerCase()),ae=$.weight||0;let pe=!0;return C==="high"?pe=ae>=8:C==="medium"?pe=ae>=6&&ae<8:C==="low"&&(pe=ae<6),ee&&pe}),W=H.map($=>{const ee=$["N-1"]||0,pe=($.N||0)-ee,je=ee!==0?pe/ee*100:0,Fe=pe>0?"up":pe<0?"down":"stable";return{...$,change:pe,changePercent:je,trend:Fe}}),B=W.filter($=>w==="all"?!0:$.trend===w),Z=Math.ceil(B.length/D),be=B.slice(v*D,(v+1)*D),z=be.map($=>({name:$.peg_name,"N-1":$["N-1"]||0,N:$.N||0,change:$.change,changePercent:$.changePercent,trend:$.trend,weight:$.weight,unit:"%",peg:$.weight||0})),me=z.filter($=>$.trend==="up").length,ue=z.filter($=>$.trend==="down").length,ce=z.filter($=>$.trend==="stable").length,ke=z.length>0?z.reduce(($,ee)=>$+ee.change,0)/z.length:0,oe=z.length>0?z.reduce(($,ee)=>$+ee.change*ee.weight,0)/z.reduce(($,ee)=>$+ee.weight,0):0;return{kpiResults:q,sortedKpiResults:_,filteredResults:H,dataWithTrends:W,trendFilteredResults:B,totalPages:Z,paginatedResults:be,data:z,summaryStats:{improved:me,declined:ue,stable:ce,avgChange:ke,weightedAvgChange:oe}}},[y,S,N,C,w,v,D]),K=()=>{const{kpiResults:I,trendFilteredResults:Y,totalPages:U,data:E,summaryStats:q}=M;return y?e.jsx(Te,{width:"100%",height:400,children:e.jsxs(js,{data:G,children:[e.jsx(Ue,{strokeDasharray:"3 3"}),e.jsx(He,{dataKey:"name"}),e.jsx(Me,{}),e.jsx(Le,{}),e.jsx(Re,{}),S.map((_,H)=>e.jsx(Ie,{dataKey:`결과${H+1}`,fill:`hsl(${H*60}, 70%, 50%)`},`result${H+1}`))]})}):I.length?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:q.improved}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"개선 📈"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-red-600",children:q.declined}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"하락 📉"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-600",children:q.stable}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"안정 ➡️"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-lg font-bold ${q.avgChange>=0?"text-green-600":"text-red-600"}`,children:[q.avgChange>0?"+":"",q.avgChange.toFixed(2),"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"평균 변화"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-lg font-bold ${q.weightedAvgChange>=0?"text-green-600":"text-red-600"}`,children:[q.weightedAvgChange>0?"+":"",q.weightedAvgChange.toFixed(2),"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"가중 평균 변화"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"📊 PEG별 N-1/N 성능 비교 (가중치 높은 순)"}),e.jsxs(X,{variant:"outline",children:["전체 ",I.length,"개 중 ",Y.length,"개 표시"]})]}),e.jsxs("div",{className:`grid gap-3 transition-all duration-300 ${g?"grid-cols-1 md:grid-cols-6 lg:grid-cols-8":"grid-cols-1 md:grid-cols-5"}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(ps,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(ye,{placeholder:"PEG 이름 검색...",value:N,onChange:_=>{P(_.target.value),n(0)},className:"pl-8"})]}),e.jsxs(Ne,{value:C,onValueChange:_=>{f(_),n(0)},children:[e.jsxs(Se,{children:[e.jsx(zs,{className:"h-4 w-4 mr-2"}),e.jsx(we,{placeholder:"가중치 필터"})]}),e.jsxs(Ce,{children:[e.jsx(Q,{value:"all",children:"전체"}),e.jsx(Q,{value:"high",children:"높음 (≥8)"}),e.jsx(Q,{value:"medium",children:"중간 (6-7.9)"}),e.jsx(Q,{value:"low",children:"낮음 (<6)"})]})]}),e.jsxs(Ne,{value:w,onValueChange:_=>{R(_),n(0)},children:[e.jsx(Se,{children:e.jsx(we,{placeholder:"트렌드 필터"})}),e.jsxs(Ce,{children:[e.jsx(Q,{value:"all",children:"전체 트렌드"}),e.jsx(Q,{value:"up",children:"개선 📈"}),e.jsx(Q,{value:"down",children:"하락 📉"}),e.jsx(Q,{value:"stable",children:"안정 ➡️"})]})]}),e.jsxs(Ne,{value:D.toString(),onValueChange:_=>{p(parseInt(_)),n(0)},children:[e.jsx(Se,{children:e.jsx(we,{placeholder:"표시 개수"})}),e.jsxs(Ce,{children:[e.jsx(Q,{value:"5",children:"5개씩"}),e.jsx(Q,{value:"10",children:"10개씩"}),e.jsx(Q,{value:"20",children:"20개씩"}),e.jsx(Q,{value:"50",children:"50개씩"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(J,{variant:"outline",size:"sm",onClick:()=>n(Math.max(0,v-1)),disabled:v===0,children:e.jsx(gr,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:[v+1," / ",U||1]}),e.jsx(J,{variant:"outline",size:"sm",onClick:()=>n(Math.min(U-1,v+1)),disabled:v>=U-1,children:e.jsx(fr,{className:"h-4 w-4"})})]})]})]}),e.jsx(Te,{width:"100%",height:g?Math.min(window.innerHeight*.55,900):Math.min(window.innerHeight*.4,500),className:"transition-all duration-300",children:e.jsxs(js,{data:E,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(Ue,{strokeDasharray:"3 3"}),e.jsx(He,{dataKey:"name",angle:-45,textAnchor:"end",height:100,interval:0,fontSize:10}),e.jsx(Me,{}),e.jsx(Le,{formatter:(_,H,W)=>[`${_==null?void 0:_.toFixed(2)} ${W.payload.unit}`,H],labelFormatter:_=>{const H=E.find(W=>W.name===_);return`${_} (가중치: ${(H==null?void 0:H.weight)||0})`},content:({active:_,payload:H,label:W})=>{var z,me,ue,ce,ke;if(!_||!(H!=null&&H.length))return null;const B=(z=H[0])==null?void 0:z.payload;if(!B)return null;const Z=oe=>{switch(oe){case"up":return"📈";case"down":return"📉";default:return"➡️"}},be=oe=>{switch(oe){case"up":return"text-green-600";case"down":return"text-red-600";default:return"text-gray-600"}};return e.jsxs("div",{className:"bg-white border rounded-lg shadow-lg p-3 min-w-[200px]",children:[e.jsx("div",{className:"font-semibold mb-2",children:W}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-orange-600",children:"N-1 기간:"}),e.jsxs("span",{className:"font-medium",children:[(me=B["N-1"])==null?void 0:me.toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-600",children:"N 기간:"}),e.jsxs("span",{className:"font-medium",children:[(ue=B.N)==null?void 0:ue.toFixed(2),"%"]})]}),e.jsxs("div",{className:"border-t pt-1 mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"성능 변화:"}),e.jsxs("div",{className:`flex items-center gap-1 font-medium ${be(B.trend)}`,children:[e.jsx("span",{children:Z(B.trend)}),e.jsxs("span",{children:[B.change>0?"+":"",(ce=B.change)==null?void 0:ce.toFixed(2),"%"]}),e.jsxs("span",{className:"text-xs",children:["(",B.changePercent>0?"+":"",(ke=B.changePercent)==null?void 0:ke.toFixed(1),"%)"]})]})]}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{className:"text-gray-600",children:"가중치:"}),e.jsxs("span",{className:"font-medium",children:[B.weight,"/10"]})]})]})]})]})}}),e.jsx(Re,{}),e.jsx(Ie,{dataKey:"N-1",fill:"#ff7300",name:"N-1 기간"}),e.jsx(Ie,{dataKey:"N",fill:"#8884d8",name:"N 기간"})]})})]}):e.jsx("div",{className:"text-center text-muted-foreground",children:"PEG 비교 데이터가 없습니다."})},te=I=>{var B;const Y=(I==null?void 0:I[0])||{},U=((B=Y==null?void 0:Y.data)==null?void 0:B.data)||(Y==null?void 0:Y.data)||Y,E=(U==null?void 0:U.analysis)||{},q=E.executive_summary||E.overall_summary||E.comprehensive_summary||"요약 정보가 없습니다.",_=Array.isArray(E.diagnostic_findings)&&E.diagnostic_findings.length?E.diagnostic_findings:Array.isArray(E.key_findings)?E.key_findings.map(Z=>({primary_hypothesis:String(Z)})):[],W=(Array.isArray(E.recommended_actions)?E.recommended_actions:[]).map(Z=>Z&&typeof Z=="object"?Z:{priority:"",action:String(Z||""),details:""});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(le,{children:[e.jsx(ge,{children:e.jsx(fe,{children:"종합 분석 요약"})}),e.jsx(ie,{children:e.jsx("div",{className:"text-sm text-muted-foreground whitespace-pre-line",children:q})})]}),_.length>0&&e.jsxs(le,{children:[e.jsx(ge,{children:e.jsx(fe,{children:"핵심 관찰 사항"})}),e.jsx(ie,{children:e.jsx("div",{className:"space-y-3",children:_.map((Z,be)=>e.jsxs("div",{className:"space-y-1",children:[Z.primary_hypothesis&&e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"font-semibold",children:["가설 ",be+1,":"]})," ",Z.primary_hypothesis]}),Z.supporting_evidence&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["증거: ",Z.supporting_evidence]}),Z.confounding_factors_assessment&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["교란 변수 평가: ",Z.confounding_factors_assessment]})]},be))})})]}),W.length>0&&e.jsxs(le,{children:[e.jsx(ge,{children:e.jsx(fe,{children:"권장 조치"})}),e.jsx(ie,{children:e.jsx("div",{className:"space-y-3",children:W.map((Z,be)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5",children:e.jsx(Rs,{className:"h-5 w-5 text-green-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[Z.priority&&e.jsx(X,{variant:"outline",children:Z.priority}),e.jsx("div",{className:"text-sm font-medium",children:Z.action||"-"})]}),Z.details&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1 whitespace-pre-line",children:Z.details})]})]},be))})})]})]})},de=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:[S.length,"개 결과 비교"]}),e.jsx("div",{className:"flex gap-2",children:S.map((I,Y)=>e.jsxs(X,{variant:"outline",className:"gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`hsl(${Y*60}, 70%, 50%)`}}),"결과 ",Y+1]},I.id))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:S.map((I,Y)=>e.jsx(le,{className:"border-l-4",style:{borderLeftColor:`hsl(${Y*60}, 70%, 50%)`},children:e.jsx(ie,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium",children:["결과 ",Y+1]}),e.jsx(X,{variant:m(I.status),children:I.status})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:j(I.analysisDate)}),e.jsxs("div",{className:"text-sm",children:["NE: ",I.neId," | Cell: ",I.cellId]})]})})},I.id))})]}),L=()=>d?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ms,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"분석 결과를 불러오는 중..."})]})}):u?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ee,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"데이터 로딩 오류"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:u}),e.jsxs(J,{onClick:()=>A(a),variant:"outline",children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),"다시 시도"]})]})}):S.length===0?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ee,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"분석 결과를 찾을 수 없습니다."})]})}):e.jsxs(Ns,{value:b,onValueChange:O,className:"w-full",children:[e.jsxs(ws,{className:"grid w-full grid-cols-3",children:[e.jsx($e,{value:"overview",children:"개요"}),e.jsx($e,{value:"kpi",children:"PEG 비교 결과"}),e.jsx($e,{value:"recommendations",children:"LLM 분석 리포트"})]}),e.jsx(Ae,{value:"overview",className:"space-y-4 mt-6",children:y?de():renderSingleOverview(S[0])}),e.jsx(Ae,{value:"kpi",className:"space-y-4 mt-6",children:e.jsxs(le,{children:[e.jsx(ge,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-5 w-5"}),y?"PEG 성능 비교 차트":"PEG 비교 결과 (N-1 vs N)"]})}),e.jsx(ie,{children:K()})]})}),e.jsx(Ae,{value:"recommendations",className:"space-y-4 mt-6",children:te(S)})]});return e.jsx(wt,{open:s,onOpenChange:t,children:e.jsxs(St,{className:`transition-all duration-500 ease-in-out transform ${g?"max-w-[99vw] h-[98vh] w-[99vw] scale-100":"max-w-6xl max-h-[85vh] w-[90vw] scale-100"}`,children:[e.jsx(Ct,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(kt,{className:"flex items-center gap-2",children:[e.jsx(jt,{className:"h-5 w-5"}),y?"분석 결과 비교":"분석 결과 상세"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(J,{variant:"ghost",size:"sm",onClick:()=>x(!g),className:"transition-all duration-200 hover:scale-110 hover:bg-accent",title:g?"원래 크기로 (ESC)":"최대화 (F11)",children:g?e.jsx(ft,{className:"h-4 w-4"}):e.jsx(pt,{className:"h-4 w-4"})})})]})}),e.jsx(vs,{className:`transition-all duration-300 ${g?"h-[85vh]":"max-h-[70vh]"}`,children:e.jsx("div",{className:"px-1",children:L()})})]})})},Cn=Object.freeze(Object.defineProperty({__proto__:null,default:qt},Symbol.toStringTag,{value:"Module"})),Yt=()=>{const{results:s,loading:t,error:a,isEmpty:l,hasMore:i,isFiltered:h,resultCount:d,filters:c,updateFilters:u,clearFilters:o,refresh:b,loadMore:O,deleteResult:g}=wn({initialLimit:20,autoFetch:!0}),[x,v]=r.useState(!1),[n,D]=r.useState(new Set),[p,N]=r.useState({key:"analysisDate",direction:"desc"}),[P,C]=r.useState({isOpen:!1,resultIds:[],mode:"single"}),f=r.useCallback((L,I={})=>{console.log(`[ResultsList] ${L}`,I)},[]),w=r.useMemo(()=>s!=null&&s.length?[...s].sort((I,Y)=>{const U=I[p.key],E=Y[p.key];if(U==null)return 1;if(E==null)return-1;if(p.key==="analysisDate"){const q=new Date(U),_=new Date(E);return p.direction==="asc"?q-_:_-q}if(typeof U=="string"&&typeof E=="string"){const q=U.localeCompare(E);return p.direction==="asc"?q:-q}return typeof U=="number"&&typeof E=="number"?p.direction==="asc"?U-E:E-U:0}):[],[s,p]),R=r.useCallback(L=>{N(I=>{const Y=I.key===L&&I.direction==="asc"?"desc":"asc";return f("정렬 변경",{key:L,direction:Y}),{key:L,direction:Y}})},[f]),y=r.useCallback(L=>{D(I=>{const Y=new Set(I);return Y.has(L)?Y.delete(L):Y.add(L),Y})},[]),A=r.useCallback(()=>{n.size===w.length?D(new Set):D(new Set(w.map(L=>L.id)))},[n.size,w]),m=r.useCallback(async L=>{try{f("분석 결과 삭제 시작",{resultId:L}),await g(L),D(I=>{const Y=new Set(I);return Y.delete(L),Y})}catch(I){f("분석 결과 삭제 실패",{resultId:L,error:I})}},[g,f]),j=r.useCallback(async()=>{if(n.size!==0)try{f("벌크 삭제 시작",{count:n.size});const L=Array.from(n).map(I=>g(I));await Promise.all(L),D(new Set),se.success(`${n.size}개의 결과가 삭제되었습니다.`)}catch(L){f("벌크 삭제 실패",{error:L}),se.error("일부 결과 삭제에 실패했습니다.")}},[n,g,f]),S=r.useCallback(L=>{f("상세 보기 요청",{resultId:L}),C({isOpen:!0,resultIds:[L],mode:"single"})},[f]),G=r.useCallback(()=>{if(n.size<2){se.error("비교할 결과를 2개 이상 선택해주세요");return}if(n.size>5){se.error("최대 5개까지만 비교할 수 있습니다");return}const L=Array.from(n);f("비교 보기 요청",{resultIds:L,count:L.length}),C({isOpen:!0,resultIds:L,mode:"compare"})},[n,f]),M=r.useCallback(()=>{C({isOpen:!1,resultIds:[],mode:"single"})},[]),K=r.useCallback(()=>{if(!(w!=null&&w.length)){se.error("내보낼 데이터가 없습니다.");return}try{f("데이터 내보내기 시작",{count:w.length});const L=w.map(E=>{var q,_;return{"분석 날짜":new Date(E.analysisDate).toLocaleString("ko-KR"),"NE ID":E.neId,"Cell ID":E.cellId,상태:E.status,"결과 수":((q=E.results)==null?void 0:q.length)||0,"통계 수":((_=E.stats)==null?void 0:_.length)||0}}),I=[Object.keys(L[0]).join(","),...L.map(E=>Object.values(E).join(","))].join(`
`),Y=new Blob([I],{type:"text/csv;charset=utf-8;"}),U=document.createElement("a");U.href=URL.createObjectURL(Y),U.download=`analysis_results_${new Date().toISOString().split("T")[0]}.csv`,U.click(),se.success("데이터가 내보내기 되었습니다."),f("데이터 내보내기 완료")}catch(L){f("데이터 내보내기 실패",{error:L}),se.error("데이터 내보내기에 실패했습니다.")}},[w,f]),te=r.useCallback(L=>{switch(L==null?void 0:L.toLowerCase()){case"success":return"default";case"error":case"failed":return"destructive";case"warning":return"secondary";case"pending":case"processing":return"outline";default:return"secondary"}},[]),de=r.useCallback(L=>{try{return new Date(L).toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return L||"-"}},[]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"LLM 분석 결과"}),e.jsxs("p",{className:"text-muted-foreground",children:["총 ",d,"개의 분석 결과",h&&" (필터 적용됨)"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.size>0&&e.jsxs(e.Fragment,{children:[n.size>=2&&e.jsxs(J,{variant:"default",size:"sm",onClick:G,children:[e.jsx(BarChart3,{className:"h-4 w-4 mr-2"}),"비교하기 (",n.size,")"]}),e.jsxs(tt,{children:[e.jsx(at,{asChild:!0,children:e.jsxs(J,{variant:"destructive",size:"sm",children:[e.jsx(Os,{className:"h-4 w-4 mr-2"}),"선택 삭제 (",n.size,")"]})}),e.jsxs(rt,{children:[e.jsxs(nt,{children:[e.jsx(it,{children:"선택된 결과 삭제"}),e.jsxs(ct,{children:["선택된 ",n.size,"개의 분석 결과를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),e.jsxs(lt,{children:[e.jsx(dt,{children:"취소"}),e.jsx(ot,{onClick:j,children:"삭제"})]})]})]})]}),e.jsxs(J,{variant:"outline",size:"sm",onClick:K,disabled:!(w!=null&&w.length),children:[e.jsx(os,{className:"h-4 w-4 mr-2"}),"내보내기"]}),e.jsxs(J,{variant:"outline",size:"sm",onClick:()=>v(!x),children:[e.jsx(zs,{className:"h-4 w-4 mr-2"}),"필터",e.jsx(ss,{className:`h-4 w-4 ml-2 transition-transform ${x?"rotate-180":""}`})]}),e.jsxs(J,{variant:"outline",size:"sm",onClick:b,disabled:t,children:[e.jsx(Us,{className:`h-4 w-4 mr-2 ${t?"animate-spin":""}`}),"새로고침"]})]})]}),x&&e.jsx(Sn,{filters:c,onFilterChange:(L,I)=>u({[L]:I}),onClearFilters:o,isCollapsed:!1,onToggleCollapse:()=>v(!1),showActiveCount:!0}),e.jsx(le,{children:e.jsxs(ie,{className:"p-0",children:[a&&e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(Ee,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"데이터 로딩 오류"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:a}),e.jsxs(J,{onClick:b,variant:"outline",children:[e.jsx(Us,{className:"h-4 w-4 mr-2"}),"다시 시도"]})]}),t&&l&&e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(ms,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"분석 결과를 불러오는 중..."})]}),!t&&l&&!a&&e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(ps,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:h?"검색 결과가 없습니다":"분석 결과가 없습니다"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:h?"다른 조건으로 검색해보세요.":"아직 생성된 분석 결과가 없습니다."}),h&&e.jsxs(J,{onClick:o,variant:"outline",children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"필터 초기화"]})]}),!l&&!a&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(jn,{children:[e.jsx(vn,{children:e.jsxs(st,{children:[e.jsx(Be,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:n.size===w.length&&w.length>0,onChange:A,className:"rounded border-gray-300"})}),e.jsxs(Be,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>R("analysisDate"),children:["분석 날짜",p.key==="analysisDate"&&e.jsx("span",{className:"ml-2",children:p.direction==="asc"?"↑":"↓"})]}),e.jsxs(Be,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>R("neId"),children:["NE ID",p.key==="neId"&&e.jsx("span",{className:"ml-2",children:p.direction==="asc"?"↑":"↓"})]}),e.jsxs(Be,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>R("cellId"),children:["Cell ID",p.key==="cellId"&&e.jsx("span",{className:"ml-2",children:p.direction==="asc"?"↑":"↓"})]}),e.jsx(Be,{children:"상태"}),e.jsx(Be,{className:"text-center",children:"결과 수"}),e.jsx(Be,{className:"text-center",children:"통계 수"}),e.jsx(Be,{className:"w-20",children:"작업"})]})}),e.jsx(bn,{children:w.map(L=>{var I,Y;return e.jsxs(st,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>S(L.id),children:[e.jsx(Ke,{onClick:U=>U.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:n.has(L.id),onChange:()=>y(L.id),className:"rounded border-gray-300"})}),e.jsx(Ke,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"h-4 w-4 text-muted-foreground"}),de(L.analysisDate)]})}),e.jsx(Ke,{className:"font-medium",children:L.neId||"-"}),e.jsx(Ke,{className:"font-medium",children:L.cellId||"-"}),e.jsx(Ke,{children:e.jsx(X,{variant:te(L.status),children:L.status||"unknown"})}),e.jsx(Ke,{className:"text-center",children:((I=L.results)==null?void 0:I.length)||0}),e.jsx(Ke,{className:"text-center",children:((Y=L.stats)==null?void 0:Y.length)||0}),e.jsx(Ke,{onClick:U=>U.stopPropagation(),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{variant:"ghost",size:"sm",onClick:()=>S(L.id),title:"상세 보기",children:e.jsx(ps,{className:"h-4 w-4"})}),e.jsxs(tt,{children:[e.jsx(at,{asChild:!0,children:e.jsx(J,{variant:"ghost",size:"sm",title:"삭제",children:e.jsx(Os,{className:"h-4 w-4 text-destructive"})})}),e.jsxs(rt,{children:[e.jsxs(nt,{children:[e.jsx(it,{children:"분석 결과 삭제"}),e.jsx(ct,{children:"이 분석 결과를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."})]}),e.jsxs(lt,{children:[e.jsx(dt,{children:"취소"}),e.jsx(ot,{onClick:()=>m(L.id),children:"삭제"})]})]})]})]})})]},L.id)})})]})}),i&&!t&&!a&&e.jsx("div",{className:"p-6 text-center border-t",children:e.jsxs(J,{variant:"outline",onClick:O,disabled:t,children:[t?e.jsx(ms,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(ss,{className:"h-4 w-4 mr-2"}),"더 보기"]})})]})}),e.jsx(qt,{isOpen:P.isOpen,onClose:M,resultIds:P.resultIds,mode:P.mode})]})},Jt=Object.freeze(Object.defineProperty({__proto__:null,default:Yt},Symbol.toStringTag,{value:"Module"})),Zt=()=>{var n;const{settings:s}=Ye(),t=(s==null?void 0:s.databaseSettings)||{host:"",port:5432,user:"postgres",password:"",dbname:"postgres",table:"summary"},[a,l]=r.useState({n_minus_1:"",n:"",table:"summary",ne:"",cellid:"",preference:"",columns:{time:"datetime",peg_name:"peg_name",value:"value",ne:"ne",cellid:"cellid"}}),[i,h]=r.useState(null),[d,c]=r.useState(!1),[u,o]=r.useState(null),[b,O]=r.useState([]),g=async()=>{if(!a.n_minus_1||!a.n){se.error("분석 기간(N-1, N)을 모두 입력해주세요.");return}if((i==null?void 0:i.type)!=="success"){se.error("먼저 Database 연결을 확인해주세요.");return}c(!0);try{console.log("🚀 LLM 분석 시작:",{dbConfig:t,analysisParams:a});const D=await Mr(t,a,"default");console.log("✅ LLM 분석 트리거 성공:",D),o({id:D.analysis_id,status:"processing",message:D.message,startTime:new Date}),se.success("LLM 분석이 시작되었습니다. 잠시 후 결과를 확인할 수 있습니다."),x(D.analysis_id)}catch(D){console.error("❌ LLM 분석 요청 실패:",D),se.error(`분석 요청 실패: ${D.message}`),c(!1)}},x=D=>{const p=setInterval(async()=>{try{const N=await zr(D);console.log("📊 폴링 결과:",N),(N.status==="completed"||N.status==="error")&&(clearInterval(p),c(!1),o(P=>({...P,status:N.status,result:N,endTime:new Date})),O(P=>[{id:D,status:N.status,startTime:new Date,params:a,result:N},...P]),N.status==="completed"?se.success("LLM 분석이 완료되었습니다!"):se.error("LLM 분석 중 오류가 발생했습니다."))}catch(N){console.error("폴링 오류:",N),clearInterval(p),c(!1)}},5e3);setTimeout(()=>{clearInterval(p),d&&(c(!1),se.error("분석 시간이 초과되었습니다. 관리자에게 문의하세요."))},6e5)},v=(D,p)=>{l(N=>({...N,[D]:p}))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(le,{children:[e.jsx(ge,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(gt,{className:"h-5 w-5"}),"LLM 분석 관리자"]})}),e.jsx(ie,{children:e.jsx("p",{className:"text-muted-foreground",children:"PostgreSQL Database에서 데이터를 조회하여 LLM 기반 성능 분석을 수행합니다."})})]}),e.jsxs(le,{children:[e.jsx(ge,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-5 w-5"}),"Database 설정"]})}),e.jsxs(ie,{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Database 설정은 이제 ",e.jsx("strong",{children:"환경설정 > Database"})," 탭에서 통합 관리됩니다. 이 화면에서는 Preference에 저장된 설정을 사용합니다."]}),e.jsxs("div",{className:"mt-3 text-sm",children:[e.jsxs("div",{children:["Host: ",e.jsx("span",{className:"font-mono",children:t.host||"-"})]}),e.jsxs("div",{children:["Port: ",e.jsx("span",{className:"font-mono",children:t.port||"-"})]}),e.jsxs("div",{children:["User: ",e.jsx("span",{className:"font-mono",children:t.user||"-"})]}),e.jsxs("div",{children:["DB: ",e.jsx("span",{className:"font-mono",children:t.dbname||"-"})]}),e.jsxs("div",{children:["Table: ",e.jsx("span",{className:"font-mono",children:t.table||"-"})]})]})]})]}),e.jsxs(le,{children:[e.jsx(ge,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-5 w-5"}),"분석 파라미터"]})}),e.jsxs(ie,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(V,{htmlFor:"n_minus_1",children:"N-1 기간"}),e.jsx(ye,{id:"n_minus_1",value:a.n_minus_1,onChange:D=>v("n_minus_1",D.target.value),placeholder:"YYYY-MM-DD_HH:mm~YYYY-MM-DD_HH:mm"})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"n",children:"N 기간"}),e.jsx(ye,{id:"n",value:a.n,onChange:D=>v("n",D.target.value),placeholder:"YYYY-MM-DD_HH:mm~YYYY-MM-DD_HH:mm"})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"table",children:"테이블명"}),e.jsx(ye,{id:"table",value:a.table,onChange:D=>v("table",D.target.value),placeholder:"summary"})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(J,{onClick:g,disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(ms,{className:"h-4 w-4 animate-spin mr-2"})," 분석 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ms,{className:"h-4 w-4 mr-2"})," 분석 시작"]})})})]})]}),u&&e.jsxs(le,{children:[e.jsx(ge,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5"}),"현재 분석 상태"]})}),e.jsxs(ie,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["분석 ID: ",u.id]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:u.message})]}),e.jsx(X,{variant:u.status==="processing"?"default":u.status==="completed"?"success":"destructive",children:u.status==="processing"?"처리 중":u.status==="completed"?"완료":"오류"})]}),u.result&&u.status==="completed"&&e.jsxs("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"font-medium mb-2",children:"분석 결과"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[u.result.report_path&&e.jsxs("p",{children:["📄 리포트: ",u.result.report_path]}),((n=u.result.results)==null?void 0:n.analysis)&&e.jsx("p",{children:"🧠 LLM 분석: 완료"})]})]})]})]}),b.length>0&&e.jsxs(le,{children:[e.jsx(ge,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(pr,{className:"h-5 w-5"}),"분석 히스토리"]})}),e.jsx(ie,{children:e.jsx("div",{className:"space-y-3",children:b.map((D,p)=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("p",{className:"font-medium text-sm",children:["분석 #",p+1]}),e.jsx(X,{variant:D.status==="completed"?"success":"destructive",children:D.status==="completed"?"완료":"오류"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["기간: ",D.params.n_minus_1," vs ",D.params.n]}),e.jsxs("p",{children:["시간: ",D.startTime.toLocaleString()]}),e.jsxs("p",{children:["ID: ",D.id]})]})]},D.id))})})]})]})},Qt=Object.freeze(Object.defineProperty({__proto__:null,default:Zt},Symbol.toStringTag,{value:"Module"}));class kn extends ra.Component{constructor(a){super(a);Ss(this,"handleRetry",()=>{console.log("🔄 앱 재시도 중..."),this.setState(a=>({hasError:!1,error:null,errorInfo:null,retryCount:a.retryCount+1}))});Ss(this,"handleReload",()=>{console.log("🔄 페이지 새로고침 중..."),window.location.reload()});this.state={hasError:!1,error:null,errorInfo:null,retryCount:0}}static getDerivedStateFromError(a){return{hasError:!0}}componentDidCatch(a,l){var d,c,u,o;console.error("🚨 ErrorBoundary에서 에러 발생:",a),console.error("🚨 에러 메시지:",a.message),console.error("🚨 에러 스택:",a.stack),console.error("🚨 에러 정보:",l),console.error("🚨 컴포넌트 스택:",l.componentStack),console.error("🚨🚨🚨 === ERROR SUMMARY === 🚨🚨🚨"),console.error(`📝 Error Type: ${a.name}`),console.error(`📝 Error Message: ${a.message}`),console.error(`📝 First Stack Line: ${((c=(d=a.stack)==null?void 0:d.split(`
`))==null?void 0:c[1])||"N/A"}`),console.error("🚨🚨🚨 =================== 🚨🚨🚨"),console.error("🚨 에러 객체 전체:",{name:a.name,message:a.message,stack:a.stack,cause:a.cause,fileName:a.fileName,lineNumber:a.lineNumber,columnNumber:a.columnNumber}),console.error("🚨 에러 객체 모든 속성:");for(const b in a)try{console.error(`  ${b}:`,a[b])}catch{console.error(`  ${b}: [접근 불가]`)}console.error("🚨 에러 객체 프로토타입 체인:");let i=a,h=0;for(;i&&h<5;)console.error(`  Level ${h}:`,((o=(u=Object.getPrototypeOf(i))==null?void 0:u.constructor)==null?void 0:o.name)||"Unknown"),i=Object.getPrototypeOf(i),h++;a.name==="ReferenceError"&&(console.error("🔍 ReferenceError 상세 분석:"),console.error("  - 변수/함수가 정의되지 않았거나 접근할 수 없음"),console.error("  - 모듈 import 순서 문제 가능성"),console.error("  - 호이스팅 문제 가능성")),a.name==="TypeError"&&(console.error("🔍 TypeError 상세 분석:"),console.error("  - 객체가 null/undefined인데 속성에 접근 시도"),console.error("  - 함수가 아닌 것을 함수로 호출"),console.error("  - 잘못된 타입의 값 사용")),a.message.includes("Cannot access")&&(console.error("🔍 순환참조 또는 초기화 순서 문제로 추정됩니다."),console.error("🔍 해결 방안: 모듈 import 순서 확인, 지연 초기화 적용")),a.message.includes("before initialization")&&(console.error("🔍 변수/함수 초기화 순서 문제로 추정됩니다."),console.error("🔍 해결 방안: 함수 선언을 상단으로 이동, 호이스팅 확인")),a.message.includes("is not a function")&&(console.error("🔍 함수 호출 문제로 추정됩니다."),console.error("🔍 해결 방안: 함수 존재 여부 확인, import 확인")),console.error("🔍 현재 URL:",window.location.href),console.error("🔍 User Agent:",navigator.userAgent),console.error("🔍 현재 시간:",new Date().toISOString()),typeof window<"u"&&console.error("🔍 window 객체 상태:",{hasReact:!!window.React,hasReactDOM:!!window.ReactDOM,hasPreferenceContext:!!window.__PREFERENCE_CONTEXT_DEBUG__,runtimeConfig:window.__RUNTIME_CONFIG__}),this.setState({error:a,errorInfo:l})}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsx("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",children:e.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"앱 초기화 중 문제가 발생했습니다"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"순환참조나 초기화 오류로 인해 앱을 로드할 수 없습니다. 아래 버튼을 클릭하여 다시 시도해주세요."}),!1,e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:this.handleRetry,className:"w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:["다시 시도 (",this.state.retryCount+1,"번째)"]}),e.jsx("button",{onClick:this.handleReload,className:"w-full bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition-colors",children:"페이지 새로고침"})]}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:[e.jsx("p",{children:"문제가 지속되면 브라우저 캐시를 정리해보세요."}),e.jsx("p",{children:"Chrome: Ctrl+Shift+R (Windows) / Cmd+Shift+R (Mac)"})]})]})})}):this.props.children}}const De=(s,t,a=null)=>{const i=`[App:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${i} ${t}`,a);break;case"error":console.error(`${i} ${t}`,a);break;case"warn":console.warn(`${i} ${t}`,a);break;case"debug":console.debug(`${i} ${t}`,a);break;default:console.log(`${i} ${t}`,a)}},as={DASHBOARD:"dashboard",STATISTICS:"statistics",PREFERENCE:"preference",RESULTS:"results",LLM_ANALYSIS:"llm-analysis"};function Dn(){De("info","App 컴포넌트 초기화");const[s,t]=r.useState(as.DASHBOARD),[a,l]=r.useState(!1);if(r.useEffect(()=>{De("debug","App 초기화 시작");const c=setTimeout(()=>{var u,o;try{if(De("info","App 초기화 완료"),typeof window<"u"){const b={hasReact:!!window.React,hasReactDOM:!!window.ReactDOM,hasStrictMode:!!((u=window.React)!=null&&u.StrictMode),hasCreateRoot:!!((o=window.ReactDOM)!=null&&o.createRoot),hasPreferenceContext:!!window.hasPreferenceContext};De("debug","React 상태 확인",b),(!b.hasReact||!b.hasReactDOM)&&De("warn","React 상태가 비정상입니다",b)}l(!0),De("info","App 준비 상태 설정 완료")}catch(b){De("error","App 초기화 중 오류 발생",b),l(!0)}},500);return()=>{De("debug","App 초기화 타이머 정리"),clearTimeout(c)}},[]),!a)return De("debug","로딩 화면 렌더링"),e.jsxs("div",{className:"flex items-center justify-center min-h-screen",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"앱 초기화 중..."})]});const i=()=>{De("debug","콘텐츠 렌더링",{activeMenu:s});try{switch(s){case as.DASHBOARD:return De("debug","Dashboard 컴포넌트 렌더링"),e.jsx(At,{});case as.STATISTICS:return De("debug","Statistics 컴포넌트 렌더링"),e.jsx(zt,{});case as.PREFERENCE:return De("debug","PreferenceManager 컴포넌트 렌더링"),e.jsx(Ht,{});case as.RESULTS:return De("debug","ResultsList 컴포넌트 렌더링"),e.jsx(Yt,{});case as.LLM_ANALYSIS:return De("debug","LLMAnalysisManager 컴포넌트 렌더링"),e.jsx(Zt,{});default:return De("warn","알 수 없는 메뉴 선택",{activeMenu:s}),h()}}catch(c){return De("error","콘텐츠 렌더링 중 오류 발생",{activeMenu:s,error:c}),d(c)}},h=()=>(De("info","기본 콘텐츠 렌더링"),e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"🎉 KPI Dashboard - 리팩토링 완료!"}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"✅ 모든 컴포넌트가 안전하게 리팩토링되었습니다"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["현재 선택된 메뉴: ",e.jsx("strong",{children:s})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:e.jsxs("p",{className:"text-green-800",children:[e.jsx("strong",{children:"안정성 테스트 완료!"})," 모든 컴포넌트가 정상적으로 작동하고 있습니다."]})}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-md",children:e.jsx("p",{className:"text-blue-800 text-sm",children:"리팩토링이 완료되어 코드가 더 안전하고 유지보수하기 쉬워졌습니다! 🚀"})}),e.jsx("div",{className:"mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsxs("p",{className:"text-yellow-800 text-sm",children:[e.jsx("strong",{children:"리팩토링 내용:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2",children:[e.jsx("li",{children:"모든 파일에 상세한 주석과 로깅 추가"}),e.jsx("li",{children:"에러 처리 강화"}),e.jsx("li",{children:"코드 모듈화 및 분리"}),e.jsx("li",{children:"타입 안전성 개선"}),e.jsx("li",{children:"성능 최적화"})]})]})})]})]})})),d=c=>(De("error","오류 콘텐츠 렌더링",{error:c}),e.jsx("div",{className:"min-h-screen bg-red-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-red-900 mb-8",children:"⚠️ 오류가 발생했습니다"}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-800 mb-4",children:"콘텐츠 렌더링 중 오류가 발생했습니다"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["메뉴: ",e.jsx("strong",{children:s})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[e.jsx("p",{className:"text-red-800",children:e.jsx("strong",{children:"오류 정보:"})}),e.jsx("pre",{className:"mt-2 text-sm text-red-700 bg-red-100 p-2 rounded",children:(c==null?void 0:c.message)||"알 수 없는 오류"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded",children:"페이지 새로고침"})})]})]})}));return De("debug","App 메인 렌더링",{activeMenu:s,isReady:a}),e.jsx(kn,{children:e.jsx(Jr,{children:e.jsx(Ar,{activeMenu:s,setActiveMenu:t,children:i()})})})}const _n=({...s})=>{const{theme:t="system"}=na();return e.jsx(la,{theme:t,className:"toaster group",style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...s})};if(typeof window<"u")try{window.React={StrictMode:r.StrictMode},window.ReactDOM={createRoot:ht.createRoot},window.hasReact=!0,window.hasReactDOM=!0,console.log("🔧 React 전역 등록 완료")}catch(s){console.error("❌ React 전역 등록 실패:",s)}const En=async()=>{try{console.log("🔍 Web Vitals 측정 시작..."),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",async()=>{await mt()}):await mt(),setTimeout(async()=>{try{const{generatePerformanceReport:s}=await _e(async()=>{const{generatePerformanceReport:t}=await import("./webVitals-R2ejtCUT.js");return{generatePerformanceReport:t}},__vite__mapDeps([0,1,2,3,4,5]));s()}catch(s){console.warn("⚠️ 성능 리포트 생성 실패:",s)}},5e3)}catch(s){console.warn("⚠️ Web Vitals 초기화 실패:",s)}},mt=async()=>{try{const{measureWebVitals:s}=await _e(async()=>{const{measureWebVitals:t}=await import("./webVitals-R2ejtCUT.js");return{measureWebVitals:t}},__vite__mapDeps([0,1,2,3,4,5]));await s()}catch(s){console.warn("⚠️ Web Vitals 측정 실패:",s)}};typeof window<"u"&&setTimeout(En,100);const ut=()=>{try{console.log("🔄 React 앱 렌더링 시작");const s=document.getElementById("root");if(!s){console.error("❌ root 엘리먼트를 찾을 수 없습니다");return}console.log("✅ root 엘리먼트 발견:",s);const t=ht.createRoot(s);console.log("✅ React Root 생성 완료"),t.render(e.jsxs(e.Fragment,{children:[e.jsx(Dn,{}),e.jsx(_n,{position:"top-right",richColors:!0})]})),console.log("✅ React 앱 렌더링 완료")}catch(s){console.error("❌ React 앱 렌더링 실패:",s);const t=document.getElementById("root");t&&(t.innerHTML=`
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-family: Arial, sans-serif;">
          <div style="text-align: center; padding: 20px;">
            <h2>앱 초기화 중 문제가 발생했습니다</h2>
            <p>페이지를 새로고침해주세요.</p>
            <button onclick="window.location.reload()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
              새로고침
            </button>
          </div>
        </div>
      `)}},Xt=()=>{try{console.log("✅ 앱 초기화 시작"),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{setTimeout(ut,100)}):setTimeout(ut,100)}catch(s){console.error("❌ startApp 실행 중 오류:",s),setTimeout(Xt,500)}};Xt();export{_e as _};

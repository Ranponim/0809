import{r as c,j as e,av as se,ay as ae,az as te,X as re,at as le,_ as K,a6 as ne,C as ce,aA as ie,ar as de,aC as I,aa as me}from"./react-vendor-BbkKAD8O.js";import{D as oe,t as xe,v as he,w as je,e as u,a as ue,C as m,b as g,c as N,d as o,B as f}from"./index-CvEd_8oR.js";import{S as ge,T as Ne,a as fe,b as p,c as v}from"./scroll-area-E1Oa0Jgs.js";import{a4 as pe}from"./vendor-B4aOkbPy.js";import{R as $,B,C as E,X as L,Y as P,T as F,L as ve,c as z,f as ye}from"./chart-vendor-DLa56ojw.js";import"./ui-vendor-BA32w1ww.js";import"./utils-vendor-DgsWbSrd.js";const Se=({isOpen:h,onClose:y,resultIds:i=[],mode:w="single"})=>{const[C,_]=c.useState([]),[H,b]=c.useState(!1),[D,k]=c.useState(null),[X,O]=c.useState("overview"),[x,V]=c.useState(!1),d=w==="compare"&&i.length>1;w==="single"&&i.length;const R=async s=>{b(!0),k(null);try{console.log("📊 분석 결과 상세 정보 요청:",s);const a=s.map(async t=>{try{return{...(await ue.get(`/api/analysis/results/${t}`)).data,id:t}}catch(l){return console.error(`❌ 결과 ${t} 로딩 실패:`,l),{id:t,error:l.message||"로딩 실패",analysisDate:new Date().toISOString(),neId:"-",cellId:"-",status:"error"}}}),r=await Promise.all(a);_(r),console.log("✅ 분석 결과 상세 정보 로딩 완료:",r)}catch(a){console.error("❌ 분석 결과 상세 정보 로딩 실패:",a),k(a.message||"데이터 로딩에 실패했습니다"),pe.error("분석 결과를 불러오는데 실패했습니다")}finally{b(!1)}};c.useEffect(()=>{h&&i.length>0&&R(i)},[h,i]);const M=s=>{switch(s==null?void 0:s.toLowerCase()){case"success":return"default";case"error":case"failed":return"destructive";case"warning":return"secondary";case"pending":case"processing":return"outline";default:return"secondary"}},S=s=>{try{return new Date(s).toLocaleString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",weekday:"short"})}catch{return s||"-"}},T=s=>{const a=["availability","rrc","erab","sar","mobility_intra","cqi"];return{...s,summary:{totalKpis:a.length,successfulAnalysis:Math.floor(Math.random()*a.length)+1,averageScore:(Math.random()*40+60).toFixed(1),recommendations:Math.floor(Math.random()*5)+1},kpiResults:a.map(r=>({name:r,value:(Math.random()*40+60).toFixed(2),trend:Math.random()>.5?"up":"down",change:(Math.random()*10-5).toFixed(1),status:Math.random()>.8?"warning":"good"})),timeline:Array.from({length:24},(r,t)=>({hour:t,value:Math.random()*100,timestamp:new Date(Date.now()-(23-t)*60*60*1e3).toISOString()})),recommendations:["네트워크 성능 최적화를 위해 특정 셀의 설정 조정을 권장합니다.","RRC 연결 성공률 개선을 위한 안테나 각도 조정이 필요합니다.","ERAB 성공률 향상을 위해 백홀 용량 증설을 고려해보세요."]}},n=c.useMemo(()=>C.map(s=>s.error?T(s):s.kpiResults?s:T(s)),[C]),Y=c.useMemo(()=>{var a,r;return d?(((r=(a=n[0])==null?void 0:a.kpiResults)==null?void 0:r.map(t=>t.name))||[]).map(t=>{const l={name:t};return n.forEach((W,Z)=>{var A;const j=(A=W.kpiResults)==null?void 0:A.find(ee=>ee.name===t);l[`결과${Z+1}`]=parseFloat((j==null?void 0:j.value)||0)}),l}):null},[n,d]),q=s=>{var a,r,t,l;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{children:[e.jsx(g,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),"분석 정보"]})}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"분석 일시"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:S(s.analysisDate)})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"NE ID"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:s.neId||"-"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cell ID"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:s.cellId||"-"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"상태"}),e.jsx(f,{variant:M(s.status),children:s.status||"unknown"})]})]})})]}),e.jsxs(m,{children:[e.jsx(g,{children:e.jsx(N,{children:"분석 요약"})}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((a=s.summary)==null?void 0:a.totalKpis)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"총 KPI 수"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:((r=s.summary)==null?void 0:r.successfulAnalysis)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"성공 분석"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[((t=s.summary)==null?void 0:t.averageScore)||0,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"평균 점수"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:((l=s.summary)==null?void 0:l.recommendations)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"권장사항"})]})]})})]})]})},G=s=>{if(d)return e.jsx($,{width:"100%",height:400,children:e.jsxs(B,{data:Y,children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(L,{dataKey:"name"}),e.jsx(P,{}),e.jsx(F,{}),e.jsx(ve,{}),n.map((t,l)=>e.jsx(z,{dataKey:`결과${l+1}`,fill:`hsl(${l*60}, 70%, 50%)`},`result${l+1}`))]})});const r=s[0].kpiResults||[];return e.jsx($,{width:"100%",height:400,children:e.jsxs(B,{data:r,children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(L,{dataKey:"name"}),e.jsx(P,{}),e.jsx(F,{}),e.jsx(z,{dataKey:"value",fill:"#8884d8",children:r.map((t,l)=>e.jsx(ye,{fill:t.status==="warning"?"#f59e0b":"#8884d8"},`cell-${l}`))})]})})},J=s=>{const a=s.flatMap(r=>r.recommendations||[]);return e.jsx("div",{className:"space-y-4",children:a.map((r,t)=>e.jsx(m,{children:e.jsx(o,{className:"pt-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1",children:e.jsx(me,{className:"h-5 w-5 text-green-500"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm",children:r})})]})})},t))})},Q=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:[n.length,"개 결과 비교"]}),e.jsx("div",{className:"flex gap-2",children:n.map((s,a)=>e.jsxs(f,{variant:"outline",className:"gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`hsl(${a*60}, 70%, 50%)`}}),"결과 ",a+1]},s.id))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.map((s,a)=>e.jsx(m,{className:"border-l-4",style:{borderLeftColor:`hsl(${a*60}, 70%, 50%)`},children:e.jsx(o,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium",children:["결과 ",a+1]}),e.jsx(f,{variant:M(s.status),children:s.status})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:S(s.analysisDate)}),e.jsxs("div",{className:"text-sm",children:["NE: ",s.neId," | Cell: ",s.cellId]})]})})},s.id))})]}),U=()=>H?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(le,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"분석 결과를 불러오는 중..."})]})}):D?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"데이터 로딩 오류"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:D}),e.jsxs(u,{onClick:()=>R(i),variant:"outline",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"다시 시도"]})]})}):n.length===0?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"분석 결과를 찾을 수 없습니다."})]})}):e.jsxs(Ne,{value:X,onValueChange:O,className:"w-full",children:[e.jsxs(fe,{className:"grid w-full grid-cols-3",children:[e.jsx(p,{value:"overview",children:"개요"}),e.jsx(p,{value:"kpi",children:"KPI 결과"}),e.jsx(p,{value:"recommendations",children:"권장사항"})]}),e.jsx(v,{value:"overview",className:"space-y-4 mt-6",children:d?Q():q(n[0])}),e.jsx(v,{value:"kpi",className:"space-y-4 mt-6",children:e.jsxs(m,{children:[e.jsx(g,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5"}),d?"KPI 비교 차트":"KPI 분석 결과"]})}),e.jsx(o,{children:G(n)})]})}),e.jsx(v,{value:"recommendations",className:"space-y-4 mt-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"AI 권장사항"}),J(n)]})})]});return e.jsx(oe,{open:h,onOpenChange:y,children:e.jsxs(xe,{className:`max-w-4xl ${x?"max-w-none h-[90vh] w-[90vw]":"max-h-[80vh]"}`,children:[e.jsx(he,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5"}),d?"분석 결과 비교":"분석 결과 상세"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>V(!x),children:x?e.jsx(ae,{className:"h-4 w-4"}):e.jsx(te,{className:"h-4 w-4"})}),e.jsx(u,{variant:"ghost",size:"sm",onClick:y,children:e.jsx(re,{className:"h-4 w-4"})})]})]})}),e.jsx(ge,{className:x?"h-full":"max-h-[60vh]",children:e.jsx("div",{className:"px-1",children:U()})})]})})};export{Se as default};

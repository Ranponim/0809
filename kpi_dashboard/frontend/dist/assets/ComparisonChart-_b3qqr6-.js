import{r as m,M as e}from"./vendor-CPBPwzYD.js";import{C as F,d as P,b as ae,c as te,B as k,e as se,h as I,i as T,j as $,k as B,l as G}from"./index-BifUC4c9.js";import{C as y,G as re,H as ne,I as L,T as le,J as ie}from"./icon-vendor-DwJrfwQP.js";import{R as x,B as de,C as b,X as N,Y as g,T as h,L as p,c as j,f as K,g as oe,b as f,h as ce,P as me,i as xe,j as he,k as O,l as pe,m as je,A as ge,d as _,a as fe}from"./chart-vendor-BCXW5yoB.js";import"./ui-vendor-nq4IHmv4.js";import"./utils-vendor-DrCDvq1f.js";const Ke=({comparisonResults:d,title:E="비교 분석 차트",className:w="",showControls:S=!0,defaultChartType:W="bar",height:o=400})=>{const[C,V]=m.useState(W),[ue,ve]=m.useState(!0),[l,H]=m.useState(!1),[i,X]=m.useState("mean"),Y=[{value:"bar",label:"막대 차트",icon:y},{value:"line",label:"라인 차트",icon:L},{value:"area",label:"영역 차트",icon:le},{value:"pie",label:"파이 차트",icon:ie},{value:"radar",label:"레이더 차트",icon:L},{value:"composed",label:"복합 차트",icon:y}],J=[{value:"mean",label:"평균값",description:"두 기간의 평균 비교"},{value:"delta",label:"Delta",description:"절대값 변화량"},{value:"delta_percentage",label:"Delta %",description:"상대적 변화율"}],t=m.useMemo(()=>d!=null&&d.analysis_results?(console.log("📊 차트 데이터 생성 중:",d.analysis_results),d.analysis_results.map((a,s)=>{var M,z;const n=parseFloat((M=a.period1_stats)==null?void 0:M.mean)||0,r=parseFloat((z=a.period2_stats)==null?void 0:z.mean)||0,c=parseFloat(a.delta)||0,v=parseFloat(a.delta_percentage)||0;return{name:a.peg_name,peg_name:a.peg_name,period1:n,period2:r,delta:c,delta_percentage:v,improvement_status:a.improvement_status,improvement_magnitude:a.improvement_magnitude,rsd_period1:parseFloat(a.rsd_period1)||0,rsd_period2:parseFloat(a.rsd_period2)||0,color:a.improvement_status==="improved"?"#22c55e":a.improvement_status==="degraded"?"#ef4444":"#3b82f6",abs_delta:Math.abs(c),abs_delta_percentage:Math.abs(v)}})):[],[d]),A=m.useMemo(()=>{if(!t.length)return[];const a=t.filter(r=>r.improvement_status==="improved").length,s=t.filter(r=>r.improvement_status==="degraded").length,n=t.filter(r=>r.improvement_status==="stable").length;return[{name:"개선",value:a,color:"#22c55e"},{name:"악화",value:s,color:"#ef4444"},{name:"안정",value:n,color:"#3b82f6"}].filter(r=>r.value>0)},[t]),u=({active:a,payload:s,label:n})=>{if(a&&s&&s.length){const r=s[0].payload;return e.jsxs("div",{className:"bg-white p-3 border rounded-lg shadow-lg",children:[e.jsx("h4",{className:"font-semibold text-sm",children:n}),e.jsxs("div",{className:"space-y-1 mt-2",children:[s.map((c,v)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:c.color}}),e.jsxs("span",{children:[c.name,": ",c.value]})]},v)),r.improvement_status&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-2 pt-2 border-t",children:["상태: ",r.improvement_status==="improved"?"개선":r.improvement_status==="degraded"?"악화":"안정",r.improvement_magnitude&&` (${r.improvement_magnitude})`]})]})]})}return null},D=()=>e.jsx(x,{width:"100%",height:l?"80vh":o,children:e.jsxs(de,{data:t,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(g,{fontSize:12}),e.jsx(h,{content:e.jsx(u,{})}),e.jsx(p,{}),i==="mean"&&e.jsxs(e.Fragment,{children:[e.jsx(j,{dataKey:"period1",fill:"#8884d8",name:"기간 1"}),e.jsx(j,{dataKey:"period2",fill:"#82ca9d",name:"기간 2"})]}),i==="delta"&&e.jsx(j,{dataKey:"delta",name:"Delta",children:t.map((a,s)=>e.jsx(K,{fill:a.color},`cell-${s}`))}),i==="delta_percentage"&&e.jsx(j,{dataKey:"delta_percentage",name:"Delta %",children:t.map((a,s)=>e.jsx(K,{fill:a.color},`cell-${s}`))})]})}),U=()=>e.jsx(x,{width:"100%",height:l?"80vh":o,children:e.jsxs(fe,{data:t,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(g,{fontSize:12}),e.jsx(h,{content:e.jsx(u,{})}),e.jsx(p,{}),i==="mean"&&e.jsxs(e.Fragment,{children:[e.jsx(f,{type:"monotone",dataKey:"period1",stroke:"#8884d8",strokeWidth:2,name:"기간 1"}),e.jsx(f,{type:"monotone",dataKey:"period2",stroke:"#82ca9d",strokeWidth:2,name:"기간 2"})]}),i==="delta"&&e.jsx(f,{type:"monotone",dataKey:"delta",stroke:"#ff7300",strokeWidth:2,name:"Delta"}),i==="delta_percentage"&&e.jsx(f,{type:"monotone",dataKey:"delta_percentage",stroke:"#ff7300",strokeWidth:2,name:"Delta %"})]})}),q=()=>e.jsx(x,{width:"100%",height:l?"80vh":o,children:e.jsxs(ge,{data:t,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(g,{fontSize:12}),e.jsx(h,{content:e.jsx(u,{})}),e.jsx(p,{}),i==="mean"&&e.jsxs(e.Fragment,{children:[e.jsx(_,{type:"monotone",dataKey:"period1",stackId:"1",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.6,name:"기간 1"}),e.jsx(_,{type:"monotone",dataKey:"period2",stackId:"2",stroke:"#82ca9d",fill:"#82ca9d",fillOpacity:.6,name:"기간 2"})]}),i==="delta"&&e.jsx(_,{type:"monotone",dataKey:"delta",stroke:"#ff7300",fill:"#ff7300",fillOpacity:.6,name:"Delta"}),i==="delta_percentage"&&e.jsx(_,{type:"monotone",dataKey:"delta_percentage",stroke:"#ff7300",fill:"#ff7300",fillOpacity:.6,name:"Delta %"})]})}),Q=()=>e.jsx(x,{width:"100%",height:l?"80vh":o,children:e.jsxs(pe,{children:[e.jsx(je,{data:A,cx:"50%",cy:"50%",labelLine:!1,label:({name:a,value:s,percent:n})=>`${a}: ${s}개 (${(n*100).toFixed(0)}%)`,outerRadius:l?200:100,fill:"#8884d8",dataKey:"value",children:A.map((a,s)=>e.jsx(K,{fill:a.color},`cell-${s}`))}),e.jsx(h,{}),e.jsx(p,{})]})}),R=()=>{const a=t.map(s=>({peg:s.name.length>10?s.name.substring(0,8)+"...":s.name,period1:Math.min(Math.max(s.period1/Math.max(...t.map(n=>n.period1))*100,0),100),period2:Math.min(Math.max(s.period2/Math.max(...t.map(n=>n.period2))*100,0),100)}));return e.jsx(x,{width:"100%",height:l?"80vh":o,children:e.jsxs(ce,{data:a,children:[e.jsx(me,{}),e.jsx(xe,{dataKey:"peg",fontSize:10}),e.jsx(he,{angle:90,domain:[0,100],fontSize:10,tick:!1}),e.jsx(O,{name:"기간 1",dataKey:"period1",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.3}),e.jsx(O,{name:"기간 2",dataKey:"period2",stroke:"#82ca9d",fill:"#82ca9d",fillOpacity:.3}),e.jsx(p,{}),e.jsx(h,{})]})})},Z=()=>e.jsx(x,{width:"100%",height:l?"80vh":o,children:e.jsxs(oe,{data:t,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(g,{yAxisId:"left",fontSize:12}),e.jsx(g,{yAxisId:"right",orientation:"right",fontSize:12}),e.jsx(h,{content:e.jsx(u,{})}),e.jsx(p,{}),e.jsx(j,{yAxisId:"left",dataKey:"period1",fill:"#8884d8",name:"기간 1"}),e.jsx(j,{yAxisId:"left",dataKey:"period2",fill:"#82ca9d",name:"기간 2"}),e.jsx(f,{yAxisId:"right",type:"monotone",dataKey:"delta_percentage",stroke:"#ff7300",strokeWidth:3,name:"Delta %"})]})}),ee=()=>{switch(C){case"bar":return D();case"line":return U();case"area":return q();case"pie":return Q();case"radar":return R();case"composed":return Z();default:return D()}};return!d||!t.length?e.jsx(F,{className:w,children:e.jsxs(P,{className:"flex flex-col items-center justify-center h-64",children:[e.jsx(y,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"차트 데이터 없음"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"비교 분석을 실행하면 결과를 차트로 볼 수 있습니다"})]})}):e.jsxs(F,{className:`${w} ${l?"fixed inset-4 z-50 bg-white":""}`,children:[e.jsxs(ae,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),E,e.jsxs(k,{variant:"outline",className:"ml-2",children:[t.length,"개 PEG"]})]}),S&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(se,{variant:"ghost",size:"sm",onClick:()=>H(!l),children:l?e.jsx(re,{className:"h-4 w-4"}):e.jsx(ne,{className:"h-4 w-4"})})})]}),S&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"차트 타입"}),e.jsxs(I,{value:C,onValueChange:V,children:[e.jsx(T,{children:e.jsx($,{})}),e.jsx(B,{children:Y.map(a=>{const s=a.icon;return e.jsx(G,{value:a.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s,{className:"h-4 w-4"}),a.label]})},a.value)})})]})]}),!["pie","radar"].includes(C)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"표시 메트릭"}),e.jsxs(I,{value:i,onValueChange:X,children:[e.jsx(T,{children:e.jsx($,{})}),e.jsx(B,{children:J.map(a=>e.jsx(G,{value:a.value,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.label}),e.jsx("div",{className:"text-xs text-muted-foreground",children:a.description})]})},a.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"차트 정보"}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("div",{children:["총 ",t.length,"개 PEG 비교"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"secondary",className:"text-xs",children:["개선: ",t.filter(a=>a.improvement_status==="improved").length]}),e.jsxs(k,{variant:"destructive",className:"text-xs",children:["악화: ",t.filter(a=>a.improvement_status==="degraded").length]})]})]})]})]})]}),e.jsxs(P,{children:[e.jsx("div",{className:"w-full",children:ee()}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsx("div",{className:"text-xs text-muted-foreground space-y-1",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsxs("span",{children:["개선 (",t.filter(a=>a.improvement_status==="improved").length,"개)"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsxs("span",{children:["악화 (",t.filter(a=>a.improvement_status==="degraded").length,"개)"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),e.jsxs("span",{children:["안정 (",t.filter(a=>a.improvement_status==="stable").length,"개)"]})]}),e.jsxs("div",{className:"text-muted-foreground",children:["총 ",t.length,"개 PEG 분석"]})]})})})]})]})};export{Ke as default};

import{r as x,M as e,a3 as _e}from"./vendor-CIPdjx1t.js";import{D as Pe,j as Ee,k as Ae,l as De,i as M,a as Te,T as $e,m as Le,n as G,o as I,C as _,b as K,c as V,d as P,B as z,I as Me,S as H,e as W,f as Y,g as O,h as j}from"./index-Q594mB1I.js";import{S as Ke}from"./scroll-area-ZOOfn5zd.js";import{E as Ve,O as ze,Q as Be,L as Ge,i as te,R as Ie,C as He,j as We,F as Ye,W as Oe,Y as Xe,d as qe}from"./icon-vendor-CWV3Q6sV.js";import{R as ae,B as ne,C as re,X as ie,Y as le,T as ce,a as de,d as X}from"./chart-vendor-CWmmjCk1.js";import"./utils-vendor-DrCDvq1f.js";import"./ui-vendor-C5A5DcrM.js";const ns=({isOpen:b,onClose:oe,resultIds:y=[],mode:q="single"})=>{const[Q,he]=x.useState([]),[me,J]=x.useState(!1),[U,Z]=x.useState(null),[xe,ge]=x.useState("overview"),[f,B]=x.useState(!1);x.useEffect(()=>{const t=a=>{a.key==="F11"?(a.preventDefault(),B(l=>!l)):a.key==="Escape"&&f&&B(!1)};if(b)return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[b,f]);const[N,C]=x.useState(0),[S,ue]=x.useState(10),[E,je]=x.useState(""),[R,fe]=x.useState("all"),[A,ve]=x.useState("all"),w=q==="compare"&&y.length>1;q==="single"&&y.length;const ee=async t=>{J(!0),Z(null);try{console.log("ğŸ“Š ë¶„ì„ ê²°ê³¼ ìƒì„¸ ì •ë³´ ìš”ì²­:",t);const a=t.map(async n=>{try{return{...(await Te.get(`/api/analysis/results/${n}`)).data,id:n}}catch(d){return console.error(`âŒ ê²°ê³¼ ${n} ë¡œë”© ì‹¤íŒ¨:`,d),{id:n,error:d.message||"ë¡œë”© ì‹¤íŒ¨",analysisDate:new Date().toISOString(),neId:"-",cellId:"-",status:"error"}}}),l=await Promise.all(a);he(l),console.log("âœ… ë¶„ì„ ê²°ê³¼ ìƒì„¸ ì •ë³´ ë¡œë”© ì™„ë£Œ:",l)}catch(a){console.error("âŒ ë¶„ì„ ê²°ê³¼ ìƒì„¸ ì •ë³´ ë¡œë”© ì‹¤íŒ¨:",a),Z(a.message||"ë°ì´í„° ë¡œë”©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤"),_e.error("ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")}finally{J(!1)}};x.useEffect(()=>{b&&y.length>0&&ee(y)},[b,y]);const pe=t=>{switch(t==null?void 0:t.toLowerCase()){case"success":return"default";case"error":case"failed":return"destructive";case"warning":return"secondary";case"pending":case"processing":return"outline";default:return"secondary"}},Ne=t=>{try{return new Date(t).toLocaleString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",weekday:"short"})}catch{return t||"-"}},g=x.useMemo(()=>Q.filter(t=>!t.error),[Q]),we=x.useMemo(()=>{var a,l;return w?(((l=(a=g[0])==null?void 0:a.kpiResults)==null?void 0:l.map(n=>n.name))||[]).map(n=>{const d={name:n};return g.forEach((r,o)=>{var h;const m=(h=r.kpiResults)==null?void 0:h.find(i=>i.name===n);d[`ê²°ê³¼${o+1}`]=parseFloat((m==null?void 0:m.value)||0)}),d}):null},[g,w]),ye=x.useMemo(()=>{var se;if(w||!g.length||!g[0].stats)return{kpiResults:[],sortedKpiResults:[],filteredResults:[],dataWithTrends:[],trendFilteredResults:[],totalPages:0,paginatedResults:[],data:[],summaryStats:{improved:0,declined:0,stable:0,avgChange:0,weightedAvgChange:0}};const t=g[0],a=t.stats||[],l={};a.forEach(s=>{const c=s.kpi_name;l[c]||(l[c]={peg_name:c,weight:5}),s.period==="N-1"?l[c]["N-1"]=s.avg:s.period==="N"&&(l[c].N=s.avg)});const n=((se=t.request_params)==null?void 0:se.peg_definitions)||{};Object.keys(l).forEach(s=>{var c;(c=n[s])!=null&&c.weight&&(l[s].weight=n[s].weight)});const d=Object.values(l).filter(s=>s["N-1"]!==void 0&&s.N!==void 0),r=[...d].sort((s,c)=>(c.weight||0)-(s.weight||0)),o=r.filter(s=>{const c=!E||s.peg_name.toLowerCase().includes(E.toLowerCase()),F=s.weight||0;let p=!0;return R==="high"?p=F>=8:R==="medium"?p=F>=6&&F<8:R==="low"&&(p=F<6),c&&p}),m=o.map(s=>{const c=s["N-1"]||0,p=(s.N||0)-c,ke=c!==0?p/c*100:0,Fe=p>0?"up":p<0?"down":"stable";return{...s,change:p,changePercent:ke,trend:Fe}}),h=m.filter(s=>A==="all"?!0:s.trend===A),i=Math.ceil(h.length/S),v=h.slice(N*S,(N+1)*S),u=v.map(s=>({name:s.peg_name,"N-1":s["N-1"]||0,N:s.N||0,change:s.change,changePercent:s.changePercent,trend:s.trend,weight:s.weight,unit:"%",peg:s.weight||0})),D=u.filter(s=>s.trend==="up").length,T=u.filter(s=>s.trend==="down").length,$=u.filter(s=>s.trend==="stable").length,L=u.length>0?u.reduce((s,c)=>s+c.change,0)/u.length:0,k=u.length>0?u.reduce((s,c)=>s+c.change*c.weight,0)/u.reduce((s,c)=>s+c.weight,0):0;return{kpiResults:d,sortedKpiResults:r,filteredResults:o,dataWithTrends:m,trendFilteredResults:h,totalPages:i,paginatedResults:v,data:u,summaryStats:{improved:D,declined:T,stable:$,avgChange:L,weightedAvgChange:k}}},[w,g,E,R,A,N,S]),Ce=()=>{const{kpiResults:t,trendFilteredResults:a,totalPages:l,data:n,summaryStats:d}=ye;return w?e.jsx(ae,{width:"100%",height:400,children:e.jsxs(ne,{data:we,children:[e.jsx(re,{strokeDasharray:"3 3"}),e.jsx(ie,{dataKey:"name"}),e.jsx(le,{}),e.jsx(ce,{}),e.jsx(de,{}),g.map((r,o)=>e.jsx(X,{dataKey:`ê²°ê³¼${o+1}`,fill:`hsl(${o*60}, 70%, 50%)`},`result${o+1}`))]})}):t.length?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:d.improved}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"ê°œì„  ğŸ“ˆ"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-red-600",children:d.declined}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"í•˜ë½ ğŸ“‰"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-600",children:d.stable}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"ì•ˆì • â¡ï¸"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-lg font-bold ${d.avgChange>=0?"text-green-600":"text-red-600"}`,children:[d.avgChange>0?"+":"",d.avgChange.toFixed(2),"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"í‰ê·  ë³€í™”"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-lg font-bold ${d.weightedAvgChange>=0?"text-green-600":"text-red-600"}`,children:[d.weightedAvgChange>0?"+":"",d.weightedAvgChange.toFixed(2),"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"ê°€ì¤‘ í‰ê·  ë³€í™”"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"ğŸ“Š PEGë³„ N-1/N ì„±ëŠ¥ ë¹„êµ (ê°€ì¤‘ì¹˜ ë†’ì€ ìˆœ)"}),e.jsxs(z,{variant:"outline",children:["ì „ì²´ ",t.length,"ê°œ ì¤‘ ",a.length,"ê°œ í‘œì‹œ"]})]}),e.jsxs("div",{className:`grid gap-3 transition-all duration-300 ${f?"grid-cols-1 md:grid-cols-6 lg:grid-cols-8":"grid-cols-1 md:grid-cols-5"}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(We,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(Me,{placeholder:"PEG ì´ë¦„ ê²€ìƒ‰...",value:E,onChange:r=>{je(r.target.value),C(0)},className:"pl-8"})]}),e.jsxs(H,{value:R,onValueChange:r=>{fe(r),C(0)},children:[e.jsxs(W,{children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),e.jsx(Y,{placeholder:"ê°€ì¤‘ì¹˜ í•„í„°"})]}),e.jsxs(O,{children:[e.jsx(j,{value:"all",children:"ì „ì²´"}),e.jsx(j,{value:"high",children:"ë†’ìŒ (â‰¥8)"}),e.jsx(j,{value:"medium",children:"ì¤‘ê°„ (6-7.9)"}),e.jsx(j,{value:"low",children:"ë‚®ìŒ (<6)"})]})]}),e.jsxs(H,{value:A,onValueChange:r=>{ve(r),C(0)},children:[e.jsx(W,{children:e.jsx(Y,{placeholder:"íŠ¸ë Œë“œ í•„í„°"})}),e.jsxs(O,{children:[e.jsx(j,{value:"all",children:"ì „ì²´ íŠ¸ë Œë“œ"}),e.jsx(j,{value:"up",children:"ê°œì„  ğŸ“ˆ"}),e.jsx(j,{value:"down",children:"í•˜ë½ ğŸ“‰"}),e.jsx(j,{value:"stable",children:"ì•ˆì • â¡ï¸"})]})]}),e.jsxs(H,{value:S.toString(),onValueChange:r=>{ue(parseInt(r)),C(0)},children:[e.jsx(W,{children:e.jsx(Y,{placeholder:"í‘œì‹œ ê°œìˆ˜"})}),e.jsxs(O,{children:[e.jsx(j,{value:"5",children:"5ê°œì”©"}),e.jsx(j,{value:"10",children:"10ê°œì”©"}),e.jsx(j,{value:"20",children:"20ê°œì”©"}),e.jsx(j,{value:"50",children:"50ê°œì”©"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(M,{variant:"outline",size:"sm",onClick:()=>C(Math.max(0,N-1)),disabled:N===0,children:e.jsx(Oe,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:[N+1," / ",l||1]}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>C(Math.min(l-1,N+1)),disabled:N>=l-1,children:e.jsx(Xe,{className:"h-4 w-4"})})]})]})]}),e.jsx(ae,{width:"100%",height:f?Math.min(window.innerHeight*.55,900):Math.min(window.innerHeight*.4,500),className:"transition-all duration-300",children:e.jsxs(ne,{data:n,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(re,{strokeDasharray:"3 3"}),e.jsx(ie,{dataKey:"name",angle:-45,textAnchor:"end",height:100,interval:0,fontSize:10}),e.jsx(le,{}),e.jsx(ce,{formatter:(r,o,m)=>[`${r==null?void 0:r.toFixed(2)} ${m.payload.unit}`,o],labelFormatter:r=>{const o=n.find(m=>m.name===r);return`${r} (ê°€ì¤‘ì¹˜: ${(o==null?void 0:o.weight)||0})`},content:({active:r,payload:o,label:m})=>{var u,D,T,$,L;if(!r||!(o!=null&&o.length))return null;const h=(u=o[0])==null?void 0:u.payload;if(!h)return null;const i=k=>{switch(k){case"up":return"ğŸ“ˆ";case"down":return"ğŸ“‰";default:return"â¡ï¸"}},v=k=>{switch(k){case"up":return"text-green-600";case"down":return"text-red-600";default:return"text-gray-600"}};return e.jsxs("div",{className:"bg-white border rounded-lg shadow-lg p-3 min-w-[200px]",children:[e.jsx("div",{className:"font-semibold mb-2",children:m}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-orange-600",children:"N-1 ê¸°ê°„:"}),e.jsxs("span",{className:"font-medium",children:[(D=h["N-1"])==null?void 0:D.toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-600",children:"N ê¸°ê°„:"}),e.jsxs("span",{className:"font-medium",children:[(T=h.N)==null?void 0:T.toFixed(2),"%"]})]}),e.jsxs("div",{className:"border-t pt-1 mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"ì„±ëŠ¥ ë³€í™”:"}),e.jsxs("div",{className:`flex items-center gap-1 font-medium ${v(h.trend)}`,children:[e.jsx("span",{children:i(h.trend)}),e.jsxs("span",{children:[h.change>0?"+":"",($=h.change)==null?void 0:$.toFixed(2),"%"]}),e.jsxs("span",{className:"text-xs",children:["(",h.changePercent>0?"+":"",(L=h.changePercent)==null?void 0:L.toFixed(1),"%)"]})]})]}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{className:"text-gray-600",children:"ê°€ì¤‘ì¹˜:"}),e.jsxs("span",{className:"font-medium",children:[h.weight,"/10"]})]})]})]})]})}}),e.jsx(de,{}),e.jsx(X,{dataKey:"N-1",fill:"#ff7300",name:"N-1 ê¸°ê°„"}),e.jsx(X,{dataKey:"N",fill:"#8884d8",name:"N ê¸°ê°„"})]})})]}):e.jsx("div",{className:"text-center text-muted-foreground",children:"PEG ë¹„êµ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."})},be=t=>{var h;const a=(t==null?void 0:t[0])||{},l=((h=a==null?void 0:a.data)==null?void 0:h.data)||(a==null?void 0:a.data)||a,n=(l==null?void 0:l.analysis)||{},d=n.executive_summary||n.overall_summary||n.comprehensive_summary||"ìš”ì•½ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.",r=Array.isArray(n.diagnostic_findings)&&n.diagnostic_findings.length?n.diagnostic_findings:Array.isArray(n.key_findings)?n.key_findings.map(i=>({primary_hypothesis:String(i)})):[],m=(Array.isArray(n.recommended_actions)?n.recommended_actions:[]).map(i=>i&&typeof i=="object"?i:{priority:"",action:String(i||""),details:""});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(_,{children:[e.jsx(K,{children:e.jsx(V,{children:"ì¢…í•© ë¶„ì„ ìš”ì•½"})}),e.jsx(P,{children:e.jsx("div",{className:"text-sm text-muted-foreground whitespace-pre-line",children:d})})]}),r.length>0&&e.jsxs(_,{children:[e.jsx(K,{children:e.jsx(V,{children:"í•µì‹¬ ê´€ì°° ì‚¬í•­"})}),e.jsx(P,{children:e.jsx("div",{className:"space-y-3",children:r.map((i,v)=>e.jsxs("div",{className:"space-y-1",children:[i.primary_hypothesis&&e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"font-semibold",children:["ê°€ì„¤ ",v+1,":"]})," ",i.primary_hypothesis]}),i.supporting_evidence&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["ì¦ê±°: ",i.supporting_evidence]}),i.confounding_factors_assessment&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["êµë€ ë³€ìˆ˜ í‰ê°€: ",i.confounding_factors_assessment]})]},v))})})]}),m.length>0&&e.jsxs(_,{children:[e.jsx(K,{children:e.jsx(V,{children:"ê¶Œì¥ ì¡°ì¹˜"})}),e.jsx(P,{children:e.jsx("div",{className:"space-y-3",children:m.map((i,v)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5",children:e.jsx(qe,{className:"h-5 w-5 text-green-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[i.priority&&e.jsx(z,{variant:"outline",children:i.priority}),e.jsx("div",{className:"text-sm font-medium",children:i.action||"-"})]}),i.details&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1 whitespace-pre-line",children:i.details})]})]},v))})})]})]})},Se=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:[g.length,"ê°œ ê²°ê³¼ ë¹„êµ"]}),e.jsx("div",{className:"flex gap-2",children:g.map((t,a)=>e.jsxs(z,{variant:"outline",className:"gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`hsl(${a*60}, 70%, 50%)`}}),"ê²°ê³¼ ",a+1]},t.id))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:g.map((t,a)=>e.jsx(_,{className:"border-l-4",style:{borderLeftColor:`hsl(${a*60}, 70%, 50%)`},children:e.jsx(P,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium",children:["ê²°ê³¼ ",a+1]}),e.jsx(z,{variant:pe(t.status),children:t.status})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:Ne(t.analysisDate)}),e.jsxs("div",{className:"text-sm",children:["NE: ",t.neId," | Cell: ",t.cellId]})]})})},t.id))})]}),Re=()=>me?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ge,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..."})]})}):U?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(te,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"ë°ì´í„° ë¡œë”© ì˜¤ë¥˜"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:U}),e.jsxs(M,{onClick:()=>ee(y),variant:"outline",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"ë‹¤ì‹œ ì‹œë„"]})]})}):g.length===0?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(te,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"ë¶„ì„ ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."})]})}):e.jsxs($e,{value:xe,onValueChange:ge,className:"w-full",children:[e.jsxs(Le,{className:"grid w-full grid-cols-3",children:[e.jsx(G,{value:"overview",children:"ê°œìš”"}),e.jsx(G,{value:"kpi",children:"PEG ë¹„êµ ê²°ê³¼"}),e.jsx(G,{value:"recommendations",children:"LLM ë¶„ì„ ë¦¬í¬íŠ¸"})]}),e.jsx(I,{value:"overview",className:"space-y-4 mt-6",children:w?Se():renderSingleOverview(g[0])}),e.jsx(I,{value:"kpi",className:"space-y-4 mt-6",children:e.jsxs(_,{children:[e.jsx(K,{children:e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(He,{className:"h-5 w-5"}),w?"PEG ì„±ëŠ¥ ë¹„êµ ì°¨íŠ¸":"PEG ë¹„êµ ê²°ê³¼ (N-1 vs N)"]})}),e.jsx(P,{children:Ce()})]})}),e.jsx(I,{value:"recommendations",className:"space-y-4 mt-6",children:be(g)})]});return e.jsx(Pe,{open:b,onOpenChange:oe,children:e.jsxs(Ee,{className:`transition-all duration-500 ease-in-out transform ${f?"max-w-[99vw] h-[98vh] w-[99vw] scale-100":"max-w-6xl max-h-[85vh] w-[90vw] scale-100"}`,children:[e.jsx(Ae,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(De,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5"}),w?"ë¶„ì„ ê²°ê³¼ ë¹„êµ":"ë¶„ì„ ê²°ê³¼ ìƒì„¸"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>B(!f),className:"transition-all duration-200 hover:scale-110 hover:bg-accent",title:f?"ì›ë˜ í¬ê¸°ë¡œ (ESC)":"ìµœëŒ€í™” (F11)",children:f?e.jsx(ze,{className:"h-4 w-4"}):e.jsx(Be,{className:"h-4 w-4"})})})]})}),e.jsx(Ke,{className:`transition-all duration-300 ${f?"h-[85vh]":"max-h-[70vh]"}`,children:e.jsx("div",{className:"px-1",children:Re()})})]})})};export{ns as default};

# 프론트엔드 저장 기능 개선 및 사용자별 설정 관리 PRD

## 1. 프로젝트 개요

### 1.1 목적
KPI 대시보드 프론트엔드의 설정 저장 기능을 개선하여 모든 저장 버튼이 정상적으로 작동하고, 사용자별로 독립적인 설정을 관리할 수 있도록 합니다.

### 1.2 배경
- 대시보드 설정 저장 버튼이 동작하지 않음
- 데이터베이스 설정 저장 버튼이 동작하지 않음  
- Statistics 데이터 선택(host->ne->cellid) 저장은 정상 동작
- 현재 user는 default로 저장되고 있어 다중 사용자 환경에서 문제 발생
- 대시보드 설정의 표시할 peg 목록이 드롭다운 방식이 아님

### 1.3 목표
- **기능성**: 모든 저장 버튼이 정상적으로 작동하도록 수정
- **사용자 관리**: 사용자별 독립적인 설정 저장 및 로드 지원
- **UI/UX**: 대시보드 설정의 peg 목록을 드롭다운 방식으로 개선
- **데이터 일관성**: 웹페이지 재접속 시 DB에서 설정 정보 정상 로드

## 2. 기능 요구사항

### 2.1 저장 기능 문제 진단 및 해결

#### 2.1.1 대시보드 설정 저장 기능 수정
- 대시보드 설정 저장 버튼 클릭 시 API 호출 실패 문제 해결
- 저장 성공/실패 피드백 구현
- 설정 데이터 구조 불일치 문제 해결
- 대시보드 설정 저장 API 엔드포인트 구현/수정
- 저장 상태 표시 (로딩, 성공, 실패)
- 설정 데이터 검증 및 변환 로직
- 에러 처리 및 사용자 피드백

#### 2.1.2 데이터베이스 설정 저장 기능 수정
- 데이터베이스 설정 저장 버튼 클릭 시 동작하지 않는 문제 해결
- 설정 데이터 전송 실패 문제 해결
- 백엔드 API 응답 처리 오류 수정
- 데이터베이스 설정 저장 API 엔드포인트 구현/수정
- 설정 데이터 형식 검증
- 저장 성공/실패 상태 관리
- 설정 로드 시 초기값 설정

#### 2.1.3 Statistics 데이터 선택 저장 기능 유지
- host->ne->cellid 선택 저장이 정상 작동하는 기능 분석
- 이 기능의 구현 방식을 다른 저장 기능에 적용
- 기존 코드 패턴 분석 및 재사용

### 2.2 사용자별 설정 관리 시스템

#### 2.2.1 사용자 식별 시스템
- 세션 기반 사용자 ID 생성
- 로컬 스토리지에 사용자 ID 저장
- 사용자별 설정 데이터 분리
- 사용자 ID 형식: "user_${timestamp}_${randomString}"

#### 2.2.2 사용자별 설정 저장 구조
- 데이터베이스 스키마 확장
- 사용자별 독립적인 설정 저장
- 설정 충돌 방지
- 사용자별 데이터 격리
- 설정 공유 기능 (선택적)

### 2.3 UI/UX 개선

#### 2.3.1 대시보드 설정 드롭다운 구현
- 표시할 peg 목록을 기존 텍스트 입력 방식에서 드롭다운으로 변경
- 다중 선택 지원
- 검색 기능 포함
- 선택된 항목 표시

#### 2.3.2 저장 상태 표시 개선
- 로딩 상태 표시
- 성공/실패 메시지
- 저장 진행률 표시
- 자동 저장 기능 (선택적)

## 3. 기술 사양

### 3.1 프론트엔드 기술 스택
- React 18+
- useState, useEffect 훅 사용
- Context API 또는 Redux 상태 관리
- Axios 또는 Fetch API
- LocalStorage 세션 관리

### 3.2 백엔드 API 엔드포인트
- POST /api/user/settings/dashboard
- GET /api/user/settings/dashboard/{userId}
- POST /api/user/settings/database  
- GET /api/user/settings/database/{userId}
- POST /api/user/settings/statistics
- GET /api/user/settings/statistics/{userId}
- POST /api/user/create
- GET /api/user/{userId}/exists
- DELETE /api/user/{userId}/settings

### 3.3 데이터베이스 스키마
- 사용자 설정 테이블 (user_settings)
- 사용자 세션 테이블 (user_sessions)
- PostgreSQL 사용자 설정 테이블
- MongoDB 사용자 세션 컬렉션

## 4. 구현 계획

### Phase 1: 문제 진단 및 분석 (3일)
- 현재 저장 기능 코드 분석
- Statistics 저장 기능 정상 동작 원인 분석
- 대시보드/데이터베이스 설정 저장 실패 원인 파악
- API 엔드포인트 상태 확인
- 프론트엔드-백엔드 통신 로그 분석

### Phase 2: 사용자 관리 시스템 구현 (5일)
- 사용자 ID 생성 및 관리 로직 구현
- 사용자별 설정 저장/로드 API 구현
- 세션 관리 시스템 구현
- 다중 사용자 환경 테스트
- 사용자 설정 데이터베이스 스키마 구현

### Phase 3: 저장 기능 수정 (4일)
- 대시보드 설정 저장 기능 수정
- 데이터베이스 설정 저장 기능 수정
- 저장 상태 표시 UI 구현
- 에러 처리 및 사용자 피드백 개선
- 설정 데이터 검증 로직 구현

### Phase 4: UI/UX 개선 (3일)
- 대시보드 설정 드롭다운 구현
- PEG 목록 드롭다운 컴포넌트 개발
- 저장 버튼 상태 표시 개선
- 반응형 디자인 적용
- 접근성 개선

### Phase 5: 통합 테스트 및 최적화 (3일)
- End-to-End 테스트 시나리오 작성
- 다중 사용자 동시 접속 테스트
- 성능 최적화 및 메모리 누수 검사
- 보안 검토 및 취약점 수정
- 문서화 및 사용자 가이드 작성

## 5. 성공 지표

### 5.1 기능적 지표
- 저장 성공률: 모든 저장 버튼 100% 정상 동작
- 사용자 격리: 사용자별 설정 독립성 100% 보장
- 데이터 지속성: 웹페이지 재접속 시 설정 로드 성공률 100%
- API 응답 시간: 설정 저장/로드 < 2초
- 에러 처리: 저장 실패 시 명확한 에러 메시지 제공

### 5.2 사용자 경험 지표
- UI 응답성: 드롭다운 선택 응답 시간 < 500ms
- 직관성: 사용자가 설정 저장 상태를 명확히 인지
- 일관성: 모든 설정 페이지의 저장 방식 통일
- 접근성: 키보드 네비게이션 및 스크린 리더 지원

### 5.3 기술적 지표
- 코드 품질: 테스트 커버리지 80% 이상
- 성능: 메모리 사용량 증가 < 10%
- 보안: 사용자 데이터 격리 및 보안 검증 통과
- 확장성: 100명 이상 동시 사용자 지원

## 6. 리스크 및 완화 방안

### 6.1 기술적 리스크
- 기존 기능 영향: 수정 과정에서 기존 정상 동작 기능 손상
  - 완화: 단계적 배포, 롤백 계획, 철저한 테스트
- 데이터 마이그레이션: 기존 default 사용자 데이터 처리
  - 완화: 자동 마이그레이션 스크립트, 데이터 백업
- 성능 저하: 사용자별 설정 관리로 인한 성능 영향
  - 완화: 캐싱 전략, 데이터베이스 인덱스 최적화

### 6.2 사용자 경험 리스크
- 설정 손실: 사용자별 설정 전환 시 기존 설정 유실
  - 완화: 설정 백업 및 복구 기능, 사용자 알림
- UI 혼란: 새로운 드롭다운 방식에 대한 사용자 적응
  - 완화: 사용자 가이드, 도움말 툴팁, 점진적 UI 변경

## 7. 테스트 시나리오

### 7.1 저장 기능 테스트
- 대시보드 설정 저장 테스트
- 데이터베이스 설정 저장 테스트
- Statistics 설정 저장 테스트

### 7.2 다중 사용자 테스트
- 사용자별 설정 격리 테스트
- 동시 접속 사용자 처리 테스트
- 설정 충돌 방지 테스트

### 7.3 드롭다운 기능 테스트
- PEG 드롭다운 테스트
- 다중 선택 기능 테스트
- 검색 기능 테스트

## 8. 관련 파일

### 8.1 프론트엔드 파일
- kpi_dashboard/frontend/src/components/Dashboard.jsx
- kpi_dashboard/frontend/src/components/Preference.jsx
- kpi_dashboard/frontend/src/components/Statistics.jsx
- kpi_dashboard/frontend/src/contexts/PreferenceContext.jsx
- kpi_dashboard/frontend/src/hooks/usePreference.js

### 8.2 백엔드 파일
- kpi_dashboard/backend/app/routers/preference.py
- kpi_dashboard/backend/app/models/preference.py
- kpi_dashboard/backend/app/db.py

# KPI 대시보드 프론트엔드 사용자 경험 개선 PRD

<context>
# Overview  
KPI 대시보드 프론트엔드의 사용자 경험을 개선하여 설정 관리의 편의성과 사용성을 향상시킵니다. 현재 사용자들이 겪고 있는 설정 초기화 문제와 복잡한 설정 순서 의존성 문제를 해결하여, 더 직관적이고 사용하기 편한 대시보드를 제공합니다.

# 현재 문제점
- 브라우저 새로고침 또는 재접속 시 저장한 설정이 초기화됨
- PostgreSQL DB 연동 후 PEG와 Statistics 설정 순서에 의존성이 있어 사용자가 혼란스러워함
- 설정 백업/복원 기능은 있지만 전체 설정을 초기화하는 기능이 없음

# Core Features  

## 1. 지속적인 설정 저장 (Persistent Settings)
- **기능**: 사용자의 모든 설정을 브라우저 재접속 후에도 유지
- **중요성**: 사용자가 매번 설정을 다시 입력할 필요가 없어 생산성 향상
- **구현 방식**: LocalStorage + 서버 동기화를 통한 하이브리드 저장 방식

## 2. 설정 순서 의존성 제거 (Order-Independent Configuration)
- **기능**: PEG와 Statistics 설정을 어떤 순서로 저장하든 정상 동작
- **중요성**: 사용자의 혼란을 줄이고 더 유연한 설정 관리 제공
- **구현 방식**: 스마트 검증 시스템과 자동 의존성 해결

## 3. 향상된 백업/복원 시스템 (Enhanced Backup/Restore)
- **기능**: 기존 백업/복원 + 전체 설정 초기화 기능 추가
- **중요성**: 사용자가 설정을 완전히 새로 시작하고 싶을 때 편의성 제공
- **구현 방식**: 확인 대화상자가 포함된 안전한 초기화 기능

# User Experience  

## 사용자 페르소나
- **주 사용자**: 네트워크 엔지니어, 시스템 관리자
- **사용 빈도**: 일일 모니터링 및 주기적 설정 조정
- **기술 수준**: 중급 (기술적 이해도는 있지만 복잡한 UI는 선호하지 않음)

## 핵심 사용자 플로우
1. **설정 지속성 플로우**: 로그인 → 설정 → 재접속 → 설정 유지됨
2. **유연한 설정 플로우**: PostgreSQL 연결 → PEG/Statistics 어느 것부터든 설정 가능
3. **설정 관리 플로우**: 백업 생성 → 설정 변경 → 복원 또는 초기화

## UI/UX 고려사항
- 설정 저장 상태를 명확히 표시 (저장됨/저장 중/오류)
- 설정 순서와 관계없이 직관적인 안내 메시지 제공
- 초기화 기능에 안전장치 (확인 대화상자) 포함
</context>

<PRD>
# Technical Architecture  

## 시스템 컴포넌트
- **프론트엔드**: React 기반 SPA (현재 구조 유지)
- **상태 관리**: Context API + LocalStorage 하이브리드
- **백엔드 API**: 기존 FastAPI 엔드포인트 확장
- **데이터베이스**: PostgreSQL (기존 구조 활용)

## 데이터 모델
```json
{
  "userSettings": {
    "id": "uuid",
    "userId": "string",
    "preferences": {
      "dashboard": { ... },
      "charts": { ... },
      "filters": { ... }
    },
    "pegConfigurations": [...],
    "statisticsConfigurations": [...],
    "lastModified": "timestamp",
    "version": "number"
  }
}
```

## API 확장 요구사항
- `/api/settings/save` - 설정 저장
- `/api/settings/load` - 설정 로드  
- `/api/settings/reset` - 설정 초기화
- `/api/settings/validate` - 설정 검증

## 인프라 요구사항
- LocalStorage 용량 관리 (5MB 제한 고려)
- 오프라인 모드 대응
- 설정 동기화 실패 시 복구 메커니즘

# Development Roadmap  

## Phase 1: 기본 설정 지속성 구현
- LocalStorage 기반 설정 저장 시스템 구축
- 페이지 새로고침 시 설정 복원 기능
- 설정 저장 상태 UI 표시
- 기본적인 오류 처리

## Phase 2: 서버 연동 및 동기화
- 백엔드 설정 저장 API 개발
- 클라이언트-서버 설정 동기화 로직
- 충돌 해결 메커니즘 (로컬 vs 서버 설정)
- 사용자별 설정 관리

## Phase 3: 설정 순서 의존성 제거
- PEG/Statistics 설정 검증 로직 개선
- 스마트 의존성 해결 시스템
- 사용자 친화적 안내 메시지
- 부분 설정 저장 지원

## Phase 4: 향상된 백업/복원 시스템
- 전체 설정 초기화 기능 구현
- 향상된 백업/복원 UI
- 설정 버전 관리
- 안전장치 및 확인 대화상자

# Logical Dependency Chain

## 개발 순서
1. **Foundation (Phase 1)**: LocalStorage 기반 설정 저장
   - 가장 빠르게 사용자에게 보이는 개선사항
   - 다른 기능들의 기반이 되는 핵심 기능

2. **Enhancement (Phase 2)**: 서버 동기화
   - Phase 1의 기능을 확장하여 더 안정적인 저장
   - 멀티 디바이스 지원의 기반

3. **UX Improvement (Phase 3)**: 순서 의존성 제거
   - 사용자 경험 크게 개선
   - 독립적으로 개발 가능하지만 Phase 1-2의 안정성 필요

4. **Final Polish (Phase 4)**: 완전한 설정 관리
   - 모든 기능이 안정화된 후 추가
   - 사용자 요청이 많은 편의 기능

## 각 단계별 MVP 정의
- **Phase 1 MVP**: 새로고침 후 기본 설정 유지
- **Phase 2 MVP**: 재접속 후 모든 설정 유지  
- **Phase 3 MVP**: PEG/Statistics 순서 무관하게 저장 가능
- **Phase 4 MVP**: 원클릭 전체 초기화 기능

# Risks and Mitigations  

## 기술적 도전과제
**리스크**: LocalStorage 용량 제한 및 브라우저 호환성
**완화방안**: 
- 설정 데이터 압축 및 최적화
- IndexedDB 폴백 메커니즘
- 핵심 설정 우선순위 저장

**리스크**: 클라이언트-서버 설정 동기화 충돌
**완화방안**:
- 타임스탬프 기반 충돌 해결
- 사용자 선택 옵션 제공
- 안전한 백업 생성

## MVP 범위 정의
**핵심 MVP**: 
- LocalStorage 기반 설정 저장 (Phase 1)
- 기본적인 PEG/Statistics 순서 독립성 (Phase 3 일부)

**확장 기능**: 
- 서버 동기화 (Phase 2)
- 고급 백업/복원 (Phase 4)

## 자원 제약사항
**리스크**: 기존 시스템에 영향을 줄 수 있는 대규모 변경
**완화방안**:
- 점진적 개발 및 배포
- 기존 기능과의 호환성 유지
- 철저한 테스트 및 롤백 계획

# Appendix  

## 기술 스펙
- **프론트엔드**: React 18+, Context API, LocalStorage API
- **백엔드**: FastAPI, PostgreSQL
- **테스팅**: Jest, React Testing Library, Playwright
- **배포**: Docker, 기존 CI/CD 파이프라인 활용

## 성능 요구사항
- 설정 저장: 100ms 이내
- 설정 로드: 50ms 이내
- 페이지 새로고침 후 복원: 200ms 이내

## 보안 고려사항
- 사용자별 설정 격리
- 설정 데이터 검증
- XSS 방지를 위한 데이터 새니타이징
</PRD>


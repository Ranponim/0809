# 특정 NE/Cell ID/Host 분석 기능 강화 PRD

## 프로젝트 개요

### 목적
기존 analysis_llm.py의 전체 네트워크 분석 기능을 확장하여, 특정 NE(Network Element), Cell ID, Host를 타겟팅한 정밀 분석 기능을 강화하고, MongoDB 저장 및 조회 기능의 견고성을 개선합니다.

### 배경
- 현재 코드는 'ne', 'cellid' 필터링을 지원하지만 'host' 필터링 및 통합 검증 처리가 미흡
- MongoDB 저장 시 ne/cellid/host 메타데이터가 부족하여 효과적인 조회가 어려움
- LLM 분석 시 특정 타겟(NE+Cell+Host 조합)의 컨텍스트가 충분히 반영되지 않음
- 백엔드 API(/api/analysis/results/) 연동에서 다중 필터 처리 개선 필요

### 목표
- 정확성: 특정 NE/Cell/Host 분석의 데이터 신뢰성 99% 이상
- 견고성: 다중 필터 입력 검증 및 에러 처리로 시스템 안정성 확보
- 조회성: MongoDB에서 ne/cellid/host 기반 빠른 검색 지원
- 분석 품질: LLM 분석 결과의 타겟 특화 정확도 향상

## 기능 요구사항

### 입력 검증 및 필터링 강화

#### NE 필터 개선
- NE ID 형식 검증 (예: "nvgnb#10000" 패턴)
- DB에서 실제 존재하는 NE인지 확인
- 복수 NE 처리 시 각각의 유효성 검사
- 잘못된 NE ID에 대한 명확한 에러 메시지

#### Cell ID 필터 개선
- Cell ID 형식 검증 (숫자, 문자열 형식 지원)
- 지정된 NE 하위의 유효한 Cell인지 확인
- NE와 Cell의 연관성 검증
- 존재하지 않는 Cell ID에 대한 상세 에러 정보

#### Host 필터 신규 추가
- Host 식별자 형식 검증 (IP 주소, 호스트명 등)
- DB에서 실제 존재하는 Host인지 확인
- Host와 NE/Cell의 연관성 검증 (물리적/논리적 연결)
- 복수 Host 처리 시 각각의 유효성 검사
- Host별 데이터 수집 범위 및 품질 확인

#### 통합 검증 로직
NE, Cell ID, Host 필터의 유효성을 검증하고 상호 연관성을 확인하는 validate_ne_cell_host_filters() 함수를 구현하여:
- 개별 타겟별 검증 결과
- NE-Cell-Host 관계 매핑
- 커버리지 분석
- 경고 및 에러 정보 제공

### MongoDB 통합 개선

#### 스키마 확장
MongoDB payload 구조를 Host 포함으로 확장:
- target_scope에 host_ids, primary_host 추가
- target_combinations으로 NE-Cell-Host 조합 저장
- filter_metadata에 Host 관련 커버리지 정보 추가
- relationship_coverage로 연관성 매칭 결과 저장

#### 인덱싱 최적화
- Host 포함 복합 인덱스 생성
- target_combinations 배열 인덱싱
- Host 기반 조회 최적화 인덱스

### LLM 분석 품질 향상

#### 타겟 특화 프롬프트 템플릿
특정 NE/Cell/Host 타겟팅 분석용 프롬프트 생성 기능:
- 타겟 NE의 특성 (위치, 용량, 주파수 등)
- Cell의 특성 (섹터, 커버리지, 인접 Cell 등)
- Host의 특성 (하드웨어 사양, 부하 수준, 연결 상태 등)
- NE-Cell-Host 조합별 성능 특성
- 물리적/논리적 인프라 연관성

#### 결과 해석 개선
LLM 분석 결과 구조를 Host 성능 분석 포함으로 확장:
- host_performance: 리소스 사용률, 인프라 상태, 병목 분석
- integration_analysis: NE-Cell 시너지, Host 인프라 영향도
- multi_dimensional_ranking: NE/Cell/Host 개별 및 통합 점수

### API 및 조회 기능 강화

#### POST 엔드포인트 개선
분석 결과 payload의 구조와 내용을 검증하는 기능:
- 필수 필드 존재 확인
- ne/cellid/host 메타데이터 유효성
- stats 데이터 일관성 검사

#### 조회 API 확장
Host 포함 새로운 조회 엔드포인트:
- by-target: ne, cell, host 복합 조회
- host 특화 성능 요약
- 다중 필터 조회 지원
- 조합별 최신 결과 조회

## 기술 사양

### 입력 형식 확장
JSON 입력 포맷에 Host 관련 필드 추가:
- host: 복수 Host 지원 (호스트명, IP 혼용)
- relationship_validation: NE-Cell-Host 연관성 검증 옵션
- host_performance_metrics: Host 성능 메트릭 선택

### 에러 처리 강화
- TargetValidationError: NE/Cell/Host 타겟 검증 실패
- HostValidationError: Host 관련 검증 실패
- handle_multi_target_validation_errors: 복합 검증 실패 처리

### 로깅 및 모니터링
- 다중 타겟 분석 메트릭 로깅
- Host 인프라 영향도 모니터링
- 연관성 검증 결과 추적

## 구현 계획

### Phase 1: 다중 타겟 입력 검증 및 필터링 (1.5주)
- validate_ne_cell_host_filters() 함수 구현
- Host 식별자 형식 검증 로직 (IP 주소, 호스트명)
- NE-Cell-Host 연관성 검증 알고리즘
- DB 연결을 통한 실시간 검증 로직
- 복합 에러 처리 및 사용자 피드백 개선
- 단위 테스트 작성 (Host 검증 포함)

### Phase 2: MongoDB 스키마 및 API 확장 (1.5주)
- target_scope, filter_metadata 필드 Host 지원 추가
- Host 관련 MongoDB 인덱스 최적화
- POST payload 다중 필터 검증 로직 강화
- Host 포함 조회 API 엔드포인트 구현
- 복합 필터 조회 성능 최적화

### Phase 3: LLM 분석 품질 향상 (1.5주)
- Host 포함 타겟 특화 프롬프트 템플릿
- NE/Cell/Host 메타데이터 수집 로직
- Host 성능 메트릭 통합 분석
- 결과 구조 확장 및 검증 (Host 성능 포함)
- 다차원 품질 평가 메트릭 구현

### Phase 4: 통합 테스트 및 최적화 (1주)
- Host 포함 End-to-End 테스트 시나리오
- 다중 필터 성능 벤치마크 및 최적화
- Host 인프라 영향도 모니터링
- 문서화 및 사용자 가이드 (Host 사용법 포함)
- 모니터링 대시보드 구성

## 성공 지표

### 기능적 지표
- 입력 검증 정확도: 잘못된 ne/cellid/host 입력 감지율 100%
- 데이터 일관성: 다중 필터링된 분석 결과의 정확성 99%+
- API 응답 시간: 복합 타겟 분석 요청 처리 < 45초
- 조회 성능: ne/cellid/host 기반 검색 < 800ms
- 연관성 검증 정확도: NE-Cell-Host 관계 검증 정확도 95%+

### 품질 지표
- LLM 분석 관련성: 다중 타겟 특화 인사이트 포함률 90%+
- Host 성능 분석 정확도: Host 리소스 메트릭 분석 정확도 85%+
- 에러 복구율: 복합 필터 입력 오류에 대한 의미있는 에러 메시지 제공
- 사용자 만족도: 다중 타겟 분석 기능 사용성 평가 4.5/5.0+

### 운영 지표
- 시스템 안정성: 다중 타겟 분석 실행 성공률 99.5%+
- MongoDB 저장 성공률: 99.9%+
- 데이터 품질: 저장된 분석 결과의 완결성 검증 (Host 메타데이터 포함)
- Host 인프라 영향도: 분석 중 Host 성능 저하 < 5%

## 리스크 및 완화 방안

### 기술적 리스크
- DB 성능 저하: 복잡한 ne/cellid/host 다중 검증으로 인한 응답 지연
  - 완화: 캐싱 및 인덱스 최적화, 비동기 검증, 배치 검증
- LLM 토큰 사용량 증가: Host 메타데이터 추가로 인한 비용 상승
  - 완화: 프롬프트 최적화 및 토큰 사용량 모니터링, Host 메트릭 선택적 포함
- Host 연결성 이슈: Host 접근 불가 또는 메트릭 수집 실패
  - 완화: 타임아웃 설정, 폴백 메커니즘, 부분 결과 지원

### 운영 리스크
- 기존 기능 영향: 새로운 Host 검증 로직이 기존 분석에 영향
  - 완화: 하위 호환성 유지 및 점진적 배포, Host 필터 선택적 활성화
- 데이터 품질 이슈: 잘못된 다중 필터링으로 인한 분석 결과 왜곡
  - 완화: 다단계 검증 및 결과 검토 프로세스, 연관성 검증 강화
- Host 인프라 과부하: 집중적인 Host 메트릭 수집으로 인한 성능 영향
  - 완화: 수집 빈도 조절, 분산 수집, 리소스 모니터링

## 현재 코드 분석

### 기존 구현 현황
- ne/cellid 처리: line 1461-1477에서 기본 처리 구현됨
- host 필터 부재: 현재 코드에서 host 필터링 미지원
- SQL 필터링: line 443-467에서 WHERE 조건 적용 (host 컬럼 추가 필요)
- payload 구성: line 1707-1721에서 기본 메타데이터 포함 (host 정보 부족)

### 개선 필요 영역
- Host 필터링 로직 신규 구현
- 다중 검증 프로세스 강화
- 에러 처리 체계 개선
- LLM 컨텍스트 Host 정보 반영
- MongoDB 스키마 Host 지원 확장

## 테스트 시나리오

### 기본 테스트
1. 단일 NE/Cell/Host 테스트
2. 복수 다중 타겟 테스트
3. 부분 필터 테스트 (Host만 지정)
4. 에러 케이스 테스트
5. 연관성 검증 테스트 (불일치하는 조합)

### 성능 테스트
- 대용량 필터 처리 성능
- 동시 요청 처리 능력
- MongoDB 조회 성능
- LLM 분석 응답 시간

### 보안 테스트
- 입력 검증 우회 시도
- Host 접근 권한 확인
- 데이터 유출 방지 검증

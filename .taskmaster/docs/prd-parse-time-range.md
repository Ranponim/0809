### PRD: `parse_time_range` 리팩토링 (analysis_llm.py)

#### 목적
- 입력으로 주어지는 시간 범위 문자열을 강건하게 파싱하여 두 시점 `(start_dt, end_dt)`의 timezone-aware `datetime` 튜플을 반환한다.
- 다양한 형식 오류/값 오류/논리 오류/타입 오류를 세분화하여 감지하고, 예외 메시지와 로깅으로 디버깅을 용이하게 한다.
- 기존 기본 동작과 호환: 단일 날짜 입력 시 해당 날짜의 00:00:00 ~ 23:59:59으로 확장.

#### 범위
- 대상 함수: `analysis_llm.py`의 `parse_time_range(range_text: str) -> Tuple[datetime, datetime]`
- 시간대: 환경변수 `DEFAULT_TZ_OFFSET`(예: `+09:00`)을 우선 사용해 timezone-aware `datetime`을 반환

---

### 기능 요구사항

#### 1) 지원 입력 형식 (정상 케이스)
- 범위 입력(권장, 엄격 포맷)
  - `YYYY-MM-DD_HH:MM~YYYY-MM-DD_HH:MM`
  - 예: `2025-08-08_15:00~2025-08-08_19:00`
  - 공백은 양 끝과 구분자 전후에 한해 무시: `2025-08-08_15:00 ~ 2025-08-08_19:00` 허용

- 단일 날짜 입력(당일 전체로 확장)
  - `YYYY-MM-DD`
  - 예: `2025-08-08` → `(2025-08-08 00:00:00, 2025-08-08 23:59:59)`

#### 2) 시간대(tz) 처리
- `DEFAULT_TZ_OFFSET`에서 오프셋을 파싱하여 tzinfo 부여(예: `+09:00`).
- 파싱 실패 시 UTC로 폴백.

#### 3) 리턴 조건
- 항상 timezone-aware `datetime` 두 개를 반환.
- `start_dt < end_dt`를 만족해야 하며, 동일하거나 역전 시 예외.

---

### 오류 분류 및 처리 정책

공통: 모든 오류는 한국어 메시지, 세분화된 코드, 상세 컨텍스트를 포함해 `ValueError`(또는 하위 예외)로 발생시키고, 로깅(LEVEL=ERROR/INFO)을 남긴다.

오류 카테고리와 대표 메시지/코드/예시는 아래와 같다.

#### A. 형식 오류 (Format Errors) → 코드: `FORMAT_ERROR`
- 구분자 `~` 없음 또는 중복
  - 입력: `2025-08-08_15:002025-08-08_19:00`
  - 처리: 에러. 메시지에 "범위 구분자 '~'가 없거나 잘못되었습니다" 포함.

- 다른 범위 구분자 사용 (`-` 등)
  - 입력: `2025-08-08_15:00-2025-08-08_19:00`
  - 처리: 에러. 메시지에 "범위 구분자는 '~'만 허용" 안내.

- 날짜/시간 구분자 `_` 오류
  - 입력: `2025-08-08 15:00~2025-08-08_19:00`
  - 처리: 에러. "날짜와 시간은 '_'로 구분해야 합니다".

- 날짜 구분자 `-` 오류
  - 입력: `2025/08/08_15:00~2025-08-08_19:00`
  - 처리: 에러. "날짜는 'YYYY-MM-DD' 형식이어야 합니다".

- 시간 구분자 `:` 오류
  - 입력: `2025-08-08_15-00~2025-08-08_19:00`
  - 처리: 에러. "시간은 'HH:MM' 형식이어야 합니다".

- 구성 요소 누락(좌/우 한쪽이 없음)
  - 입력: `2025-08-08_15:00~`
  - 처리: 에러. "시작/종료 시각이 모두 필요합니다".

- 불필요한 공백 포함
  - 입력: `2025-08-08_15:00 ~ 2025-08-08_19:00`
  - 처리: 허용(트리밍). 단, 내부 형식은 엄격 검증.

- 잘못된 자릿수
  - 입력: `2025-8-8_15:0~2025-08-08_19:00`
  - 처리: 에러. "자릿수가 올바르지 않습니다 (YYYY-MM-DD_HH:MM)".

#### B. 값의 유효성 오류 (Value Errors) → 코드: `VALUE_ERROR`
- 존재하지 않는 월
  - 입력: `2025-13-08_15:00~2025-08-08_19:00`
  - 처리: 에러. "유효하지 않은 월입니다(1-12)".

- 존재하지 않는 일
  - 입력: `2025-02-30_15:00~2025-08-08_19:00`
  - 처리: 에러. "유효하지 않은 일입니다".

- 유효하지 않은 시간(24시 이상)
  - 입력: `2025-08-08_25:00~2025-08-08_19:00`
  - 처리: 에러. "시(hour)는 00-23 범위여야 합니다".

- 유효하지 않은 분(60분 이상)
  - 입력: `2025-08-08_15:70~2025-08-08_19:00`
  - 처리: 에러. "분(minute)은 00-59 범위여야 합니다".

#### C. 논리적 오류 (Logical Errors) → 코드: `LOGIC_ERROR`
- 시작 시간이 종료 시간보다 늦음
  - 입력: `2025-08-08_19:00~2025-08-08_15:00`
  - 처리: 에러. "시작 시각은 종료 시각보다 빠르거나 같아야 합니다" (같음은 아래 참조).

- 시작과 종료 시간이 동일함
  - 입력: `2025-08-08_15:00~2025-08-08_15:00`
  - 처리: 에러. "동일한 시각 범위는 허용되지 않습니다".

#### D. 데이터 타입 및 기타 (Data Type & Others)
- 문자열이 아닌 타입 입력 → 코드: `TYPE_ERROR`
  - 입력: `None`, `12345`, `[ ... ]`
  - 처리: `TypeError` 발생. "입력은 문자열(str)이어야 합니다".

- 빈 문자열 입력 → 코드: `FORMAT_ERROR`
  - 입력: `""`
  - 처리: 에러. "빈 문자열은 허용되지 않습니다".

---

### 로깅 & 예외 정책
- 모든 주요 단계에 INFO 로그: 입력 수신, 전처리(트리밍), 구분자 분리, 각 토큰 파싱, tz 부여, 결과 요약.
- 오류 발생 시 ERROR 로그 + 예외 raise. 메시지에는 다음 포함:
  - `code`: `FORMAT_ERROR|VALUE_ERROR|LOGIC_ERROR|TYPE_ERROR`
  - `message`: 한국어 설명
  - `input`: 원본 입력(민감정보 없음)
  - `hint`: 교정 예시(가능 시)

예시 메시지(JSON):
```json
{
  "code": "FORMAT_ERROR",
  "message": "범위 구분자 '~'가 없거나 잘못되었습니다",
  "input": "2025-08-08_15:002025-08-08_19:00",
  "hint": "예: 2025-08-08_15:00~2025-08-08_19:00"
}
```

---

### 비기능 요구사항
- 성능: 단일 파싱 작업은 1ms 수준(평균) 목표. 정규식/표준 파서 사용을 권장.
- 보안: 입력 문자열 외 외부 자원 접근 금지.
- 일관성: 반환값은 항상 tz-aware.

---

### 테스트 전략 (필수 케이스)
- 정상
  - `2025-08-08_15:00~2025-08-08_19:00` → OK
  - ` 2025-08-08_15:00 ~ 2025-08-08_19:00 ` → OK (트리밍)
  - `2025-08-08` → `(00:00:00, 23:59:59)`

- 형식 오류(각 1건 이상)
  - 구분자 없음/중복, 다른 구분자, `_`/`-`/`:` 오류, 누락, 잘못된 자릿수, 빈 문자열

- 값 오류(각 1건 이상)
  - 잘못된 월/일/시간/분

- 논리 오류(각 1건 이상)
  - 시작>종료, 시작=종료

- 타입 오류(각 1건 이상)
  - `None`, 숫자, 리스트

각 테스트는 예외 코드와 메시지를 단언하고, tz 부여 여부를 검증.

---

### 산출물
- 구현: `analysis_llm.py` 내 `parse_time_range` 리팩토링
- 단위테스트: 신규 테스트 파일 추가(예: `tests/test_parse_time_range.py`) 또는 기존 테스트 스위트에 케이스 추가
- 로깅: 기존 로깅 포맷 준수

---

### 완료 기준 (Definition of Done)
- 모든 명시 테스트 케이스 통과 (정상/오류 분류 포함)
- 반환값 tz-aware 보장, `DEFAULT_TZ_OFFSET` 존중
- 상세 로깅 및 한국어 예외 메시지/코드 제공
- 기존 호출 지점에서 호환(서명 및 기본 동작 유지)


